{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\admin\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\order\\\\OrderApproval.js\";\nimport React, { Component } from \"react\";\nimport { db } from \"../../../../firebase\";\nimport { collection, getDocs, updateDoc, doc, getDoc, query, where } from \"firebase/firestore\";\nimport html2canvas from \"html2canvas\";\nimport { jsPDF } from \"jspdf\";\nimport { toWords } from \"number-to-words\";\n\nclass OrderApproval extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      orders: [],\n      customers: [],\n      products: [],\n      taxGroups: [],\n      selectedOrder: null,\n      previewMode: false,\n      loading: false,\n      error: null,\n      showRejectDialog: false,\n      showEditForm: false,\n      editFormData: null,\n      rejectReason: \"\"\n    };\n\n    this.fetchOrders = async () => {\n      this.setState({\n        loading: true,\n        error: null\n      });\n\n      try {\n        const snap = await getDocs(collection(db, \"orders\"));\n        const orders = snap.docs.map(d => ({\n          id: d.id,\n          ...d.data()\n        }));\n        orders.sort((a, b) => {\n          var _a$createdAt, _a$createdAt$toDate, _b$createdAt, _b$createdAt$toDate;\n\n          const dateA = new Date(a.quoteDate || ((_a$createdAt = a.createdAt) === null || _a$createdAt === void 0 ? void 0 : (_a$createdAt$toDate = _a$createdAt.toDate) === null || _a$createdAt$toDate === void 0 ? void 0 : _a$createdAt$toDate.call(_a$createdAt)) || a.createdAt || 0);\n          const dateB = new Date(b.quoteDate || ((_b$createdAt = b.createdAt) === null || _b$createdAt === void 0 ? void 0 : (_b$createdAt$toDate = _b$createdAt.toDate) === null || _b$createdAt$toDate === void 0 ? void 0 : _b$createdAt$toDate.call(_b$createdAt)) || b.createdAt || 0);\n          return dateB - dateA;\n        });\n        this.setState({\n          orders,\n          loading: false\n        });\n        console.log(\"Fetched orders ids:\", orders.map(o => o.id));\n      } catch (err) {\n        this.setState({\n          error: err.message,\n          loading: false\n        });\n      }\n    };\n\n    this.openEditForm = order => {\n      this.setState({\n        showEditForm: true,\n        editFormData: { ...order\n        }\n      });\n    };\n\n    this.closeEditForm = () => {\n      this.setState({\n        showEditForm: false,\n        editFormData: null\n      });\n    };\n\n    this.handleEditInputChange = (field, value) => {\n      this.setState(prev => ({\n        editFormData: { ...prev.editFormData,\n          [field]: value\n        }\n      }));\n    };\n\n    this.handleEditLineItemChange = (idx, field, value) => {\n      const items = [...this.state.editFormData.lineItems];\n      items[idx] = { ...items[idx],\n        [field]: value\n      };\n      this.setState(prev => ({\n        editFormData: { ...prev.editFormData,\n          lineItems: items\n        }\n      }), this.recalculateEditTotals);\n    };\n\n    this.recalculateEditTotals = () => {\n      const {\n        lineItems,\n        discountPercent\n      } = this.state.editFormData;\n      let orderValue = 0;\n      let taxAmount = 0;\n      (lineItems || []).forEach(item => {\n        const qty = parseFloat(item.qty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const baseTotal = qty * unitPrice;\n        const taxAmt = parseFloat(item.taxAmt || 0);\n        orderValue += baseTotal + taxAmt;\n        taxAmount += taxAmt;\n      });\n      const discountAmount = orderValue * parseFloat(discountPercent || 0) / 100;\n      const afterDiscountValue = orderValue - discountAmount;\n      this.setState(prev => ({\n        editFormData: { ...prev.editFormData,\n          orderValue: orderValue.toFixed(2),\n          taxAmount: taxAmount.toFixed(2),\n          discountAmount: discountAmount.toFixed(2),\n          afterDiscountValue: afterDiscountValue.toFixed(2)\n        }\n      }));\n    };\n\n    this.handleEditSubmit = async e => {\n      e.preventDefault();\n      const {\n        editFormData\n      } = this.state;\n      if (!editFormData) return alert(\"No data to save\");\n      if (!editFormData.customer) return alert(\"Customer is required\");\n      if (!editFormData.lineItems || editFormData.lineItems.length === 0) return alert(\"At least one line item is required\");\n      if (!editFormData.id) return alert(\"Order ID missing – cannot update!\");\n\n      try {\n        const ref = doc(db, \"orders\", editFormData.id);\n        const snap = await getDoc(ref);\n\n        if (!snap.exists()) {\n          return alert(`Order not found: ${editFormData.id}`);\n        }\n\n        await updateDoc(ref, editFormData);\n        alert(\"Order updated!\");\n        this.setState({\n          showEditForm: false,\n          editFormData: null\n        });\n        this.fetchOrders();\n      } catch (err) {\n        console.error(\"handleEditSubmit error:\", err);\n        alert(\"Error updating order: \" + err.message);\n      }\n    };\n\n    this.fetchCustomers = async () => {\n      const snap = await getDocs(collection(db, \"customers\"));\n      const customers = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        customers\n      });\n    };\n\n    this.fetchProducts = async () => {\n      const snap = await getDocs(collection(db, \"products\"));\n      const products = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        products\n      });\n    };\n\n    this.fetchTaxGroups = async () => {\n      const snap = await getDocs(collection(db, \"taxGroups\"));\n      const taxGroups = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        taxGroups\n      });\n    };\n\n    this.openPreview = order => {\n      console.log(\"openPreview order:\", order);\n      this.setState({\n        selectedOrder: order,\n        previewMode: true\n      });\n    };\n\n    this.closePreview = () => {\n      this.setState({\n        selectedOrder: null,\n        previewMode: false\n      });\n    };\n\n    this.updateStatus = async (id, status, rejectReason = \"\") => {\n      console.log(\"updateStatus called:\", {\n        id,\n        status,\n        rejectReason\n      });\n      if (!id) return alert(\"Missing order id — cannot update\");\n      this.setState({\n        loading: true,\n        error: null\n      });\n\n      try {\n        const ref = doc(db, \"orders\", id);\n        const snap = await getDoc(ref);\n\n        if (!snap.exists()) {\n          const q = query(collection(db, \"orders\"), where(\"orderNo\", \"==\", id));\n          const found = await getDocs(q);\n\n          if (!found.empty) {\n            const realId = found.docs[0].id;\n            console.log(\"Found by orderNo, using id:\", realId);\n            await updateDoc(doc(db, \"orders\", realId), {\n              status,\n              rejectReason\n            });\n          } else {\n            this.setState({\n              loading: false\n            });\n            return alert(`No order found with id or orderNo \"${id}\".`);\n          }\n        } else {\n          await updateDoc(ref, {\n            status,\n            rejectReason\n          });\n        }\n\n        alert(`Order ${status}`);\n        await this.fetchOrders();\n        this.setState({\n          selectedOrder: null,\n          previewMode: false,\n          showRejectDialog: false,\n          rejectReason: \"\",\n          loading: false\n        });\n      } catch (err) {\n        console.error(\"updateStatus error:\", err);\n        this.setState({\n          error: err.message,\n          loading: false\n        });\n        alert(\"Error updating status: \" + err.message);\n      }\n    };\n\n    this.openRejectDialog = () => {\n      this.setState({\n        showRejectDialog: true,\n        rejectReason: \"\"\n      });\n    };\n\n    this.closeRejectDialog = () => {\n      this.setState({\n        showRejectDialog: false,\n        rejectReason: \"\"\n      });\n    };\n\n    this.handleRejectReasonChange = e => {\n      this.setState({\n        rejectReason: e.target.value\n      });\n    };\n\n    this.handleRejectConfirm = () => {\n      const {\n        selectedOrder,\n        rejectReason\n      } = this.state;\n\n      if (!rejectReason.trim()) {\n        alert(\"Please enter a reason for rejection.\");\n        return;\n      }\n\n      this.updateStatus(selectedOrder.id, \"Rejected\", rejectReason);\n    };\n\n    this.showOrderPDFWithOrg = async order => {\n      var _orgSnap$docs$, _order$billTo, _order$shipTo;\n\n      if (!order || !Array.isArray(order.lineItems) || order.lineItems.length === 0) {\n        alert(\"Order data is incomplete.\");\n        return;\n      } // 1. Fetch org and customer data\n\n\n      const orgSnap = await getDocs(collection(db, 'businessGroups'));\n      const org = ((_orgSnap$docs$ = orgSnap.docs[0]) === null || _orgSnap$docs$ === void 0 ? void 0 : _orgSnap$docs$.data()) || {};\n      const customer = this.state.customers.find(c => c.custshortName === order.customer || c.custname === order.customer) || {}; // GST State Map for Place of Supply\n\n      const gstStateMap = {\n        \"01\": \"Jammu & Kashmir\",\n        \"02\": \"Himachal Pradesh\",\n        \"03\": \"Punjab\",\n        \"04\": \"Chandigarh\",\n        \"05\": \"Uttarakhand\",\n        \"06\": \"Haryana\",\n        \"07\": \"Delhi\",\n        \"08\": \"Rajasthan\",\n        \"09\": \"Uttar Pradesh\",\n        \"10\": \"Bihar\",\n        \"11\": \"Sikkim\",\n        \"12\": \"Arunachal Pradesh\",\n        \"13\": \"Nagaland\",\n        \"14\": \"Manipur\",\n        \"15\": \"Mizoram\",\n        \"16\": \"Tripura\",\n        \"17\": \"Meghalaya\",\n        \"18\": \"Assam\",\n        \"19\": \"West Bengal\",\n        \"20\": \"Jharkhand\",\n        \"21\": \"Odisha\",\n        \"22\": \"Chhattisgarh\",\n        \"23\": \"Madhya Pradesh\",\n        \"24\": \"Gujarat\",\n        \"25\": \"Daman and Diu\",\n        \"26\": \"Dadra and Nagar Haveli\",\n        \"27\": \"Maharashtra\",\n        \"28\": \"Andhra Pradesh (Old)\",\n        \"29\": \"Karnataka\",\n        \"30\": \"Goa\",\n        \"31\": \"Lakshadweep\",\n        \"32\": \"Kerala\",\n        \"33\": \"Tamil Nadu\",\n        \"34\": \"Puducherry\",\n        \"35\": \"Andaman and Nicobar Islands\",\n        \"36\": \"Telangana\",\n        \"37\": \"Andhra Pradesh\",\n        \"97\": \"Other Territory\"\n      };\n\n      const getPlaceOfSupply = gstin => {\n        if (!gstin || gstin.length < 2) return '';\n        const code = gstin.substring(0, 2);\n        const state = gstStateMap[code];\n        return state ? `${code} - ${state}` : '';\n      }; // 2. Enrich line items\n\n\n      const enrichedItems = order.lineItems.map(item => {\n        const product = this.state.products.find(p => p.productId === item.itemCode) || {};\n        return { ...item,\n          ptshortName: product.ptshortName || '',\n          hsnCode: product.hsnCode || '',\n          uom: product.stockingUOM || '',\n          cgst: item.cgst || 0,\n          sgst: item.sgst || 0,\n          igst: item.igst || 0,\n          taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\n        };\n      }); // 3. Subtotal (without tax)\n\n      const subtotal = enrichedItems.reduce((sum, item) => sum + (parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0), 0);\n      const freightCharges = parseFloat(order.freightCharges || 0);\n      const freightTax = parseFloat(order.freighttaxAmount || 0);\n      const totalTaxAmount = parseFloat(order.taxAmount || 0);\n      const grandTotal = parseFloat(order.orderValue || subtotal + totalTaxAmount);\n      const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`; // 4. Tax breakdown by group\n\n      let taxBreakdown = {};\n      let taxGroupDetails = [];\n      let sno = 1;\n      enrichedItems.forEach(item => {\n        const qty = parseFloat(item.qty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const base = qty * unitPrice;\n        (item.taxGroupNames || []).forEach(tgName => {\n          const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\n\n          if (group) {\n            group.lineItems.forEach(li => {\n              const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\n              let taxAmt = 0;\n              if (li.type === 'Amount') taxAmt = parseFloat(li.percentOrAmt || 0);else taxAmt = base * parseFloat(li.percentOrAmt || 0) / 100;\n              taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n              taxGroupDetails.push({\n                sno: sno++,\n                group: tgName,\n                peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\n                taxAmt: taxAmt.toFixed(2)\n              });\n            });\n          }\n        }); // Legacy support for cgst/sgst/igst\n\n        if (item.cgst) {\n          const key = `CGST ${item.cgst}%`;\n          const taxAmt = base * item.cgst / 100;\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n          taxGroupDetails.push({\n            sno: sno++,\n            group: key,\n            peramt: `${item.cgst}%`,\n            taxAmt: taxAmt.toFixed(2)\n          });\n        }\n\n        if (item.sgst) {\n          const key = `SGST ${item.sgst}%`;\n          const taxAmt = base * item.sgst / 100;\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n          taxGroupDetails.push({\n            sno: sno++,\n            group: key,\n            peramt: `${item.sgst}%`,\n            taxAmt: taxAmt.toFixed(2)\n          });\n        }\n\n        if (item.igst) {\n          const key = `IGST ${item.igst}%`;\n          const taxAmt = base * item.igst / 100;\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n          taxGroupDetails.push({\n            sno: sno++,\n            group: key,\n            peramt: `${item.igst}%`,\n            taxAmt: taxAmt.toFixed(2)\n          });\n        }\n      });\n\n      if (freightTax > 0) {\n        taxBreakdown[\"Freight Tax\"] = freightTax;\n        taxGroupDetails.push({\n          sno: sno++,\n          group: \"Freight Tax\",\n          peramt: \"-\",\n          taxAmt: freightTax.toFixed(2)\n        });\n      } // 5. Build HTML for PDF\n\n\n      const container = document.createElement('div');\n      container.id = 'pdf-preview-container';\n      container.style.width = '794px';\n      container.style.padding = '40px';\n      container.style.fontFamily = 'Arial';\n      container.innerHTML = `\n      <div style=\"display:flex; justify-content:space-between; align-items:center;\">\n        <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\n        <div style=\"font-size:18px; font-weight:bold;\">CUSTOMER ORDER</div>\n      </div>\n      <hr/>\n      <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\n        <div style=\"line-height:1.5; width:50%;\">\n          <b>${org.bgName || ''}</b><br/>\n          ${org.address || ''}<br/>\n          <b>Email:</b> ${org.email || ''}<br/>\n          <b>Website:</b> ${org.website || ''}<br/>\n          <b>GSTIN:</b> ${org.gstin || ''}<br/>\n          <b>Mobile:</b> ${org.mobile || ''}<br/>\n          <b>CIN:</b> ${org.cin || ''}\n        </div>\n        <table style=\"font-size:11px; text-align:left;\">\n          <tr><td><b>Order No</b></td><td>: ${order.orderNo}</td></tr>\n          <tr><td><b>Order Date</b></td><td>: ${order.orderDate}</td></tr>\n          <tr><td><b>Currency</b></td><td>: ${order.currency || 'INR'}</td></tr>\n          <tr><td><b>Despatch</b></td><td>: ${order.despatchMode || ''}</td></tr>\n        </table>\n      </div>\n\n      <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\n        <div style=\"width:48%;\">\n          <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\n          <div style=\"border:1px solid #ccc; padding:6px;\">\n           <b>${order.customer || ''}</b><br/>\n            ${((_order$billTo = order.billTo) === null || _order$billTo === void 0 ? void 0 : _order$billTo.replace(/\\n/g, '<br/>')) || ''}\n          </div>\n          <div style=\"font-size:10px; margin-top:6px;\">\n              <b>GSTIN:</b> ${customer.gstin || ''}<br/>\n              <b>Email:</b> ${customer.email || ''}<br/>\n              <b>Contact:</b> ${customer.contactPerson || ''}<br/>\n              <b>Phone:</b> ${customer.phone || ''}\n          </div>\n        </div>\n        <div style=\"width:48%;\">\n          <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\n          <div style=\"border:1px solid #ccc; padding:6px;\">\n           <b>${order.customer || ''}</b><br/>\n            ${((_order$shipTo = order.shipTo) === null || _order$shipTo === void 0 ? void 0 : _order$shipTo.replace(/\\n/g, '<br/>')) || ''}\n          </div>\n          <div style=\"font-size:10px; margin-top:6px;\">\n            <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\n          </div>\n        </div>\n      </div>\n\n      <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\n        <thead>\n          <tr style=\"background:#f4f6fa;\">\n            <th style=\"border:1px solid #011b56;\">Item Code</th>\n            <th style=\"border:1px solid #011b56;\">Description</th>\n            <th style=\"border:1px solid #011b56;\">HSN</th>\n            <th style=\"border:1px solid #011b56;\">UOM</th>\n            <th style=\"border:1px solid #011b56;\">Qty</th>\n            <th style=\"border:1px solid #011b56;\">Unit Price</th>\n            <th style=\"border:1px solid #011b56;\">GST%</th>\n            <th style=\"border:1px solid #011b56;\">Item Total</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${enrichedItems.map(item => {\n        const gstLabel = item.taxGroupNames && item.taxGroupNames.length ? item.taxGroupNames.join(', ') : item.taxGroupName || item.taxId || '-';\n        return `\n              <tr>\n                <td style=\"border:1px solid #011b56;\">${item.itemCode}</td>\n                <td style=\"border:1px solid #011b56;\">${item.itemDescription}</td>\n                <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\n                <td style=\"border:1px solid #011b56;\">${item.uom}</td>\n                <td style=\"border:1px solid #011b56;\">${item.qty}</td>\n                <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\n                <td style=\"border:1px solid #011b56;\">${gstLabel}</td>\n                <td style=\"border:1px solid #011b56;\">${item.total}</td>\n              </tr>`;\n      }).join('')}\n          <tr>\n            <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\n            <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\n        </tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Grand Total</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${grandTotal.toFixed(2)}</b></td>\n        </tr>\n        </tbody>\n      </table>\n      <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\n      <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\n    `;\n      document.body.appendChild(container);\n      const canvas = await html2canvas(container, {\n        scale: 2,\n        useCORS: true\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF('p', 'pt', 'a4');\n      const width = 595.28;\n      const height = canvas.height * width / canvas.width;\n      pdf.addImage(imgData, 'PNG', 0, 0, width, height);\n      document.body.removeChild(container);\n      pdf.setFontSize(11);\n      pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\n      pdf.text('Authorized Signatory', width - 200, 800);\n      const blob = pdf.output('blob');\n      const url = URL.createObjectURL(blob);\n      const newWin = window.open();\n      newWin.document.write(`\n      <html><head><title>Order PDF Preview</title></head>\n      <body style=\"margin:0;\">\n        <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\n      </body></html>\n    `);\n      newWin.document.close();\n    };\n\n    this.renderRejectDialog = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay-content\",\n      style: {\n        width: 400\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 9\n      }\n    }, \"Reject Reason\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control\",\n      rows: 3,\n      value: this.state.rejectReason,\n      onChange: this.handleRejectReasonChange,\n      placeholder: \"Enter reason for rejection\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"text-right mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 476,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-secondary mr-2\",\n      onClick: this.closeRejectDialog,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 477,\n        columnNumber: 11\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-danger\",\n      onClick: this.handleRejectConfirm,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 11\n      }\n    }, \"Reject\"))));\n\n    this.renderOrderTable = () => {\n      // Apply sorting here\n      const sortedOrders = [...this.state.orders].sort((a, b) => {\n        // Approved at bottom, new at top\n        if (a.status === \"Approved\" && b.status !== \"Approved\") return 1;\n        if (b.status === \"Approved\" && a.status !== \"Approved\") return -1; // Newest first by created date or orderNo\n\n        const aDate = new Date(a.createdAt || a.orderDate || 0);\n        const bDate = new Date(b.createdAt || b.orderDate || 0);\n        return bDate - aDate; // latest first\n      });\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 full-height\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card-body\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 499,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 500,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 501,\n          columnNumber: 11\n        }\n      }, \"Order Approval\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"table-responsive\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 503,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-hover\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 504,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 505,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 17\n        }\n      }, \"Order No\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 508,\n          columnNumber: 17\n        }\n      }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 509,\n          columnNumber: 17\n        }\n      }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 510,\n          columnNumber: 17\n        }\n      }, \"Ref No\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 511,\n          columnNumber: 17\n        }\n      }, \"Order Value\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 512,\n          columnNumber: 17\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 513,\n          columnNumber: 17\n        }\n      }, \"Reject Reason\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 514,\n          columnNumber: 17\n        }\n      }, \"Print\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 517,\n          columnNumber: 13\n        }\n      }, this.state.orders.map((o, i) => {\n        let statusClass = \"badge-secondary\";\n        if (o.status === \"Entered\") statusClass = \"badge-warning\";else if (o.status === \"Approved\") statusClass = \"badge-success\";else if (o.status === \"Rejected\") statusClass = \"badge-danger\";else if (o.status === \"CO Created\") statusClass = \"badge-info\";else if (o.status === \"Awaiting for Approval\") statusClass = \"badge-warning\";\n        return /*#__PURE__*/React.createElement(\"tr\", {\n          key: i,\n          style: {\n            fontSize: '14px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 527,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 528,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(\"button\", {\n          className: \"btn btn-link p-0\",\n          onClick: () => this.openPreview(o),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 529,\n            columnNumber: 23\n          }\n        }, o.orderNo)), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 536,\n            columnNumber: 21\n          }\n        }, o.customer), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 537,\n            columnNumber: 21\n          }\n        }, o.orderDate), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 538,\n            columnNumber: 21\n          }\n        }, o.qRefNo), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 539,\n            columnNumber: 21\n          }\n        }, o.orderValue), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 540,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(\"label\", {\n          className: `badge ${statusClass}`,\n          style: {\n            fontSize: '14px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 541,\n            columnNumber: 23\n          }\n        }, o.status)), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 545,\n            columnNumber: 21\n          }\n        }, o.rejectReason || \"-\"), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 546,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(\"i\", {\n          className: \"mdi mdi-printer menu-icon\",\n          onClick: () => this.showOrderPDFWithOrg(o),\n          style: {\n            fontSize: '24px',\n            color: '#2196F3',\n            cursor: 'pointer'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 547,\n            columnNumber: 23\n          }\n        })));\n      }), this.state.orders.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 557,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: \"7\",\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 557,\n          columnNumber: 21\n        }\n      }, \"No orders found.\")))))));\n    };\n\n    this.renderEditForm = () => {\n      var _editFormData$lineIte;\n\n      const {\n        editFormData,\n        customers,\n        products,\n        taxGroups\n      } = this.state;\n      if (!editFormData) return null;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 p-4 shadow-sm full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 573,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 574,\n          columnNumber: 7\n        }\n      }, \"Edit Order - \", editFormData.orderNo), /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: this.handleEditSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 575,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 576,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 577,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 578,\n          columnNumber: 13\n        }\n      }, \"Order No\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: editFormData.orderNo,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 579,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 586,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 587,\n          columnNumber: 13\n        }\n      }, \"Order Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control\",\n        value: editFormData.orderDate,\n        onChange: e => this.handleEditInputChange(\"orderDate\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 588,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 595,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 596,\n          columnNumber: 13\n        }\n      }, \"Customer\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: editFormData.customer,\n        onChange: e => this.handleEditInputChange(\"customer\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 597,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 604,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 605,\n          columnNumber: 13\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: editFormData.status,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 606,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 614,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 615,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 616,\n          columnNumber: 13\n        }\n      }, \"Ref No\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: editFormData.qRefNo,\n        onChange: e => this.handleEditInputChange(\"qRefNo\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 617,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 624,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 625,\n          columnNumber: 13\n        }\n      }, \"Currency\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: editFormData.currency,\n        onChange: e => this.handleEditInputChange(\"currency\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 626,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 633,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 634,\n          columnNumber: 13\n        }\n      }, \"Order Value\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: editFormData.orderValue,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 635,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 642,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 643,\n          columnNumber: 13\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: editFormData.taxAmount,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 644,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 652,\n          columnNumber: 9\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 653,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 654,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 655,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 656,\n          columnNumber: 15\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 657,\n          columnNumber: 15\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 658,\n          columnNumber: 15\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 659,\n          columnNumber: 15\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 660,\n          columnNumber: 15\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 661,\n          columnNumber: 15\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 664,\n          columnNumber: 11\n        }\n      }, (_editFormData$lineIte = editFormData.lineItems) === null || _editFormData$lineIte === void 0 ? void 0 : _editFormData$lineIte.map((item, idx) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: idx,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 666,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 667,\n          columnNumber: 17\n        }\n      }, item.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 668,\n          columnNumber: 17\n        }\n      }, item.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 669,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        value: item.qty,\n        onChange: e => this.handleEditLineItemChange(idx, \"qty\", e.target.value),\n        style: {\n          width: 80\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 670,\n          columnNumber: 19\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 677,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        value: item.unitPrice,\n        onChange: e => this.handleEditLineItemChange(idx, \"unitPrice\", e.target.value),\n        style: {\n          width: 80\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 678,\n          columnNumber: 19\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 685,\n          columnNumber: 17\n        }\n      }, item.taxAmt), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 686,\n          columnNumber: 17\n        }\n      }, item.itemTotal))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 691,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-success mr-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 692,\n          columnNumber: 11\n        }\n      }, \"Save\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary\",\n        onClick: this.closeEditForm,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 693,\n          columnNumber: 11\n        }\n      }, \"Cancel\"))));\n    };\n\n    this.renderOrderPreview = () => {\n      var _o$lineItems, _o$lineItems2;\n\n      const o = this.state.selectedOrder;\n      if (!o) return null;\n      const subtotal = ((_o$lineItems = o.lineItems) === null || _o$lineItems === void 0 ? void 0 : _o$lineItems.reduce((sum, item) => sum + (parseFloat(item.itemTotal) || 0), 0)) || 0;\n      const freightCharges = parseFloat(o.freightCharges || 0);\n      const taxAmount = parseFloat(o.taxAmount || 0);\n      const grandTotal = parseFloat(o.orderValue || subtotal + freightCharges + taxAmount);\n      const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`; // Find customer record for extra details\n\n      const customer = this.state.customers.find(c => c.custshortName === o.customer || c.custname === o.customer) || {};\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 p-4 shadow-sm full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 720,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 721,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title mb-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 722,\n          columnNumber: 11\n        }\n      }, \"Order Preview - \", o.orderNo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"flex items-center gap-x-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 723,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-sm btn-primary mr-2\",\n        onClick: () => this.openEditForm(o),\n        disabled: o.status !== \"Entered\" && o.status !== \"Awaiting for Approval\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 724,\n          columnNumber: 13\n        }\n      }, \"Edit\"), /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-printer menu-icon ml-3\",\n        style: {\n          marginBlockStart: '10px',\n          gap: '10px',\n          fontSize: '27px',\n          color: '#2196F3',\n          cursor: 'pointer'\n        },\n        onClick: () => this.showOrderPDFWithOrg(o),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 731,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 738,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 739,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 739,\n          columnNumber: 37\n        }\n      }, \"Customer:\"), \" \", o.customer), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 740,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 740,\n          columnNumber: 37\n        }\n      }, \"Date:\"), \" \", o.orderDate), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 741,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 741,\n          columnNumber: 37\n        }\n      }, \"Status:\"), \" \", o.status)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 743,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 744,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 745,\n          columnNumber: 13\n        }\n      }, \"Bill To:\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 745,\n          columnNumber: 28\n        }\n      }), o.billTo || \"-\", /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-2\",\n        style: {\n          fontSize: \"0.9em\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 747,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 748,\n          columnNumber: 15\n        }\n      }, \"GSTIN:\"), \" \", customer.gstin || \"-\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 748,\n          columnNumber: 52\n        }\n      }), /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 749,\n          columnNumber: 15\n        }\n      }, \"Email:\"), \" \", customer.email || \"-\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 749,\n          columnNumber: 52\n        }\n      }), /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 750,\n          columnNumber: 15\n        }\n      }, \"Phone:\"), \" \", customer.phone || \"-\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 753,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 754,\n          columnNumber: 13\n        }\n      }, \"Ship To:\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 754,\n          columnNumber: 28\n        }\n      }), o.shipTo || \"-\")), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 758,\n          columnNumber: 9\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 759,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 760,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 761,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 762,\n          columnNumber: 15\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 763,\n          columnNumber: 15\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 764,\n          columnNumber: 15\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 765,\n          columnNumber: 15\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 766,\n          columnNumber: 15\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 767,\n          columnNumber: 15\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 770,\n          columnNumber: 11\n        }\n      }, (_o$lineItems2 = o.lineItems) === null || _o$lineItems2 === void 0 ? void 0 : _o$lineItems2.map((item, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 772,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 773,\n          columnNumber: 17\n        }\n      }, item.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 774,\n          columnNumber: 17\n        }\n      }, item.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 775,\n          columnNumber: 17\n        }\n      }, item.qty), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 776,\n          columnNumber: 17\n        }\n      }, item.unitPrice), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 777,\n          columnNumber: 17\n        }\n      }, item.taxAmt), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 778,\n          columnNumber: 17\n        }\n      }, item.itemTotal))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 783,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 784,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 784,\n          columnNumber: 14\n        }\n      }, \"Subtotal:\"), \" \", subtotal.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 785,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 785,\n          columnNumber: 14\n        }\n      }, \"Freight Charges:\"), \" \", freightCharges.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 786,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 786,\n          columnNumber: 14\n        }\n      }, \"Tax Amount:\"), \" \", taxAmount.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        className: \"h6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 787,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 787,\n          columnNumber: 29\n        }\n      }, \"Grand Total:\"), \" \", grandTotal.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        className: \"h6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 788,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 788,\n          columnNumber: 29\n        }\n      }, \"Amount in Words:\"), \" \", amountWords)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 790,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 791,\n          columnNumber: 11\n        }\n      }, \"Reject Reason:\"), \" \", o.rejectReason || \"-\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-auto pt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 793,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success\",\n        onClick: () => {\n          console.log(\"Approve clicked for order:\", o);\n          this.updateStatus(o.id, \"Approved\");\n        },\n        disabled: o.status !== \"Awaiting for Approval\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 794,\n          columnNumber: 11\n        }\n      }, \"Approve\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-danger\",\n        onClick: this.openRejectDialog,\n        disabled: o.status !== \"Awaiting for Approval\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 804,\n          columnNumber: 11\n        }\n      }, \"Reject\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: this.closePreview,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 811,\n          columnNumber: 11\n        }\n      }, \"Back to List\")), this.state.showRejectDialog && this.renderRejectDialog());\n    };\n  }\n\n  componentDidMount() {\n    this.fetchOrders();\n    this.fetchCustomers();\n    this.fetchProducts();\n    this.fetchTaxGroups();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 825,\n        columnNumber: 7\n      }\n    }, this.state.showEditForm ? this.renderEditForm() : this.state.previewMode ? this.renderOrderPreview() : this.renderOrderTable());\n  }\n\n}\n\nexport default OrderApproval;","map":{"version":3,"sources":["C:/Users/College/admin/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/order/OrderApproval.js"],"names":["React","Component","db","collection","getDocs","updateDoc","doc","getDoc","query","where","html2canvas","jsPDF","toWords","OrderApproval","state","orders","customers","products","taxGroups","selectedOrder","previewMode","loading","error","showRejectDialog","showEditForm","editFormData","rejectReason","fetchOrders","setState","snap","docs","map","d","id","data","sort","a","b","dateA","Date","quoteDate","createdAt","toDate","dateB","console","log","o","err","message","openEditForm","order","closeEditForm","handleEditInputChange","field","value","prev","handleEditLineItemChange","idx","items","lineItems","recalculateEditTotals","discountPercent","orderValue","taxAmount","forEach","item","qty","parseFloat","unitPrice","baseTotal","taxAmt","discountAmount","afterDiscountValue","toFixed","handleEditSubmit","e","preventDefault","alert","customer","length","ref","exists","fetchCustomers","fetchProducts","fetchTaxGroups","openPreview","closePreview","updateStatus","status","q","found","empty","realId","openRejectDialog","closeRejectDialog","handleRejectReasonChange","target","handleRejectConfirm","trim","showOrderPDFWithOrg","Array","isArray","orgSnap","org","find","c","custshortName","custname","gstStateMap","getPlaceOfSupply","gstin","code","substring","enrichedItems","product","p","productId","itemCode","ptshortName","hsnCode","uom","stockingUOM","cgst","sgst","igst","taxGroupNames","taxGroupName","split","s","subtotal","reduce","sum","freightCharges","freightTax","freighttaxAmount","totalTaxAmount","grandTotal","amountWords","Math","floor","taxBreakdown","taxGroupDetails","sno","base","tgName","group","g","groupName","li","key","component","percentOrAmt","type","push","peramt","container","document","createElement","style","width","padding","fontFamily","innerHTML","logoUrl","bgName","address","email","website","mobile","cin","orderNo","orderDate","currency","despatchMode","billTo","replace","contactPerson","phone","shipTo","gstLabel","join","taxId","itemDescription","total","toLocaleString","body","appendChild","canvas","scale","useCORS","imgData","toDataURL","pdf","height","addImage","removeChild","setFontSize","text","blob","output","url","URL","createObjectURL","newWin","window","open","write","close","renderRejectDialog","renderOrderTable","sortedOrders","aDate","bDate","fontSize","i","statusClass","qRefNo","color","cursor","renderEditForm","itemTotal","renderOrderPreview","marginBlockStart","gap","componentDidMount","render"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,EAAT,QAAmB,sBAAnB;AACA,SAASC,UAAT,EAAqBC,OAArB,EAA8BC,SAA9B,EAAyCC,GAAzC,EAA6CC,MAA7C,EAAqDC,KAArD,EAA4DC,KAA5D,QAA0E,oBAA1E;AACA,OAAOC,WAAP,MAAwB,aAAxB;AACA,SAASC,KAAT,QAAsB,OAAtB;AACA,SAASC,OAAT,QAAwB,iBAAxB;;AAEA,MAAMC,aAAN,SAA4BZ,SAA5B,CAAsC;AAAA;AAAA;AAAA,SACpCa,KADoC,GAC5B;AACNC,MAAAA,MAAM,EAAE,EADF;AAENC,MAAAA,SAAS,EAAE,EAFL;AAGNC,MAAAA,QAAQ,EAAE,EAHJ;AAINC,MAAAA,SAAS,EAAE,EAJL;AAKNC,MAAAA,aAAa,EAAE,IALT;AAMNC,MAAAA,WAAW,EAAE,KANP;AAONC,MAAAA,OAAO,EAAE,KAPH;AAQNC,MAAAA,KAAK,EAAE,IARD;AASNC,MAAAA,gBAAgB,EAAE,KATZ;AAUNC,MAAAA,YAAY,EAAE,KAVR;AAWNC,MAAAA,YAAY,EAAE,IAXR;AAYNC,MAAAA,YAAY,EAAE;AAZR,KAD4B;;AAAA,SAgBpCC,WAhBoC,GAgBtB,YAAY;AAC1B,WAAKC,QAAL,CAAc;AAAEP,QAAAA,OAAO,EAAE,IAAX;AAAiBC,QAAAA,KAAK,EAAE;AAAxB,OAAd;;AACA,UAAI;AACF,cAAMO,IAAI,GAAG,MAAMzB,OAAO,CAACD,UAAU,CAACD,EAAD,EAAK,QAAL,CAAX,CAA1B;AACA,cAAMa,MAAM,GAAGc,IAAI,CAACC,IAAL,CAAUC,GAAV,CAAcC,CAAC,KAAK;AAAEC,UAAAA,EAAE,EAAED,CAAC,CAACC,EAAR;AAAY,aAAGD,CAAC,CAACE,IAAF;AAAf,SAAL,CAAf,CAAf;AACAnB,QAAAA,MAAM,CAACoB,IAAP,CAAY,CAACC,CAAD,EAAGC,CAAH,KAAO;AAAA;;AACjB,gBAAMC,KAAK,GAAG,IAAIC,IAAJ,CAASH,CAAC,CAACI,SAAF,qBAAeJ,CAAC,CAACK,SAAjB,wEAAe,aAAaC,MAA5B,wDAAe,sCAAf,KAA0CN,CAAC,CAACK,SAA5C,IAAyD,CAAlE,CAAd;AACA,gBAAME,KAAK,GAAG,IAAIJ,IAAJ,CAASF,CAAC,CAACG,SAAF,qBAAeH,CAAC,CAACI,SAAjB,wEAAe,aAAaC,MAA5B,wDAAe,sCAAf,KAA0CL,CAAC,CAACI,SAA5C,IAAyD,CAAlE,CAAd;AACA,iBAAOE,KAAK,GAAGL,KAAf;AACD,SAJD;AAKA,aAAKV,QAAL,CAAc;AAAEb,UAAAA,MAAF;AAAUM,UAAAA,OAAO,EAAE;AAAnB,SAAd;AACAuB,QAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAAmC9B,MAAM,CAACgB,GAAP,CAAWe,CAAC,IAAIA,CAAC,CAACb,EAAlB,CAAnC;AACD,OAVD,CAUE,OAAOc,GAAP,EAAY;AACZ,aAAKnB,QAAL,CAAc;AAAEN,UAAAA,KAAK,EAAEyB,GAAG,CAACC,OAAb;AAAsB3B,UAAAA,OAAO,EAAE;AAA/B,SAAd;AACD;AACF,KA/BqC;;AAAA,SAwCtC4B,YAxCsC,GAwCtBC,KAAD,IAAW;AACxB,WAAKtB,QAAL,CAAc;AAAEJ,QAAAA,YAAY,EAAE,IAAhB;AAAsBC,QAAAA,YAAY,EAAE,EAAE,GAAGyB;AAAL;AAApC,OAAd;AACD,KA1CqC;;AAAA,SA4CtCC,aA5CsC,GA4CtB,MAAM;AACpB,WAAKvB,QAAL,CAAc;AAAEJ,QAAAA,YAAY,EAAE,KAAhB;AAAuBC,QAAAA,YAAY,EAAE;AAArC,OAAd;AACD,KA9CqC;;AAAA,SAgDtC2B,qBAhDsC,GAgDd,CAACC,KAAD,EAAQC,KAAR,KAAkB;AACxC,WAAK1B,QAAL,CAAc2B,IAAI,KAAK;AACrB9B,QAAAA,YAAY,EAAE,EAAE,GAAG8B,IAAI,CAAC9B,YAAV;AAAwB,WAAC4B,KAAD,GAASC;AAAjC;AADO,OAAL,CAAlB;AAGD,KApDqC;;AAAA,SAsDtCE,wBAtDsC,GAsDX,CAACC,GAAD,EAAMJ,KAAN,EAAaC,KAAb,KAAuB;AAChD,YAAMI,KAAK,GAAG,CAAC,GAAG,KAAK5C,KAAL,CAAWW,YAAX,CAAwBkC,SAA5B,CAAd;AACAD,MAAAA,KAAK,CAACD,GAAD,CAAL,GAAa,EAAE,GAAGC,KAAK,CAACD,GAAD,CAAV;AAAiB,SAACJ,KAAD,GAASC;AAA1B,OAAb;AACA,WAAK1B,QAAL,CAAc2B,IAAI,KAAK;AACrB9B,QAAAA,YAAY,EAAE,EAAE,GAAG8B,IAAI,CAAC9B,YAAV;AAAwBkC,UAAAA,SAAS,EAAED;AAAnC;AADO,OAAL,CAAlB,EAEI,KAAKE,qBAFT;AAGD,KA5DqC;;AAAA,SA6DtCA,qBA7DsC,GA6Dd,MAAM;AAC5B,YAAM;AAAED,QAAAA,SAAF;AAAaE,QAAAA;AAAb,UAAiC,KAAK/C,KAAL,CAAWW,YAAlD;AACA,UAAIqC,UAAU,GAAG,CAAjB;AACA,UAAIC,SAAS,GAAG,CAAhB;AACA,OAACJ,SAAS,IAAI,EAAd,EAAkBK,OAAlB,CAA0BC,IAAI,IAAI;AAChC,cAAMC,GAAG,GAAGC,UAAU,CAACF,IAAI,CAACC,GAAL,IAAY,CAAb,CAAtB;AACA,cAAME,SAAS,GAAGD,UAAU,CAACF,IAAI,CAACG,SAAL,IAAkB,CAAnB,CAA5B;AACA,cAAMC,SAAS,GAAGH,GAAG,GAAGE,SAAxB;AACA,cAAME,MAAM,GAAGH,UAAU,CAACF,IAAI,CAACK,MAAL,IAAe,CAAhB,CAAzB;AACAR,QAAAA,UAAU,IAAIO,SAAS,GAAGC,MAA1B;AACAP,QAAAA,SAAS,IAAIO,MAAb;AAED,OARD;AASA,YAAMC,cAAc,GAAIT,UAAU,GAAGK,UAAU,CAACN,eAAe,IAAI,CAApB,CAAxB,GAAkD,GAAzE;AACA,YAAMW,kBAAkB,GAAGV,UAAU,GAAGS,cAAxC;AACA,WAAK3C,QAAL,CAAc2B,IAAI,KAAK;AACrB9B,QAAAA,YAAY,EAAE,EACZ,GAAG8B,IAAI,CAAC9B,YADI;AAEZqC,UAAAA,UAAU,EAAEA,UAAU,CAACW,OAAX,CAAmB,CAAnB,CAFA;AAGZV,UAAAA,SAAS,EAAEA,SAAS,CAACU,OAAV,CAAkB,CAAlB,CAHC;AAIZF,UAAAA,cAAc,EAAEA,cAAc,CAACE,OAAf,CAAuB,CAAvB,CAJJ;AAKZD,UAAAA,kBAAkB,EAAEA,kBAAkB,CAACC,OAAnB,CAA2B,CAA3B;AALR;AADO,OAAL,CAAlB;AASD,KArFqC;;AAAA,SAuFtCC,gBAvFsC,GAuFnB,MAAOC,CAAP,IAAa;AAC9BA,MAAAA,CAAC,CAACC,cAAF;AACA,YAAM;AAAEnD,QAAAA;AAAF,UAAmB,KAAKX,KAA9B;AACA,UAAI,CAACW,YAAL,EAAmB,OAAOoD,KAAK,CAAC,iBAAD,CAAZ;AACnB,UAAI,CAACpD,YAAY,CAACqD,QAAlB,EAA4B,OAAOD,KAAK,CAAC,sBAAD,CAAZ;AAC5B,UAAI,CAACpD,YAAY,CAACkC,SAAd,IAA2BlC,YAAY,CAACkC,SAAb,CAAuBoB,MAAvB,KAAkC,CAAjE,EAAoE,OAAOF,KAAK,CAAC,oCAAD,CAAZ;AACpE,UAAI,CAACpD,YAAY,CAACQ,EAAlB,EAAsB,OAAO4C,KAAK,CAAC,mCAAD,CAAZ;;AAEtB,UAAI;AACF,cAAMG,GAAG,GAAG1E,GAAG,CAACJ,EAAD,EAAK,QAAL,EAAeuB,YAAY,CAACQ,EAA5B,CAAf;AACA,cAAMJ,IAAI,GAAG,MAAMtB,MAAM,CAACyE,GAAD,CAAzB;;AACA,YAAI,CAACnD,IAAI,CAACoD,MAAL,EAAL,EAAoB;AAClB,iBAAOJ,KAAK,CAAE,oBAAmBpD,YAAY,CAACQ,EAAG,EAArC,CAAZ;AACD;;AAED,cAAM5B,SAAS,CAAC2E,GAAD,EAAMvD,YAAN,CAAf;AACAoD,QAAAA,KAAK,CAAC,gBAAD,CAAL;AACA,aAAKjD,QAAL,CAAc;AAAEJ,UAAAA,YAAY,EAAE,KAAhB;AAAuBC,UAAAA,YAAY,EAAE;AAArC,SAAd;AACA,aAAKE,WAAL;AACD,OAXD,CAWE,OAAOoB,GAAP,EAAY;AACZH,QAAAA,OAAO,CAACtB,KAAR,CAAc,yBAAd,EAAyCyB,GAAzC;AACA8B,QAAAA,KAAK,CAAC,2BAA2B9B,GAAG,CAACC,OAAhC,CAAL;AACD;AACF,KA9GqC;;AAAA,SAiHpCkC,cAjHoC,GAiHnB,YAAY;AAC3B,YAAMrD,IAAI,GAAG,MAAMzB,OAAO,CAACD,UAAU,CAACD,EAAD,EAAK,WAAL,CAAX,CAA1B;AACA,YAAMc,SAAS,GAAGa,IAAI,CAACC,IAAL,CAAUC,GAAV,CAAczB,GAAG,KAAK;AAAE2B,QAAAA,EAAE,EAAE3B,GAAG,CAAC2B,EAAV;AAAc,WAAG3B,GAAG,CAAC4B,IAAJ;AAAjB,OAAL,CAAjB,CAAlB;AACA,WAAKN,QAAL,CAAc;AAAEZ,QAAAA;AAAF,OAAd;AACD,KArHmC;;AAAA,SAuHpCmE,aAvHoC,GAuHpB,YAAY;AAC1B,YAAMtD,IAAI,GAAG,MAAMzB,OAAO,CAACD,UAAU,CAACD,EAAD,EAAK,UAAL,CAAX,CAA1B;AACA,YAAMe,QAAQ,GAAGY,IAAI,CAACC,IAAL,CAAUC,GAAV,CAAczB,GAAG,KAAK;AAAE2B,QAAAA,EAAE,EAAE3B,GAAG,CAAC2B,EAAV;AAAc,WAAG3B,GAAG,CAAC4B,IAAJ;AAAjB,OAAL,CAAjB,CAAjB;AACA,WAAKN,QAAL,CAAc;AAAEX,QAAAA;AAAF,OAAd;AACD,KA3HmC;;AAAA,SA6HpCmE,cA7HoC,GA6HnB,YAAY;AAC3B,YAAMvD,IAAI,GAAG,MAAMzB,OAAO,CAACD,UAAU,CAACD,EAAD,EAAK,WAAL,CAAX,CAA1B;AACA,YAAMgB,SAAS,GAAGW,IAAI,CAACC,IAAL,CAAUC,GAAV,CAAczB,GAAG,KAAK;AAAE2B,QAAAA,EAAE,EAAE3B,GAAG,CAAC2B,EAAV;AAAc,WAAG3B,GAAG,CAAC4B,IAAJ;AAAjB,OAAL,CAAjB,CAAlB;AACA,WAAKN,QAAL,CAAc;AAAEV,QAAAA;AAAF,OAAd;AACD,KAjImC;;AAAA,SAmIrCmE,WAnIqC,GAmItBnC,KAAD,IAAW;AACxBN,MAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCK,KAAlC;AACA,WAAKtB,QAAL,CAAc;AAAET,QAAAA,aAAa,EAAE+B,KAAjB;AAAwB9B,QAAAA,WAAW,EAAE;AAArC,OAAd;AACD,KAtIqC;;AAAA,SA4IpCkE,YA5IoC,GA4IrB,MAAM;AACnB,WAAK1D,QAAL,CAAc;AAAET,QAAAA,aAAa,EAAE,IAAjB;AAAuBC,QAAAA,WAAW,EAAE;AAApC,OAAd;AACD,KA9ImC;;AAAA,SAgJtCmE,YAhJsC,GAgJvB,OAAOtD,EAAP,EAAWuD,MAAX,EAAmB9D,YAAY,GAAG,EAAlC,KAAyC;AACtDkB,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoC;AAAEZ,QAAAA,EAAF;AAAMuD,QAAAA,MAAN;AAAc9D,QAAAA;AAAd,OAApC;AACA,UAAI,CAACO,EAAL,EAAS,OAAO4C,KAAK,CAAC,kCAAD,CAAZ;AAET,WAAKjD,QAAL,CAAc;AAAEP,QAAAA,OAAO,EAAE,IAAX;AAAiBC,QAAAA,KAAK,EAAE;AAAxB,OAAd;;AACA,UAAI;AACF,cAAM0D,GAAG,GAAG1E,GAAG,CAACJ,EAAD,EAAK,QAAL,EAAe+B,EAAf,CAAf;AACA,cAAMJ,IAAI,GAAG,MAAMtB,MAAM,CAACyE,GAAD,CAAzB;;AAEA,YAAI,CAACnD,IAAI,CAACoD,MAAL,EAAL,EAAoB;AAClB,gBAAMQ,CAAC,GAAGjF,KAAK,CAACL,UAAU,CAACD,EAAD,EAAK,QAAL,CAAX,EAA2BO,KAAK,CAAC,SAAD,EAAY,IAAZ,EAAkBwB,EAAlB,CAAhC,CAAf;AACA,gBAAMyD,KAAK,GAAG,MAAMtF,OAAO,CAACqF,CAAD,CAA3B;;AACA,cAAI,CAACC,KAAK,CAACC,KAAX,EAAkB;AAChB,kBAAMC,MAAM,GAAGF,KAAK,CAAC5D,IAAN,CAAW,CAAX,EAAcG,EAA7B;AACAW,YAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2C+C,MAA3C;AACA,kBAAMvF,SAAS,CAACC,GAAG,CAACJ,EAAD,EAAK,QAAL,EAAe0F,MAAf,CAAJ,EAA4B;AAAEJ,cAAAA,MAAF;AAAU9D,cAAAA;AAAV,aAA5B,CAAf;AACD,WAJD,MAIO;AACL,iBAAKE,QAAL,CAAc;AAAEP,cAAAA,OAAO,EAAE;AAAX,aAAd;AACA,mBAAOwD,KAAK,CAAE,sCAAqC5C,EAAG,IAA1C,CAAZ;AACD;AACF,SAXD,MAWO;AACL,gBAAM5B,SAAS,CAAC2E,GAAD,EAAM;AAAEQ,YAAAA,MAAF;AAAU9D,YAAAA;AAAV,WAAN,CAAf;AACD;;AAEDmD,QAAAA,KAAK,CAAE,SAAQW,MAAO,EAAjB,CAAL;AACA,cAAM,KAAK7D,WAAL,EAAN;AACA,aAAKC,QAAL,CAAc;AAAET,UAAAA,aAAa,EAAE,IAAjB;AAAuBC,UAAAA,WAAW,EAAE,KAApC;AAA2CG,UAAAA,gBAAgB,EAAE,KAA7D;AAAoEG,UAAAA,YAAY,EAAE,EAAlF;AAAsFL,UAAAA,OAAO,EAAE;AAA/F,SAAd;AACD,OAtBD,CAsBE,OAAO0B,GAAP,EAAY;AACZH,QAAAA,OAAO,CAACtB,KAAR,CAAc,qBAAd,EAAqCyB,GAArC;AACA,aAAKnB,QAAL,CAAc;AAAEN,UAAAA,KAAK,EAAEyB,GAAG,CAACC,OAAb;AAAsB3B,UAAAA,OAAO,EAAE;AAA/B,SAAd;AACAwD,QAAAA,KAAK,CAAC,4BAA4B9B,GAAG,CAACC,OAAjC,CAAL;AACD;AACF,KAhLqC;;AAAA,SAoLpC6C,gBApLoC,GAoLjB,MAAM;AACvB,WAAKjE,QAAL,CAAc;AAAEL,QAAAA,gBAAgB,EAAE,IAApB;AAA0BG,QAAAA,YAAY,EAAE;AAAxC,OAAd;AACD,KAtLmC;;AAAA,SAwLpCoE,iBAxLoC,GAwLhB,MAAM;AACxB,WAAKlE,QAAL,CAAc;AAAEL,QAAAA,gBAAgB,EAAE,KAApB;AAA2BG,QAAAA,YAAY,EAAE;AAAzC,OAAd;AACD,KA1LmC;;AAAA,SA4LpCqE,wBA5LoC,GA4LRpB,CAAD,IAAO;AAChC,WAAK/C,QAAL,CAAc;AAAEF,QAAAA,YAAY,EAAEiD,CAAC,CAACqB,MAAF,CAAS1C;AAAzB,OAAd;AACD,KA9LmC;;AAAA,SAgMpC2C,mBAhMoC,GAgMd,MAAM;AAC1B,YAAM;AAAE9E,QAAAA,aAAF;AAAiBO,QAAAA;AAAjB,UAAkC,KAAKZ,KAA7C;;AACA,UAAI,CAACY,YAAY,CAACwE,IAAb,EAAL,EAA0B;AACxBrB,QAAAA,KAAK,CAAC,sCAAD,CAAL;AACA;AACD;;AACD,WAAKU,YAAL,CAAkBpE,aAAa,CAACc,EAAhC,EAAoC,UAApC,EAAgDP,YAAhD;AACD,KAvMmC;;AAAA,SAyMpCyE,mBAzMoC,GAyMd,MAAOjD,KAAP,IAAiB;AAAA;;AACrC,UAAI,CAACA,KAAD,IAAU,CAACkD,KAAK,CAACC,OAAN,CAAcnD,KAAK,CAACS,SAApB,CAAX,IAA6CT,KAAK,CAACS,SAAN,CAAgBoB,MAAhB,KAA2B,CAA5E,EAA+E;AAC7EF,QAAAA,KAAK,CAAC,2BAAD,CAAL;AACA;AACD,OAJoC,CAMrC;;;AACA,YAAMyB,OAAO,GAAG,MAAMlG,OAAO,CAACD,UAAU,CAACD,EAAD,EAAK,gBAAL,CAAX,CAA7B;AACA,YAAMqG,GAAG,GAAG,mBAAAD,OAAO,CAACxE,IAAR,CAAa,CAAb,mEAAiBI,IAAjB,OAA2B,EAAvC;AACA,YAAM4C,QAAQ,GAAG,KAAKhE,KAAL,CAAWE,SAAX,CAAqBwF,IAArB,CACfC,CAAC,IAAIA,CAAC,CAACC,aAAF,KAAoBxD,KAAK,CAAC4B,QAA1B,IAAsC2B,CAAC,CAACE,QAAF,KAAezD,KAAK,CAAC4B,QADjD,KAEZ,EAFL,CATqC,CAarC;;AACA,YAAM8B,WAAW,GAAG;AAClB,cAAM,iBADY;AACO,cAAM,kBADb;AACiC,cAAM,QADvC;AACiD,cAAM,YADvD;AAElB,cAAM,aAFY;AAEG,cAAM,SAFT;AAEoB,cAAM,OAF1B;AAEmC,cAAM,WAFzC;AAEsD,cAAM,eAF5D;AAGlB,cAAM,OAHY;AAGH,cAAM,QAHH;AAGa,cAAM,mBAHnB;AAGwC,cAAM,UAH9C;AAG0D,cAAM,SAHhE;AAIlB,cAAM,SAJY;AAID,cAAM,SAJL;AAIgB,cAAM,WAJtB;AAImC,cAAM,OAJzC;AAIkD,cAAM,aAJxD;AAKlB,cAAM,WALY;AAKC,cAAM,QALP;AAKiB,cAAM,cALvB;AAKuC,cAAM,gBAL7C;AAK+D,cAAM,SALrE;AAMlB,cAAM,eANY;AAMK,cAAM,wBANX;AAMqC,cAAM,aAN3C;AAM0D,cAAM,sBANhE;AAOlB,cAAM,WAPY;AAOC,cAAM,KAPP;AAOc,cAAM,aAPpB;AAOmC,cAAM,QAPzC;AAOmD,cAAM,YAPzD;AAQlB,cAAM,YARY;AAQE,cAAM,6BARR;AAQuC,cAAM,WAR7C;AAQ0D,cAAM,gBARhE;AASlB,cAAM;AATY,OAApB;;AAYA,YAAMC,gBAAgB,GAAIC,KAAD,IAAW;AAClC,YAAI,CAACA,KAAD,IAAUA,KAAK,CAAC/B,MAAN,GAAe,CAA7B,EAAgC,OAAO,EAAP;AAChC,cAAMgC,IAAI,GAAGD,KAAK,CAACE,SAAN,CAAgB,CAAhB,EAAmB,CAAnB,CAAb;AACA,cAAMlG,KAAK,GAAG8F,WAAW,CAACG,IAAD,CAAzB;AACA,eAAOjG,KAAK,GAAI,GAAEiG,IAAK,MAAKjG,KAAM,EAAtB,GAA0B,EAAtC;AACD,OALD,CA1BqC,CAiCrC;;;AACA,YAAMmG,aAAa,GAAG/D,KAAK,CAACS,SAAN,CAAgB5B,GAAhB,CAAoBkC,IAAI,IAAI;AAChD,cAAMiD,OAAO,GAAG,KAAKpG,KAAL,CAAWG,QAAX,CAAoBuF,IAApB,CAAyBW,CAAC,IAAIA,CAAC,CAACC,SAAF,KAAgBnD,IAAI,CAACoD,QAAnD,KAAgE,EAAhF;AACA,eAAO,EACL,GAAGpD,IADE;AAELqD,UAAAA,WAAW,EAAEJ,OAAO,CAACI,WAAR,IAAuB,EAF/B;AAGLC,UAAAA,OAAO,EAAEL,OAAO,CAACK,OAAR,IAAmB,EAHvB;AAILC,UAAAA,GAAG,EAAEN,OAAO,CAACO,WAAR,IAAuB,EAJvB;AAKLC,UAAAA,IAAI,EAAEzD,IAAI,CAACyD,IAAL,IAAa,CALd;AAMLC,UAAAA,IAAI,EAAE1D,IAAI,CAAC0D,IAAL,IAAa,CANd;AAOLC,UAAAA,IAAI,EAAE3D,IAAI,CAAC2D,IAAL,IAAa,CAPd;AAQLC,UAAAA,aAAa,EAAE5D,IAAI,CAAC4D,aAAL,KAAuB5D,IAAI,CAAC6D,YAAL,GAAoB7D,IAAI,CAAC6D,YAAL,CAAkBC,KAAlB,CAAwB,GAAxB,EAA6BhG,GAA7B,CAAiCiG,CAAC,IAAIA,CAAC,CAAC9B,IAAF,EAAtC,CAApB,GAAsE,EAA7F;AARV,SAAP;AAUD,OAZqB,CAAtB,CAlCqC,CAgDrC;;AACA,YAAM+B,QAAQ,GAAGhB,aAAa,CAACiB,MAAd,CAAqB,CAACC,GAAD,EAAMlE,IAAN,KAAekE,GAAG,GAAI,CAAChE,UAAU,CAACF,IAAI,CAACG,SAAN,CAAV,IAA8B,CAA/B,KAAqCD,UAAU,CAACF,IAAI,CAACC,GAAN,CAAV,IAAwB,CAA7D,CAA3C,EAA6G,CAA7G,CAAjB;AACA,YAAMkE,cAAc,GAAGjE,UAAU,CAACjB,KAAK,CAACkF,cAAN,IAAwB,CAAzB,CAAjC;AACA,YAAMC,UAAU,GAAGlE,UAAU,CAACjB,KAAK,CAACoF,gBAAN,IAA0B,CAA3B,CAA7B;AACA,YAAMC,cAAc,GAAGpE,UAAU,CAACjB,KAAK,CAACa,SAAN,IAAmB,CAApB,CAAjC;AACA,YAAMyE,UAAU,GAAGrE,UAAU,CAACjB,KAAK,CAACY,UAAN,IAAqBmE,QAAQ,GAAGM,cAAjC,CAA7B;AACA,YAAME,WAAW,GAAI,OAAM7H,OAAO,CAAC8H,IAAI,CAACC,KAAL,CAAWH,UAAX,CAAD,CAAyB,OAA3D,CAtDqC,CAwDrC;;AACA,UAAII,YAAY,GAAG,EAAnB;AACA,UAAIC,eAAe,GAAG,EAAtB;AACA,UAAIC,GAAG,GAAG,CAAV;AACA7B,MAAAA,aAAa,CAACjD,OAAd,CAAsBC,IAAI,IAAI;AAC5B,cAAMC,GAAG,GAAGC,UAAU,CAACF,IAAI,CAACC,GAAL,IAAY,CAAb,CAAtB;AACA,cAAME,SAAS,GAAGD,UAAU,CAACF,IAAI,CAACG,SAAL,IAAkB,CAAnB,CAA5B;AACA,cAAM2E,IAAI,GAAG7E,GAAG,GAAGE,SAAnB;AACA,SAACH,IAAI,CAAC4D,aAAL,IAAsB,EAAvB,EAA2B7D,OAA3B,CAAmCgF,MAAM,IAAI;AAC3C,gBAAMC,KAAK,GAAG,CAAC,KAAKnI,KAAL,CAAWI,SAAX,IAAwB,EAAzB,EAA6BsF,IAA7B,CAAkC0C,CAAC,IAAIA,CAAC,CAACC,SAAF,KAAgBH,MAAvD,CAAd;;AACA,cAAIC,KAAJ,EAAW;AACTA,YAAAA,KAAK,CAACtF,SAAN,CAAgBK,OAAhB,CAAwBoF,EAAE,IAAI;AAC5B,oBAAMC,GAAG,GAAI,GAAEL,MAAO,MAAKI,EAAE,CAACE,SAAU,KAAIF,EAAE,CAACG,YAAa,GAAEH,EAAE,CAACI,IAAH,KAAY,QAAZ,GAAuB,EAAvB,GAA4B,GAAI,GAA9F;AACA,kBAAIlF,MAAM,GAAG,CAAb;AACA,kBAAI8E,EAAE,CAACI,IAAH,KAAY,QAAhB,EAA0BlF,MAAM,GAAGH,UAAU,CAACiF,EAAE,CAACG,YAAH,IAAmB,CAApB,CAAnB,CAA1B,KACKjF,MAAM,GAAIyE,IAAI,GAAG5E,UAAU,CAACiF,EAAE,CAACG,YAAH,IAAmB,CAApB,CAAlB,GAA4C,GAArD;AACLX,cAAAA,YAAY,CAACS,GAAD,CAAZ,GAAoB,CAACT,YAAY,CAACS,GAAD,CAAZ,IAAqB,CAAtB,IAA2B/E,MAA/C;AACAuE,cAAAA,eAAe,CAACY,IAAhB,CAAqB;AACnBX,gBAAAA,GAAG,EAAEA,GAAG,EADW;AAEnBG,gBAAAA,KAAK,EAAED,MAFY;AAGnBU,gBAAAA,MAAM,EAAG,GAAEN,EAAE,CAACG,YAAa,GAAEH,EAAE,CAACI,IAAH,KAAY,QAAZ,GAAuB,EAAvB,GAA4B,GAAI,EAH1C;AAInBlF,gBAAAA,MAAM,EAAEA,MAAM,CAACG,OAAP,CAAe,CAAf;AAJW,eAArB;AAMD,aAZD;AAaD;AACF,SAjBD,EAJ4B,CAsB5B;;AACA,YAAIR,IAAI,CAACyD,IAAT,EAAe;AACb,gBAAM2B,GAAG,GAAI,QAAOpF,IAAI,CAACyD,IAAK,GAA9B;AACA,gBAAMpD,MAAM,GAAIyE,IAAI,GAAG9E,IAAI,CAACyD,IAAb,GAAqB,GAApC;AACAkB,UAAAA,YAAY,CAACS,GAAD,CAAZ,GAAoB,CAACT,YAAY,CAACS,GAAD,CAAZ,IAAqB,CAAtB,IAA2B/E,MAA/C;AACAuE,UAAAA,eAAe,CAACY,IAAhB,CAAqB;AACnBX,YAAAA,GAAG,EAAEA,GAAG,EADW;AAEnBG,YAAAA,KAAK,EAAEI,GAFY;AAGnBK,YAAAA,MAAM,EAAG,GAAEzF,IAAI,CAACyD,IAAK,GAHF;AAInBpD,YAAAA,MAAM,EAAEA,MAAM,CAACG,OAAP,CAAe,CAAf;AAJW,WAArB;AAMD;;AACD,YAAIR,IAAI,CAAC0D,IAAT,EAAe;AACb,gBAAM0B,GAAG,GAAI,QAAOpF,IAAI,CAAC0D,IAAK,GAA9B;AACA,gBAAMrD,MAAM,GAAIyE,IAAI,GAAG9E,IAAI,CAAC0D,IAAb,GAAqB,GAApC;AACAiB,UAAAA,YAAY,CAACS,GAAD,CAAZ,GAAoB,CAACT,YAAY,CAACS,GAAD,CAAZ,IAAqB,CAAtB,IAA2B/E,MAA/C;AACAuE,UAAAA,eAAe,CAACY,IAAhB,CAAqB;AACnBX,YAAAA,GAAG,EAAEA,GAAG,EADW;AAEnBG,YAAAA,KAAK,EAAEI,GAFY;AAGnBK,YAAAA,MAAM,EAAG,GAAEzF,IAAI,CAAC0D,IAAK,GAHF;AAInBrD,YAAAA,MAAM,EAAEA,MAAM,CAACG,OAAP,CAAe,CAAf;AAJW,WAArB;AAMD;;AACD,YAAIR,IAAI,CAAC2D,IAAT,EAAe;AACb,gBAAMyB,GAAG,GAAI,QAAOpF,IAAI,CAAC2D,IAAK,GAA9B;AACA,gBAAMtD,MAAM,GAAIyE,IAAI,GAAG9E,IAAI,CAAC2D,IAAb,GAAqB,GAApC;AACAgB,UAAAA,YAAY,CAACS,GAAD,CAAZ,GAAoB,CAACT,YAAY,CAACS,GAAD,CAAZ,IAAqB,CAAtB,IAA2B/E,MAA/C;AACAuE,UAAAA,eAAe,CAACY,IAAhB,CAAqB;AACnBX,YAAAA,GAAG,EAAEA,GAAG,EADW;AAEnBG,YAAAA,KAAK,EAAEI,GAFY;AAGnBK,YAAAA,MAAM,EAAG,GAAEzF,IAAI,CAAC2D,IAAK,GAHF;AAInBtD,YAAAA,MAAM,EAAEA,MAAM,CAACG,OAAP,CAAe,CAAf;AAJW,WAArB;AAMD;AACF,OAxDD;;AAyDA,UAAI4D,UAAU,GAAG,CAAjB,EAAoB;AAClBO,QAAAA,YAAY,CAAC,aAAD,CAAZ,GAA8BP,UAA9B;AACAQ,QAAAA,eAAe,CAACY,IAAhB,CAAqB;AACnBX,UAAAA,GAAG,EAAEA,GAAG,EADW;AAEnBG,UAAAA,KAAK,EAAE,aAFY;AAGnBS,UAAAA,MAAM,EAAE,GAHW;AAInBpF,UAAAA,MAAM,EAAE+D,UAAU,CAAC5D,OAAX,CAAmB,CAAnB;AAJW,SAArB;AAMD,OA7HoC,CA+HrC;;;AACA,YAAMkF,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB;AACAF,MAAAA,SAAS,CAAC1H,EAAV,GAAe,uBAAf;AACA0H,MAAAA,SAAS,CAACG,KAAV,CAAgBC,KAAhB,GAAwB,OAAxB;AACAJ,MAAAA,SAAS,CAACG,KAAV,CAAgBE,OAAhB,GAA0B,MAA1B;AACAL,MAAAA,SAAS,CAACG,KAAV,CAAgBG,UAAhB,GAA6B,OAA7B;AAEAN,MAAAA,SAAS,CAACO,SAAV,GAAuB;;oBAEP3D,GAAG,CAAC4D,OAAJ,IAAe,EAAG;;;;;;eAMvB5D,GAAG,CAAC6D,MAAJ,IAAc,EAAG;YACpB7D,GAAG,CAAC8D,OAAJ,IAAe,EAAG;0BACJ9D,GAAG,CAAC+D,KAAJ,IAAa,EAAG;4BACd/D,GAAG,CAACgE,OAAJ,IAAe,EAAG;0BACpBhE,GAAG,CAACO,KAAJ,IAAa,EAAG;2BACfP,GAAG,CAACiE,MAAJ,IAAc,EAAG;wBACpBjE,GAAG,CAACkE,GAAJ,IAAW,EAAG;;;8CAGQvH,KAAK,CAACwH,OAAQ;gDACZxH,KAAK,CAACyH,SAAU;8CAClBzH,KAAK,CAAC0H,QAAN,IAAkB,KAAM;8CACxB1H,KAAK,CAAC2H,YAAN,IAAsB,EAAG;;;;;;;;gBAQvD3H,KAAK,CAAC4B,QAAN,IAAkB,EAAG;cACvB,kBAAA5B,KAAK,CAAC4H,MAAN,gEAAcC,OAAd,CAAsB,KAAtB,EAA6B,OAA7B,MAAyC,EAAG;;;8BAG5BjG,QAAQ,CAACgC,KAAT,IAAkB,EAAG;8BACrBhC,QAAQ,CAACwF,KAAT,IAAkB,EAAG;gCACnBxF,QAAQ,CAACkG,aAAT,IAA0B,EAAG;8BAC/BlG,QAAQ,CAACmG,KAAT,IAAkB,EAAG;;;;;;gBAMnC/H,KAAK,CAAC4B,QAAN,IAAkB,EAAG;cACvB,kBAAA5B,KAAK,CAACgI,MAAN,gEAAcH,OAAd,CAAsB,KAAtB,EAA6B,OAA7B,MAAyC,EAAG;;;sCAGpBlE,gBAAgB,CAAC/B,QAAQ,CAACgC,KAAT,IAAkB,EAAnB,CAAuB;;;;;;;;;;;;;;;;;;;YAmBjEG,aAAa,CAAClF,GAAd,CAAkBkC,IAAI,IAAI;AAC1B,cAAMkH,QAAQ,GAAIlH,IAAI,CAAC4D,aAAL,IAAsB5D,IAAI,CAAC4D,aAAL,CAAmB9C,MAA1C,GACbd,IAAI,CAAC4D,aAAL,CAAmBuD,IAAnB,CAAwB,IAAxB,CADa,GAEZnH,IAAI,CAAC6D,YAAL,IAAqB7D,IAAI,CAACoH,KAA1B,IAAmC,GAFxC;AAGA,eAAQ;;wDAEoCpH,IAAI,CAACoD,QAAS;wDACdpD,IAAI,CAACqH,eAAgB;wDACrBrH,IAAI,CAACsD,OAAQ;wDACbtD,IAAI,CAACuD,GAAI;wDACTvD,IAAI,CAACC,GAAI;wDACTD,IAAI,CAACG,SAAU;wDACf+G,QAAS;wDACTlH,IAAI,CAACsH,KAAM;oBATvD;AAWD,OAfC,EAeCH,IAfD,CAeM,EAfN,CAeU;;;uDAGiCnD,QAAQ,CAACxD,OAAT,CAAiB,CAAjB,CAAoB;;;qDAGtB8D,cAAc,CAAC9D,OAAf,CAAuB,CAAvB,CAA0B;;;;qDAI1B+D,UAAU,CAAC/D,OAAX,CAAmB,CAAnB,CAAsB;;;;6EAIEgE,WAAY;mFACN,IAAIlG,IAAJ,GAAWiJ,cAAX,EAA4B;KA9F3G;AAiGA5B,MAAAA,QAAQ,CAAC6B,IAAT,CAAcC,WAAd,CAA0B/B,SAA1B;AACA,YAAMgC,MAAM,GAAG,MAAMjL,WAAW,CAACiJ,SAAD,EAAY;AAAEiC,QAAAA,KAAK,EAAE,CAAT;AAAYC,QAAAA,OAAO,EAAE;AAArB,OAAZ,CAAhC;AACA,YAAMC,OAAO,GAAGH,MAAM,CAACI,SAAP,CAAiB,WAAjB,CAAhB;AACA,YAAMC,GAAG,GAAG,IAAIrL,KAAJ,CAAU,GAAV,EAAe,IAAf,EAAqB,IAArB,CAAZ;AACA,YAAMoJ,KAAK,GAAG,MAAd;AACA,YAAMkC,MAAM,GAAGN,MAAM,CAACM,MAAP,GAAgBlC,KAAhB,GAAwB4B,MAAM,CAAC5B,KAA9C;AACAiC,MAAAA,GAAG,CAACE,QAAJ,CAAaJ,OAAb,EAAsB,KAAtB,EAA6B,CAA7B,EAAgC,CAAhC,EAAmC/B,KAAnC,EAA0CkC,MAA1C;AACArC,MAAAA,QAAQ,CAAC6B,IAAT,CAAcU,WAAd,CAA0BxC,SAA1B;AAEAqC,MAAAA,GAAG,CAACI,WAAJ,CAAgB,EAAhB;AACAJ,MAAAA,GAAG,CAACK,IAAJ,CAAU,OAAM9F,GAAG,CAAC6D,MAAJ,IAAc,EAAG,EAAjC,EAAoCL,KAAK,GAAG,GAA5C,EAAiD,GAAjD;AACAiC,MAAAA,GAAG,CAACK,IAAJ,CAAS,sBAAT,EAAiCtC,KAAK,GAAG,GAAzC,EAA8C,GAA9C;AAEA,YAAMuC,IAAI,GAAGN,GAAG,CAACO,MAAJ,CAAW,MAAX,CAAb;AACA,YAAMC,GAAG,GAAGC,GAAG,CAACC,eAAJ,CAAoBJ,IAApB,CAAZ;AACA,YAAMK,MAAM,GAAGC,MAAM,CAACC,IAAP,EAAf;AACAF,MAAAA,MAAM,CAAC/C,QAAP,CAAgBkD,KAAhB,CAAuB;;;uEAG4CN,GAAI;;KAHvE;AAMAG,MAAAA,MAAM,CAAC/C,QAAP,CAAgBmD,KAAhB;AACD,KAvcmC;;AAAA,SAycpCC,kBAzcoC,GAycf,mBACnB;AAAK,MAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,wBAAf;AAAwC,MAAA,KAAK,EAAE;AAAEjD,QAAAA,KAAK,EAAE;AAAT,OAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,eAEE;AACE,MAAA,SAAS,EAAC,cADZ;AAEE,MAAA,IAAI,EAAE,CAFR;AAGE,MAAA,KAAK,EAAE,KAAKjJ,KAAL,CAAWY,YAHpB;AAIE,MAAA,QAAQ,EAAE,KAAKqE,wBAJjB;AAKE,MAAA,WAAW,EAAC,4BALd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFF,eASE;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAQ,MAAA,SAAS,EAAC,wBAAlB;AAA2C,MAAA,OAAO,EAAE,KAAKD,iBAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAQ,MAAA,SAAS,EAAC,gBAAlB;AAAmC,MAAA,OAAO,EAAE,KAAKG,mBAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,CATF,CADF,CA1ckC;;AAAA,SA4dtCgH,gBA5dsC,GA4dnB,MAAM;AACvB;AACA,YAAMC,YAAY,GAAG,CAAC,GAAG,KAAKpM,KAAL,CAAWC,MAAf,EAAuBoB,IAAvB,CAA4B,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACzD;AACA,YAAID,CAAC,CAACoD,MAAF,KAAa,UAAb,IAA2BnD,CAAC,CAACmD,MAAF,KAAa,UAA5C,EAAwD,OAAO,CAAP;AACxD,YAAInD,CAAC,CAACmD,MAAF,KAAa,UAAb,IAA2BpD,CAAC,CAACoD,MAAF,KAAa,UAA5C,EAAwD,OAAO,CAAC,CAAR,CAHC,CAKzD;;AACA,cAAM2H,KAAK,GAAG,IAAI5K,IAAJ,CAASH,CAAC,CAACK,SAAF,IAAeL,CAAC,CAACuI,SAAjB,IAA8B,CAAvC,CAAd;AACA,cAAMyC,KAAK,GAAG,IAAI7K,IAAJ,CAASF,CAAC,CAACI,SAAF,IAAeJ,CAAC,CAACsI,SAAjB,IAA8B,CAAvC,CAAd;AACA,eAAOyC,KAAK,GAAGD,KAAf,CARyD,CAQnC;AACvB,OAToB,CAArB;AAWA,0BACE;AAAK,QAAA,SAAS,EAAC,uBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,wDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAI,QAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,CADF,eAIE;AAAK,QAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,SAAS,EAAC,kCAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,SAAS,EAAC,aAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAI,QAAA,KAAK,EAAE;AAAEE,UAAAA,QAAQ,EAAE;AAAZ,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBALF,eAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBANF,eAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAPF,eAQE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBARF,CADF,CADF,eAaE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,KAAKvM,KAAL,CAAWC,MAAX,CAAkBgB,GAAlB,CAAsB,CAACe,CAAD,EAAIwK,CAAJ,KAAU;AAC/B,YAAIC,WAAW,GAAG,iBAAlB;AACA,YAAIzK,CAAC,CAAC0C,MAAF,KAAa,SAAjB,EAA4B+H,WAAW,GAAG,eAAd,CAA5B,KACK,IAAIzK,CAAC,CAAC0C,MAAF,KAAa,UAAjB,EAA6B+H,WAAW,GAAG,eAAd,CAA7B,KACA,IAAIzK,CAAC,CAAC0C,MAAF,KAAa,UAAjB,EAA6B+H,WAAW,GAAG,cAAd,CAA7B,KACA,IAAIzK,CAAC,CAAC0C,MAAF,KAAa,YAAjB,EAA+B+H,WAAW,GAAG,YAAd,CAA/B,KACA,IAAIzK,CAAC,CAAC0C,MAAF,KAAa,uBAAjB,EAA0C+H,WAAW,GAAG,eAAd;AAE/C,4BACE;AAAI,UAAA,GAAG,EAAED,CAAT;AAAY,UAAA,KAAK,EAAE;AAAED,YAAAA,QAAQ,EAAE;AAAZ,WAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AACE,UAAA,SAAS,EAAC,kBADZ;AAEE,UAAA,OAAO,EAAE,MAAM,KAAKhI,WAAL,CAAiBvC,CAAjB,CAFjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAIGA,CAAC,CAAC4H,OAJL,CADF,CADF,eASE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAK5H,CAAC,CAACgC,QAAP,CATF,eAUE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAKhC,CAAC,CAAC6H,SAAP,CAVF,eAWE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAK7H,CAAC,CAAC0K,MAAP,CAXF,eAYE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAK1K,CAAC,CAACgB,UAAP,CAZF,eAaE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AACE,UAAA,SAAS,EAAG,SAAQyJ,WAAY,EADlC;AAEE,UAAA,KAAK,EAAE;AAAEF,YAAAA,QAAQ,EAAE;AAAZ,WAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAEgCvK,CAAC,CAAC0C,MAFlC,CADF,CAbF,eAkBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAK1C,CAAC,CAACpB,YAAF,IAAkB,GAAvB,CAlBF,eAmBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AACE,UAAA,SAAS,EAAC,2BADZ;AAEE,UAAA,OAAO,EAAE,MAAM,KAAKyE,mBAAL,CAAyBrD,CAAzB,CAFjB;AAGE,UAAA,KAAK,EAAE;AAAEuK,YAAAA,QAAQ,EAAE,MAAZ;AAAoBI,YAAAA,KAAK,EAAE,SAA3B;AAAsCC,YAAAA,MAAM,EAAE;AAA9C,WAHT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,CAnBF,CADF;AA6BD,OArCA,CADH,EAuCG,KAAK5M,KAAL,CAAWC,MAAX,CAAkBgE,MAAlB,KAA6B,CAA7B,iBACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAI;AAAI,QAAA,OAAO,EAAC,GAAZ;AAAgB,QAAA,SAAS,EAAC,aAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAJ,CAxCJ,CAbF,CADF,CAJF,CADF,CADF;AAoED,KA7iBqC;;AAAA,SAgjBtC4I,cAhjBsC,GAgjBrB,MAAM;AAAA;;AACrB,YAAM;AAAElM,QAAAA,YAAF;AAAgBT,QAAAA,SAAhB;AAA2BC,QAAAA,QAA3B;AAAqCC,QAAAA;AAArC,UAAmD,KAAKJ,KAA9D;AACA,UAAI,CAACW,YAAL,EAAmB,OAAO,IAAP;AAEnB,0BACE;AAAK,QAAA,SAAS,EAAC,wDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAkBA,YAAY,CAACiJ,OAA/B,CADF,eAEE;AAAM,QAAA,QAAQ,EAAE,KAAKhG,gBAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAEjD,YAAY,CAACiJ,OAHtB;AAIE,QAAA,QAAQ,MAJV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CADF,eAUE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAEjJ,YAAY,CAACkJ,SAHtB;AAIE,QAAA,QAAQ,EAAEhG,CAAC,IAAI,KAAKvB,qBAAL,CAA2B,WAA3B,EAAwCuB,CAAC,CAACqB,MAAF,CAAS1C,KAAjD,CAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAVF,eAmBE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAE7B,YAAY,CAACqD,QAHtB;AAIE,QAAA,QAAQ,EAAEH,CAAC,IAAI,KAAKvB,qBAAL,CAA2B,UAA3B,EAAuCuB,CAAC,CAACqB,MAAF,CAAS1C,KAAhD,CAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAnBF,eA4BE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAE7B,YAAY,CAAC+D,MAHtB;AAIE,QAAA,QAAQ,MAJV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CA5BF,CADF,eAuCE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAE/D,YAAY,CAAC+L,MAHtB;AAIE,QAAA,QAAQ,EAAE7I,CAAC,IAAI,KAAKvB,qBAAL,CAA2B,QAA3B,EAAqCuB,CAAC,CAACqB,MAAF,CAAS1C,KAA9C,CAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CADF,eAUE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAE7B,YAAY,CAACmJ,QAHtB;AAIE,QAAA,QAAQ,EAAEjG,CAAC,IAAI,KAAKvB,qBAAL,CAA2B,UAA3B,EAAuCuB,CAAC,CAACqB,MAAF,CAAS1C,KAAhD,CAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAVF,eAmBE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,eAEE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAE7B,YAAY,CAACqC,UAHtB;AAIE,QAAA,QAAQ,MAJV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAnBF,eA4BE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAErC,YAAY,CAACsC,SAHtB;AAIE,QAAA,QAAQ,MAJV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CA5BF,CAvCF,eA6EE;AAAI,QAAA,SAAS,EAAC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBA7EF,eA8EE;AAAO,QAAA,SAAS,EAAC,+BAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,SAAS,EAAC,aAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBALF,eAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBANF,CADF,CADF,eAWE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCACGtC,YAAY,CAACkC,SADhB,0DACG,sBAAwB5B,GAAxB,CAA4B,CAACkC,IAAD,EAAOR,GAAP,kBAC3B;AAAI,QAAA,GAAG,EAAEA,GAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKQ,IAAI,CAACoD,QAAV,CADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKpD,IAAI,CAACqH,eAAV,CAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,KAAK,EAAErH,IAAI,CAACC,GAFd;AAGE,QAAA,QAAQ,EAAES,CAAC,IAAI,KAAKnB,wBAAL,CAA8BC,GAA9B,EAAmC,KAAnC,EAA0CkB,CAAC,CAACqB,MAAF,CAAS1C,KAAnD,CAHjB;AAIE,QAAA,KAAK,EAAE;AAAEyG,UAAAA,KAAK,EAAE;AAAT,SAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAHF,eAWE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,KAAK,EAAE9F,IAAI,CAACG,SAFd;AAGE,QAAA,QAAQ,EAAEO,CAAC,IAAI,KAAKnB,wBAAL,CAA8BC,GAA9B,EAAmC,WAAnC,EAAgDkB,CAAC,CAACqB,MAAF,CAAS1C,KAAzD,CAHjB;AAIE,QAAA,KAAK,EAAE;AAAEyG,UAAAA,KAAK,EAAE;AAAT,SAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAXF,eAmBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAK9F,IAAI,CAACK,MAAV,CAnBF,eAoBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKL,IAAI,CAAC2J,SAAV,CApBF,CADD,CADH,CAXF,CA9EF,eAoHE;AAAK,QAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAQ,QAAA,IAAI,EAAC,QAAb;AAAsB,QAAA,SAAS,EAAC,sBAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAQ,QAAA,IAAI,EAAC,QAAb;AAAsB,QAAA,SAAS,EAAC,mBAAhC;AAAoD,QAAA,OAAO,EAAE,KAAKzK,aAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF,CApHF,CAFF,CADF;AA8HD,KAlrBqC;;AAAA,SAmrBpC0K,kBAnrBoC,GAmrBf,MAAM;AAAA;;AACzB,YAAM/K,CAAC,GAAG,KAAKhC,KAAL,CAAWK,aAArB;AACA,UAAI,CAAC2B,CAAL,EAAQ,OAAO,IAAP;AAER,YAAMmF,QAAQ,GAAG,iBAAAnF,CAAC,CAACa,SAAF,8DAAauE,MAAb,CACf,CAACC,GAAD,EAAMlE,IAAN,KAAekE,GAAG,IAAIhE,UAAU,CAACF,IAAI,CAAC2J,SAAN,CAAV,IAA8B,CAAlC,CADH,EAEf,CAFe,MAGZ,CAHL;AAKA,YAAMxF,cAAc,GAAGjE,UAAU,CAACrB,CAAC,CAACsF,cAAF,IAAoB,CAArB,CAAjC;AACA,YAAMrE,SAAS,GAAGI,UAAU,CAACrB,CAAC,CAACiB,SAAF,IAAe,CAAhB,CAA5B;AACA,YAAMyE,UAAU,GAAGrE,UAAU,CAACrB,CAAC,CAACgB,UAAF,IAAgBmE,QAAQ,GAAGG,cAAX,GAA4BrE,SAA7C,CAA7B;AAEA,YAAM0E,WAAW,GAAI,OAAM7H,OAAO,CAAC8H,IAAI,CAACC,KAAL,CAAWH,UAAX,CAAD,CAAyB,OAA3D,CAbyB,CAezB;;AACA,YAAM1D,QAAQ,GAAG,KAAKhE,KAAL,CAAWE,SAAX,CAAqBwF,IAArB,CACfC,CAAC,IAAIA,CAAC,CAACC,aAAF,KAAoB5D,CAAC,CAACgC,QAAtB,IAAkC2B,CAAC,CAACE,QAAF,KAAe7D,CAAC,CAACgC,QADzC,KAEZ,EAFL;AAIA,0BACE;AAAK,QAAA,SAAS,EAAC,wDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,wDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAI,QAAA,SAAS,EAAC,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAiDhC,CAAC,CAAC4H,OAAnD,CADF,eAEE;AAAK,QAAA,SAAS,EAAC,2BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACI,QAAA,SAAS,EAAC,6BADd;AAEI,QAAA,OAAO,EAAE,MAAM,KAAKzH,YAAL,CAAkBH,CAAlB,CAFnB;AAGI,QAAA,QAAQ,EAAEA,CAAC,CAAC0C,MAAF,KAAa,SAAb,IAA0B1C,CAAC,CAAC0C,MAAF,KAAa,uBAHrD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAQE;AACE,QAAA,SAAS,EAAC,gCADZ;AAEE,QAAA,KAAK,EAAE;AAAEsI,UAAAA,gBAAgB,EAAE,MAApB;AAA4BC,UAAAA,GAAG,EAAE,MAAjC;AAAyCV,UAAAA,QAAQ,EAAE,MAAnD;AAA2DI,UAAAA,KAAK,EAAE,SAAlE;AAA6EC,UAAAA,MAAM,EAAE;AAArF,SAFT;AAGE,QAAA,OAAO,EAAE,MAAM,KAAKvH,mBAAL,CAAyBrD,CAAzB,CAHjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARF,CAFF,CADF,eAkBE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAA1B,OAA4CA,CAAC,CAACgC,QAA9C,CADF,eAEE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAA1B,OAAwChC,CAAC,CAAC6H,SAA1C,CAFF,eAGE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA1B,OAA0C7H,CAAC,CAAC0C,MAA5C,CAHF,CAlBF,eAuBE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eACiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADjB,EAEG1C,CAAC,CAACgI,MAAF,IAAY,GAFf,eAGE;AAAK,QAAA,SAAS,EAAC,MAAf;AAAsB,QAAA,KAAK,EAAE;AAAEuC,UAAAA,QAAQ,EAAE;AAAZ,SAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,OACiBvI,QAAQ,CAACgC,KAAT,IAAkB,GADnC,eACuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADvC,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF,OAEiBhC,QAAQ,CAACwF,KAAT,IAAkB,GAFnC,eAEuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFvC,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHF,OAGiBxF,QAAQ,CAACmG,KAAT,IAAkB,GAHnC,CAHF,CADF,eAUE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eACiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADjB,EAEGnI,CAAC,CAACoI,MAAF,IAAY,GAFf,CAVF,CAvBF,eAsCE;AAAI,QAAA,SAAS,EAAC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAtCF,eAuCE;AAAO,QAAA,SAAS,EAAC,+BAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,SAAS,EAAC,aAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBALF,eAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBANF,CADF,CADF,eAWE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BACGpI,CAAC,CAACa,SADL,kDACG,cAAa5B,GAAb,CAAiB,CAACkC,IAAD,EAAOqJ,CAAP,kBAChB;AAAI,QAAA,GAAG,EAAEA,CAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKrJ,IAAI,CAACoD,QAAV,CADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKpD,IAAI,CAACqH,eAAV,CAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKrH,IAAI,CAACC,GAAV,CAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKD,IAAI,CAACG,SAAV,CAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKH,IAAI,CAACK,MAAV,CALF,eAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKL,IAAI,CAAC2J,SAAV,CANF,CADD,CADH,CAXF,CAvCF,eA+DE;AAAK,QAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAAH,OAAqB3F,QAAQ,CAACxD,OAAT,CAAiB,CAAjB,CAArB,CADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAH,OAA4B2D,cAAc,CAAC3D,OAAf,CAAuB,CAAvB,CAA5B,CAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAH,OAAuBV,SAAS,CAACU,OAAV,CAAkB,CAAlB,CAAvB,CAHF,eAIE;AAAG,QAAA,SAAS,EAAC,IAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAAlB,OAAuC+D,UAAU,CAAC/D,OAAX,CAAmB,CAAnB,CAAvC,CAJF,eAKE;AAAG,QAAA,SAAS,EAAC,IAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAlB,OAA2CgE,WAA3C,CALF,CA/DF,eAsEE;AAAK,QAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,OACyB3F,CAAC,CAACpB,YAAF,IAAkB,GAD3C,CAtEF,eAyEE;AAAK,QAAA,SAAS,EAAC,yBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,SAAS,EAAC,iBADZ;AAEE,QAAA,OAAO,EAAE,MAAM;AACfkB,UAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ,EAA0CC,CAA1C;AACA,eAAKyC,YAAL,CAAkBzC,CAAC,CAACb,EAApB,EAAwB,UAAxB;AACD,SALD;AAME,QAAA,QAAQ,EAAEa,CAAC,CAAC0C,MAAF,KAAa,uBANzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,eAWE;AACE,QAAA,SAAS,EAAC,gBADZ;AAEE,QAAA,OAAO,EAAE,KAAKK,gBAFhB;AAGE,QAAA,QAAQ,EAAE/C,CAAC,CAAC0C,MAAF,KAAa,uBAHzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAXF,eAkBE;AACE,QAAA,SAAS,EAAC,mBADZ;AAEE,QAAA,OAAO,EAAE,KAAKF,YAFhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAlBF,CAzEF,EAkGG,KAAKxE,KAAL,CAAWS,gBAAX,IAA+B,KAAKyL,kBAAL,EAlGlC,CADF;AAsGD,KA7yBmC;AAAA;;AAkCpCgB,EAAAA,iBAAiB,GAAG;AAClB,SAAKrM,WAAL;AACA,SAAKuD,cAAL;AACA,SAAKC,aAAL;AACA,SAAKC,cAAL;AACD;;AAwwBD6I,EAAAA,MAAM,GAAG;AACP,wBACE;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKnN,KAAL,CAAWU,YAAX,GACC,KAAKmM,cAAL,EADD,GAEC,KAAK7M,KAAL,CAAWM,WAAX,GACE,KAAKyM,kBAAL,EADF,GAEE,KAAKZ,gBAAL,EALN,CADF;AASD;;AAzzBmC;;AA4zBtC,eAAepM,aAAf","sourcesContent":["import React, { Component } from \"react\";\r\nimport { db } from \"../../../../firebase\";\r\nimport { collection, getDocs, updateDoc, doc,getDoc, query, where  } from \"firebase/firestore\";\r\nimport html2canvas from \"html2canvas\";\r\nimport { jsPDF } from \"jspdf\";\r\nimport { toWords } from \"number-to-words\";\r\n\r\nclass OrderApproval extends Component {\r\n  state = {\r\n    orders: [],\r\n    customers: [],\r\n    products: [],\r\n    taxGroups: [],\r\n    selectedOrder: null,\r\n    previewMode: false,\r\n    loading: false,\r\n    error: null,\r\n    showRejectDialog: false,\r\n    showEditForm: false,\r\n    editFormData: null,\r\n    rejectReason: \"\",\r\n  };\r\n\r\n  fetchOrders = async () => {\r\n  this.setState({ loading: true, error: null });\r\n  try {\r\n    const snap = await getDocs(collection(db, \"orders\"));\r\n    const orders = snap.docs.map(d => ({ id: d.id, ...d.data() }));\r\n    orders.sort((a,b)=>{\r\n      const dateA = new Date(a.quoteDate || a.createdAt?.toDate?.() || a.createdAt || 0);\r\n      const dateB = new Date(b.quoteDate || b.createdAt?.toDate?.() || b.createdAt || 0);\r\n      return dateB - dateA;\r\n    });\r\n    this.setState({ orders, loading: false });\r\n    console.log(\"Fetched orders ids:\", orders.map(o => o.id));\r\n  } catch (err) {\r\n    this.setState({ error: err.message, loading: false });\r\n  }\r\n};\r\n\r\n\r\n  componentDidMount() {\r\n    this.fetchOrders();\r\n    this.fetchCustomers();\r\n    this.fetchProducts();\r\n    this.fetchTaxGroups();\r\n  }\r\nopenEditForm = (order) => {\r\n  this.setState({ showEditForm: true, editFormData: { ...order } });\r\n};\r\n\r\ncloseEditForm = () => {\r\n  this.setState({ showEditForm: false, editFormData: null });\r\n};\r\n\r\nhandleEditInputChange = (field, value) => {\r\n  this.setState(prev => ({\r\n    editFormData: { ...prev.editFormData, [field]: value }\r\n  }));\r\n};\r\n\r\nhandleEditLineItemChange = (idx, field, value) => {\r\n  const items = [...this.state.editFormData.lineItems];\r\n  items[idx] = { ...items[idx], [field]: value };\r\n  this.setState(prev => ({\r\n    editFormData: { ...prev.editFormData, lineItems: items }\r\n  }), this.recalculateEditTotals);\r\n};\r\nrecalculateEditTotals = () => {\r\n  const { lineItems, discountPercent } = this.state.editFormData;\r\n  let orderValue = 0;\r\n  let taxAmount = 0;\r\n  (lineItems || []).forEach(item => {\r\n    const qty = parseFloat(item.qty || 0);\r\n    const unitPrice = parseFloat(item.unitPrice || 0);\r\n    const baseTotal = qty * unitPrice;\r\n    const taxAmt = parseFloat(item.taxAmt || 0);\r\n    orderValue += baseTotal + taxAmt;\r\n    taxAmount += taxAmt;\r\n\r\n  });\r\n  const discountAmount = (orderValue * parseFloat(discountPercent || 0)) / 100;\r\n  const afterDiscountValue = orderValue - discountAmount;\r\n  this.setState(prev => ({\r\n    editFormData: {\r\n      ...prev.editFormData,\r\n      orderValue: orderValue.toFixed(2),\r\n      taxAmount: taxAmount.toFixed(2),\r\n      discountAmount: discountAmount.toFixed(2),\r\n      afterDiscountValue: afterDiscountValue.toFixed(2)\r\n    }\r\n  }));\r\n};\r\n\r\nhandleEditSubmit = async (e) => {\r\n  e.preventDefault();\r\n  const { editFormData } = this.state;\r\n  if (!editFormData) return alert(\"No data to save\");\r\n  if (!editFormData.customer) return alert(\"Customer is required\");\r\n  if (!editFormData.lineItems || editFormData.lineItems.length === 0) return alert(\"At least one line item is required\");\r\n  if (!editFormData.id) return alert(\"Order ID missing – cannot update!\");\r\n\r\n  try {\r\n    const ref = doc(db, \"orders\", editFormData.id);\r\n    const snap = await getDoc(ref);\r\n    if (!snap.exists()) {\r\n      return alert(`Order not found: ${editFormData.id}`);\r\n    }\r\n\r\n    await updateDoc(ref, editFormData);\r\n    alert(\"Order updated!\");\r\n    this.setState({ showEditForm: false, editFormData: null });\r\n    this.fetchOrders();\r\n  } catch (err) {\r\n    console.error(\"handleEditSubmit error:\", err);\r\n    alert(\"Error updating order: \" + err.message);\r\n  }\r\n};\r\n  \r\n\r\n  fetchCustomers = async () => {\r\n    const snap = await getDocs(collection(db, \"customers\"));\r\n    const customers = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ customers });\r\n  };\r\n\r\n  fetchProducts = async () => {\r\n    const snap = await getDocs(collection(db, \"products\"));\r\n    const products = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ products });\r\n  };\r\n\r\n  fetchTaxGroups = async () => {\r\n    const snap = await getDocs(collection(db, \"taxGroups\"));\r\n    const taxGroups = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ taxGroups });\r\n  };\r\n\r\n openPreview = (order) => {\r\n  console.log(\"openPreview order:\", order);\r\n  this.setState({ selectedOrder: order, previewMode: true });\r\n};\r\n\r\n// and/or in the Approve button:\r\n\r\n\r\n\r\n  closePreview = () => {\r\n    this.setState({ selectedOrder: null, previewMode: false });\r\n  };\r\n\r\nupdateStatus = async (id, status, rejectReason = \"\") => {\r\n  console.log(\"updateStatus called:\", { id, status, rejectReason });\r\n  if (!id) return alert(\"Missing order id — cannot update\");\r\n\r\n  this.setState({ loading: true, error: null });\r\n  try {\r\n    const ref = doc(db, \"orders\", id);\r\n    const snap = await getDoc(ref);\r\n\r\n    if (!snap.exists()) {\r\n      const q = query(collection(db, \"orders\"), where(\"orderNo\", \"==\", id));\r\n      const found = await getDocs(q);\r\n      if (!found.empty) {\r\n        const realId = found.docs[0].id;\r\n        console.log(\"Found by orderNo, using id:\", realId);\r\n        await updateDoc(doc(db, \"orders\", realId), { status, rejectReason });\r\n      } else {\r\n        this.setState({ loading: false });\r\n        return alert(`No order found with id or orderNo \"${id}\".`);\r\n      }\r\n    } else {\r\n      await updateDoc(ref, { status, rejectReason });\r\n    }\r\n\r\n    alert(`Order ${status}`);\r\n    await this.fetchOrders();\r\n    this.setState({ selectedOrder: null, previewMode: false, showRejectDialog: false, rejectReason: \"\", loading: false });\r\n  } catch (err) {\r\n    console.error(\"updateStatus error:\", err);\r\n    this.setState({ error: err.message, loading: false });\r\n    alert(\"Error updating status: \" + err.message);\r\n  }\r\n};\r\n\r\n\r\n\r\n  openRejectDialog = () => {\r\n    this.setState({ showRejectDialog: true, rejectReason: \"\" });\r\n  };\r\n\r\n  closeRejectDialog = () => {\r\n    this.setState({ showRejectDialog: false, rejectReason: \"\" });\r\n  };\r\n\r\n  handleRejectReasonChange = (e) => {\r\n    this.setState({ rejectReason: e.target.value });\r\n  };\r\n\r\n  handleRejectConfirm = () => {\r\n    const { selectedOrder, rejectReason } = this.state;\r\n    if (!rejectReason.trim()) {\r\n      alert(\"Please enter a reason for rejection.\");\r\n      return;\r\n    }\r\n    this.updateStatus(selectedOrder.id, \"Rejected\", rejectReason);\r\n  };\r\n\r\n  showOrderPDFWithOrg = async (order) => {\r\n    if (!order || !Array.isArray(order.lineItems) || order.lineItems.length === 0) {\r\n      alert(\"Order data is incomplete.\");\r\n      return;\r\n    }\r\n\r\n    // 1. Fetch org and customer data\r\n    const orgSnap = await getDocs(collection(db, 'businessGroups'));\r\n    const org = orgSnap.docs[0]?.data() || {};\r\n    const customer = this.state.customers.find(\r\n      c => c.custshortName === order.customer || c.custname === order.customer\r\n    ) || {};\r\n\r\n    // GST State Map for Place of Supply\r\n    const gstStateMap = {\r\n      \"01\": \"Jammu & Kashmir\", \"02\": \"Himachal Pradesh\", \"03\": \"Punjab\", \"04\": \"Chandigarh\",\r\n      \"05\": \"Uttarakhand\", \"06\": \"Haryana\", \"07\": \"Delhi\", \"08\": \"Rajasthan\", \"09\": \"Uttar Pradesh\",\r\n      \"10\": \"Bihar\", \"11\": \"Sikkim\", \"12\": \"Arunachal Pradesh\", \"13\": \"Nagaland\", \"14\": \"Manipur\",\r\n      \"15\": \"Mizoram\", \"16\": \"Tripura\", \"17\": \"Meghalaya\", \"18\": \"Assam\", \"19\": \"West Bengal\",\r\n      \"20\": \"Jharkhand\", \"21\": \"Odisha\", \"22\": \"Chhattisgarh\", \"23\": \"Madhya Pradesh\", \"24\": \"Gujarat\",\r\n      \"25\": \"Daman and Diu\", \"26\": \"Dadra and Nagar Haveli\", \"27\": \"Maharashtra\", \"28\": \"Andhra Pradesh (Old)\",\r\n      \"29\": \"Karnataka\", \"30\": \"Goa\", \"31\": \"Lakshadweep\", \"32\": \"Kerala\", \"33\": \"Tamil Nadu\",\r\n      \"34\": \"Puducherry\", \"35\": \"Andaman and Nicobar Islands\", \"36\": \"Telangana\", \"37\": \"Andhra Pradesh\",\r\n      \"97\": \"Other Territory\"\r\n    };\r\n\r\n    const getPlaceOfSupply = (gstin) => {\r\n      if (!gstin || gstin.length < 2) return '';\r\n      const code = gstin.substring(0, 2);\r\n      const state = gstStateMap[code];\r\n      return state ? `${code} - ${state}` : '';\r\n    };\r\n\r\n    // 2. Enrich line items\r\n    const enrichedItems = order.lineItems.map(item => {\r\n      const product = this.state.products.find(p => p.productId === item.itemCode) || {};\r\n      return {\r\n        ...item,\r\n        ptshortName: product.ptshortName || '',\r\n        hsnCode: product.hsnCode || '',\r\n        uom: product.stockingUOM || '',\r\n        cgst: item.cgst || 0,\r\n        sgst: item.sgst || 0,\r\n        igst: item.igst || 0,\r\n        taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\r\n      };\r\n    });\r\n\r\n    // 3. Subtotal (without tax)\r\n    const subtotal = enrichedItems.reduce((sum, item) => sum + ((parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0)), 0);\r\n    const freightCharges = parseFloat(order.freightCharges || 0);\r\n    const freightTax = parseFloat(order.freighttaxAmount || 0);\r\n    const totalTaxAmount = parseFloat(order.taxAmount || 0);\r\n    const grandTotal = parseFloat(order.orderValue || (subtotal + totalTaxAmount));\r\n    const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`;\r\n\r\n    // 4. Tax breakdown by group\r\n    let taxBreakdown = {};\r\n    let taxGroupDetails = [];\r\n    let sno = 1;\r\n    enrichedItems.forEach(item => {\r\n      const qty = parseFloat(item.qty || 0);\r\n      const unitPrice = parseFloat(item.unitPrice || 0);\r\n      const base = qty * unitPrice;\r\n      (item.taxGroupNames || []).forEach(tgName => {\r\n        const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\r\n        if (group) {\r\n          group.lineItems.forEach(li => {\r\n            const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\r\n            let taxAmt = 0;\r\n            if (li.type === 'Amount') taxAmt = parseFloat(li.percentOrAmt || 0);\r\n            else taxAmt = (base * parseFloat(li.percentOrAmt || 0)) / 100;\r\n            taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n            taxGroupDetails.push({\r\n              sno: sno++,\r\n              group: tgName,\r\n              peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\r\n              taxAmt: taxAmt.toFixed(2)\r\n            });\r\n          });\r\n        }\r\n      });\r\n      // Legacy support for cgst/sgst/igst\r\n      if (item.cgst) {\r\n        const key = `CGST ${item.cgst}%`;\r\n        const taxAmt = (base * item.cgst) / 100;\r\n        taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n        taxGroupDetails.push({\r\n          sno: sno++,\r\n          group: key,\r\n          peramt: `${item.cgst}%`,\r\n          taxAmt: taxAmt.toFixed(2)\r\n        });\r\n      }\r\n      if (item.sgst) {\r\n        const key = `SGST ${item.sgst}%`;\r\n        const taxAmt = (base * item.sgst) / 100;\r\n        taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n        taxGroupDetails.push({\r\n          sno: sno++,\r\n          group: key,\r\n          peramt: `${item.sgst}%`,\r\n          taxAmt: taxAmt.toFixed(2)\r\n        });\r\n      }\r\n      if (item.igst) {\r\n        const key = `IGST ${item.igst}%`;\r\n        const taxAmt = (base * item.igst) / 100;\r\n        taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n        taxGroupDetails.push({\r\n          sno: sno++,\r\n          group: key,\r\n          peramt: `${item.igst}%`,\r\n          taxAmt: taxAmt.toFixed(2)\r\n        });\r\n      }\r\n    });\r\n    if (freightTax > 0) {\r\n      taxBreakdown[\"Freight Tax\"] = freightTax;\r\n      taxGroupDetails.push({\r\n        sno: sno++,\r\n        group: \"Freight Tax\",\r\n        peramt: \"-\",\r\n        taxAmt: freightTax.toFixed(2)\r\n      });\r\n    }\r\n\r\n    // 5. Build HTML for PDF\r\n    const container = document.createElement('div');\r\n    container.id = 'pdf-preview-container';\r\n    container.style.width = '794px';\r\n    container.style.padding = '40px';\r\n    container.style.fontFamily = 'Arial';\r\n\r\n    container.innerHTML = `\r\n      <div style=\"display:flex; justify-content:space-between; align-items:center;\">\r\n        <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\r\n        <div style=\"font-size:18px; font-weight:bold;\">CUSTOMER ORDER</div>\r\n      </div>\r\n      <hr/>\r\n      <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n        <div style=\"line-height:1.5; width:50%;\">\r\n          <b>${org.bgName || ''}</b><br/>\r\n          ${org.address || ''}<br/>\r\n          <b>Email:</b> ${org.email || ''}<br/>\r\n          <b>Website:</b> ${org.website || ''}<br/>\r\n          <b>GSTIN:</b> ${org.gstin || ''}<br/>\r\n          <b>Mobile:</b> ${org.mobile || ''}<br/>\r\n          <b>CIN:</b> ${org.cin || ''}\r\n        </div>\r\n        <table style=\"font-size:11px; text-align:left;\">\r\n          <tr><td><b>Order No</b></td><td>: ${order.orderNo}</td></tr>\r\n          <tr><td><b>Order Date</b></td><td>: ${order.orderDate}</td></tr>\r\n          <tr><td><b>Currency</b></td><td>: ${order.currency || 'INR'}</td></tr>\r\n          <tr><td><b>Despatch</b></td><td>: ${order.despatchMode || ''}</td></tr>\r\n        </table>\r\n      </div>\r\n\r\n      <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\r\n        <div style=\"width:48%;\">\r\n          <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\r\n          <div style=\"border:1px solid #ccc; padding:6px;\">\r\n           <b>${order.customer || ''}</b><br/>\r\n            ${order.billTo?.replace(/\\n/g, '<br/>') || ''}\r\n          </div>\r\n          <div style=\"font-size:10px; margin-top:6px;\">\r\n              <b>GSTIN:</b> ${customer.gstin || ''}<br/>\r\n              <b>Email:</b> ${customer.email || ''}<br/>\r\n              <b>Contact:</b> ${customer.contactPerson || ''}<br/>\r\n              <b>Phone:</b> ${customer.phone || ''}\r\n          </div>\r\n        </div>\r\n        <div style=\"width:48%;\">\r\n          <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\r\n          <div style=\"border:1px solid #ccc; padding:6px;\">\r\n           <b>${order.customer || ''}</b><br/>\r\n            ${order.shipTo?.replace(/\\n/g, '<br/>') || ''}\r\n          </div>\r\n          <div style=\"font-size:10px; margin-top:6px;\">\r\n            <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\r\n        <thead>\r\n          <tr style=\"background:#f4f6fa;\">\r\n            <th style=\"border:1px solid #011b56;\">Item Code</th>\r\n            <th style=\"border:1px solid #011b56;\">Description</th>\r\n            <th style=\"border:1px solid #011b56;\">HSN</th>\r\n            <th style=\"border:1px solid #011b56;\">UOM</th>\r\n            <th style=\"border:1px solid #011b56;\">Qty</th>\r\n            <th style=\"border:1px solid #011b56;\">Unit Price</th>\r\n            <th style=\"border:1px solid #011b56;\">GST%</th>\r\n            <th style=\"border:1px solid #011b56;\">Item Total</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          ${enrichedItems.map(item => {\r\n            const gstLabel = (item.taxGroupNames && item.taxGroupNames.length)\r\n              ? item.taxGroupNames.join(', ')\r\n              : (item.taxGroupName || item.taxId || '-');\r\n            return `\r\n              <tr>\r\n                <td style=\"border:1px solid #011b56;\">${item.itemCode}</td>\r\n                <td style=\"border:1px solid #011b56;\">${item.itemDescription}</td>\r\n                <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\r\n                <td style=\"border:1px solid #011b56;\">${item.uom}</td>\r\n                <td style=\"border:1px solid #011b56;\">${item.qty}</td>\r\n                <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\r\n                <td style=\"border:1px solid #011b56;\">${gstLabel}</td>\r\n                <td style=\"border:1px solid #011b56;\">${item.total}</td>\r\n              </tr>`;\r\n          }).join('')}\r\n          <tr>\r\n            <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\r\n            <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\r\n        </tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Grand Total</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${grandTotal.toFixed(2)}</b></td>\r\n        </tr>\r\n        </tbody>\r\n      </table>\r\n      <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\r\n      <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\r\n    `;\r\n\r\n    document.body.appendChild(container);\r\n    const canvas = await html2canvas(container, { scale: 2, useCORS: true });\r\n    const imgData = canvas.toDataURL('image/png');\r\n    const pdf = new jsPDF('p', 'pt', 'a4');\r\n    const width = 595.28;\r\n    const height = canvas.height * width / canvas.width;\r\n    pdf.addImage(imgData, 'PNG', 0, 0, width, height);\r\n    document.body.removeChild(container);\r\n\r\n    pdf.setFontSize(11);\r\n    pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\r\n    pdf.text('Authorized Signatory', width - 200, 800);\r\n\r\n    const blob = pdf.output('blob');\r\n    const url = URL.createObjectURL(blob);\r\n    const newWin = window.open();\r\n    newWin.document.write(`\r\n      <html><head><title>Order PDF Preview</title></head>\r\n      <body style=\"margin:0;\">\r\n        <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\r\n      </body></html>\r\n    `);\r\n    newWin.document.close();\r\n  };\r\n\r\n  renderRejectDialog = () => (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\" style={{ width: 400 }}>\r\n        <h5>Reject Reason</h5>\r\n        <textarea\r\n          className=\"form-control\"\r\n          rows={3}\r\n          value={this.state.rejectReason}\r\n          onChange={this.handleRejectReasonChange}\r\n          placeholder=\"Enter reason for rejection\"\r\n        />\r\n        <div className=\"text-right mt-3\">\r\n          <button className=\"btn btn-secondary mr-2\" onClick={this.closeRejectDialog}>Cancel</button>\r\n          <button className=\"btn btn-danger\" onClick={this.handleRejectConfirm}>Reject</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\nrenderOrderTable = () => {\r\n  // Apply sorting here\r\n  const sortedOrders = [...this.state.orders].sort((a, b) => {\r\n    // Approved at bottom, new at top\r\n    if (a.status === \"Approved\" && b.status !== \"Approved\") return 1;\r\n    if (b.status === \"Approved\" && a.status !== \"Approved\") return -1;\r\n\r\n    // Newest first by created date or orderNo\r\n    const aDate = new Date(a.createdAt || a.orderDate || 0);\r\n    const bDate = new Date(b.createdAt || b.orderDate || 0);\r\n    return bDate - aDate; // latest first\r\n  });\r\n\r\n  return (\r\n    <div className=\"card mt-4 full-height\">\r\n      <div className=\"card-body\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n          <h4 className=\"card-title\">Order Approval</h4>\r\n        </div>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr style={{ fontSize: '14px' }}>\r\n                <th>Order No</th>\r\n                <th>Customer</th>\r\n                <th>Date</th>\r\n                <th>Ref No</th>\r\n                <th>Order Value</th>\r\n                <th>Status</th>\r\n                <th>Reject Reason</th>\r\n                <th>Print</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {this.state.orders.map((o, i) => {\r\n                let statusClass = \"badge-secondary\";\r\n                if (o.status === \"Entered\") statusClass = \"badge-warning\";\r\n                else if (o.status === \"Approved\") statusClass = \"badge-success\";\r\n                else if (o.status === \"Rejected\") statusClass = \"badge-danger\";\r\n                else if (o.status === \"CO Created\") statusClass = \"badge-info\";\r\n                else if (o.status === \"Awaiting for Approval\") statusClass = \"badge-warning\";\r\n\r\n                return (\r\n                  <tr key={i} style={{ fontSize: '14px' }}>\r\n                    <td>\r\n                      <button\r\n                        className=\"btn btn-link p-0\"\r\n                        onClick={() => this.openPreview(o)}\r\n                      >\r\n                        {o.orderNo}\r\n                      </button>\r\n                    </td>\r\n                    <td>{o.customer}</td>\r\n                    <td>{o.orderDate}</td>\r\n                    <td>{o.qRefNo}</td>\r\n                    <td>{o.orderValue}</td>\r\n                    <td>\r\n                      <label\r\n                        className={`badge ${statusClass}`}\r\n                        style={{ fontSize: '14px' }}>{o.status}</label>\r\n                    </td>\r\n                    <td>{o.rejectReason || \"-\"}</td>\r\n                    <td>\r\n                      <i\r\n                        className=\"mdi mdi-printer menu-icon\"\r\n                        onClick={() => this.showOrderPDFWithOrg(o)}\r\n                        style={{ fontSize: '24px', color: '#2196F3', cursor: 'pointer' }}\r\n                      ></i>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n              {this.state.orders.length === 0 && (\r\n                <tr><td colSpan=\"7\" className=\"text-center\">No orders found.</td></tr>\r\n              )}\r\n             </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n// ...existing code...\r\n\r\nrenderEditForm = () => {\r\n  const { editFormData, customers, products, taxGroups } = this.state;\r\n  if (!editFormData) return null;\r\n\r\n  return (\r\n    <div className=\"card mt-4 p-4 shadow-sm full-height d-flex flex-column\">\r\n      <h4>Edit Order - {editFormData.orderNo}</h4>\r\n      <form onSubmit={this.handleEditSubmit}>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Order No</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={editFormData.orderNo}\r\n              readOnly\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Order Date</label>\r\n            <input\r\n              type=\"date\"\r\n              className=\"form-control\"\r\n              value={editFormData.orderDate}\r\n              onChange={e => this.handleEditInputChange(\"orderDate\", e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Customer</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={editFormData.customer}\r\n              onChange={e => this.handleEditInputChange(\"customer\", e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Status</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={editFormData.status}\r\n              readOnly\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Ref No</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={editFormData.qRefNo}\r\n              onChange={e => this.handleEditInputChange(\"qRefNo\", e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Currency</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={editFormData.currency}\r\n              onChange={e => this.handleEditInputChange(\"currency\", e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Order Value</label>\r\n            <input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              value={editFormData.orderValue}\r\n              readOnly\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Tax Amount</label>\r\n            <input\r\n              type=\"number\"\r\n              className=\"form-control\"\r\n              value={editFormData.taxAmount}\r\n              readOnly\r\n            />\r\n          </div>\r\n        </div>\r\n        <h5 className=\"mt-3\">Line Items</h5>\r\n        <table className=\"table table-bordered table-sm\">\r\n          <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Item Code</th>\r\n              <th>Description</th>\r\n              <th>Qty</th>\r\n              <th>Unit Price</th>\r\n              <th>Tax Amount</th>\r\n              <th>Item Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {editFormData.lineItems?.map((item, idx) => (\r\n              <tr key={idx}>\r\n                <td>{item.itemCode}</td>\r\n                <td>{item.itemDescription}</td>\r\n                <td>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={item.qty}\r\n                    onChange={e => this.handleEditLineItemChange(idx, \"qty\", e.target.value)}\r\n                    style={{ width: 80 }}\r\n                  />\r\n                </td>\r\n                <td>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={item.unitPrice}\r\n                    onChange={e => this.handleEditLineItemChange(idx, \"unitPrice\", e.target.value)}\r\n                    style={{ width: 80 }}\r\n                  />\r\n                </td>\r\n                <td>{item.taxAmt}</td>\r\n                <td>{item.itemTotal}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        <div className=\"mt-3 text-right\">\r\n          <button type=\"submit\" className=\"btn btn-success mr-2\">Save</button>\r\n          <button type=\"button\" className=\"btn btn-secondary\" onClick={this.closeEditForm}>Cancel</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n  renderOrderPreview = () => {\r\n    const o = this.state.selectedOrder;\r\n    if (!o) return null;\r\n\r\n    const subtotal = o.lineItems?.reduce(\r\n      (sum, item) => sum + (parseFloat(item.itemTotal) || 0),\r\n      0\r\n    ) || 0;\r\n\r\n    const freightCharges = parseFloat(o.freightCharges || 0);\r\n    const taxAmount = parseFloat(o.taxAmount || 0);\r\n    const grandTotal = parseFloat(o.orderValue || subtotal + freightCharges + taxAmount);\r\n\r\n    const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`;\r\n\r\n    // Find customer record for extra details\r\n    const customer = this.state.customers.find(\r\n      c => c.custshortName === o.customer || c.custname === o.customer\r\n    ) || {};\r\n\r\n    return (\r\n      <div className=\"card mt-4 p-4 shadow-sm full-height d-flex flex-column\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n          <h4 className=\"card-title mb-0\">Order Preview - {o.orderNo}</h4>\r\n          <div className=\"flex items-center gap-x-4\">\r\n            <button\r\n                className=\"btn btn-sm btn-primary mr-2\"\r\n                onClick={() => this.openEditForm(o)}\r\n                disabled={o.status !== \"Entered\" && o.status !== \"Awaiting for Approval\"}\r\n              >\r\n                Edit\r\n              </button>\r\n            <i\r\n              className=\"mdi mdi-printer menu-icon ml-3\"\r\n              style={{ marginBlockStart: '10px', gap: '10px', fontSize: '27px', color: '#2196F3', cursor: 'pointer' }}\r\n              onClick={() => this.showOrderPDFWithOrg(o)}\r\n            ></i>\r\n          </div>\r\n        </div>\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-md-4\"><b>Customer:</b> {o.customer}</div>\r\n          <div className=\"col-md-4\"><b>Date:</b> {o.orderDate}</div>\r\n          <div className=\"col-md-4\"><b>Status:</b> {o.status}</div>\r\n        </div>\r\n        <div className=\"row mb-4\">\r\n          <div className=\"col-md-6\">\r\n            <b>Bill To:</b><br />\r\n            {o.billTo || \"-\"}\r\n            <div className=\"mt-2\" style={{ fontSize: \"0.9em\" }}>\r\n              <b>GSTIN:</b> {customer.gstin || \"-\"}<br />\r\n              <b>Email:</b> {customer.email || \"-\"}<br />\r\n              <b>Phone:</b> {customer.phone || \"-\"}\r\n            </div>\r\n          </div>\r\n          <div className=\"col-md-6\">\r\n            <b>Ship To:</b><br />\r\n            {o.shipTo || \"-\"}\r\n          </div>\r\n        </div>\r\n        <h5 className=\"mt-2\">Line Items</h5>\r\n        <table className=\"table table-bordered table-sm\">\r\n          <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Item Code</th>\r\n              <th>Description</th>\r\n              <th>Qty</th>\r\n              <th>Unit Price</th>\r\n              <th>Tax Amount</th>\r\n              <th>Item Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {o.lineItems?.map((item, i) => (\r\n              <tr key={i}>\r\n                <td>{item.itemCode}</td>\r\n                <td>{item.itemDescription}</td>\r\n                <td>{item.qty}</td>\r\n                <td>{item.unitPrice}</td>\r\n                <td>{item.taxAmt}</td>\r\n                <td>{item.itemTotal}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        <div className=\"mt-3\">\r\n          <p><b>Subtotal:</b> {subtotal.toFixed(2)}</p>\r\n          <p><b>Freight Charges:</b> {freightCharges.toFixed(2)}</p>\r\n          <p><b>Tax Amount:</b> {taxAmount.toFixed(2)}</p>\r\n          <p className=\"h6\"><b>Grand Total:</b> {grandTotal.toFixed(2)}</p>\r\n          <p className=\"h6\"><b>Amount in Words:</b> {amountWords}</p>\r\n        </div>\r\n        <div className=\"mt-2\">\r\n          <b>Reject Reason:</b> {o.rejectReason || \"-\"}\r\n        </div>\r\n        <div className=\"mt-auto pt-3 text-right\">\r\n          <button\r\n            className=\"btn btn-success\"\r\n            onClick={() => {\r\n            console.log(\"Approve clicked for order:\", o);\r\n            this.updateStatus(o.id, \"Approved\");\r\n          }}\r\n            disabled={o.status !== \"Awaiting for Approval\"}\r\n          >\r\n            Approve\r\n          </button>\r\n          <button\r\n            className=\"btn btn-danger\"\r\n            onClick={this.openRejectDialog}\r\n            disabled={o.status !== \"Awaiting for Approval\"}\r\n          >\r\n            Reject\r\n          </button>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={this.closePreview}\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n        {this.state.showRejectDialog && this.renderRejectDialog()}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        {this.state.showEditForm\r\n        ? this.renderEditForm()\r\n        : this.state.previewMode\r\n          ? this.renderOrderPreview()\r\n          : this.renderOrderTable()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default OrderApproval;"]},"metadata":{},"sourceType":"module"}