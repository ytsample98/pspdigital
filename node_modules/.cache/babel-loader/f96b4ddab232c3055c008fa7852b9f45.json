{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\admin\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\servicecontract\\\\servicecontractapproval.js\";\nimport React, { Component } from 'react';\nimport { db } from '../../../../firebase';\nimport { collection, getDocs, updateDoc, doc } from 'firebase/firestore';\nimport { serverTimestamp } from 'firebase/firestore';\nimport { format } from 'date-fns';\n\nclass servicecontractapproval extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      contracts: [],\n      selected: null,\n      loading: false,\n      showRejectDialog: false,\n      rejectReason: \"\"\n    };\n\n    this.fetchAwaiting = async () => {\n      const snap = await getDocs(collection(db, 'contracts'));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      })); // earlier you filtered only awaiting. Now show all.\n\n      this.setState({\n        contracts: data\n      });\n    };\n\n    this.formatDate = d => {\n      if (!d) return '';\n\n      try {\n        return format(new Date(d), 'dd-MMM-yy');\n      } catch {\n        return d;\n      }\n    };\n\n    this.openPreview = contract => {\n      this.setState({\n        selected: contract\n      });\n    };\n\n    this.closePreview = () => {\n      this.setState({\n        selected: null,\n        showRejectDialog: false,\n        rejectReason: \"\"\n      });\n    };\n\n    this.approve = async contract => {\n      if (!window.confirm(`Approve ${contract.contractNo}?`)) return;\n      this.setState({\n        loading: true\n      });\n\n      try {\n        const cRef = doc(db, 'contracts', contract.id);\n        await updateDoc(cRef, {\n          status: 'Approved',\n          approvedAt: serverTimestamp(),\n          approvedLineItems: contract.lineItems || [],\n          updatedAt: serverTimestamp()\n        });\n        alert('Approved.');\n        this.fetchAwaiting();\n        this.closePreview();\n      } catch (err) {\n        console.error(err);\n        alert('Error approving: ' + err.message);\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this.openRejectDialog = () => {\n      this.setState({\n        showRejectDialog: true,\n        rejectReason: \"\"\n      });\n    };\n\n    this.closeRejectDialog = () => {\n      this.setState({\n        showRejectDialog: false,\n        rejectReason: \"\"\n      });\n    };\n\n    this.handleRejectReasonChange = e => {\n      this.setState({\n        rejectReason: e.target.value\n      });\n    };\n\n    this.handleRejectConfirm = async () => {\n      const {\n        selected,\n        rejectReason\n      } = this.state;\n\n      if (!rejectReason.trim()) {\n        alert(\"Please enter a reason for rejection.\");\n        return;\n      }\n\n      try {\n        await updateDoc(doc(db, 'contracts', selected.id), {\n          status: 'Rejected',\n          rejectedAt: serverTimestamp(),\n          rejectReason,\n          updatedAt: serverTimestamp()\n        });\n        alert('Rejected.');\n        this.fetchAwaiting();\n        this.closePreview();\n      } catch (err) {\n        alert(err.message);\n      }\n    };\n\n    this.renderRejectDialog = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay-content\",\n      style: {\n        width: 400\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }\n    }, \"Reject Reason\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control\",\n      rows: 3,\n      value: this.state.rejectReason,\n      onChange: this.handleRejectReasonChange,\n      placeholder: \"Enter reason for rejection\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"text-right mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-secondary mr-2\",\n      onClick: this.closeRejectDialog,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 11\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-danger\",\n      onClick: this.handleRejectConfirm,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }\n    }, \"Reject\"))));\n\n    this.renderTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-4 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 3\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"card-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 7\n      }\n    }, \"Service Contract Approval\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 15\n      }\n    }, \"Contract No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 15\n      }\n    }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 15\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 15\n      }\n    }, \"Value\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 15\n      }\n    }, \"Std Days\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 15\n      }\n    }, \"Status\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }\n    }, this.state.contracts.map(c => {\n      let statusClass = \"badge-secondary\";\n      if (c.status === \"Awaiting Approval\") statusClass = \"badge-warning\";else if (c.status === \"Approved\") statusClass = \"badge-success\";else if (c.status === \"Partial\") statusClass = \"badge-purple\";else if (c.status === \"Completed\") statusClass = \"badge-info\";else if (c.status === \"Rejected\") statusClass = \"badge-danger\";\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: c.id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-link p-0\",\n        onClick: () => this.openPreview(c),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 21\n        }\n      }, c.contractNo)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 19\n        }\n      }, c.customer), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 19\n        }\n      }, this.formatDate(c.createdDate || c.contrDurationFrom)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 19\n        }\n      }, c.contractValue || c.amtAgreed), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 19\n        }\n      }, c.stdDays), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${statusClass}`,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 21\n        }\n      }, c.status)));\n    }), this.state.contracts.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      colSpan: \"6\",\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 19\n      }\n    }, \"No contracts\")))))));\n\n    this.renderPreview = () => {\n      const c = this.state.selected;\n      if (!c) return null;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 p-4 shadow-sm full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title mb-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 9\n        }\n      }, \"Contract Preview - \", c.contractNo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 8\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 37\n        }\n      }, \"Customer:\"), \" \", c.customer), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 37\n        }\n      }, \"Contract No:\"), \" \", c.contractNo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 37\n        }\n      }, \"Status:\"), \" \", c.status)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 37\n        }\n      }, \"Duration:\"), \" \", c.durationFrom, \" to \", c.durationTo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 37\n        }\n      }, \"Till Date:\"), \" \", c.tillDate || '-'), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 37\n        }\n      }, \"Repeat:\"), \" \", c.repeat ? 'Yes' : 'No')), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 9\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 5\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 5\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 5\n        }\n      }, \"HSN\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 5\n        }\n      }, \"UOM\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 5\n        }\n      }, \"Duration\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 5\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 5\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 5\n        }\n      }, \"Days\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 5\n        }\n      }, \"Months\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 5\n        }\n      }, \"Tax\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 5\n        }\n      }, \"Tax Amt\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 5\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 1\n        }\n      }, (c.lineItems || []).map((li, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 7\n        }\n      }, li.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 7\n        }\n      }, li.itemDesc || li.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 7\n        }\n      }, li.hsnCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 7\n        }\n      }, li.uom), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 7\n        }\n      }, li.duration || `${c.durationFrom} to ${c.durationTo}`), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 7\n        }\n      }, li.qty), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 7\n        }\n      }, li.unitPrice), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 7\n        }\n      }, li.days), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 7\n        }\n      }, li.months), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 7\n        }\n      }, (li.taxGroupNames || []).join(', ')), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 7\n        }\n      }, li.taxAmt), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 7\n        }\n      }, li.itemTotal))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-auto pt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success mr-2\",\n        onClick: () => this.approve(c),\n        disabled: c.status === \"Approved\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }\n      }, \"Approve\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-danger mr-2\",\n        onClick: this.openRejectDialog,\n        disabled: c.status === \"Rejected\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }\n      }, \"Reject\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: this.closePreview,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }\n      }, \"Back to List\")), this.state.showRejectDialog && this.renderRejectDialog());\n    };\n  }\n\n  componentDidMount() {\n    this.fetchAwaiting();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 7\n      }\n    }, this.state.selected ? this.renderPreview() : this.renderTable());\n  }\n\n}\n\nexport default servicecontractapproval;","map":{"version":3,"sources":["C:/Users/College/admin/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/servicecontract/servicecontractapproval.js"],"names":["React","Component","db","collection","getDocs","updateDoc","doc","serverTimestamp","format","servicecontractapproval","state","contracts","selected","loading","showRejectDialog","rejectReason","fetchAwaiting","snap","data","docs","map","d","id","setState","formatDate","Date","openPreview","contract","closePreview","approve","window","confirm","contractNo","cRef","status","approvedAt","approvedLineItems","lineItems","updatedAt","alert","err","console","error","message","openRejectDialog","closeRejectDialog","handleRejectReasonChange","e","target","value","handleRejectConfirm","trim","rejectedAt","renderRejectDialog","width","renderTable","c","statusClass","customer","createdDate","contrDurationFrom","contractValue","amtAgreed","stdDays","fontSize","length","renderPreview","durationFrom","durationTo","tillDate","repeat","li","i","itemCode","itemDesc","itemDescription","hsnCode","uom","duration","qty","unitPrice","days","months","taxGroupNames","join","taxAmt","itemTotal","componentDidMount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { db } from '../../../../firebase';\r\nimport { collection, getDocs, updateDoc, doc } from 'firebase/firestore';\r\nimport { serverTimestamp } from 'firebase/firestore';\r\nimport { format } from 'date-fns';  \r\nclass servicecontractapproval extends Component {\r\n  state = {\r\n    contracts: [],\r\n    selected: null,\r\n    loading: false,\r\n    showRejectDialog: false,\r\n    rejectReason: \"\",\r\n  };\r\nfetchAwaiting = async () => {\r\n  const snap = await getDocs(collection(db, 'contracts'));\r\n  const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));\r\n  // earlier you filtered only awaiting. Now show all.\r\n  this.setState({ contracts: data });\r\n};\r\n\r\nformatDate = (d) => {\r\n  if (!d) return '';\r\n  try {\r\n    return format(new Date(d), 'dd-MMM-yy');\r\n  } catch {\r\n    return d;\r\n  }\r\n};\r\n  componentDidMount() { this.fetchAwaiting(); }\r\n\r\n  openPreview = (contract) => {\r\n    this.setState({ selected: contract });\r\n  };\r\n\r\n  closePreview = () => {\r\n    this.setState({ selected: null, showRejectDialog: false, rejectReason: \"\" });\r\n  };\r\n\r\n  approve = async (contract) => {\r\n    if (!window.confirm(`Approve ${contract.contractNo}?`)) return;\r\n    this.setState({ loading: true });\r\n    try {\r\n      const cRef = doc(db, 'contracts', contract.id);\r\n      await updateDoc(cRef, {\r\n        status: 'Approved',\r\n        approvedAt: serverTimestamp(),\r\n        approvedLineItems: contract.lineItems || [],\r\n        updatedAt: serverTimestamp()\r\n      });\r\n      alert('Approved.');\r\n      this.fetchAwaiting();\r\n      this.closePreview();\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Error approving: ' + err.message);\r\n    } finally {\r\n      this.setState({ loading: false });\r\n    }\r\n  };\r\n\r\n  openRejectDialog = () => {\r\n    this.setState({ showRejectDialog: true, rejectReason: \"\" });\r\n  };\r\n\r\n  closeRejectDialog = () => {\r\n    this.setState({ showRejectDialog: false, rejectReason: \"\" });\r\n  };\r\n\r\n  handleRejectReasonChange = (e) => {\r\n    this.setState({ rejectReason: e.target.value });\r\n  };\r\n\r\n  handleRejectConfirm = async () => {\r\n    const { selected, rejectReason } = this.state;\r\n    if (!rejectReason.trim()) {\r\n      alert(\"Please enter a reason for rejection.\");\r\n      return;\r\n    }\r\n    try {\r\n      await updateDoc(doc(db, 'contracts', selected.id), {\r\n        status: 'Rejected',\r\n        rejectedAt: serverTimestamp(),\r\n        rejectReason,\r\n        updatedAt: serverTimestamp()\r\n      });\r\n      alert('Rejected.');\r\n      this.fetchAwaiting();\r\n      this.closePreview();\r\n    } catch (err) {\r\n      alert(err.message);\r\n    }\r\n  };\r\n\r\n  renderRejectDialog = () => (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\" style={{ width: 400 }}>\r\n        <h5>Reject Reason</h5>\r\n        <textarea\r\n          className=\"form-control\"\r\n          rows={3}\r\n          value={this.state.rejectReason}\r\n          onChange={this.handleRejectReasonChange}\r\n          placeholder=\"Enter reason for rejection\"\r\n        />\r\n        <div className=\"text-right mt-3\">\r\n          <button className=\"btn btn-secondary mr-2\" onClick={this.closeRejectDialog}>Cancel</button>\r\n          <button className=\"btn btn-danger\" onClick={this.handleRejectConfirm}>Reject</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n\r\n\r\n\r\n\r\nrenderTable = () => (\r\n  <div className=\"card mt-4 full-height\">\r\n    <div className=\"card-body\">\r\n      <h4 className=\"card-title\">Service Contract Approval</h4>\r\n      <div className=\"table-responsive\">\r\n        <table className=\"table table-bordered table-hover\">\r\n          <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Contract No</th>\r\n              <th>Customer</th>\r\n              <th>Date</th>\r\n              <th>Value</th>\r\n              <th>Std Days</th>\r\n              <th>Status</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {this.state.contracts.map(c => {\r\n              let statusClass = \"badge-secondary\";\r\n              if (c.status === \"Awaiting Approval\") statusClass = \"badge-warning\";\r\n              else if (c.status === \"Approved\") statusClass = \"badge-success\";\r\n              else if (c.status === \"Partial\") statusClass = \"badge-purple\";\r\n              else if (c.status === \"Completed\") statusClass = \"badge-info\";\r\n              else if (c.status === \"Rejected\") statusClass = \"badge-danger\";\r\n\r\n              return (\r\n                <tr key={c.id}>\r\n                  <td>\r\n                    <button className=\"btn btn-link p-0\" onClick={() => this.openPreview(c)}>\r\n                      {c.contractNo}\r\n                    </button>\r\n                  </td>\r\n                  <td>{c.customer}</td>\r\n                  <td>{this.formatDate(c.createdDate || c.contrDurationFrom)}</td>\r\n                  <td>{c.contractValue || c.amtAgreed}</td>\r\n                  <td>{c.stdDays}</td>\r\n                  <td>\r\n                    <label className={`badge ${statusClass}`} style={{ fontSize: '14px' }}>{c.status}</label>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n            {this.state.contracts.length === 0 && (\r\n              <tr><td colSpan=\"6\" className=\"text-center\">No contracts</td></tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\n  renderPreview = () => {\r\n    const c = this.state.selected;\r\n    if (!c) return null;\r\n    return (\r\n      <div className=\"card mt-4 p-4 shadow-sm full-height d-flex flex-column\">\r\n        <h4 className=\"card-title mb-0\">Contract Preview - {c.contractNo}</h4>\r\n       <div className=\"row mb-3\">\r\n          <div className=\"col-md-4\"><b>Customer:</b> {c.customer}</div>\r\n          <div className=\"col-md-4\"><b>Contract No:</b> {c.contractNo}</div>\r\n          <div className=\"col-md-4\"><b>Status:</b> {c.status}</div>\r\n        </div>\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-md-4\"><b>Duration:</b> {c.durationFrom} to {c.durationTo}</div>\r\n          <div className=\"col-md-4\"><b>Till Date:</b> {c.tillDate || '-'}</div>\r\n          <div className=\"col-md-4\"><b>Repeat:</b> {c.repeat ? 'Yes' : 'No'}</div>\r\n        </div>\r\n        <h5 className=\"mt-2\">Line Items</h5>\r\n        <table className=\"table table-bordered table-sm\">\r\n          <thead className='thead-light'>\r\n  <tr>\r\n    <th>Item Code</th>\r\n    <th>Description</th>\r\n    <th>HSN</th>\r\n    <th>UOM</th>\r\n    <th>Duration</th>\r\n    <th>Qty</th>\r\n    <th>Unit Price</th>\r\n    <th>Days</th>\r\n    <th>Months</th>\r\n    <th>Tax</th>\r\n    <th>Tax Amt</th>\r\n    <th>Item Total</th>\r\n  </tr>\r\n</thead>\r\n<tbody>\r\n  {(c.lineItems || []).map((li, i) => (\r\n    <tr key={i}>\r\n      <td>{li.itemCode}</td>\r\n      <td>{li.itemDesc || li.itemDescription}</td>\r\n      <td>{li.hsnCode}</td>\r\n      <td>{li.uom}</td>\r\n      <td>{li.duration || `${c.durationFrom} to ${c.durationTo}`}</td>\r\n      <td>{li.qty}</td>\r\n      <td>{li.unitPrice}</td>\r\n      <td>{li.days}</td>\r\n      <td>{li.months}</td>\r\n      <td>{(li.taxGroupNames || []).join(', ')}</td>\r\n      <td>{li.taxAmt}</td>\r\n      <td>{li.itemTotal}</td>\r\n    </tr>\r\n  ))}\r\n</tbody>\r\n  \r\n        </table>\r\n        <div className=\"mt-auto pt-3 text-right\">\r\n          <button\r\n            className=\"btn btn-success mr-2\"\r\n            onClick={() => this.approve(c)}\r\n            disabled={c.status === \"Approved\"}\r\n          >\r\n            Approve\r\n          </button>\r\n          <button\r\n            className=\"btn btn-danger mr-2\"\r\n            onClick={this.openRejectDialog}\r\n            disabled={c.status === \"Rejected\"}\r\n          >\r\n            Reject\r\n          </button>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={this.closePreview}\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n        {this.state.showRejectDialog && this.renderRejectDialog()}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        {this.state.selected ? this.renderPreview() : this.renderTable()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default servicecontractapproval;\r\n"]},"metadata":{},"sourceType":"module"}