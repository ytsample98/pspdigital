{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\admin\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\invoice\\\\tpbill\\\\ThirdPartyBilling.js\";\n// ThirdPartyBilling.js\nimport React, { Component } from \"react\";\nimport { db } from \"../../../../../firebase\";\nimport { collection, getDocs, addDoc, updateDoc, doc, serverTimestamp } from \"firebase/firestore\";\n\nclass ThirdPartyBilling extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      vendors: [],\n      services: [],\n      bills: [],\n      taxGroups: [],\n      showForm: false,\n      editingId: null,\n      activeTab: 0,\n      showVendorOverlay: false,\n      vendorOverlaySearch: \"\",\n      showServiceOverlay: false,\n      serviceOverlaySearch: \"\",\n      selectedServiceIds: [],\n      formData: this.getEmptyForm(),\n      notes: \"\"\n    };\n\n    this.fetchVendors = async () => {\n      const snap = await getDocs(collection(db, \"vendors\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        vendors: data\n      });\n    };\n\n    this.fetchServices = async () => {\n      const snap = await getDocs(collection(db, \"services\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        services: data\n      });\n    };\n\n    this.fetchBills = async () => {\n      const snap = await getDocs(collection(db, \"thirdPartyBills\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        bills: data.reverse()\n      });\n    };\n\n    this.fetchTaxGroups = async () => {\n      const snap = await getDocs(collection(db, \"taxGroups\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        taxGroups: data\n      });\n    };\n\n    this.selectVendor = v => {\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          vendorId: v.id,\n          vendorName: v.name || v.vendorName || \"\",\n          currency: v.currency || prev.formData.currency,\n          paymentTerms: v.paymentTerms || prev.formData.paymentTerms,\n          billTo: v.address || prev.formData.billTo\n        },\n        showVendorOverlay: false\n      }));\n    };\n\n    this.showVendorOverlay = () => this.setState({\n      showVendorOverlay: true,\n      vendorOverlaySearch: \"\"\n    });\n\n    this.hideVendorOverlay = () => this.setState({\n      showVendorOverlay: false,\n      vendorOverlaySearch: \"\"\n    });\n\n    this.showServiceOverlay = () => this.setState({\n      showServiceOverlay: true,\n      serviceOverlaySearch: \"\",\n      selectedServiceIds: []\n    });\n\n    this.hideServiceOverlay = () => this.setState({\n      showServiceOverlay: false,\n      serviceOverlaySearch: \"\",\n      selectedServiceIds: []\n    });\n\n    this.toggleServiceSelection = (serviceId, checked) => {\n      this.setState(prev => ({\n        selectedServiceIds: checked ? [...prev.selectedServiceIds, serviceId] : prev.selectedServiceIds.filter(id => id !== serviceId)\n      }));\n    };\n\n    this.addSelectedServicesToLineItems = () => {\n      const selected = this.state.services.filter(s => this.state.selectedServiceIds.includes(s.id));\n      const newItems = selected.map(s => ({\n        serviceCode: s.code || \"\",\n        description: s.description || s.name || \"\",\n        qty: 1,\n        unitPrice: s.rate || 0,\n        itemTotal: (1 * (s.rate || 0)).toFixed(2),\n        taxGroup: s.taxGroup || null,\n        taxAmt: 0\n      }));\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: [...(prev.formData.lineItems || []), ...newItems]\n        },\n        showServiceOverlay: false,\n        selectedServiceIds: []\n      }), this.recalculateTotals);\n    };\n\n    this.handleInputChange = (field, value) => {\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          [field]: value\n        }\n      }), () => {\n        if ([\"conversionRate\", \"totalValue\"].includes(field)) this.recalculateTotals();\n      });\n    };\n\n    this.handleLineItemChange = (idx, field, value) => {\n      const items = [...this.state.formData.lineItems];\n      items[idx] = { ...items[idx],\n        [field]: value\n      };\n      const qty = parseFloat(items[idx].qty || 0);\n      const unit = parseFloat(items[idx].unitPrice || 0);\n      items[idx].itemTotal = (qty * unit).toFixed(2);\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: items\n        }\n      }), this.recalculateTotals);\n    };\n\n    this.recalculateTotals = () => {\n      const f = this.state.formData;\n      let total = 0;\n      (f.lineItems || []).forEach(it => {\n        total += parseFloat(it.itemTotal || 0);\n      }); // compute tax amounts per line if taxGroup exists\n\n      const taxGroups = this.state.taxGroups.reduce((map, tg) => {\n        map[tg.id || tg.name] = tg;\n        return map;\n      }, {});\n      const items = (f.lineItems || []).map(it => {\n        const tg = it.taxGroup ? taxGroups[it.taxGroup] || {} : {};\n        const pct = parseFloat(tg.percentage || 0);\n        const taxAmt = parseFloat(it.itemTotal || 0) * pct / 100;\n        total += taxAmt;\n        return { ...it,\n          taxAmt: taxAmt.toFixed(2)\n        };\n      });\n      if (f.conversionRate) total = total * parseFloat(f.conversionRate || 1);\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: items,\n          totalValue: total ? total.toFixed(2) : \"0.00\"\n        }\n      }));\n    };\n\n    this.handleTabChange = i => this.setState({\n      activeTab: i\n    });\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      const {\n        editingId,\n        formData,\n        bills\n      } = this.state;\n      const saveData = { ...formData,\n        status: \"Awaiting Approval\",\n        notes: this.state.notes,\n        updatedAt: serverTimestamp(),\n        createdAt: editingId ? formData.createdAt || serverTimestamp() : serverTimestamp()\n      };\n\n      try {\n        if (editingId) {\n          await updateDoc(doc(db, \"thirdPartyBills\", editingId), saveData);\n        } else {\n          saveData.billNo = formData.billType === \"Standard\" ? `TPB${1000 + bills.length}` : formData.billNo || `TPB${1000 + bills.length}`;\n          await addDoc(collection(db, \"thirdPartyBills\"), saveData);\n        }\n\n        this.fetchBills();\n        this.setState({\n          showForm: false,\n          editingId: null,\n          formData: this.getEmptyForm(),\n          notes: \"\"\n        });\n      } catch (err) {\n        console.error(\"Save error:\", err);\n        alert(\"Error saving: \" + err.message);\n      }\n    };\n\n    this.getStatusBadge = status => {\n      let cls = \"badge-secondary\";\n      if (!status) status = \"Entered\";\n      if (status === \"Awaiting Approval\" || status === \"Entered\") cls = \"badge-warning\";else if (status === \"Approved\") cls = \"badge-success\";else if (status === \"Rejected\") cls = \"badge-success\"; // per rule\n      else if (status === \"Partial\") cls = \"badge-purple\";else if (status === \"Completed\") cls = \"badge-info\";\n      return /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${cls}`,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 12\n        }\n      }, status);\n    };\n\n    this.renderBillingDetailsTab = () => {\n      const f = this.state.formData;\n      const items = f.lineItems || [];\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 13\n        }\n      }, \"Bill Type\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control\",\n        value: f.billType,\n        onChange: e => this.handleInputChange('billType', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Standard\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 15\n        }\n      }, \"Standard\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Manual\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 15\n        }\n      }, \"Manual\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 13\n        }\n      }, \"Bill No\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.billNo,\n        readOnly: f.billType === \"Standard\",\n        onChange: e => this.handleInputChange('billNo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 13\n        }\n      }, \"Bill Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control\",\n        value: f.billDate,\n        onChange: e => this.handleInputChange('billDate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 13\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 13\n        }\n      }, this.getStatusBadge(f.status))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 13\n        }\n      }, \"Vendor\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.vendorName,\n        readOnly: true,\n        onClick: this.showVendorOverlay,\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mt-3 mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"h5\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 13\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-primary btn-sm\",\n        onClick: this.showServiceOverlay,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 13\n        }\n      }, \"+ Add Services\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"table-responsive mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 17\n        }\n      }, \"Service Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 17\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 17\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 17\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 17\n        }\n      }, \"Item Total\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 17\n        }\n      }, \"Tax\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 13\n        }\n      }, items.map((it, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 19\n        }\n      }, it.serviceCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 19\n        }\n      }, it.description), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"number\",\n        value: it.qty,\n        onChange: e => this.handleLineItemChange(i, 'qty', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"number\",\n        value: it.unitPrice,\n        onChange: e => this.handleLineItemChange(i, 'unitPrice', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 19\n        }\n      }, it.itemTotal), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 19\n        }\n      }, it.taxAmt || \"0.00\"))), items.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 38\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: 6,\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 42\n        }\n      }, \"No items\"))))));\n    };\n\n    this.renderNotesTab = () => /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 9\n      }\n    }, \"Notes / Remarks\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control\",\n      rows: 3,\n      value: this.state.notes,\n      onChange: e => this.setState({\n        notes: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 9\n      }\n    })));\n\n    this.renderVendorOverlay = () => {\n      const {\n        vendors,\n        vendorOverlaySearch\n      } = this.state;\n      const filtered = vendors.filter(v => (v.name || \"\").toLowerCase().includes(vendorOverlaySearch.toLowerCase()) || (v.code || \"\").toLowerCase().includes(vendorOverlaySearch.toLowerCase()));\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }\n      }, \"Select Vendor\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control mb-2\",\n        placeholder: \"Search vendor\",\n        value: vendorOverlaySearch,\n        onChange: e => this.setState({\n          vendorOverlaySearch: e.target.value\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          maxHeight: 300,\n          overflowY: 'auto'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-sm table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 22\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 26\n        }\n      }, \"Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 39\n        }\n      }, \"Name\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 15\n        }\n      }, filtered.map((v, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: v.id || i,\n        onClick: () => this.selectVendor(v),\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 21\n        }\n      }, v.code), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 38\n        }\n      }, v.name))), filtered.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 43\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: 2,\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 47\n        }\n      }, \"No vendors\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-2 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary btn-sm\",\n        onClick: this.hideVendorOverlay,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 13\n        }\n      }, \"Cancel\"))));\n    };\n\n    this.renderServiceOverlay = () => {\n      const {\n        services,\n        serviceOverlaySearch,\n        selectedServiceIds\n      } = this.state;\n      const filtered = services.filter(s => (s.code || \"\").toLowerCase().includes(serviceOverlaySearch.toLowerCase()) || (s.name || \"\").toLowerCase().includes(serviceOverlaySearch.toLowerCase()));\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }\n      }, \"Select Services\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control mb-2\",\n        placeholder: \"Search services\",\n        value: serviceOverlaySearch,\n        onChange: e => this.setState({\n          serviceOverlaySearch: e.target.value\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          maxHeight: 300,\n          overflowY: 'auto'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-sm table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 22\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 26\n        }\n      }), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 35\n        }\n      }, \"Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 48\n        }\n      }, \"Name\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 61\n        }\n      }, \"Rate\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 15\n        }\n      }, filtered.map(s => /*#__PURE__*/React.createElement(\"tr\", {\n        key: s.id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: selectedServiceIds.includes(s.id),\n        onChange: e => this.toggleServiceSelection(s.id, e.target.checked),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 21\n        }\n      }, s.code), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 38\n        }\n      }, s.name), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 55\n        }\n      }, s.rate))), filtered.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 43\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: 4,\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 47\n        }\n      }, \"No services\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success btn-sm\",\n        onClick: this.addSelectedServicesToLineItems,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 13\n        }\n      }, \"Add Selected\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary btn-sm\",\n        onClick: this.hideServiceOverlay,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 13\n        }\n      }, \"Cancel\"))));\n    };\n\n    this.renderForm = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 352,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        padding: 20,\n        overflowY: 'auto',\n        height: 'calc(100% - 72px)'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 11\n      }\n    }, \"Third Party Billing\"), /*#__PURE__*/React.createElement(\"ul\", {\n      className: \"nav nav-tabs mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      className: \"nav-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: `nav-link ${this.state.activeTab === 0 ? 'active' : ''}`,\n      onClick: () => this.handleTabChange(0),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 38\n      }\n    }, \"Billing\")), /*#__PURE__*/React.createElement(\"li\", {\n      className: \"nav-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: `nav-link ${this.state.activeTab === 1 ? 'active' : ''}`,\n      onClick: () => this.handleTabChange(1),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 38\n      }\n    }, \"Notes\"))), this.state.activeTab === 0 && this.renderBillingDetailsTab(), this.state.activeTab === 1 && this.renderNotesTab()), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"fixed-card-footer p-3 border-top bg-white text-right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 364,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn btn-secondary mr-2\",\n      onClick: () => this.setState({\n        showForm: false,\n        editingId: null,\n        formData: this.getEmptyForm(),\n        notes: \"\"\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 11\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submit\",\n      className: \"btn btn-success\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 11\n      }\n    }, this.state.editingId ? \"Update & Send for Approval\" : \"Create & Send for Approval\"))));\n\n    this.renderTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-3 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 373,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-between align-items-center mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 11\n      }\n    }, \"Third Party Billing\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary mr-2\",\n      onClick: () => this.setState({\n        showForm: true\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 13\n      }\n    }, \"Create\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-outline-secondary\",\n      onClick: () => this.props.history && this.props.history.push('/thirdparty-billing-approvals'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 13\n      }\n    }, \"Go to Approvals\"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 17\n      }\n    }, \"Bill No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 33\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 46\n      }\n    }, \"Vendor\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 61\n      }\n    }, \"Total\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 75\n      }\n    }, \"Status\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 13\n      }\n    }, this.state.bills.map(b => /*#__PURE__*/React.createElement(\"tr\", {\n      key: b.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-link p-0\",\n      onClick: () => this.setState({\n        showForm: true,\n        editingId: b.id,\n        formData: { ...b\n        },\n        notes: b.notes || \"\"\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 23\n      }\n    }, b.billNo)), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 19\n      }\n    }, b.billDate), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 19\n      }\n    }, b.vendorName), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 396,\n        columnNumber: 19\n      }\n    }, b.totalValue), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 19\n      }\n    }, this.getStatusBadge(b.status)))), this.state.bills.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 49\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      colSpan: 5,\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 53\n      }\n    }, \"No records\")))))));\n  }\n\n  getEmptyForm() {\n    return {\n      billType: \"Standard\",\n      billNo: \"\",\n      billDate: new Date().toISOString().split(\"T\")[0],\n      status: \"Entered\",\n      refNo: \"\",\n      vendorId: \"\",\n      vendorName: \"\",\n      currency: \"\",\n      conversionRate: \"\",\n      paymentTerms: \"\",\n      totalValue: \"\",\n      billTo: \"\",\n      lineItems: []\n    };\n  }\n\n  componentDidMount() {\n    this.fetchVendors();\n    this.fetchServices();\n    this.fetchBills();\n    this.fetchTaxGroups();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 7\n      }\n    }, this.state.showForm ? this.renderForm() : this.renderTable(), this.state.showVendorOverlay && this.renderVendorOverlay(), this.state.showServiceOverlay && this.renderServiceOverlay());\n  }\n\n}\n\nexport default ThirdPartyBilling;","map":{"version":3,"sources":["C:/Users/College/admin/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/invoice/tpbill/ThirdPartyBilling.js"],"names":["React","Component","db","collection","getDocs","addDoc","updateDoc","doc","serverTimestamp","ThirdPartyBilling","state","vendors","services","bills","taxGroups","showForm","editingId","activeTab","showVendorOverlay","vendorOverlaySearch","showServiceOverlay","serviceOverlaySearch","selectedServiceIds","formData","getEmptyForm","notes","fetchVendors","snap","data","docs","map","d","id","setState","fetchServices","fetchBills","reverse","fetchTaxGroups","selectVendor","v","prev","vendorId","vendorName","name","currency","paymentTerms","billTo","address","hideVendorOverlay","hideServiceOverlay","toggleServiceSelection","serviceId","checked","filter","addSelectedServicesToLineItems","selected","s","includes","newItems","serviceCode","code","description","qty","unitPrice","rate","itemTotal","toFixed","taxGroup","taxAmt","lineItems","recalculateTotals","handleInputChange","field","value","handleLineItemChange","idx","items","parseFloat","unit","f","total","forEach","it","reduce","tg","pct","percentage","conversionRate","totalValue","handleTabChange","i","handleSubmit","e","preventDefault","saveData","status","updatedAt","createdAt","billNo","billType","length","err","console","error","alert","message","getStatusBadge","cls","fontSize","renderBillingDetailsTab","target","billDate","cursor","renderNotesTab","renderVendorOverlay","filtered","toLowerCase","maxHeight","overflowY","renderServiceOverlay","renderForm","padding","height","renderTable","props","history","push","b","Date","toISOString","split","refNo","componentDidMount","render"],"mappings":"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","sourcesContent":["// ThirdPartyBilling.js\r\nimport React, { Component } from \"react\";\r\nimport { db } from \"../../../../../firebase\";\r\nimport {\r\n  collection,\r\n  getDocs,\r\n  addDoc,\r\n  updateDoc,\r\n  doc,\r\n  serverTimestamp,\r\n} from \"firebase/firestore\";\r\n\r\nclass ThirdPartyBilling extends Component {\r\n  state = {\r\n    vendors: [],\r\n    services: [],\r\n    bills: [],\r\n    taxGroups: [],\r\n    showForm: false,\r\n    editingId: null,\r\n    activeTab: 0,\r\n    showVendorOverlay: false,\r\n    vendorOverlaySearch: \"\",\r\n    showServiceOverlay: false,\r\n    serviceOverlaySearch: \"\",\r\n    selectedServiceIds: [],\r\n    formData: this.getEmptyForm(),\r\n    notes: \"\",\r\n  };\r\n\r\n  getEmptyForm() {\r\n    return {\r\n      billType: \"Standard\",\r\n      billNo: \"\",\r\n      billDate: new Date().toISOString().split(\"T\")[0],\r\n      status: \"Entered\",\r\n      refNo: \"\",\r\n      vendorId: \"\",\r\n      vendorName: \"\",\r\n      currency: \"\",\r\n      conversionRate: \"\",\r\n      paymentTerms: \"\",\r\n      totalValue: \"\",\r\n      billTo: \"\",\r\n      lineItems: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.fetchVendors();\r\n    this.fetchServices();\r\n    this.fetchBills();\r\n    this.fetchTaxGroups();\r\n  }\r\n\r\n  fetchVendors = async () => {\r\n    const snap = await getDocs(collection(db, \"vendors\"));\r\n    const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n    this.setState({ vendors: data });\r\n  };\r\n\r\n  fetchServices = async () => {\r\n    const snap = await getDocs(collection(db, \"services\"));\r\n    const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n    this.setState({ services: data });\r\n  };\r\n\r\n  fetchBills = async () => {\r\n    const snap = await getDocs(collection(db, \"thirdPartyBills\"));\r\n    const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n    this.setState({ bills: data.reverse() });\r\n  };\r\n\r\n  fetchTaxGroups = async () => {\r\n    const snap = await getDocs(collection(db, \"taxGroups\"));\r\n    const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n    this.setState({ taxGroups: data });\r\n  };\r\n\r\n  selectVendor = (v) => {\r\n    this.setState((prev) => ({\r\n      formData: {\r\n        ...prev.formData,\r\n        vendorId: v.id,\r\n        vendorName: v.name || v.vendorName || \"\",\r\n        currency: v.currency || prev.formData.currency,\r\n        paymentTerms: v.paymentTerms || prev.formData.paymentTerms,\r\n        billTo: v.address || prev.formData.billTo,\r\n      },\r\n      showVendorOverlay: false,\r\n    }));\r\n  };\r\n\r\n  showVendorOverlay = () => this.setState({ showVendorOverlay: true, vendorOverlaySearch: \"\" });\r\n  hideVendorOverlay = () => this.setState({ showVendorOverlay: false, vendorOverlaySearch: \"\" });\r\n\r\n  showServiceOverlay = () => this.setState({ showServiceOverlay: true, serviceOverlaySearch: \"\", selectedServiceIds: [] });\r\n  hideServiceOverlay = () => this.setState({ showServiceOverlay: false, serviceOverlaySearch: \"\", selectedServiceIds: [] });\r\n\r\n  toggleServiceSelection = (serviceId, checked) => {\r\n    this.setState(prev => ({\r\n      selectedServiceIds: checked\r\n        ? [...prev.selectedServiceIds, serviceId]\r\n        : prev.selectedServiceIds.filter(id => id !== serviceId)\r\n    }));\r\n  };\r\n\r\n  addSelectedServicesToLineItems = () => {\r\n    const selected = this.state.services.filter(s => this.state.selectedServiceIds.includes(s.id));\r\n    const newItems = selected.map(s => ({\r\n      serviceCode: s.code || \"\",\r\n      description: s.description || s.name || \"\",\r\n      qty: 1,\r\n      unitPrice: s.rate || 0,\r\n      itemTotal: (1 * (s.rate || 0)).toFixed(2),\r\n      taxGroup: s.taxGroup || null,\r\n      taxAmt: 0,\r\n    }));\r\n\r\n    this.setState(prev => ({\r\n      formData: {\r\n        ...prev.formData,\r\n        lineItems: [...(prev.formData.lineItems || []), ...newItems],\r\n      },\r\n      showServiceOverlay: false,\r\n      selectedServiceIds: []\r\n    }), this.recalculateTotals);\r\n  };\r\n\r\n  handleInputChange = (field, value) => {\r\n    this.setState((prev) => ({\r\n      formData: { ...prev.formData, [field]: value },\r\n    }), () => {\r\n      if ([\"conversionRate\", \"totalValue\"].includes(field)) this.recalculateTotals();\r\n    });\r\n  };\r\n\r\n  handleLineItemChange = (idx, field, value) => {\r\n    const items = [...this.state.formData.lineItems];\r\n    items[idx] = { ...items[idx], [field]: value };\r\n\r\n    const qty = parseFloat(items[idx].qty || 0);\r\n    const unit = parseFloat(items[idx].unitPrice || 0);\r\n    items[idx].itemTotal = (qty * unit).toFixed(2);\r\n\r\n    this.setState((prev) => ({\r\n      formData: { ...prev.formData, lineItems: items },\r\n    }), this.recalculateTotals);\r\n  };\r\n\r\n  recalculateTotals = () => {\r\n    const f = this.state.formData;\r\n    let total = 0;\r\n    (f.lineItems || []).forEach(it => {\r\n      total += parseFloat(it.itemTotal || 0);\r\n    });\r\n\r\n    // compute tax amounts per line if taxGroup exists\r\n    const taxGroups = this.state.taxGroups.reduce((map, tg) => { map[tg.id || tg.name] = tg; return map; }, {});\r\n    const items = (f.lineItems || []).map(it => {\r\n      const tg = it.taxGroup ? (taxGroups[it.taxGroup] || {}) : {};\r\n      const pct = parseFloat(tg.percentage || 0);\r\n      const taxAmt = (parseFloat(it.itemTotal || 0) * pct) / 100;\r\n      total += taxAmt;\r\n      return { ...it, taxAmt: taxAmt.toFixed(2) };\r\n    });\r\n\r\n    if (f.conversionRate) total = total * parseFloat(f.conversionRate || 1);\r\n\r\n    this.setState(prev => ({\r\n      formData: { ...prev.formData, lineItems: items, totalValue: total ? total.toFixed(2) : \"0.00\" }\r\n    }));\r\n  };\r\n\r\n  handleTabChange = (i) => this.setState({ activeTab: i });\r\n\r\n  handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const { editingId, formData, bills } = this.state;\r\n    const saveData = {\r\n      ...formData,\r\n      status: \"Awaiting Approval\",\r\n      notes: this.state.notes,\r\n      updatedAt: serverTimestamp(),\r\n      createdAt: editingId ? formData.createdAt || serverTimestamp() : serverTimestamp(),\r\n    };\r\n\r\n    try {\r\n      if (editingId) {\r\n        await updateDoc(doc(db, \"thirdPartyBills\", editingId), saveData);\r\n      } else {\r\n        saveData.billNo = formData.billType === \"Standard\" ? `TPB${1000 + bills.length}` : formData.billNo || `TPB${1000 + bills.length}`;\r\n        await addDoc(collection(db, \"thirdPartyBills\"), saveData);\r\n      }\r\n      this.fetchBills();\r\n      this.setState({ showForm: false, editingId: null, formData: this.getEmptyForm(), notes: \"\" });\r\n    } catch (err) {\r\n      console.error(\"Save error:\", err);\r\n      alert(\"Error saving: \" + err.message);\r\n    }\r\n  };\r\n\r\n  getStatusBadge = (status) => {\r\n    let cls = \"badge-secondary\";\r\n    if (!status) status = \"Entered\";\r\n    if (status === \"Awaiting Approval\" || status === \"Entered\") cls = \"badge-warning\";\r\n    else if (status === \"Approved\") cls = \"badge-success\";\r\n    else if (status === \"Rejected\") cls = \"badge-success\"; // per rule\r\n    else if (status === \"Partial\") cls = \"badge-purple\";\r\n    else if (status === \"Completed\") cls = \"badge-info\";\r\n    return <label className={`badge ${cls}`} style={{ fontSize: '14px' }}>{status}</label>;\r\n  };\r\n\r\n  renderBillingDetailsTab = () => {\r\n    const f = this.state.formData;\r\n    const items = f.lineItems || [];\r\n    return (\r\n      <div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Bill Type</label>\r\n            <select className=\"form-control\" value={f.billType} onChange={e => this.handleInputChange('billType', e.target.value)}>\r\n              <option value=\"Standard\">Standard</option>\r\n              <option value=\"Manual\">Manual</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Bill No</label>\r\n            <input className=\"form-control\" value={f.billNo} readOnly={f.billType === \"Standard\"} onChange={e => this.handleInputChange('billNo', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill Date</label>\r\n            <input type=\"date\" className=\"form-control\" value={f.billDate} onChange={e => this.handleInputChange('billDate', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Status</label>\r\n            <div>{this.getStatusBadge(f.status)}</div>\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Vendor</label>\r\n            <input className=\"form-control\" value={f.vendorName} readOnly onClick={this.showVendorOverlay} style={{ cursor: 'pointer' }} />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"d-flex justify-content-between align-items-center mt-3 mb-2\">\r\n            <h5>Line Items</h5>\r\n            <button type=\"button\" className=\"btn btn-primary btn-sm\" onClick={this.showServiceOverlay}>+ Add Services</button>\r\n        </div>\r\n\r\n        <div className=\"table-responsive mt-2\">\r\n          <table className=\"table table-bordered\">\r\n            <thead>\r\n              <tr>\r\n                <th>Service Code</th>\r\n                <th>Description</th>\r\n                <th>Qty</th>\r\n                <th>Unit Price</th>\r\n                <th>Item Total</th>\r\n                <th>Tax</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {items.map((it, i) => (\r\n                <tr key={i}>\r\n                  <td>{it.serviceCode}</td>\r\n                  <td>{it.description}</td>\r\n                  <td><input className=\"form-control\" type=\"number\" value={it.qty} onChange={e => this.handleLineItemChange(i, 'qty', e.target.value)} /></td>\r\n                  <td><input className=\"form-control\" type=\"number\" value={it.unitPrice} onChange={e => this.handleLineItemChange(i, 'unitPrice', e.target.value)} /></td>\r\n                  <td>{it.itemTotal}</td>\r\n                  <td>{it.taxAmt || \"0.00\"}</td>\r\n                </tr>\r\n              ))}\r\n              {items.length === 0 && <tr><td colSpan={6} className=\"text-center\">No items</td></tr>}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderNotesTab = () => (\r\n    <div>\r\n      <div className=\"form-group\">\r\n        <label>Notes / Remarks</label>\r\n        <textarea className=\"form-control\" rows={3} value={this.state.notes} onChange={e => this.setState({ notes: e.target.value })} />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderVendorOverlay = () => {\r\n    const { vendors, vendorOverlaySearch } = this.state;\r\n    const filtered = vendors.filter(v => (v.name || \"\").toLowerCase().includes(vendorOverlaySearch.toLowerCase()) || (v.code || \"\").toLowerCase().includes(vendorOverlaySearch.toLowerCase()));\r\n    return (\r\n      <div className=\"custom-overlay\">\r\n        <div className=\"custom-overlay-content\">\r\n          <div className=\"custom-overlay-title\">Select Vendor</div>\r\n          <input className=\"form-control mb-2\" placeholder=\"Search vendor\" value={vendorOverlaySearch} onChange={e => this.setState({ vendorOverlaySearch: e.target.value })} />\r\n          <div style={{ maxHeight: 300, overflowY: 'auto' }}>\r\n            <table className=\"table table-sm table-bordered\">\r\n              <thead><tr><th>Code</th><th>Name</th></tr></thead>\r\n              <tbody>\r\n                {filtered.map((v, i) => (\r\n                  <tr key={v.id || i} onClick={() => this.selectVendor(v)} style={{ cursor: 'pointer' }}>\r\n                    <td>{v.code}</td><td>{v.name}</td>\r\n                  </tr>\r\n                ))}\r\n                {filtered.length === 0 && <tr><td colSpan={2} className=\"text-center\">No vendors</td></tr>}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"mt-2 text-right\">\r\n            <button className=\"btn btn-secondary btn-sm\" onClick={this.hideVendorOverlay}>Cancel</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderServiceOverlay = () => {\r\n    const { services, serviceOverlaySearch, selectedServiceIds } = this.state;\r\n    const filtered = services.filter(s => (s.code || \"\").toLowerCase().includes(serviceOverlaySearch.toLowerCase()) || (s.name || \"\").toLowerCase().includes(serviceOverlaySearch.toLowerCase()));\r\n    return (\r\n      <div className=\"custom-overlay\">\r\n        <div className=\"custom-overlay-content\">\r\n          <div className=\"custom-overlay-title\">Select Services</div>\r\n          <input className=\"form-control mb-2\" placeholder=\"Search services\" value={serviceOverlaySearch} onChange={e => this.setState({ serviceOverlaySearch: e.target.value })} />\r\n          <div style={{ maxHeight: 300, overflowY: 'auto' }}>\r\n            <table className=\"table table-sm table-bordered\">\r\n              <thead><tr><th></th><th>Code</th><th>Name</th><th>Rate</th></tr></thead>\r\n              <tbody>\r\n                {filtered.map(s => (\r\n                  <tr key={s.id}>\r\n                    <td><input type=\"checkbox\" checked={selectedServiceIds.includes(s.id)} onChange={e => this.toggleServiceSelection(s.id, e.target.checked)} /></td>\r\n                    <td>{s.code}</td><td>{s.name}</td><td>{s.rate}</td>\r\n                  </tr>\r\n                ))}\r\n                {filtered.length === 0 && <tr><td colSpan={4} className=\"text-center\">No services</td></tr>}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"d-flex justify-content-between mt-2\">\r\n            <button className=\"btn btn-success btn-sm\" onClick={this.addSelectedServicesToLineItems}>Add Selected</button>\r\n            <button className=\"btn btn-secondary btn-sm\" onClick={this.hideServiceOverlay}>Cancel</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderForm = () => (\r\n    <div className=\"card full-height\">\r\n      <form onSubmit={this.handleSubmit}>\r\n        <div style={{ padding: 20, overflowY: 'auto', height: 'calc(100% - 72px)' }}>\r\n          <h4>Third Party Billing</h4>\r\n          <ul className=\"nav nav-tabs mb-3\">\r\n            <li className=\"nav-item\"><button type=\"button\" className={`nav-link ${this.state.activeTab===0?'active':''}`} onClick={() => this.handleTabChange(0)}>Billing</button></li>\r\n            <li className=\"nav-item\"><button type=\"button\" className={`nav-link ${this.state.activeTab===1?'active':''}`} onClick={() => this.handleTabChange(1)}>Notes</button></li>\r\n          </ul>\r\n\r\n          {this.state.activeTab === 0 && this.renderBillingDetailsTab()}\r\n          {this.state.activeTab === 1 && this.renderNotesTab()}\r\n        </div>\r\n\r\n        <div className=\"fixed-card-footer p-3 border-top bg-white text-right\">\r\n          <button type=\"button\" className=\"btn btn-secondary mr-2\" onClick={() => this.setState({ showForm: false, editingId: null, formData: this.getEmptyForm(), notes: \"\" })}>Cancel</button>\r\n          <button type=\"submit\" className=\"btn btn-success\">{this.state.editingId ? \"Update & Send for Approval\" : \"Create & Send for Approval\"}</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n\r\n  renderTable = () => (\r\n    <div className=\"card mt-3 full-height\">\r\n      <div className=\"card-body\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n          <h4>Third Party Billing</h4>\r\n          <div>\r\n            <button className=\"btn btn-primary mr-2\" onClick={() => this.setState({ showForm: true })}>Create</button>\r\n            <button className=\"btn btn-outline-secondary\" onClick={() => this.props.history && this.props.history.push('/thirdparty-billing-approvals')}>Go to Approvals</button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr>\r\n                <th>Bill No</th><th>Date</th><th>Vendor</th><th>Total</th><th>Status</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {this.state.bills.map(b => (\r\n                <tr key={b.id}>\r\n                  <td><button className=\"btn btn-link p-0\" onClick={() => this.setState({ showForm: true, editingId: b.id, formData: { ...b }, notes: b.notes || \"\" })}>{b.billNo}</button></td>\r\n                  <td>{b.billDate}</td>\r\n                  <td>{b.vendorName}</td>\r\n                  <td>{b.totalValue}</td>\r\n                  <td>{this.getStatusBadge(b.status)}</td>\r\n                </tr>\r\n              ))}\r\n              {this.state.bills.length === 0 && <tr><td colSpan={5} className=\"text-center\">No records</td></tr>}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        {this.state.showForm ? this.renderForm() : this.renderTable()}\r\n        {this.state.showVendorOverlay && this.renderVendorOverlay()}\r\n        {this.state.showServiceOverlay && this.renderServiceOverlay()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ThirdPartyBilling;\r\n"]},"metadata":{},"sourceType":"module"}