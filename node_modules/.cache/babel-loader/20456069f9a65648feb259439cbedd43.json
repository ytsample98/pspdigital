{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\admin\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\quote\\\\Quote.js\";\nimport React, { Component } from 'react';\nimport { Form } from 'react-bootstrap';\nimport bsCustomFileInput from 'bs-custom-file-input';\nimport { db } from '../../../../firebase';\nimport { collection, getDocs, addDoc, doc, updateDoc, serverTimestamp } from 'firebase/firestore';\nimport { withRouter } from 'react-router-dom';\nimport html2canvas from 'html2canvas';\nimport { jsPDF } from 'jspdf';\nimport { recalculateTotals, getTaxDetailsFromGroup } from '../calculation';\nimport { toWords } from 'number-to-words';\nconst amount = 12345678;\nconst amountWords = `INR ${toWords(amount)} Only`;\n\nclass Quote extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      activeTab: 'co',\n      quotes: [],\n      customers: [],\n      products: [],\n      despatchModes: [],\n      paymentTerms: [],\n      showForm: false,\n      showTaxOverlay: false,\n      currentTaxLineIdx: null,\n      editingId: null,\n      overlayType: '',\n      overlaySearch: '',\n      productOverlayVisible: false,\n      productOverlaySearch: '',\n      selectedProductIds: [],\n      selectedTaxGroups: [],\n      taxComponents: [],\n      taxGroups: [],\n      previewMode: false,\n      selectedQuote: null,\n      breakdownItems: [],\n      breakdownType: 'Percentage',\n      breakdownSelectAll: false,\n      showSubProductDialog: false,\n      currentBreakdownIdx: null,\n      searchTerm: '',\n      subProductForm: {\n        name: '',\n        value: '',\n        type: 'Amount',\n        dueDate: ''\n      },\n      formData: {\n        quoteNo: '',\n        quoteDate: new Date().toISOString().split('T')[0],\n        quoteType: 'Standard',\n        customer: '',\n        status: 'Entered',\n        choose: 'Service',\n        qrefNo: '',\n        impExp: 'None',\n        currency: '',\n        conversionRate: '',\n        taxAmount: '',\n        quoteValue: '',\n        discountPercent: 0,\n        discountAmount: 0,\n        afterDiscountValue: 0,\n        billTo: '',\n        shipTo: '',\n        despatchMode: 'By Air',\n        paymentTerms: '',\n        freightCharges: '',\n        freighttaxAmount: '',\n        taxPercent: '',\n        packingCharges: '',\n        lineItems: []\n      }\n    };\n    this.customerInputRef = React.createRef();\n\n    this.handleOverlayClose = () => {\n      this.setState({\n        overlayType: '',\n        overlaySearch: '',\n        productOverlayVisible: false,\n        showTaxOverlay: false,\n        currentTaxLineIdx: null,\n        selectedProductIds: []\n      });\n    };\n\n    this.recalculateQuoteTotals = () => {\n      const {\n        lineItems,\n        discountPercent\n      } = this.state.formData;\n      let quoteValue = 0;\n      let taxAmount = 0;\n      (lineItems || []).forEach(item => {\n        quoteValue += parseFloat(item.itemTotal || 0);\n        taxAmount += parseFloat(item.taxAmt || 0);\n      });\n      const discountPercentNum = parseFloat(discountPercent || 0);\n      const discountAmount = parseFloat(quoteValue) * discountPercentNum / 100;\n      const afterDiscountValue = quoteValue - discountAmount;\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          quoteValue: quoteValue.toFixed(2),\n          taxAmount: taxAmount.toFixed(2),\n          discountAmount: discountAmount.toFixed(2),\n          afterDiscountValue: afterDiscountValue.toFixed(2)\n        }\n      }));\n    };\n\n    this.formatAddress = addr => {\n      if (!addr) return '';\n      if (typeof addr === 'string') return addr;\n      return [addr.address, [addr.city, addr.state, addr.country].filter(Boolean).join(', '), addr.zip].filter(Boolean).join('\\n');\n    };\n\n    this.handleChooseChange = value => {\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          choose: value\n        }\n      }), this.filterProductsByCategory);\n    };\n\n    this.filterProductsByCategory = () => {\n      const {\n        choose\n      } = this.state.formData;\n      let filteredProducts = [];\n\n      if (choose === \"Service\") {\n        filteredProducts = this.state.products.filter(p => p.category === \"Service\");\n      } else if (choose === \"Product\") {\n        filteredProducts = this.state.products.filter(p => p.category === \"Product\");\n      } else if (choose === \"Bundle\") {\n        filteredProducts = this.state.products; // All products\n      }\n\n      this.setState({\n        filteredProducts\n      });\n    };\n\n    this.handleDiscountChange = (field, value) => {\n      let {\n        formData\n      } = this.state;\n      formData[field] = value;\n      const quoteValue = parseFloat(formData.quoteValue || 0);\n      const discountPercent = parseFloat(formData.discountPercent || 0);\n      const discountAmount = quoteValue * discountPercent / 100;\n      const afterDiscountValue = quoteValue - discountAmount;\n      formData.discountAmount = discountAmount;\n      formData.afterDiscountValue = afterDiscountValue;\n      this.setState({\n        formData\n      });\n    };\n\n    this.handleLineItemChange = (idx, field, value) => {\n      const updatedItems = [...this.state.formData.lineItems];\n      updatedItems[idx] = { ...updatedItems[idx],\n        [field]: value\n      };\n\n      if (field === 'qty' || field === 'unitPrice' || field === 'taxAmt') {\n        // Calculate taxAmt based on selected tax groups\n        let percent = 0;\n        let amount = 0;\n        (updatedItems[idx].taxGroupNames || []).forEach(groupName => {\n          const group = this.state.taxGroups.find(t => t.groupName === groupName);\n\n          if (group && Array.isArray(group.lineItems)) {\n            group.lineItems.forEach(comp => {\n              const val = parseFloat(comp.percentOrAmt || 0);\n              if (comp.type === 'Percentage') percent += val;\n              if (comp.type === 'Amount') amount += val;\n            });\n          }\n        });\n        const qty = parseFloat(updatedItems[idx].qty || 0);\n        const unitPrice = parseFloat(updatedItems[idx].unitPrice || 0);\n        const baseTotal = qty * unitPrice;\n        const taxAmt = baseTotal * percent / 100 + amount;\n        updatedItems[idx].baseTotal = baseTotal.toFixed(2);\n        updatedItems[idx].taxAmt = taxAmt.toFixed(2);\n        updatedItems[idx].itemTotal = (baseTotal + taxAmt).toFixed(2);\n      }\n\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: updatedItems\n        }\n      }), this.recalculateQuoteTotals);\n    };\n\n    this.fetchTaxGroups = async () => {\n      const snap = await getDocs(collection(db, 'taxGroups'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        taxGroups: data\n      });\n    };\n\n    this.fetchQuotes = async () => {\n      const snap = await getDocs(collection(db, 'quotes'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      data.sort((a, b) => {\n        var _a$createdAt, _a$createdAt$toDate, _b$createdAt, _b$createdAt$toDate;\n\n        const dateA = new Date(a.quoteDate || ((_a$createdAt = a.createdAt) === null || _a$createdAt === void 0 ? void 0 : (_a$createdAt$toDate = _a$createdAt.toDate) === null || _a$createdAt$toDate === void 0 ? void 0 : _a$createdAt$toDate.call(_a$createdAt)) || a.createdAt || 0);\n        const dateB = new Date(b.quoteDate || ((_b$createdAt = b.createdAt) === null || _b$createdAt === void 0 ? void 0 : (_b$createdAt$toDate = _b$createdAt.toDate) === null || _b$createdAt$toDate === void 0 ? void 0 : _b$createdAt$toDate.call(_b$createdAt)) || b.createdAt || 0);\n        return dateA - dateB;\n      });\n      this.setState({\n        quotes: data.reverse()\n      });\n    };\n\n    this.fetchCustomers = async () => {\n      const snap = await getDocs(collection(db, 'customers'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        customers: data\n      });\n    };\n\n    this.fetchProducts = async () => {\n      const snap = await getDocs(collection(db, 'products'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        products: data,\n        filteredProducts: data\n      }, this.filterProductsByCategory);\n    };\n\n    this.fetchDespatchModes = async () => {\n      const snap = await getDocs(collection(db, 'modes'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        despatchModes: data\n      });\n    };\n\n    this.fetchPaymentTerms = async () => {\n      const snap = await getDocs(collection(db, 'paymentTerms'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        paymentTerms: data\n      });\n    };\n\n    this.toggleTaxGroupSelection = (groupName, lineIdx, checked) => {\n      this.setState(prev => {\n        const lineItems = [...prev.formData.lineItems];\n        const item = { ...lineItems[lineIdx]\n        };\n        let taxGroupNames = Array.isArray(item.taxGroupNames) ? [...item.taxGroupNames] : [];\n\n        if (checked) {\n          if (!taxGroupNames.includes(groupName)) taxGroupNames.push(groupName);\n        } else {\n          taxGroupNames = taxGroupNames.filter(g => g !== groupName);\n        }\n\n        item.taxGroupNames = taxGroupNames;\n        item.taxGroupName = taxGroupNames.join(', ');\n        lineItems[lineIdx] = item;\n        const {\n          updatedLineItems,\n          freighttaxAmount,\n          taxAmount,\n          quoteValue\n        } = recalculateTotals({\n          lineItems,\n          freightCharges: prev.formData.freightCharges,\n          packingCharges: prev.formData.packingCharges,\n          taxPercent: prev.formData.taxPercent,\n          taxGroups: prev.taxGroups\n        });\n        return {\n          formData: { ...prev.formData,\n            lineItems: updatedLineItems,\n            freighttaxAmount,\n            taxAmount,\n            quoteValue\n          }\n        };\n      });\n    };\n\n    this.handleInputChange = (field, value) => {\n      this.setState(prev => {\n        let newFormData = { ...prev.formData,\n          [field]: value\n        };\n\n        if (field === \"quoteType\") {\n          if (value === \"Standard\") {\n            newFormData.quoteNo = `QT${1000 + (prev.quotes ? prev.quotes.length : 0)}`;\n          } else {\n            newFormData.quoteNo = \"\";\n          }\n        }\n\n        return {\n          formData: newFormData\n        };\n      }, () => {\n        if (['freightCharges', 'taxPercent', 'packingCharges'].includes(field)) {\n          const {\n            updatedLineItems,\n            freighttaxAmount,\n            taxAmount,\n            quoteValue\n          } = recalculateTotals({\n            lineItems: this.state.formData.lineItems,\n            freightCharges: this.state.formData.freightCharges,\n            packingCharges: this.state.formData.packingCharges,\n            taxPercent: this.state.formData.taxPercent,\n            taxGroups: this.state.taxGroups\n          });\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              lineItems: updatedLineItems,\n              freighttaxAmount,\n              taxAmount,\n              quoteValue\n            }\n          }));\n        }\n      });\n    };\n\n    this.handleBreakdownSelectAll = checked => {\n      this.setState(prev => ({\n        breakdownSelectAll: checked,\n        breakdownItems: prev.breakdownItems.map(item => ({ ...item,\n          selected: checked\n        }))\n      }));\n    };\n\n    this.handleBreakdownRowSelect = (idx, checked) => {\n      this.setState(prev => {\n        const items = [...prev.breakdownItems];\n        items[idx].selected = checked;\n        return {\n          breakdownItems: items\n        };\n      });\n    };\n\n    this.handleBreakdownTypeChange = type => {\n      this.setState({\n        breakdownType: type\n      });\n    };\n\n    this.handleBreakdownValueChange = (idx, value) => {\n      this.setState(prev => {\n        const items = [...prev.breakdownItems];\n        items[idx].value = value;\n        return {\n          breakdownItems: items\n        };\n      });\n    };\n\n    this.updateStatus = async (id, status) => {\n      await updateDoc(doc(db, \"quotes\", id), {\n        status\n      });\n      alert(`Quote ${status}`);\n      this.fetchQuotes();\n      this.setState({\n        previewMode: false\n      });\n    };\n\n    this.handleBreakdownDateChange = (idx, value) => {\n      this.setState(prev => {\n        const items = [...prev.breakdownItems];\n        items[idx].lastDate = value;\n        return {\n          breakdownItems: items\n        };\n      });\n    };\n\n    this.saveBreakdownToSession = () => {\n      sessionStorage.setItem('breakdownItems', JSON.stringify(this.state.breakdownItems));\n    };\n\n    this.loadBreakdownFromSession = () => {\n      const data = sessionStorage.getItem('breakdownItems');\n      if (data) this.setState({\n        breakdownItems: JSON.parse(data)\n      });\n    };\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      const {\n        editingId,\n        formData,\n        quotes\n      } = this.state;\n      if (!formData.customer) return alert(\"Customer is required\");\n      if (formData.lineItems.length === 0) return alert(\"At least one line item is required\");\n\n      if (!this.isBreakdownValid()) {\n        return alert(\"Please complete the breakdown: each product's subproduct totals must match the product total.\");\n      }\n\n      const payload = { ...formData,\n        status: \"Awaiting for Approval\",\n        breakdownItems: this.state.breakdownItems || []\n      };\n\n      if (editingId) {\n        await updateDoc(doc(db, 'quotes', editingId), payload);\n      } else {\n        payload.quoteNo = `QT${1000 + quotes.length}`;\n        await addDoc(collection(db, \"quotes\"), { ...payload,\n          status: \"Awaiting for Approval\",\n          createdAt: serverTimestamp()\n        });\n      }\n\n      this.setState({\n        showForm: false,\n        editingId: null\n      });\n      this.fetchQuotes();\n    };\n\n    this.loadQuotePreview = q => {\n      this.setState({\n        selectedQuote: q,\n        previewMode: true\n      });\n    };\n\n    this.loadQuoteForEdit = quote => {\n      this.setState({\n        formData: { ...quote,\n          lineItems: Array.isArray(quote.lineItems) ? quote.lineItems : []\n        },\n        breakdownItems: Array.isArray(quote.breakdownItems) ? quote.breakdownItems : [],\n        editingId: quote.id,\n        showForm: true,\n        previewMode: false,\n        activeTab: 'co'\n      }, () => {\n        if (this.customerInputRef.current) {\n          this.customerInputRef.current.value = quote.customer;\n        }\n      });\n    };\n\n    this.convertToOrder = quoteObj => {\n      sessionStorage.setItem('quoteToConvert', JSON.stringify(quoteObj));\n      this.props.history.push({\n        pathname: '/sales/salestransactions/order/Order',\n        state: {\n          openForm: true,\n          quoteId: quoteObj.id || null\n        }\n      });\n    };\n\n    this.showQuotePDFWithOrg = async quote => {\n      var _orgSnap$docs$;\n\n      if (!quote || !Array.isArray(quote.lineItems) || quote.lineItems.length === 0) {\n        alert(\"Quote data is incomplete.\");\n        return;\n      } // 1. Fetch org and customer data\n\n\n      const orgSnap = await getDocs(collection(db, 'businessGroups'));\n      const org = ((_orgSnap$docs$ = orgSnap.docs[0]) === null || _orgSnap$docs$ === void 0 ? void 0 : _orgSnap$docs$.data()) || {};\n      const customer = this.state.customers.find(c => c.custshortName === quote.customer || c.custname === quote.customer) || {}; // GST State Map for Place of Supply\n\n      const gstStateMap = {\n        \"01\": \"Jammu & Kashmir\",\n        \"02\": \"Himachal Pradesh\",\n        \"03\": \"Punjab\",\n        \"04\": \"Chandigarh\",\n        \"05\": \"Uttarakhand\",\n        \"06\": \"Haryana\",\n        \"07\": \"Delhi\",\n        \"08\": \"Rajasthan\",\n        \"09\": \"Uttar Pradesh\",\n        \"10\": \"Bihar\",\n        \"11\": \"Sikkim\",\n        \"12\": \"Arunachal Pradesh\",\n        \"13\": \"Nagaland\",\n        \"14\": \"Manipur\",\n        \"15\": \"Mizoram\",\n        \"16\": \"Tripura\",\n        \"17\": \"Meghalaya\",\n        \"18\": \"Assam\",\n        \"19\": \"West Bengal\",\n        \"20\": \"Jharkhand\",\n        \"21\": \"Odisha\",\n        \"22\": \"Chhattisgarh\",\n        \"23\": \"Madhya Pradesh\",\n        \"24\": \"Gujarat\",\n        \"25\": \"Daman and Diu\",\n        \"26\": \"Dadra and Nagar Haveli\",\n        \"27\": \"Maharashtra\",\n        \"28\": \"Andhra Pradesh (Old)\",\n        \"29\": \"Karnataka\",\n        \"30\": \"Goa\",\n        \"31\": \"Lakshadweep\",\n        \"32\": \"Kerala\",\n        \"33\": \"Tamil Nadu\",\n        \"34\": \"Puducherry\",\n        \"35\": \"Andaman and Nicobar Islands\",\n        \"36\": \"Telangana\",\n        \"37\": \"Andhra Pradesh\",\n        \"97\": \"Other Territory\"\n      }; // Helper for Place of Supply\n\n      const getPlaceOfSupply = gstin => {\n        if (!gstin || gstin.length < 2) return '';\n        const code = gstin.substring(0, 2);\n        const state = gstStateMap[code];\n        return state ? `${code} - ${state}` : '';\n      }; // 2. Enrich line items\n\n\n      const enrichedItems = quote.lineItems.map(item => {\n        const product = this.state.products.find(p => p.productId === item.itemCode) || {};\n        return { ...item,\n          ptshortName: product.ptshortName || '',\n          hsnCode: product.hsnCode || '',\n          uom: product.stockingUOM || '',\n          cgst: item.cgst || 0,\n          sgst: item.sgst || 0,\n          igst: item.igst || 0,\n          taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\n        };\n      }); // 3. Subtotal (without tax)\n\n      const subtotal = enrichedItems.reduce((sum, item) => sum + (parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0), 0);\n      const freightCharges = parseFloat(quote.freightCharges || 0);\n      const freightTax = parseFloat(quote.freighttaxAmount || 0);\n      const totalTaxAmount = parseFloat(quote.taxAmount || 0);\n      const grandTotal = parseFloat(quote.quoteValue || subtotal + totalTaxAmount);\n      const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`;\n      const isINR = (quote.currency || 'INR') === 'INR';\n      const conversionRate = parseFloat(quote.conversionRate || 1);\n\n      const convert = amt => isINR ? amt : amt * conversionRate;\n\n      const subtotalConv = convert(subtotal);\n      const freightChargesConv = convert(freightCharges);\n      const taxAmountConv = convert(totalTaxAmount);\n      const discountAmountConv = convert(quote.discountAmount || 0);\n      const grandTotalConv = convert(quote.afterDiscountValue || grandTotal); // 4. Tax breakdown by group\n\n      let taxBreakdown = {};\n      let taxGroupDetails = [];\n      let sno = 1;\n      enrichedItems.forEach(item => {\n        const qty = parseFloat(item.qty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const base = qty * unitPrice;\n        (item.taxGroupNames || []).forEach(tgName => {\n          // Find group in taxGroups\n          const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\n\n          if (group) {\n            group.lineItems.forEach(li => {\n              const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\n              let taxAmt = 0;\n              if (li.type === 'Amount') taxAmt = parseFloat(li.percentOrAmt || 0);else taxAmt = base * parseFloat(li.percentOrAmt || 0) / 100;\n              taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n              taxGroupDetails.push({\n                sno: sno++,\n                group: tgName,\n                peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\n                taxAmt: taxAmt.toFixed(2)\n              });\n            });\n          }\n        });\n      });\n\n      if (freightTax > 0) {\n        taxBreakdown[\"Freight Tax\"] = freightTax;\n        taxGroupDetails.push({\n          sno: sno++,\n          group: \"Freight Tax\",\n          peramt: \"-\",\n          taxAmt: freightTax.toFixed(2)\n        });\n      } // 5. Milestone breakdown (with subproducts)\n\n\n      const {\n        breakdownItems,\n        breakdownType\n      } = this.state; // 6. Build HTML for PDF\n\n      const container = document.createElement('div');\n      container.id = 'pdf-preview-container';\n      container.style.width = '794px';\n      container.style.padding = '40px';\n      container.style.fontFamily = 'Arial'; // before this block, define:\n\n      const numCols = isINR ? 8 : 7;\n      container.innerHTML += `\n  <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\n    <thead>\n      <tr style=\"background:#f4f6fa;\">\n        <th style=\"border:1px solid #011b56;\">Item Code</th>\n        <th style=\"border:1px solid #011b56;\">Description</th>\n        <th style=\"border:1px solid #011b56;\">HSN</th>\n        <th style=\"border:1px solid #011b56;\">UOM</th>\n        <th style=\"border:1px solid #011b56;\">Qty</th>\n        <th style=\"border:1px solid #011b56;\">Unit Price</th>\n        ${isINR ? `<th style=\"border:1px solid #011b56;\">GST%</th>` : ''}\n        <th style=\"border:1px solid #011b56;\">Item Total</th>\n      </tr>\n    </thead>\n    <tbody>\n      ${enrichedItems.map(item => {\n        const gstLabel = item.taxGroupNames && item.taxGroupNames.length ? item.taxGroupNames.join(', ') : item.taxGroupName || item.taxId || '-';\n        return `\n          <tr>\n            <td style=\"border:1px solid #011b56;\">${item.itemCode}</td>\n            <td style=\"border:1px solid #011b56;\">${item.itemDescription}</td>\n            <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\n            <td style=\"border:1px solid #011b56;\">${item.uom}</td>\n            <td style=\"border:1px solid #011b56;\">${item.qty}</td>\n            <td style=\"border:1px solid #011b56;\">${convert(item.unitPrice).toFixed(2)}</td>\n            ${isINR ? `<td style=\"border:1px solid #011b56;\">${gstLabel}</td>` : ''}\n            <td style=\"border:1px solid #011b56;\">${convert(item.total).toFixed(2)}</td>\n          </tr>`;\n      }).join('')}\n\n      <!-- Subtotal -->\n      <tr>\n        <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\n        <td style=\"border:1px solid #011b56;\"><b>${convert(subtotal).toFixed(2)}</b></td>\n      </tr>\n\n      <!-- Total Tax Amount (only if > 0) -->\n      ${convert(totalTaxAmount) > 0 ? `\n        <tr>\n          <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${convert(totalTaxAmount).toFixed(2)}</b></td>\n        </tr>` : ''}\n\n      <!-- Discount Amount (only if > 0) -->\n      ${Number(convert(quote.discountAmount || 0)) > 0 ? `\n        <tr>\n          <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${Number(convert(quote.discountAmount || 0)).toFixed(2)}</b></td>\n        </tr>` : ''}\n\n      <!-- Grand Total -->\n      <tr>\n        <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Grand Total</b></td>\n        <td style=\"border:1px solid #011b56;\"><b>${Number(convert(quote.afterDiscountValue || grandTotal)).toFixed(2)}</b></td>\n      </tr>\n    </tbody>\n  </table>\n\n  <div style=\"margin-top:8px; font-size:11px;\">\n    <b>Amount in Words:</b> ${amountWords}\n  </div>\n  <div style=\"margin-top:20px; text-align:right; font-size:10px;\">\n    Printed on ${new Date().toLocaleString()}\n  </div>\n`;\n      document.body.appendChild(container);\n      const canvas = await html2canvas(container, {\n        scale: 2,\n        useCORS: true\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF('p', 'pt', 'a4');\n      const width = 595.28;\n      const height = canvas.height * width / canvas.width;\n      pdf.addImage(imgData, 'PNG', 0, 0, width, height);\n      document.body.removeChild(container); // ...existing code...\n      // 8. Milestone breakdown and tax breakdown on the same page, same style as quote table\n\n      if (breakdownItems && breakdownItems.length > 0) {\n        pdf.addPage();\n        let milestoneRows = breakdownItems.filter(bi => bi.selected !== false).map((item, idx) => {\n          const mainItem = enrichedItems.find(li => li.itemCode === item.productId);\n          const mainItemTotal = mainItem ? parseFloat(mainItem.total) || 0 : 0;\n          return `\n    <tr>\n      <td style=\"border:1px solid #011b56;\">${item.sno || ''}</td>\n      <td style=\"border:1px solid #011b56;\">${item.productId || ''}</td>\n      <td style=\"border:1px solid #011b56;\">${item.desc || ''}</td>\n      <td style=\"border:1px solid #011b56;\">${item.value ? item.value + (breakdownType === 'Percentage' ? '%' : '₹') : ''}</td>\n      <td style=\"border:1px solid #011b56;\">${item.dueDate || ''}</td>\n      <td style=\"border:1px solid #011b56;\">${mainItemTotal.toFixed(2)}</td>\n    </tr>\n    ${(item.subProducts || []).map((sp, spIdx) => {\n            const rawVal = parseFloat(sp.value || 0) || 0;\n            let spTotal = 0;\n\n            if (breakdownType === 'Percentage') {\n              spTotal = mainItemTotal * rawVal / 100;\n            } else {\n              spTotal = rawVal;\n            }\n\n            return `\n        <tr style=\"background: #f9f9f9;\">\n          <td style=\"border:1px solid #011b56;\"></td>\n          <td style=\"border:1px solid #011b56;\">${item.productId}_${spIdx + 1}</td>\n          <td style=\"border:1px solid #011b56;\">→ ${sp.name || ''}</td>\n          <td style=\"border:1px solid #011b56;\">${sp.value ? breakdownType === 'Percentage' ? sp.value + '%' : '₹' + sp.value : ''}</td>\n          <td style=\"border:1px solid #011b56;\">${sp.dueDate || ''}</td>\n          <td style=\"border:1px solid #011b56;\">${spTotal.toFixed(2)}</td>\n        </tr>\n      `;\n          }).join('')}\n  `;\n        }).join('');\n        let taxRows = taxGroupDetails.map(row => `\n  <tr>\n    <td style=\"border:1px solid #011b56;\">${row.sno}</td>\n    <td style=\"border:1px solid #011b56;\">${row.group}</td>\n    <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\n    <td style=\"border:1px solid #011b56;\">${convert(row.taxAmt).toFixed(2)}</td>\n  </tr>\n`).join('');\n        let combinedHtml = `\n  <div style=\"font-family:Arial; padding:40px; width:100%;\">\n    <h2 style=\"margin-bottom:20px; font-size:20px;\">Tax Breakdown</h2>\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:13px;\">\n      <thead>\n        <tr style=\"background:#f4f6fa;\">\n          <th style=\"border:1px solid #011b56;\">S.No</th>\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\n          <th style=\"border:1px solid #011b56;\">Per/Amt</th>\n          <th style=\"border:1px solid #011b56;\">Tax Amt</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${taxRows}\n        <tr>\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${taxAmountConv.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${discountAmountConv.toFixed(2)}</b></td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n`;\n        const combinedContainer = document.createElement('div');\n        combinedContainer.id = 'pdf-preview-container';\n        combinedContainer.style.width = '794px';\n        combinedContainer.style.padding = '40px';\n        combinedContainer.style.fontFamily = 'Arial';\n        combinedContainer.style.fontSize = '10px'; // Ensure same font size as first page\n\n        combinedContainer.innerHTML = combinedHtml;\n        document.body.appendChild(combinedContainer);\n        const combinedCanvas = await html2canvas(combinedContainer, {\n          scale: 2,\n          useCORS: true\n        });\n        const combinedImg = combinedCanvas.toDataURL('image/png');\n        pdf.addImage(combinedImg, 'PNG', 0, 0, width, combinedCanvas.height * width / combinedCanvas.width);\n        document.body.removeChild(combinedContainer);\n      }\n\n      pdf.setFontSize(11);\n      pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\n      pdf.text('Authorized Signatory', width - 200, 800); // 11. Show PDF\n\n      const blob = pdf.output('blob');\n      const url = URL.createObjectURL(blob);\n      const newWin = window.open();\n      newWin.document.write(`\n    <html><head><title>Quote PDF Preview</title></head>\n    <body style=\"margin:0;\">\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\n      <button onclick=\"document.querySelector('iframe').contentWindow.print()\" style=\"position:fixed;top:10px;right:110px;\"></button>\n      <a href=\"${url}\" download=\"Quote_${quote.quoteNo || 'PDF'}.pdf\" style=\"position:fixed;top:10px;right:10px;\"></a>\n    </body></html>\n  `);\n      newWin.document.close();\n    };\n\n    this.showOverlay = type => this.setState({\n      overlayType: type,\n      overlaySearch: ''\n    });\n\n    this.hideOverlay = () => this.setState({\n      overlayType: '',\n      overlaySearch: ''\n    });\n\n    this.selectOverlayValue = async value => {\n      if (this.state.overlayType === 'customer') {\n        // Fetch conversion rate from Firestore\n        let conversionRate = '';\n\n        if (value.currency && value.currency !== 'INR') {\n          const snap = await getDocs(collection(db, 'currencies'));\n          const currencies = snap.docs.map(d => ({\n            id: d.id,\n            ...d.data()\n          }));\n          const cur = currencies.find(c => c.code === value.currency);\n          conversionRate = cur ? cur.conversionRate : '';\n        }\n\n        this.setState(prev => ({\n          formData: { ...prev.formData,\n            customer: value.custname || value.custcode || '',\n            billTo: this.formatAddress(value.billTo),\n            shipTo: this.formatAddress(value.shipTo),\n            currency: value.currency || '',\n            conversionRate: conversionRate\n          },\n          overlayType: '',\n          overlaySearch: ''\n        }), () => {\n          if (this.customerInputRef.current) {\n            this.customerInputRef.current.value = value.custname || value.custcode || '';\n          }\n        });\n      }\n    };\n\n    this.renderOverlay = () => {\n      const {\n        overlayType,\n        overlaySearch,\n        customers,\n        despatchModes,\n        paymentTerms\n      } = this.state;\n\n      const getFilteredRows = (list, nameKey = 'name', codeKey = 'shortName') => list.filter(item => (item[nameKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase()) || (item[codeKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase()));\n\n      const handleSelect = item => {\n        if (overlayType === 'customer') {\n          this.selectOverlayValue(item);\n        } else if (overlayType === 'despatchMode') {\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              despatchMode: item.name\n            },\n            overlayType: '',\n            overlaySearch: ''\n          }));\n        } else if (overlayType === 'paymentTerms') {\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              paymentTerms: item.name\n            },\n            overlayType: '',\n            overlaySearch: ''\n          }));\n        }\n      };\n\n      let title = '';\n      let headers = [];\n      let rows = [];\n\n      if (overlayType === 'customer') {\n        title = 'Select Customer';\n        headers = ['Name', 'Code', 'Short Name'];\n        rows = getFilteredRows(customers, 'custname', 'custcode');\n      } else if (overlayType === 'despatchMode') {\n        title = 'Select Despatch Mode';\n        headers = ['Name', 'Short Name'];\n        rows = getFilteredRows(despatchModes);\n      } else if (overlayType === 'paymentTerms') {\n        title = 'Select Payment Terms';\n        headers = ['Name', 'Short Name'];\n        rows = getFilteredRows(paymentTerms);\n      } else {\n        return null;\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 812,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 813,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 814,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 815,\n          columnNumber: 11\n        }\n      }, title), /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-close-box-outline\",\n        style: {\n          fontSize: \"24px\",\n          color: \"#2196F3\",\n          cursor: \"pointer\"\n        },\n        onClick: this.handleOverlayClose,\n        \"aria-label\": \"Close\",\n        type: \"button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 816,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control mb-2\",\n        placeholder: `Search ${overlayType}...`,\n        value: overlaySearch,\n        onChange: e => this.setState({\n          overlaySearch: e.target.value\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 824,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          maxHeight: 300,\n          overflowY: 'auto'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 831,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 832,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 833,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 834,\n          columnNumber: 15\n        }\n      }, headers.map((h, i) => /*#__PURE__*/React.createElement(\"th\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 835,\n          columnNumber: 40\n        }\n      }, h)))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 838,\n          columnNumber: 13\n        }\n      }, rows.map((item, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: item.id || i,\n        onClick: () => handleSelect(item),\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 840,\n          columnNumber: 17\n        }\n      }, headers.map((h, j) => /*#__PURE__*/React.createElement(\"td\", {\n        key: j,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 842,\n          columnNumber: 21\n        }\n      }, overlayType === 'customer' ? h === 'Name' ? item.custname : h === 'Code' ? item.custcode : item.custshortName : h === 'Name' ? item.name : item.shortName)))), rows.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 854,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: headers.length,\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 855,\n          columnNumber: 19\n        }\n      }, \"No records found\")))))));\n    };\n\n    this.renderProductOverlay = () => {\n      const {\n        filteredProducts,\n        productOverlaySearch,\n        selectedProductIds,\n        currentPage = 1\n      } = this.state;\n      const itemsPerPage = 10;\n      const filtered = filteredProducts.filter(p => (p.ptshortName || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) || (p.ptdescription || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) || (p.itemCode || '').toLowerCase().includes(productOverlaySearch.toLowerCase()));\n      const totalPages = Math.ceil(filtered.length / itemsPerPage);\n      const paginated = filtered.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 879,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 880,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 881,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 882,\n          columnNumber: 3\n        }\n      }, \"Select Products\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex align-items-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 883,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-primary btn-sm mr-2\",\n        onClick: () => {\n          const selectedProducts = filteredProducts.filter(p => selectedProductIds.includes(p.id));\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              lineItems: [...prev.formData.lineItems, ...selectedProducts.filter(p => !prev.formData.lineItems.some(item => item.id === p.id)).map(p => ({\n                id: p.id,\n                itemCode: p.productId || '',\n                itemDescription: p.ptdescription || '',\n                itemType: p.itemType || '',\n                materialType: p.materialType || '',\n                onHand: p.onHand || 0,\n                taxGroup: p.taxGroup || '',\n                taxGroupName: p.taxGroup || '',\n                custPartNo: p.custPartNo || '',\n                hsnCode: p.hsnCode || '',\n                unitPrice: p.unitPrice || 0,\n                qty: 1,\n                total: (p.unitPrice || 0).toFixed(2)\n              }))]\n            },\n            productOverlayVisible: false,\n            selectedProductIds: []\n          }));\n        },\n        type: \"button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 884,\n          columnNumber: 5\n        }\n      }, \"Add Selected\"), /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-close-box-outline\",\n        style: {\n          fontSize: \"24px\",\n          color: \"#2196F3\",\n          cursor: \"pointer\"\n        },\n        onClick: this.handleOverlayClose,\n        \"aria-label\": \"Close\",\n        type: \"button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 923,\n          columnNumber: 3\n        }\n      }))), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control mb-2\",\n        placeholder: \"Search products...\",\n        value: productOverlaySearch,\n        onChange: e => this.setState({\n          productOverlaySearch: e.target.value,\n          currentPage: 1\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 937,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          flex: 1,\n          overflowY: \"auto\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 944,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 945,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 946,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 947,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 948,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 949,\n          columnNumber: 17\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 950,\n          columnNumber: 17\n        }\n      }, \"Item Desc\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 951,\n          columnNumber: 17\n        }\n      }, \"Item Type\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 952,\n          columnNumber: 17\n        }\n      }, \"Material Type\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 953,\n          columnNumber: 17\n        }\n      }, \"On Hand\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 954,\n          columnNumber: 17\n        }\n      }, \"Tax Grp\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 955,\n          columnNumber: 17\n        }\n      }, \"Cust Part No\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 958,\n          columnNumber: 13\n        }\n      }, paginated.map(p => /*#__PURE__*/React.createElement(\"tr\", {\n        key: p.id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 960,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 961,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: selectedProductIds.includes(p.id),\n        onChange: e => {\n          const checked = e.target.checked;\n          this.setState(prev => ({\n            selectedProductIds: checked ? [...prev.selectedProductIds, p.id] : prev.selectedProductIds.filter(id => id !== p.id)\n          }));\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 962,\n          columnNumber: 21\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 975,\n          columnNumber: 19\n        }\n      }, p.productId), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 976,\n          columnNumber: 19\n        }\n      }, p.ptdescription || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 977,\n          columnNumber: 19\n        }\n      }, p.itemType || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 978,\n          columnNumber: 19\n        }\n      }, p.materialType || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 979,\n          columnNumber: 19\n        }\n      }, p.onHand || 0), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 980,\n          columnNumber: 19\n        }\n      }, p.taxGroup || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 981,\n          columnNumber: 19\n        }\n      }, p.custPartNo || ''))), paginated.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 985,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: \"8\",\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 986,\n          columnNumber: 19\n        }\n      }, \"No products found\"))))), /*#__PURE__*/React.createElement(\"nav\", {\n        \"aria-label\": \"Product pagination example\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 993,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"pagination justify-content-end\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 994,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"li\", {\n        className: `page-item ${currentPage === 1 ? \"disabled\" : \"\"}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 995,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"page-link\",\n        \"aria-label\": \"Previous\",\n        onClick: () => this.setState({\n          currentPage: Math.max(currentPage - 1, 1)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 996,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        \"aria-hidden\": \"true\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1001,\n          columnNumber: 17\n        }\n      }, \"\\xAB\"))), [...Array(totalPages)].map((_, idx) => /*#__PURE__*/React.createElement(\"li\", {\n        key: idx,\n        className: `page-item ${currentPage === idx + 1 ? \"active\" : \"\"}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1005,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"page-link\",\n        onClick: () => this.setState({\n          currentPage: idx + 1\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1006,\n          columnNumber: 17\n        }\n      }, idx + 1))), /*#__PURE__*/React.createElement(\"li\", {\n        className: `page-item ${currentPage === totalPages ? \"disabled\" : \"\"}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1014,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"page-link\",\n        \"aria-label\": \"Next\",\n        onClick: () => this.setState({\n          currentPage: Math.min(currentPage + 1, totalPages)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1015,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        \"aria-hidden\": \"true\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1020,\n          columnNumber: 17\n        }\n      }, \"\\xBB\")))))));\n    };\n\n    this.renderTaxOverlay = () => {\n      const {\n        taxGroups,\n        currentTaxLineIdx,\n        formData\n      } = this.state;\n      if (currentTaxLineIdx === null) return null;\n      const item = formData.lineItems[currentTaxLineIdx];\n      const selected = new Set(item.taxGroupNames || []);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1039,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1040,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1041,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1042,\n          columnNumber: 11\n        }\n      }, \"Select Tax Groups\"), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1043,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-primary btn-sm mr-2\",\n        onClick: () => this.setState({\n          showTaxOverlay: false\n        }),\n        type: \"button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1044,\n          columnNumber: 13\n        }\n      }, \"Submit\"), /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-close-box-outline\",\n        style: {\n          fontSize: \"24px\",\n          color: \"#2196F3\",\n          cursor: \"pointer\"\n        },\n        onClick: this.handleOverlayClose,\n        \"aria-label\": \"Close\",\n        type: \"button\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1051,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-sm table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1060,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        style: {\n          background: '#f4f6fa'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1061,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1062,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1063,\n          columnNumber: 15\n        }\n      }), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1064,\n          columnNumber: 15\n        }\n      }, \"Group\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1065,\n          columnNumber: 15\n        }\n      }, \"Components\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1066,\n          columnNumber: 15\n        }\n      }, \"Type\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1067,\n          columnNumber: 15\n        }\n      }, \"% / Amount\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1070,\n          columnNumber: 11\n        }\n      }, taxGroups.map(tg => /*#__PURE__*/React.createElement(\"tr\", {\n        key: tg.groupName,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1072,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1073,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: selected.has(tg.groupName),\n        onChange: e => this.toggleTaxGroupSelection(tg.groupName, currentTaxLineIdx, e.target.checked),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1074,\n          columnNumber: 19\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1082,\n          columnNumber: 17\n        }\n      }, tg.groupName), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1083,\n          columnNumber: 17\n        }\n      }, tg.lineItems.map(li => li.component).join(', ')), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1084,\n          columnNumber: 17\n        }\n      }, tg.lineItems.map(li => li.type).join(', ')), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1085,\n          columnNumber: 17\n        }\n      }, tg.lineItems.map(li => li.percentOrAmt).join(', '))))))));\n    };\n\n    this.addBreakdownFromLineItems = () => {\n      const {\n        formData,\n        breakdownItems\n      } = this.state;\n      const existing = new Set((breakdownItems || []).map(b => b.productId));\n      const toAdd = (formData.lineItems || []).filter(li => li.itemCode && !existing.has(li.itemCode)).map((li, i) => ({\n        sno: ((breakdownItems === null || breakdownItems === void 0 ? void 0 : breakdownItems.length) || 0) + i + 1,\n        productId: li.itemCode,\n        desc: li.itemDescription || '',\n        subProducts: []\n      }));\n\n      if (toAdd.length) {\n        this.setState({\n          breakdownItems: [...(breakdownItems || []), ...toAdd]\n        }, this.saveBreakdownToSession);\n      }\n    };\n\n    this.renderBreakdownTab = () => {\n      const {\n        breakdownItems,\n        breakdownType,\n        formData\n      } = this.state; // map item totals from lineItems (main product totals)\n\n      const itemTotals = (formData.lineItems || []).reduce((acc, li) => {\n        acc[li.itemCode] = parseFloat(li.total || 0) || 0;\n        return acc;\n      }, {});\n      const sumOfItemTotals = Object.values(itemTotals).reduce((s, v) => s + v, 0); // compute subproducts sum\n\n      const getSubProductsSum = bi => {\n        const mainTotal = itemTotals[bi.productId] || 0;\n        const subs = Array.isArray(bi.subProducts) ? bi.subProducts : [];\n        return subs.reduce((s, sp) => {\n          const val = parseFloat(sp.value || 0) || 0;\n          return s + (breakdownType === \"Percentage\" ? mainTotal * val / 100 : val);\n        }, 0);\n      };\n\n      const canSave = this.isBreakdownValid();\n      const isConverted = (formData === null || formData === void 0 ? void 0 : formData.status) === \" CO Created\"; // 🔑 single flag\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1137,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"h5\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1138,\n          columnNumber: 7\n        }\n      }, \"Milestone Breakdown\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1140,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1141,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1141,\n          columnNumber: 30\n        }\n      }, \"Quote Value:\"), \" \", formData.quoteValue), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1142,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1142,\n          columnNumber: 30\n        }\n      }, \"After Discount Quote Value:\"), \" \", formData.afterDiscountValue), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1143,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1143,\n          columnNumber: 30\n        }\n      }, \"Tax Amount:\"), \" \", formData.taxAmount), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1144,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1144,\n          columnNumber: 30\n        }\n      }, \"Sum of Item Totals:\"), \" \", sumOfItemTotals.toFixed(2))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1148,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1149,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1150,\n          columnNumber: 11\n        }\n      }, \"Subproduct Mode\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control form-control-sm\",\n        value: breakdownType,\n        onChange: e => this.handleBreakdownTypeChange(e.target.value),\n        disabled: isConverted // disable if converted\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1151,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Amount\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1157,\n          columnNumber: 13\n        }\n      }, \"Amount\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Percentage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1158,\n          columnNumber: 13\n        }\n      }, \"Percentage\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-9 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1161,\n          columnNumber: 9\n        }\n      }, !isConverted && /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-primary btn-sm\",\n        onClick: this.addBreakdownFromLineItems,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1163,\n          columnNumber: 13\n        }\n      }, \"+ Add Breakdown\"))), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1175,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1176,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1177,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1178,\n          columnNumber: 13\n        }\n      }, \"S.No\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1179,\n          columnNumber: 13\n        }\n      }, \"ID\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1180,\n          columnNumber: 13\n        }\n      }, \"Desc / Subproduct name\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1181,\n          columnNumber: 13\n        }\n      }, \"SubProduct value (\", breakdownType === \"Percentage\" ? \"%\" : \"₹\", \")\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1182,\n          columnNumber: 13\n        }\n      }, \"Total (\\u20B9)\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1183,\n          columnNumber: 13\n        }\n      }, \"Due Date\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1184,\n          columnNumber: 13\n        }\n      }, \"Action\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1187,\n          columnNumber: 9\n        }\n      }, breakdownItems.map((item, idx) => {\n        const mainItemTotal = itemTotals[item.productId] || 0;\n        const subSum = getSubProductsSum(item);\n        const remaining = mainItemTotal - subSum;\n        const subs = Array.isArray(item.subProducts) ? item.subProducts : [];\n        return /*#__PURE__*/React.createElement(React.Fragment, {\n          key: idx,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1195,\n            columnNumber: 15\n          }\n        }, /*#__PURE__*/React.createElement(\"tr\", {\n          style: {\n            background: \"#eef4ff\"\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1197,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1198,\n            columnNumber: 19\n          }\n        }, item.sno), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1199,\n            columnNumber: 19\n          }\n        }, item.productId), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1200,\n            columnNumber: 19\n          }\n        }, item.desc), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1201,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1202,\n            columnNumber: 21\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1203,\n            columnNumber: 23\n          }\n        }, /*#__PURE__*/React.createElement(\"small\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1203,\n            columnNumber: 28\n          }\n        }, \"Subproducts sum: \", /*#__PURE__*/React.createElement(\"b\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1203,\n            columnNumber: 52\n          }\n        }, subSum.toFixed(2)))), /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1204,\n            columnNumber: 23\n          }\n        }, /*#__PURE__*/React.createElement(\"small\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1205,\n            columnNumber: 25\n          }\n        }, \"Remaining:\", \" \", /*#__PURE__*/React.createElement(\"b\", {\n          style: {\n            color: remaining > 0.01 ? \"red\" : \"green\"\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1207,\n            columnNumber: 27\n          }\n        }, remaining.toFixed(2)))))), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1214,\n            columnNumber: 19\n          }\n        }, mainItemTotal.toFixed(2)), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1215,\n            columnNumber: 19\n          }\n        }), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1216,\n            columnNumber: 19\n          }\n        }, !isConverted && /*#__PURE__*/React.createElement(\"div\", {\n          className: \"d-flex\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1218,\n            columnNumber: 23\n          }\n        }, /*#__PURE__*/React.createElement(\"button\", {\n          type: \"button\",\n          className: \"btn btn-sm btn-outline-primary mr-2\",\n          onClick: () => this.handleAddInlineSubProduct(idx),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1219,\n            columnNumber: 25\n          }\n        }, \"+ Add\"), /*#__PURE__*/React.createElement(\"button\", {\n          type: \"button\",\n          className: \"btn btn-sm btn-outline-secondary\",\n          onClick: () => {\n            if (remaining <= 0) return;\n            this.handleAddInlineSubProduct(idx, {\n              name: \"New Product\",\n              value: breakdownType === \"Percentage\" ? (remaining * 100 / (mainItemTotal || 1)).toFixed(2) : remaining.toFixed(2)\n            });\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1224,\n            columnNumber: 25\n          }\n        }, \"Auto-fill\")))), subs.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n          key: `notice-${idx}`,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1244,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"td\", {\n          colSpan: \"6\",\n          className: \"text-center text-muted\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1245,\n            columnNumber: 21\n          }\n        }, \"No subproducts added for this item.\")), subs.map((sp, spIdx) => {\n          const spId = `${item.productId}_${spIdx + 1}`;\n          const rawVal = parseFloat(sp.value || 0) || 0;\n          const spTotal = breakdownType === \"Percentage\" ? mainItemTotal * rawVal / 100 : rawVal;\n          return /*#__PURE__*/React.createElement(\"tr\", {\n            key: spId,\n            style: {\n              background: \"#f9f9f9\"\n            },\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1259,\n              columnNumber: 21\n            }\n          }, /*#__PURE__*/React.createElement(\"td\", {\n            className: \"text-muted\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1260,\n              columnNumber: 23\n            }\n          }, \"\\u2014\"), /*#__PURE__*/React.createElement(\"td\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1261,\n              columnNumber: 23\n            }\n          }, spId), /*#__PURE__*/React.createElement(\"td\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1262,\n              columnNumber: 23\n            }\n          }, /*#__PURE__*/React.createElement(\"input\", {\n            type: \"text\",\n            className: \"form-control form-control-sm\",\n            value: sp.name || \"\",\n            onChange: e => this.handleSubProductChange(idx, spIdx, \"name\", e.target.value),\n            placeholder: \"Enter name\",\n            disabled: isConverted,\n            style: {\n              paddingLeft: \"18px\"\n            },\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1263,\n              columnNumber: 25\n            }\n          })), /*#__PURE__*/React.createElement(\"td\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1273,\n              columnNumber: 23\n            }\n          }, /*#__PURE__*/React.createElement(\"input\", {\n            type: \"number\",\n            step: \"any\",\n            className: \"form-control form-control-sm\",\n            value: sp.value || \"\",\n            onChange: e => this.handleSubProductChange(idx, spIdx, \"value\", e.target.value),\n            disabled: isConverted,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1274,\n              columnNumber: 25\n            }\n          })), /*#__PURE__*/React.createElement(\"td\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1283,\n              columnNumber: 23\n            }\n          }, spTotal.toFixed(2)), /*#__PURE__*/React.createElement(\"td\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1284,\n              columnNumber: 23\n            }\n          }, /*#__PURE__*/React.createElement(\"input\", {\n            type: \"date\",\n            className: \"form-control form-control-sm\",\n            value: sp.dueDate || \"\",\n            onChange: e => this.handleSubProductChange(idx, spIdx, \"dueDate\", e.target.value),\n            disabled: isConverted,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1285,\n              columnNumber: 23\n            }\n          })), /*#__PURE__*/React.createElement(\"td\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1296,\n              columnNumber: 23\n            }\n          }, !isConverted && /*#__PURE__*/React.createElement(\"button\", {\n            type: \"button\",\n            className: \"btn btn-sm btn-danger\",\n            onClick: () => this.handleRemoveSubProduct(idx, spIdx),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 1298,\n              columnNumber: 27\n            }\n          }, \"-\")));\n        }));\n      }))), !canSave && !isConverted && /*#__PURE__*/React.createElement(\"div\", {\n        className: \"alert alert-danger\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1315,\n          columnNumber: 9\n        }\n      }, \"Breakdown incomplete \\u2014 for each product the sum of subproduct totals must equal the product total. Save disabled until fixed.\"));\n    };\n\n    this.renderSubProductDialog = () => {\n      const {\n        showSubProductDialog,\n        subProductForm\n      } = this.state;\n      if (!showSubProductDialog) return null;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        onClick: e => e.stopPropagation(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1329,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        style: {\n          width: 400\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1330,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1331,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1332,\n          columnNumber: 11\n        }\n      }, \"Name\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: subProductForm.name,\n        onChange: e => this.setState({\n          subProductForm: { ...subProductForm,\n            name: e.target.value\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1333,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1335,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1336,\n          columnNumber: 11\n        }\n      }, \"Type\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control\",\n        value: subProductForm.type,\n        onChange: e => this.setState({\n          subProductForm: { ...subProductForm,\n            type: e.target.value\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1337,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Amount\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1338,\n          columnNumber: 13\n        }\n      }, \"Amount\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Percentage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1339,\n          columnNumber: 13\n        }\n      }, \"Percentage\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1342,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1343,\n          columnNumber: 11\n        }\n      }, subProductForm.type), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"number\",\n        value: subProductForm.value,\n        onChange: e => this.setState({\n          subProductForm: { ...subProductForm,\n            value: e.target.value\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1344,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1346,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1347,\n          columnNumber: 11\n        }\n      }, \"Due Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"date\",\n        value: subProductForm.dueDate,\n        onChange: e => this.setState({\n          subProductForm: { ...subProductForm,\n            dueDate: e.target.value\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1348,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1350,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary mr-2\",\n        onClick: () => this.setState({\n          showSubProductDialog: false\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1351,\n          columnNumber: 11\n        }\n      }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-primary\",\n        onClick: e => {\n          e.preventDefault(); //  this prevents the form submission\n\n          this.handleAddSubProduct();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1353,\n          columnNumber: 11\n        }\n      }, \"Add\"))));\n    };\n\n    this.handleAddInlineSubProduct = (breakdownIdx, initial = null) => {\n      this.setState(prev => {\n        const items = [...prev.breakdownItems];\n        const item = { ...items[breakdownIdx]\n        };\n        const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\n        const defaultSP = {\n          name: '',\n          value: '',\n          dueDate: ''\n        };\n        subProducts.push(initial ? { ...defaultSP,\n          ...initial\n        } : defaultSP);\n        item.subProducts = subProducts;\n        items[breakdownIdx] = item;\n        return {\n          breakdownItems: items\n        };\n      }, this.saveBreakdownToSession);\n    };\n\n    this.handleRemoveSubProduct = (biIdx, spIdx) => {\n      this.setState(prev => {\n        const items = [...prev.breakdownItems];\n        const item = { ...items[biIdx]\n        };\n        const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\n        subProducts.splice(spIdx, 1);\n        item.subProducts = subProducts;\n        items[biIdx] = item;\n        return {\n          breakdownItems: items\n        };\n      }, this.saveBreakdownToSession);\n    };\n\n    this.handleSubProductChange = (biIdx, spIdx, field, value) => {\n      this.setState(prev => {\n        const items = [...prev.breakdownItems];\n        const item = { ...items[biIdx]\n        };\n        const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\n        const sp = { ...subProducts[spIdx],\n          [field]: value\n        };\n        subProducts[spIdx] = sp;\n        item.subProducts = subProducts;\n        items[biIdx] = item;\n        return {\n          breakdownItems: items\n        };\n      }, this.saveBreakdownToSession);\n    };\n\n    this.getSubProductsSum = bi => {\n      const {\n        breakdownType,\n        formData\n      } = this.state;\n      const itemTotals = (formData.lineItems || []).reduce((acc, li) => {\n        acc[li.itemCode] = parseFloat(li.total || 0) || 0;\n        return acc;\n      }, {});\n      const mainTotal = itemTotals[bi.productId] || 0;\n      const subs = Array.isArray(bi.subProducts) ? bi.subProducts : [];\n      return subs.reduce((s, sp) => {\n        const val = parseFloat(sp.value || 0) || 0;\n\n        if (breakdownType === 'Percentage') {\n          return s + mainTotal * val / 100;\n        }\n\n        return s + val;\n      }, 0);\n    };\n\n    this.isBreakdownValid = () => {\n      const {\n        breakdownItems,\n        formData\n      } = this.state;\n      const itemTotals = (formData.lineItems || []).reduce((acc, li) => {\n        acc[li.itemCode] = parseFloat(li.total || 0) || 0;\n        return acc;\n      }, {});\n      const TOL = 0.01;\n\n      for (let bi of breakdownItems) {\n        const mainTotal = itemTotals[bi.productId] || 0; // require at least one subproduct for products with non-zero mainTotal\n\n        if (mainTotal > 0) {\n          const subSum = this.getSubProductsSum(bi);\n          if (Math.abs(subSum - mainTotal) > TOL) return false;\n        }\n      }\n\n      return true;\n    };\n\n    this.handleAddSubProduct = () => {\n      const {\n        currentBreakdownIdx,\n        subProductForm,\n        breakdownItems\n      } = this.state;\n      if (!subProductForm.name || !subProductForm.value) return; // Clone breakdownItems and subProducts for immutability\n\n      const items = breakdownItems.map((item, idx) => {\n        if (idx === currentBreakdownIdx) {\n          const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\n          subProducts.push({ ...subProductForm\n          });\n          return { ...item,\n            subProducts\n          };\n        }\n\n        return item;\n      });\n      this.setState({\n        breakdownItems: items,\n        showSubProductDialog: false,\n        subProductForm: {\n          name: '',\n          value: '',\n          type: 'Amount',\n          dueDate: ''\n        }\n      }, this.saveBreakdownToSession);\n    };\n\n    this.renderQuoteTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-4 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1458,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1459,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-between align-items-center mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1460,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"card-title mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1461,\n        columnNumber: 3\n      }\n    }, \"Quotes\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex align-items-center\",\n      style: {\n        gap: '10px',\n        width: '40%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1463,\n        columnNumber: 3\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      className: \"form-control\",\n      placeholder: \"Search by Bill No, Customer, Status, Date...\",\n      value: this.state.searchTerm,\n      onChange: e => this.setState({\n        searchTerm: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1464,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn btn-primary\",\n      onClick: () => this.setState({\n        showForm: true\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1471,\n        columnNumber: 5\n      }\n    }, \"Create\"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1480,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1481,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1482,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      style: {\n        fontSize: '14px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1483,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1484,\n        columnNumber: 17\n      }\n    }, \"Quote No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1485,\n        columnNumber: 17\n      }\n    }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1486,\n        columnNumber: 17\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1487,\n        columnNumber: 17\n      }\n    }, \"Quote Value\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1488,\n        columnNumber: 17\n      }\n    }, \"After Discount\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1489,\n        columnNumber: 17\n      }\n    }, \"Status\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1490,\n        columnNumber: 17\n      }\n    }, \"Print\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1493,\n        columnNumber: 13\n      }\n    }, this.state.quotes.filter(q => {\n      var _q$quoteValue, _q$afterDiscountValue;\n\n      const term = this.state.searchTerm.toLowerCase();\n      if (!term) return true;\n      return (q.quoteNo || '').toLowerCase().includes(term) || (q.customer || '').toLowerCase().includes(term) || (q.status || '').toLowerCase().includes(term) || (q.quoteDate || '').toLowerCase().includes(term) || (((_q$quoteValue = q.quoteValue) === null || _q$quoteValue === void 0 ? void 0 : _q$quoteValue.toString()) || '').toLowerCase().includes(term) || (((_q$afterDiscountValue = q.afterDiscountValue) === null || _q$afterDiscountValue === void 0 ? void 0 : _q$afterDiscountValue.toString()) || '').toLowerCase().includes(term);\n    }).map((q, i) => {\n      let statusClass = \"badge-info\";\n      if (q.status === \"Awaiting for Approval\") statusClass = \"badge-warning\";else if (q.status === \"CO created\") statusClass = \"badge-secondary\";else if (q.status === \"Cancelled\") statusClass = \"badge-danger\";else if (q.status === \"Approved\") statusClass = \"badge-success\";\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1514,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1515,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-link p-0\",\n        onClick: () => this.loadQuotePreview(q),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1516,\n          columnNumber: 23\n        }\n      }, q.quoteNo)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1523,\n          columnNumber: 21\n        }\n      }, q.customer), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1524,\n          columnNumber: 21\n        }\n      }, q.quoteDate), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1525,\n          columnNumber: 21\n        }\n      }, q.quoteValue), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1526,\n          columnNumber: 21\n        }\n      }, q.afterDiscountValue), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1527,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${statusClass}`,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1528,\n          columnNumber: 23\n        }\n      }, q.status)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1532,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-printer menu-icon\",\n        onClick: () => this.showQuotePDFWithOrg(q),\n        style: {\n          fontSize: '24px',\n          color: '#2196F3',\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1533,\n          columnNumber: 23\n        }\n      })));\n    }), this.state.quotes.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1543,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      colSpan: \"6\",\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1543,\n        columnNumber: 21\n      }\n    }, \"No quotes found.\")))))));\n\n    this.renderQuoteForm = () => {\n      const {\n        formData,\n        overlayType,\n        productOverlayVisible,\n        recalculateQuoteTotals,\n        showTaxOverlay,\n        taxGroups\n      } = this.state;\n      const isFOB = formData.impExp === 'FOB';\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1556,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card full-height\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1557,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          flex: 1,\n          overflowY: 'auto',\n          padding: '24px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1558,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1559,\n          columnNumber: 13\n        }\n      }, \"Quote Form\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"nav nav-tabs\",\n        role: \"tablist\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1560,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"li\", {\n        className: \"nav-item\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1561,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: `nav-link ${this.state.activeTab === 'co' ? 'active' : ''}`,\n        onClick: () => this.setState({\n          activeTab: 'co'\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1562,\n          columnNumber: 17\n        }\n      }, \"CO Details\")), /*#__PURE__*/React.createElement(\"li\", {\n        className: \"nav-item\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1564,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: `nav-link ${this.state.activeTab === 'breakdown' ? 'active' : ''}`,\n        onClick: () => this.setState({\n          activeTab: 'breakdown'\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1565,\n          columnNumber: 15\n        }\n      }, \"Breakdown\")), /*#__PURE__*/React.createElement(\"li\", {\n        className: \"nav-item\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1567,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: `nav-link ${this.state.activeTab === 'commercial' ? 'active' : ''}`,\n        onClick: () => this.setState({\n          activeTab: 'commercial'\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1568,\n          columnNumber: 17\n        }\n      }, \"Commercial Terms\"))), /*#__PURE__*/React.createElement(\"form\", {\n        className: \"form-sample\",\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1571,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"tab-content pt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1572,\n          columnNumber: 15\n        }\n      }, this.state.activeTab === 'co' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1575,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1576,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1577,\n          columnNumber: 25\n        }\n      }, \"Quote Type\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control form-control-sm\",\n        value: formData.quoteType,\n        onChange: e => this.handleInputChange('quoteType', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1578,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1579,\n          columnNumber: 27\n        }\n      }, \"Standard\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1580,\n          columnNumber: 27\n        }\n      }, \"Manual\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1583,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1584,\n          columnNumber: 23\n        }\n      }, \"Quote No\"), formData.quoteType === \"Standard\" ? /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.quoteNo,\n        readOnly: true,\n        placeholder: \"Auto\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1586,\n          columnNumber: 25\n        }\n      }) : /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.quoteNo,\n        onChange: e => this.handleInputChange('quoteNo', e.target.value),\n        placeholder: \"Enter Quote No\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1594,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1603,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1604,\n          columnNumber: 25\n        }\n      }, \"Quote Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control form-control-sm\",\n        value: formData.quoteDate,\n        onChange: e => this.handleInputChange('quoteDate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1605,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1608,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1609,\n          columnNumber: 25\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.status,\n        style: {\n          backgroundColor: '#fff'\n        },\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1610,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1613,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1614,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1615,\n          columnNumber: 25\n        }\n      }, \"Customer\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group input-group-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1616,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        placeholder: \"Choose Customer\",\n        ref: this.customerInputRef,\n        value: formData.customer,\n        readOnly: true,\n        onClick: () => this.showOverlay('customer'),\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1617,\n          columnNumber: 27\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-append\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1627,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-outline-secondary btn-sm\",\n        type: \"button\",\n        onClick: () => this.showOverlay('customer'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1628,\n          columnNumber: 29\n        }\n      }, \"Select\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1632,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1633,\n          columnNumber: 25\n        }\n      }, \"IMP/EXP\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control form-control-sm\",\n        value: formData.impExp,\n        onChange: e => this.handleInputChange('impExp', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1634,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1639,\n          columnNumber: 27\n        }\n      }, \"None\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1640,\n          columnNumber: 27\n        }\n      }, \"COB\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1641,\n          columnNumber: 27\n        }\n      }, \"FOB\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1642,\n          columnNumber: 27\n        }\n      }, \"CIF\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1645,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1646,\n          columnNumber: 25\n        }\n      }, \"Ref No.\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.qrefNo,\n        onChange: e => this.handleInputChange('qrefNo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1647,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1654,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1655,\n          columnNumber: 25\n        }\n      }, \"Choose\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex align-items-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1656,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-check mr-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1657,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"radio\",\n        className: \"form-check-input\",\n        name: \"choose\",\n        id: \"chooseService\",\n        value: \"Service\",\n        checked: formData.choose === 'Service',\n        onChange: e => this.handleChooseChange(e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1658,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(\"label\", {\n        className: \"form-check-label\",\n        htmlFor: \"chooseService\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1662,\n          columnNumber: 29\n        }\n      }, \"Service\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-check mr-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1664,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"radio\",\n        className: \"form-check-input\",\n        name: \"choose\",\n        id: \"chooseProduct\",\n        value: \"Product\",\n        checked: formData.choose === 'Product',\n        onChange: e => this.handleChooseChange(e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1665,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(\"label\", {\n        className: \"form-check-label\",\n        htmlFor: \"chooseProduct\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1669,\n          columnNumber: 29\n        }\n      }, \"Product\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-check\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1671,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"radio\",\n        className: \"form-check-input\",\n        name: \"choose\",\n        id: \"chooseBundle\",\n        value: \"Bundle\",\n        checked: formData.choose === 'Bundle',\n        onChange: e => this.handleChooseChange(e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1672,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(\"label\", {\n        className: \"form-check-label\",\n        htmlFor: \"chooseBundle\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1676,\n          columnNumber: 29\n        }\n      }, \"Service+Product\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1681,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1682,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1683,\n          columnNumber: 25\n        }\n      }, \"Currency\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.currency,\n        style: {\n          backgroundColor: '#fff'\n        },\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1684,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1692,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1693,\n          columnNumber: 25\n        }\n      }, \"Conversion Rate\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.conversionRate,\n        onChange: e => this.handleInputChange('conversionRate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1694,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1701,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1702,\n          columnNumber: 25\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.taxAmount,\n        onChange: e => this.handleInputChange('taxAmount', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1703,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1711,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1712,\n          columnNumber: 25\n        }\n      }, \"Quote Value\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.quoteValue,\n        onChange: e => this.handleInputChange('quoteValue', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1713,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1722,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1723,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1724,\n          columnNumber: 23\n        }\n      }, \"Discount %\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: formData.discountPercent,\n        onChange: e => {\n          this.handleDiscountChange('discountPercent', e.target.value);\n          this.recalculateQuoteTotals();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1725,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1735,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1736,\n          columnNumber: 21\n        }\n      }, \"Discount Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: this.state.formData.discountAmount,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1737,\n          columnNumber: 21\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1744,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1745,\n          columnNumber: 21\n        }\n      }, \"After Discount - Quote Value\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: formData.discountPercent > 0 ? formData.afterDiscountValue : \"\",\n        readOnly: true,\n        placeholder: formData.discountPercent > 0 ? \"\" : \"Enter Discount %\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1746,\n          columnNumber: 21\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1755,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1756,\n          columnNumber: 29\n        }\n      }, \"Line Item\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-primary btn-sm\",\n        onClick: () => this.setState({\n          productOverlayVisible: true\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1757,\n          columnNumber: 29\n        }\n      }, \"+ Add Product\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"table-responsive\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1761,\n          columnNumber: 24\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1762,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1763,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1764,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1765,\n          columnNumber: 15\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1766,\n          columnNumber: 15\n        }\n      }, \"Item Desc\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1767,\n          columnNumber: 15\n        }\n      }, \"Cust Part No\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1768,\n          columnNumber: 15\n        }\n      }, \"HSN No\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1769,\n          columnNumber: 15\n        }\n      }, \"UOM\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1770,\n          columnNumber: 15\n        }\n      }, \"On Hand\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1771,\n          columnNumber: 15\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1772,\n          columnNumber: 15\n        }\n      }, \"Quantity\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1773,\n          columnNumber: 15\n        }\n      }, \"Tax Id\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1774,\n          columnNumber: 15\n        }\n      }, \"Item Total\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1775,\n          columnNumber: 14\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1776,\n          columnNumber: 15\n        }\n      }, \"Grand Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1779,\n          columnNumber: 11\n        }\n      }, formData.lineItems.map((item, idx) => {\n        const itemTotal = item.unitPrice * item.qty;\n        const taxDetails = getTaxDetailsFromGroup(item.taxGroupName, this.state.taxGroups);\n        const taxAmt = itemTotal * taxDetails.totalPercent / 100 + itemTotal * taxDetails.totalAmount;\n        const totalWithTax = itemTotal + taxAmt;\n        return /*#__PURE__*/React.createElement(\"tr\", {\n          key: item.id || idx,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1788,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1789,\n            columnNumber: 19\n          }\n        }, item.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1790,\n            columnNumber: 19\n          }\n        }, item.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1791,\n            columnNumber: 19\n          }\n        }, item.custPartNo), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1792,\n            columnNumber: 19\n          }\n        }, item.hsnCode), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1793,\n            columnNumber: 19\n          }\n        }, item.uom), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1794,\n            columnNumber: 19\n          }\n        }, item.onHand), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1795,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"input\", {\n          type: \"number\",\n          value: item.unitPrice,\n          onChange: e => this.handleLineItemChange(idx, 'unitPrice', e.target.value),\n          style: {\n            width: 80\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1796,\n            columnNumber: 21\n          }\n        })), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1803,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"input\", {\n          type: \"number\",\n          min: \"1\",\n          value: item.qty,\n          onChange: e => this.handleLineItemChange(idx, 'qty', e.target.value),\n          style: {\n            width: 60\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1804,\n            columnNumber: 21\n          }\n        })), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1812,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"button\", {\n          type: \"button\",\n          className: \"btn btn-outline-secondary btn-sm btn-rounded btn-icon\",\n          style: {\n            padding: '2px 6px',\n            fontSize: '12px',\n            lineHeight: '1'\n          },\n          onClick: () => this.setState({\n            showTaxOverlay: true,\n            currentTaxLineIdx: idx\n          }),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1813,\n            columnNumber: 19\n          }\n        }, \"+\"), /*#__PURE__*/React.createElement(\"div\", {\n          style: {\n            fontSize: '13px',\n            marginTop: '4px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1821,\n            columnNumber: 19\n          }\n        }, (item.taxGroupNames || []).join(', ') || '-')), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1825,\n            columnNumber: 17\n          }\n        }, parseFloat(item.baseTotal || 0).toFixed(2)), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1826,\n            columnNumber: 13\n          }\n        }, parseFloat(item.taxAmt || 0).toFixed(2)), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 1827,\n            columnNumber: 15\n          }\n        }, parseFloat(item.itemTotal || 0).toFixed(2)));\n      }))))), this.state.activeTab === 'commercial' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1839,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1840,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1841,\n          columnNumber: 25\n        }\n      }, \"Bill To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control form-control-sm\",\n        rows: \"3\",\n        value: formData.billTo,\n        onChange: e => this.handleInputChange('billTo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1842,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1849,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1850,\n          columnNumber: 25\n        }\n      }, \"Ship To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control form-control-sm\",\n        rows: \"3\",\n        value: formData.shipTo,\n        onChange: e => this.handleInputChange('shipTo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1851,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1859,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1860,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1861,\n          columnNumber: 3\n        }\n      }, \"Despatch Mode\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group input-group-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1862,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: formData.despatchMode,\n        readOnly: true,\n        onClick: () => !isFOB && this.showOverlay('despatchMode'),\n        style: {\n          cursor: isFOB ? 'not-allowed' : 'pointer',\n          backgroundColor: '#fff'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1863,\n          columnNumber: 5\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-append\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1871,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-outline-secondary btn-sm\",\n        type: \"button\",\n        disabled: isFOB,\n        onClick: () => this.showOverlay('despatchMode'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1872,\n          columnNumber: 7\n        }\n      }, \"Select\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1884,\n          columnNumber: 1\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1885,\n          columnNumber: 3\n        }\n      }, \"Payment Terms\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group input-group-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1886,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: formData.paymentTerms,\n        readOnly: true,\n        onClick: () => !isFOB && this.showOverlay('paymentTerms'),\n        style: {\n          cursor: isFOB ? 'not-allowed' : 'pointer',\n          backgroundColor: '#fff'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1887,\n          columnNumber: 5\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-append\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1895,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-outline-secondary btn-sm\",\n        type: \"button\",\n        disabled: isFOB,\n        onClick: () => this.showOverlay('paymentTerms'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1896,\n          columnNumber: 7\n        }\n      }, \"Select\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1908,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1909,\n          columnNumber: 25\n        }\n      }, \"Freight Charges\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.freightCharges,\n        onChange: e => this.handleInputChange('freightCharges', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1910,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1919,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1920,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1921,\n          columnNumber: 25\n        }\n      }, \"Tax %\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.taxPercent,\n        onChange: e => this.handleInputChange('taxPercent', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1922,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1930,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1931,\n          columnNumber: 25\n        }\n      }, \"Freight Tax Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.freighttaxAmount,\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1932,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1939,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1940,\n          columnNumber: 25\n        }\n      }, \"Packing Charges\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.packingCharges,\n        onChange: e => this.handleInputChange('packingCharges', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1941,\n          columnNumber: 25\n        }\n      })))), this.state.activeTab === 'breakdown' && this.renderBreakdownTab()), this.renderSubProductDialog(), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"fixed-card-footer text-right p-3 border-top bg-white\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1956,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary mr-2\",\n        onClick: () => this.setState({\n          showForm: false,\n          editingId: null\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1957,\n          columnNumber: 17\n        }\n      }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-success mr-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1964,\n          columnNumber: 17\n        }\n      }, \"Save All Details\"))), overlayType && this.renderOverlay(), productOverlayVisible && this.renderProductOverlay(), this.state.showTaxOverlay && this.renderTaxOverlay())));\n    };\n\n    this.renderQuotePreview = () => {\n      var _q$lineItems, _q$lineItems2;\n\n      const q = this.state.selectedQuote;\n      const {\n        isApprovalMode\n      } = this.props;\n      if (!q) return null;\n      const subtotal = ((_q$lineItems = q.lineItems) === null || _q$lineItems === void 0 ? void 0 : _q$lineItems.reduce((sum, item) => sum + (parseFloat(item.total) || 0), 0)) || 0;\n      const freightCharges = parseFloat(q.freightCharges || 0);\n      const taxAmount = parseFloat(q.taxAmount || 0);\n      const grandTotal = parseFloat(q.quoteValue || subtotal + freightCharges + taxAmount);\n      const amountWords = `INR ${window.toWords ? window.toWords(Math.floor(grandTotal)) : grandTotal} Only`;\n      const customer = this.state.customers.find(c => c.custshortName === q.customer || c.custname === q.customer) || {};\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 p-4 shadow-sm full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2001,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2003,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title mb-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2004,\n          columnNumber: 9\n        }\n      }, \"Quote Preview - \", q.quoteNo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"flex items-center gap-x-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2005,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-sm btn-primary\",\n        onClick: () => this.loadQuoteForEdit(q),\n        disabled: q.status === \"Approved\" || q.status === \"CO Created\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2006,\n          columnNumber: 11\n        }\n      }, \"Edit\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-sm btn-outline-secondary\",\n        onClick: () => this.convertToOrder(q),\n        disabled: q.status !== \"Approved\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2013,\n          columnNumber: 11\n        }\n      }, \"Convert to Order\"), /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-printer menu-icon ml-3\",\n        onClick: () => this.showQuotePDFWithOrg(q),\n        style: {\n          marginBlockStart: '10px',\n          gap: '10px',\n          fontSize: '27px',\n          color: '#2196F3',\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2020,\n          columnNumber: 15\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2029,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2030,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2030,\n          columnNumber: 35\n        }\n      }, \"Customer:\"), \" \", q.customer), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2031,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2031,\n          columnNumber: 35\n        }\n      }, \"Date:\"), \" \", q.quoteDate), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2032,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2032,\n          columnNumber: 35\n        }\n      }, \"Status:\"), \" \", q.status)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2035,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2036,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2037,\n          columnNumber: 11\n        }\n      }, \"Bill To:\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2037,\n          columnNumber: 26\n        }\n      }), q.billTo || \"-\", /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-2\",\n        style: {\n          fontSize: \"0.9em\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2039,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2040,\n          columnNumber: 13\n        }\n      }, \"GSTIN:\"), \" \", customer.gstin || \"-\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2040,\n          columnNumber: 50\n        }\n      }), /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2041,\n          columnNumber: 13\n        }\n      }, \"Email:\"), \" \", customer.email || \"-\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2041,\n          columnNumber: 50\n        }\n      }), /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2042,\n          columnNumber: 13\n        }\n      }, \"Phone:\"), \" \", customer.phone || \"-\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2045,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2046,\n          columnNumber: 11\n        }\n      }, \"Ship To:\"), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2046,\n          columnNumber: 26\n        }\n      }), q.shipTo || \"-\")), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2052,\n          columnNumber: 7\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2053,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2054,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2055,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2056,\n          columnNumber: 13\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2057,\n          columnNumber: 13\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2058,\n          columnNumber: 13\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2059,\n          columnNumber: 13\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2060,\n          columnNumber: 13\n        }\n      }, \"Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2063,\n          columnNumber: 9\n        }\n      }, (_q$lineItems2 = q.lineItems) === null || _q$lineItems2 === void 0 ? void 0 : _q$lineItems2.map((item, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2065,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2066,\n          columnNumber: 15\n        }\n      }, item.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2067,\n          columnNumber: 15\n        }\n      }, item.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2068,\n          columnNumber: 15\n        }\n      }, item.qty), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2069,\n          columnNumber: 15\n        }\n      }, item.unitPrice), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2070,\n          columnNumber: 15\n        }\n      }, item.total))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2077,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2078,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2078,\n          columnNumber: 12\n        }\n      }, \"Subtotal:\"), \" \", subtotal.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2079,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2079,\n          columnNumber: 12\n        }\n      }, \"Freight Charges:\"), \" \", freightCharges.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2080,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2080,\n          columnNumber: 12\n        }\n      }, \"Tax Amount:\"), \" \", taxAmount.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        className: \"h6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2081,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2081,\n          columnNumber: 27\n        }\n      }, \"Grand Total:\"), \" \", grandTotal.toFixed(2)), /*#__PURE__*/React.createElement(\"p\", {\n        className: \"h6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2082,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2082,\n          columnNumber: 27\n        }\n      }, \"Amount in Words:\"), \" \", amountWords)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-auto pt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2084,\n          columnNumber: 8\n        }\n      }, !isApprovalMode ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: () => this.setState({\n          previewMode: false\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2089,\n          columnNumber: 13\n        }\n      }, \"Back to List\")) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success mr-2\",\n        onClick: () => this.updateStatus(q.id, \"Approved\"),\n        disabled: q.status === \"Approved\" || q.status === \"CO Created\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2098,\n          columnNumber: 13\n        }\n      }, \"Approve\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-danger mr-2\",\n        onClick: () => this.updateStatus(q.id, \"Rejected\"),\n        disabled: q.status === \"Rejected\" || q.status === \"CO Created\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2105,\n          columnNumber: 13\n        }\n      }, \"Reject\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: () => this.setState({\n          previewMode: false\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 2112,\n          columnNumber: 13\n        }\n      }, \"Back to List\"))));\n    };\n  }\n\n  componentDidMount() {\n    bsCustomFileInput.init();\n    this.fetchQuotes();\n    this.fetchCustomers();\n    this.fetchProducts().then(() => this.filterProductsByCategory());\n    this.fetchDespatchModes();\n    this.fetchPaymentTerms();\n    this.fetchTaxGroups();\n  }\n\n  componentDidUpdate(prevProps, prevState) {}\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 2131,\n        columnNumber: 7\n      }\n    }, this.state.previewMode ? this.renderQuotePreview() : this.state.showForm ? this.renderQuoteForm() : this.renderQuoteTable());\n  }\n\n}\n\nexport default withRouter(Quote);","map":{"version":3,"sources":["C:/Users/College/admin/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/quote/Quote.js"],"names":["React","Component","Form","bsCustomFileInput","db","collection","getDocs","addDoc","doc","updateDoc","serverTimestamp","withRouter","html2canvas","jsPDF","recalculateTotals","getTaxDetailsFromGroup","toWords","amount","amountWords","Quote","state","activeTab","quotes","customers","products","despatchModes","paymentTerms","showForm","showTaxOverlay","currentTaxLineIdx","editingId","overlayType","overlaySearch","productOverlayVisible","productOverlaySearch","selectedProductIds","selectedTaxGroups","taxComponents","taxGroups","previewMode","selectedQuote","breakdownItems","breakdownType","breakdownSelectAll","showSubProductDialog","currentBreakdownIdx","searchTerm","subProductForm","name","value","type","dueDate","formData","quoteNo","quoteDate","Date","toISOString","split","quoteType","customer","status","choose","qrefNo","impExp","currency","conversionRate","taxAmount","quoteValue","discountPercent","discountAmount","afterDiscountValue","billTo","shipTo","despatchMode","freightCharges","freighttaxAmount","taxPercent","packingCharges","lineItems","customerInputRef","createRef","handleOverlayClose","setState","recalculateQuoteTotals","forEach","item","parseFloat","itemTotal","taxAmt","discountPercentNum","prev","toFixed","formatAddress","addr","address","city","country","filter","Boolean","join","zip","handleChooseChange","filterProductsByCategory","filteredProducts","p","category","handleDiscountChange","field","handleLineItemChange","idx","updatedItems","percent","taxGroupNames","groupName","group","find","t","Array","isArray","comp","val","percentOrAmt","qty","unitPrice","baseTotal","fetchTaxGroups","snap","data","docs","map","id","fetchQuotes","sort","a","b","dateA","createdAt","toDate","dateB","reverse","fetchCustomers","fetchProducts","fetchDespatchModes","fetchPaymentTerms","toggleTaxGroupSelection","lineIdx","checked","includes","push","g","taxGroupName","updatedLineItems","handleInputChange","newFormData","length","handleBreakdownSelectAll","selected","handleBreakdownRowSelect","items","handleBreakdownTypeChange","handleBreakdownValueChange","updateStatus","alert","handleBreakdownDateChange","lastDate","saveBreakdownToSession","sessionStorage","setItem","JSON","stringify","loadBreakdownFromSession","getItem","parse","handleSubmit","e","preventDefault","isBreakdownValid","payload","loadQuotePreview","q","loadQuoteForEdit","quote","current","convertToOrder","quoteObj","props","history","pathname","openForm","quoteId","showQuotePDFWithOrg","orgSnap","org","c","custshortName","custname","gstStateMap","getPlaceOfSupply","gstin","code","substring","enrichedItems","product","productId","itemCode","ptshortName","hsnCode","uom","stockingUOM","cgst","sgst","igst","s","trim","subtotal","reduce","sum","freightTax","totalTaxAmount","grandTotal","Math","floor","isINR","convert","amt","subtotalConv","freightChargesConv","taxAmountConv","discountAmountConv","grandTotalConv","taxBreakdown","taxGroupDetails","sno","base","tgName","li","key","component","peramt","container","document","createElement","style","width","padding","fontFamily","numCols","innerHTML","gstLabel","taxId","itemDescription","total","Number","toLocaleString","body","appendChild","canvas","scale","useCORS","imgData","toDataURL","pdf","height","addImage","removeChild","addPage","milestoneRows","bi","mainItem","mainItemTotal","desc","subProducts","sp","spIdx","rawVal","spTotal","taxRows","row","combinedHtml","combinedContainer","fontSize","combinedCanvas","combinedImg","setFontSize","text","bgName","blob","output","url","URL","createObjectURL","newWin","window","open","write","close","showOverlay","hideOverlay","selectOverlayValue","currencies","d","cur","custcode","renderOverlay","getFilteredRows","list","nameKey","codeKey","toLowerCase","handleSelect","title","headers","rows","color","cursor","target","maxHeight","overflowY","h","i","j","shortName","renderProductOverlay","currentPage","itemsPerPage","filtered","ptdescription","totalPages","ceil","paginated","slice","selectedProducts","some","itemType","materialType","onHand","taxGroup","custPartNo","flex","max","_","min","renderTaxOverlay","Set","background","tg","has","addBreakdownFromLineItems","existing","toAdd","renderBreakdownTab","itemTotals","acc","sumOfItemTotals","Object","values","v","getSubProductsSum","mainTotal","subs","canSave","isConverted","subSum","remaining","handleAddInlineSubProduct","spId","handleSubProductChange","paddingLeft","handleRemoveSubProduct","renderSubProductDialog","stopPropagation","handleAddSubProduct","breakdownIdx","initial","defaultSP","biIdx","splice","TOL","abs","renderQuoteTable","gap","term","toString","statusClass","renderQuoteForm","isFOB","backgroundColor","taxDetails","totalPercent","totalAmount","totalWithTax","lineHeight","marginTop","renderQuotePreview","isApprovalMode","marginBlockStart","email","phone","componentDidMount","init","then","componentDidUpdate","prevProps","prevState","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Form } from 'react-bootstrap';\r\nimport bsCustomFileInput from 'bs-custom-file-input';\r\nimport { db } from '../../../../firebase';\r\nimport { collection, getDocs, addDoc, doc, updateDoc,serverTimestamp } from 'firebase/firestore';\r\nimport { withRouter } from 'react-router-dom';\r\nimport html2canvas from 'html2canvas';\r\nimport { jsPDF } from 'jspdf';\r\nimport { recalculateTotals,getTaxDetailsFromGroup} from '../calculation';\r\nimport { toWords } from 'number-to-words';\r\nconst amount = 12345678;\r\nconst amountWords = `INR ${toWords(amount)} Only`;\r\n\r\nclass Quote extends Component {\r\n  state = {\r\n    activeTab: 'co',\r\n    quotes: [],\r\n    customers: [],\r\n    products: [],\r\n    despatchModes: [],\r\n    paymentTerms: [],\r\n    showForm: false,\r\n    showTaxOverlay: false,\r\n    currentTaxLineIdx: null,\r\n    editingId: null,\r\n    overlayType: '',\r\n    overlaySearch: '',\r\n    productOverlayVisible: false,\r\n    productOverlaySearch: '',\r\n    selectedProductIds: [],\r\n    selectedTaxGroups: [],\r\n    taxComponents: [],\r\n    taxGroups:[],\r\n    previewMode: false,\r\n    selectedQuote: null,\r\n    breakdownItems: [], \r\n    breakdownType: 'Percentage',\r\n    breakdownSelectAll: false,\r\n    showSubProductDialog: false,\r\n    currentBreakdownIdx: null,\r\n     searchTerm:'',\r\n    subProductForm: { name: '', value: '', type: 'Amount', dueDate: '' },\r\n    formData: {\r\n      quoteNo: '',\r\n      quoteDate: new Date().toISOString().split('T')[0],\r\n      quoteType: 'Standard',\r\n      customer: '',\r\n      status: 'Entered', \r\n      choose: 'Service',\r\n      qrefNo: '',\r\n      impExp: 'None',\r\n      currency: '',\r\n      conversionRate: '',\r\n      taxAmount: '',\r\n      quoteValue: '',\r\n      discountPercent: 0,\r\n      discountAmount: 0,\r\n      afterDiscountValue: 0,\r\n      billTo: '',\r\n      shipTo: '',\r\n      despatchMode: 'By Air',\r\n      paymentTerms: '',\r\n      freightCharges: '',\r\n      freighttaxAmount: '',\r\n      taxPercent: '',\r\n      packingCharges: '',\r\n      lineItems: [],\r\n    }\r\n  };\r\n  customerInputRef = React.createRef();\r\n\r\nhandleOverlayClose = () => {\r\n  this.setState({\r\n    overlayType: '',\r\n    overlaySearch: '',\r\n    productOverlayVisible: false,\r\n    showTaxOverlay: false,\r\n    currentTaxLineIdx: null,\r\n    selectedProductIds: [],\r\n  });\r\n};\r\n  recalculateQuoteTotals = () => {\r\n  const { lineItems, discountPercent } = this.state.formData;\r\n  let quoteValue = 0;\r\n  let taxAmount = 0;\r\n  (lineItems || []).forEach(item => {\r\n    quoteValue += parseFloat(item.itemTotal || 0);\r\n    taxAmount += parseFloat(item.taxAmt || 0);\r\n  });\r\n  const discountPercentNum = parseFloat(discountPercent || 0);\r\n  const discountAmount = (parseFloat(quoteValue) * discountPercentNum) / 100;\r\n  const afterDiscountValue = quoteValue - discountAmount;\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      quoteValue: quoteValue.toFixed(2),\r\n      taxAmount: taxAmount.toFixed(2),\r\n      discountAmount: discountAmount.toFixed(2),\r\n      afterDiscountValue: afterDiscountValue.toFixed(2)\r\n    }\r\n  }));\r\n};\r\n\r\n  formatAddress = (addr) => {\r\n    if (!addr) return '';\r\n    if (typeof addr === 'string') return addr;\r\n    return [\r\n      addr.address,\r\n      [addr.city, addr.state, addr.country].filter(Boolean).join(', '),\r\n      addr.zip\r\n    ].filter(Boolean).join('\\n');\r\n  };\r\nhandleChooseChange = (value) => {\r\n  this.setState(prev => ({\r\n    formData: { ...prev.formData, choose: value }\r\n  }), this.filterProductsByCategory);\r\n};\r\n\r\n// Filtering logic\r\nfilterProductsByCategory = () => {\r\n  const { choose } = this.state.formData;\r\n  let filteredProducts = [];\r\n  if (choose === \"Service\") {\r\n    filteredProducts = this.state.products.filter(p => p.category === \"Service\");\r\n  } else if (choose === \"Product\") {\r\n    filteredProducts = this.state.products.filter(p => p.category === \"Product\");\r\n  } else if (choose === \"Bundle\") {\r\n    filteredProducts = this.state.products; // All products\r\n  }\r\n  this.setState({ filteredProducts });\r\n};\r\n\r\n  componentDidMount() {\r\n    bsCustomFileInput.init();\r\n    this.fetchQuotes();\r\n    this.fetchCustomers();\r\n    this.fetchProducts().then(() => this.filterProductsByCategory());\r\n    this.fetchDespatchModes();\r\n    this.fetchPaymentTerms();\r\n    this.fetchTaxGroups();\r\n  }\r\n handleDiscountChange = (field, value) => {\r\n  let { formData } = this.state;\r\n  formData[field] = value;\r\n\r\n  const quoteValue = parseFloat(formData.quoteValue || 0);\r\n  const discountPercent = parseFloat(formData.discountPercent || 0);\r\n  const discountAmount = (quoteValue * discountPercent) / 100;\r\n  const afterDiscountValue = quoteValue - discountAmount;\r\n\r\n  formData.discountAmount = discountAmount;\r\n  formData.afterDiscountValue = afterDiscountValue;\r\n\r\n  this.setState({ formData });\r\n};\r\n\r\n\r\nhandleLineItemChange = (idx, field, value) => {\r\n  const updatedItems = [...this.state.formData.lineItems];\r\n  updatedItems[idx] = { ...updatedItems[idx], [field]: value };\r\n  if (field === 'qty' || field === 'unitPrice' || field === 'taxAmt') {\r\n    // Calculate taxAmt based on selected tax groups\r\n    let percent = 0;\r\n    let amount = 0;\r\n    (updatedItems[idx].taxGroupNames || []).forEach(groupName => {\r\n      const group = this.state.taxGroups.find(t => t.groupName === groupName);\r\n      if (group && Array.isArray(group.lineItems)) {\r\n        group.lineItems.forEach(comp => {\r\n          const val = parseFloat(comp.percentOrAmt || 0);\r\n          if (comp.type === 'Percentage') percent += val;\r\n          if (comp.type === 'Amount') amount += val;\r\n        });\r\n      }\r\n    });\r\n    const qty = parseFloat(updatedItems[idx].qty || 0);\r\n    const unitPrice = parseFloat(updatedItems[idx].unitPrice || 0);\r\n    const baseTotal = qty * unitPrice;\r\n    const taxAmt = ((baseTotal * percent) / 100 + amount);\r\n    updatedItems[idx].baseTotal=baseTotal.toFixed(2);\r\n    updatedItems[idx].taxAmt = taxAmt.toFixed(2);\r\n    updatedItems[idx].itemTotal = (baseTotal + taxAmt).toFixed(2);\r\n  }\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      lineItems: updatedItems\r\n    }\r\n  }), this.recalculateQuoteTotals);\r\n};\r\n\r\n\r\n\r\ncomponentDidUpdate(prevProps, prevState) {\r\n \r\n}\r\n\r\nfetchTaxGroups = async () => {\r\n  const snap = await getDocs(collection(db, 'taxGroups'));\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ taxGroups: data });\r\n};\r\n\r\n\r\n  fetchQuotes = async () => {\r\n    const snap = await getDocs(collection(db, 'quotes'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    data.sort((a,b)=>{\r\n      const dateA=new Date(a.quoteDate || a.createdAt?.toDate?.() || a.createdAt || 0);\r\n      const dateB=new Date(b.quoteDate || b.createdAt?.toDate?.() || b.createdAt || 0);\r\n      return dateA - dateB;\r\n    });\r\n    this.setState({ quotes: data.reverse() });\r\n  };\r\n\r\n  fetchCustomers = async () => {\r\n    const snap = await getDocs(collection(db, 'customers'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ customers: data });\r\n  };\r\n\r\n  fetchProducts = async () => {\r\n  const snap = await getDocs(collection(db, 'products'));\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ products: data, filteredProducts: data }, this.filterProductsByCategory);\r\n};\r\n  fetchDespatchModes = async () => {\r\n  const snap = await getDocs(collection(db, 'modes'));\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ despatchModes: data });\r\n};\r\n\r\nfetchPaymentTerms = async () => {\r\n  const snap = await getDocs(collection(db, 'paymentTerms'));\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ paymentTerms: data });\r\n};\r\ntoggleTaxGroupSelection = (groupName, lineIdx, checked) => {\r\n  this.setState(prev => {\r\n    const lineItems = [...prev.formData.lineItems];\r\n    const item = { ...lineItems[lineIdx] };\r\n    let taxGroupNames = Array.isArray(item.taxGroupNames) ? [...item.taxGroupNames] : [];\r\n    if (checked) {\r\n      if (!taxGroupNames.includes(groupName)) taxGroupNames.push(groupName);\r\n    } else {\r\n      taxGroupNames = taxGroupNames.filter(g => g !== groupName);\r\n    }\r\n    item.taxGroupNames = taxGroupNames;\r\n    item.taxGroupName = taxGroupNames.join(', ');\r\n    lineItems[lineIdx] = item;\r\n    const { updatedLineItems, freighttaxAmount, taxAmount, quoteValue } = recalculateTotals({\r\n      lineItems,\r\n      freightCharges: prev.formData.freightCharges,\r\n      packingCharges: prev.formData.packingCharges,\r\n      taxPercent: prev.formData.taxPercent,\r\n      taxGroups: prev.taxGroups\r\n    });\r\n\r\n    return {\r\n      formData: {\r\n        ...prev.formData,\r\n        lineItems: updatedLineItems,\r\n        freighttaxAmount,\r\n        taxAmount,\r\n        quoteValue\r\n      }\r\n    };\r\n  });\r\n};\r\n\r\nhandleInputChange = (field, value) => {\r\n  this.setState(prev => {\r\n    let newFormData = { ...prev.formData, [field]: value };\r\n    if (field === \"quoteType\") {\r\n      if (value === \"Standard\") {\r\n        newFormData.quoteNo = `QT${1000 + (prev.quotes ? prev.quotes.length : 0)}`;\r\n      } else {\r\n        newFormData.quoteNo = \"\";\r\n      }\r\n    }\r\n\r\n    return { formData: newFormData };\r\n  }, () => {\r\n    if (['freightCharges', 'taxPercent', 'packingCharges'].includes(field)) {\r\n      const { updatedLineItems, freighttaxAmount, taxAmount, quoteValue } = recalculateTotals({\r\n        lineItems: this.state.formData.lineItems,\r\n        freightCharges: this.state.formData.freightCharges,\r\n        packingCharges: this.state.formData.packingCharges,\r\n        taxPercent: this.state.formData.taxPercent,\r\n        taxGroups: this.state.taxGroups\r\n      });\r\n      this.setState(prev => ({\r\n        formData: {\r\n          ...prev.formData,\r\n          lineItems: updatedLineItems,\r\n          freighttaxAmount,\r\n          taxAmount,\r\n          quoteValue\r\n        }\r\n      }));\r\n    }\r\n  });\r\n};\r\n\r\n\r\nhandleBreakdownSelectAll = (checked) => {\r\n  this.setState(prev => ({\r\n    breakdownSelectAll: checked,\r\n    breakdownItems: prev.breakdownItems.map(item => ({ ...item, selected: checked }))\r\n  }));\r\n};\r\nhandleBreakdownRowSelect = (idx, checked) => {\r\n  this.setState(prev => {\r\n    const items = [...prev.breakdownItems];\r\n    items[idx].selected = checked;\r\n    return { breakdownItems: items };\r\n  });\r\n};\r\n\r\n// Handler for per/amt dropdown\r\nhandleBreakdownTypeChange = (type) => {\r\n  this.setState({ breakdownType: type });\r\n};\r\n\r\nhandleBreakdownValueChange = (idx, value) => {\r\n  this.setState(prev => {\r\n    const items = [...prev.breakdownItems];\r\n    items[idx].value = value;\r\n    return { breakdownItems: items };\r\n  });\r\n};\r\nupdateStatus = async (id, status) => {\r\n  await updateDoc(doc(db, \"quotes\", id), { status });\r\n  alert(`Quote ${status}`);\r\n  this.fetchQuotes();\r\n  this.setState({ previewMode: false });\r\n};\r\nhandleBreakdownDateChange = (idx, value) => {\r\n  this.setState(prev => {\r\n    const items = [...prev.breakdownItems];\r\n    items[idx].lastDate = value;\r\n    return { breakdownItems: items };\r\n  });\r\n};\r\nsaveBreakdownToSession = () => {\r\n  sessionStorage.setItem('breakdownItems', JSON.stringify(this.state.breakdownItems));\r\n};\r\nloadBreakdownFromSession = () => {\r\n  const data = sessionStorage.getItem('breakdownItems');\r\n  if (data) this.setState({ breakdownItems: JSON.parse(data) });\r\n};\r\n\r\nhandleSubmit = async (e) => {\r\n  e.preventDefault();\r\n  const { editingId, formData, quotes } = this.state;\r\n\r\n  if (!formData.customer) return alert(\"Customer is required\");\r\n  if (formData.lineItems.length === 0) return alert(\"At least one line item is required\");\r\n  if (!this.isBreakdownValid()) {\r\n    return alert(\"Please complete the breakdown: each product's subproduct totals must match the product total.\");\r\n  }\r\n\r\n  const payload = {\r\n    ...formData,\r\n    status: \"Awaiting for Approval\",\r\n    breakdownItems: this.state.breakdownItems || []\r\n  };\r\n\r\n  if (editingId) {\r\n    await updateDoc(doc(db, 'quotes', editingId), payload);\r\n  } else {\r\n    payload.quoteNo = `QT${1000 + quotes.length}`;\r\n    await addDoc(collection(db, \"quotes\"), {\r\n      ...payload,\r\n      status: \"Awaiting for Approval\",\r\n      createdAt: serverTimestamp()\r\n    });\r\n  }\r\n\r\n  this.setState({ showForm: false, editingId: null });\r\n  this.fetchQuotes();\r\n};\r\n\r\nloadQuotePreview = (q) => {\r\n  this.setState({\r\n    selectedQuote: q,\r\n    previewMode: true\r\n  });\r\n};\r\n\r\n\r\n loadQuoteForEdit = (quote) => {\r\n  this.setState({\r\n    formData: {\r\n      ...quote,\r\n      lineItems: Array.isArray(quote.lineItems) ? quote.lineItems : []\r\n    },\r\n    breakdownItems: Array.isArray(quote.breakdownItems) ? quote.breakdownItems : [],\r\n    editingId: quote.id,\r\n    showForm: true,\r\n    previewMode: false,\r\n    activeTab: 'co'\r\n  }, () => {\r\n    if (this.customerInputRef.current) {\r\n      this.customerInputRef.current.value = quote.customer;\r\n    }\r\n  });\r\n};\r\n\r\nconvertToOrder = (quoteObj) => {\r\n  sessionStorage.setItem('quoteToConvert', JSON.stringify(quoteObj));\r\n this.props.history.push({\r\n    pathname: '/sales/salestransactions/order/Order',\r\n    state: { openForm: true, quoteId: quoteObj.id || null }\r\n  });\r\n};\r\n\r\n\r\n\r\nshowQuotePDFWithOrg = async (quote) => {\r\n  if (!quote || !Array.isArray(quote.lineItems) || quote.lineItems.length === 0) {\r\n    alert(\"Quote data is incomplete.\");\r\n    return;\r\n  }\r\n\r\n  // 1. Fetch org and customer data\r\n  const orgSnap = await getDocs(collection(db, 'businessGroups'));\r\n  const org = orgSnap.docs[0]?.data() || {};\r\n  const customer = this.state.customers.find(\r\n    c => c.custshortName === quote.customer || c.custname === quote.customer\r\n  ) || {};\r\n\r\n  // GST State Map for Place of Supply\r\n  const gstStateMap = {\r\n    \"01\": \"Jammu & Kashmir\", \"02\": \"Himachal Pradesh\", \"03\": \"Punjab\", \"04\": \"Chandigarh\",\r\n    \"05\": \"Uttarakhand\", \"06\": \"Haryana\", \"07\": \"Delhi\", \"08\": \"Rajasthan\", \"09\": \"Uttar Pradesh\",\r\n    \"10\": \"Bihar\", \"11\": \"Sikkim\", \"12\": \"Arunachal Pradesh\", \"13\": \"Nagaland\", \"14\": \"Manipur\",\r\n    \"15\": \"Mizoram\", \"16\": \"Tripura\", \"17\": \"Meghalaya\", \"18\": \"Assam\", \"19\": \"West Bengal\",\r\n    \"20\": \"Jharkhand\", \"21\": \"Odisha\", \"22\": \"Chhattisgarh\", \"23\": \"Madhya Pradesh\", \"24\": \"Gujarat\",\r\n    \"25\": \"Daman and Diu\", \"26\": \"Dadra and Nagar Haveli\", \"27\": \"Maharashtra\", \"28\": \"Andhra Pradesh (Old)\",\r\n    \"29\": \"Karnataka\", \"30\": \"Goa\", \"31\": \"Lakshadweep\", \"32\": \"Kerala\", \"33\": \"Tamil Nadu\",\r\n    \"34\": \"Puducherry\", \"35\": \"Andaman and Nicobar Islands\", \"36\": \"Telangana\", \"37\": \"Andhra Pradesh\",\r\n    \"97\": \"Other Territory\"\r\n  };\r\n\r\n  // Helper for Place of Supply\r\n  const getPlaceOfSupply = (gstin) => {\r\n    if (!gstin || gstin.length < 2) return '';\r\n    const code = gstin.substring(0, 2);\r\n    const state = gstStateMap[code];\r\n    return state ? `${code} - ${state}` : '';\r\n  };\r\n\r\n  // 2. Enrich line items\r\n  const enrichedItems = quote.lineItems.map(item => {\r\n    const product = this.state.products.find(p => p.productId === item.itemCode) || {};\r\n    return {\r\n      ...item,\r\n      ptshortName: product.ptshortName || '',\r\n      hsnCode: product.hsnCode || '',\r\n      uom: product.stockingUOM || '',\r\n      cgst: item.cgst || 0,\r\n      sgst: item.sgst || 0,\r\n      igst: item.igst || 0,\r\n      taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\r\n    };\r\n  });\r\n\r\n  // 3. Subtotal (without tax)\r\n  const subtotal = enrichedItems.reduce((sum, item) => sum + ((parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0)), 0);\r\n  const freightCharges = parseFloat(quote.freightCharges || 0);\r\n  const freightTax = parseFloat(quote.freighttaxAmount || 0);\r\n  const totalTaxAmount = parseFloat(quote.taxAmount || 0);\r\n  const grandTotal = parseFloat(quote.quoteValue || (subtotal + totalTaxAmount));\r\n  const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`;\r\n  const isINR = (quote.currency || 'INR') === 'INR';\r\nconst conversionRate = parseFloat(quote.conversionRate || 1);\r\n\r\nconst convert = (amt) => isINR ? amt : amt * conversionRate;\r\nconst subtotalConv = convert(subtotal);\r\nconst freightChargesConv = convert(freightCharges);\r\nconst taxAmountConv = convert(totalTaxAmount);\r\nconst discountAmountConv = convert(quote.discountAmount || 0);\r\nconst grandTotalConv = convert(quote.afterDiscountValue || grandTotal);\r\n  \r\n  // 4. Tax breakdown by group\r\n  let taxBreakdown = {};\r\n  let taxGroupDetails = [];\r\n  let sno = 1;\r\n  enrichedItems.forEach(item => {\r\n    const qty = parseFloat(item.qty || 0);\r\n    const unitPrice = parseFloat(item.unitPrice || 0);\r\n    const base = qty * unitPrice;\r\n    (item.taxGroupNames || []).forEach(tgName => {\r\n      // Find group in taxGroups\r\n      const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\r\n      if (group) {\r\n        group.lineItems.forEach(li => {\r\n          const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\r\n          let taxAmt = 0;\r\n          if (li.type === 'Amount') taxAmt = parseFloat(li.percentOrAmt || 0);\r\n          else taxAmt = (base * parseFloat(li.percentOrAmt || 0)) / 100;\r\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n          taxGroupDetails.push({\r\n            sno: sno++,\r\n            group: tgName,\r\n            peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\r\n            taxAmt: taxAmt.toFixed(2)\r\n          });\r\n        });\r\n      }\r\n    });\r\n  });\r\n  if (freightTax > 0) {\r\n    taxBreakdown[\"Freight Tax\"] = freightTax;\r\n    taxGroupDetails.push({\r\n      sno: sno++,\r\n      group: \"Freight Tax\",\r\n      peramt: \"-\",\r\n      taxAmt: freightTax.toFixed(2)\r\n    });\r\n  }\r\n\r\n  // 5. Milestone breakdown (with subproducts)\r\n  const { breakdownItems, breakdownType } = this.state;\r\n\r\n  // 6. Build HTML for PDF\r\n  const container = document.createElement('div');\r\n  container.id = 'pdf-preview-container';\r\n  container.style.width = '794px';\r\n  container.style.padding = '40px';\r\n  container.style.fontFamily = 'Arial';\r\n\r\n  // before this block, define:\r\nconst numCols = isINR ? 8 : 7;\r\n\r\ncontainer.innerHTML += `\r\n  <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\r\n    <thead>\r\n      <tr style=\"background:#f4f6fa;\">\r\n        <th style=\"border:1px solid #011b56;\">Item Code</th>\r\n        <th style=\"border:1px solid #011b56;\">Description</th>\r\n        <th style=\"border:1px solid #011b56;\">HSN</th>\r\n        <th style=\"border:1px solid #011b56;\">UOM</th>\r\n        <th style=\"border:1px solid #011b56;\">Qty</th>\r\n        <th style=\"border:1px solid #011b56;\">Unit Price</th>\r\n        ${isINR ? `<th style=\"border:1px solid #011b56;\">GST%</th>` : ''}\r\n        <th style=\"border:1px solid #011b56;\">Item Total</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      ${enrichedItems.map(item => {\r\n        const gstLabel = (item.taxGroupNames && item.taxGroupNames.length)\r\n          ? item.taxGroupNames.join(', ')\r\n          : (item.taxGroupName || item.taxId || '-');\r\n        return `\r\n          <tr>\r\n            <td style=\"border:1px solid #011b56;\">${item.itemCode}</td>\r\n            <td style=\"border:1px solid #011b56;\">${item.itemDescription}</td>\r\n            <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\r\n            <td style=\"border:1px solid #011b56;\">${item.uom}</td>\r\n            <td style=\"border:1px solid #011b56;\">${item.qty}</td>\r\n            <td style=\"border:1px solid #011b56;\">${convert(item.unitPrice).toFixed(2)}</td>\r\n            ${isINR ? `<td style=\"border:1px solid #011b56;\">${gstLabel}</td>` : ''}\r\n            <td style=\"border:1px solid #011b56;\">${convert(item.total).toFixed(2)}</td>\r\n          </tr>`;\r\n      }).join('')}\r\n\r\n      <!-- Subtotal -->\r\n      <tr>\r\n        <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\r\n        <td style=\"border:1px solid #011b56;\"><b>${convert(subtotal).toFixed(2)}</b></td>\r\n      </tr>\r\n\r\n      <!-- Total Tax Amount (only if > 0) -->\r\n      ${convert(totalTaxAmount) > 0 ? `\r\n        <tr>\r\n          <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${convert(totalTaxAmount).toFixed(2)}</b></td>\r\n        </tr>` : ''}\r\n\r\n      <!-- Discount Amount (only if > 0) -->\r\n      ${Number(convert(quote.discountAmount || 0)) > 0 ? `\r\n        <tr>\r\n          <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${Number(convert(quote.discountAmount || 0)).toFixed(2)}</b></td>\r\n        </tr>` : ''}\r\n\r\n      <!-- Grand Total -->\r\n      <tr>\r\n        <td colspan=\"${numCols - 1}\" style=\"text-align:right; border:1px solid #011b56;\"><b>Grand Total</b></td>\r\n        <td style=\"border:1px solid #011b56;\"><b>${Number(convert(quote.afterDiscountValue || grandTotal)).toFixed(2)}</b></td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n\r\n  <div style=\"margin-top:8px; font-size:11px;\">\r\n    <b>Amount in Words:</b> ${amountWords}\r\n  </div>\r\n  <div style=\"margin-top:20px; text-align:right; font-size:10px;\">\r\n    Printed on ${new Date().toLocaleString()}\r\n  </div>\r\n`;\r\n\r\n\r\n  document.body.appendChild(container);\r\n  const canvas = await html2canvas(container, { scale: 2, useCORS: true });\r\n  const imgData = canvas.toDataURL('image/png');\r\n  const pdf = new jsPDF('p', 'pt', 'a4');\r\n  const width = 595.28;\r\n  const height = canvas.height * width / canvas.width;\r\n  pdf.addImage(imgData, 'PNG', 0, 0, width, height);\r\n  document.body.removeChild(container);\r\n\r\n  // ...existing code...\r\n\r\n// 8. Milestone breakdown and tax breakdown on the same page, same style as quote table\r\nif (breakdownItems && breakdownItems.length > 0) {\r\n  pdf.addPage();\r\n\r\n  let milestoneRows = breakdownItems.filter(bi => bi.selected !== false).map((item, idx) => {\r\n  const mainItem = enrichedItems.find(li => li.itemCode === item.productId);\r\n  const mainItemTotal = mainItem ? (parseFloat(mainItem.total) || 0) : 0;\r\n\r\n  return `\r\n    <tr>\r\n      <td style=\"border:1px solid #011b56;\">${item.sno || ''}</td>\r\n      <td style=\"border:1px solid #011b56;\">${item.productId || ''}</td>\r\n      <td style=\"border:1px solid #011b56;\">${item.desc || ''}</td>\r\n      <td style=\"border:1px solid #011b56;\">${item.value ? item.value + (breakdownType === 'Percentage' ? '%' : '₹') : ''}</td>\r\n      <td style=\"border:1px solid #011b56;\">${item.dueDate || ''}</td>\r\n      <td style=\"border:1px solid #011b56;\">${mainItemTotal.toFixed(2)}</td>\r\n    </tr>\r\n    ${(item.subProducts || []).map((sp, spIdx) => {\r\n      const rawVal = parseFloat(sp.value || 0) || 0;\r\n      let spTotal = 0;\r\n      if (breakdownType === 'Percentage') {\r\n        spTotal = mainItemTotal * rawVal / 100;\r\n      } else {\r\n        spTotal = rawVal;\r\n      }\r\n      return `\r\n        <tr style=\"background: #f9f9f9;\">\r\n          <td style=\"border:1px solid #011b56;\"></td>\r\n          <td style=\"border:1px solid #011b56;\">${item.productId}_${spIdx + 1}</td>\r\n          <td style=\"border:1px solid #011b56;\">→ ${sp.name || ''}</td>\r\n          <td style=\"border:1px solid #011b56;\">${sp.value ? (breakdownType === 'Percentage' ? sp.value + '%' : '₹' + sp.value) : ''}</td>\r\n          <td style=\"border:1px solid #011b56;\">${sp.dueDate || ''}</td>\r\n          <td style=\"border:1px solid #011b56;\">${spTotal.toFixed(2)}</td>\r\n        </tr>\r\n      `;\r\n    }).join('')}\r\n  `;\r\n}).join('');\r\n\r\nlet taxRows = taxGroupDetails.map(row => `\r\n  <tr>\r\n    <td style=\"border:1px solid #011b56;\">${row.sno}</td>\r\n    <td style=\"border:1px solid #011b56;\">${row.group}</td>\r\n    <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\r\n    <td style=\"border:1px solid #011b56;\">${convert(row.taxAmt).toFixed(2)}</td>\r\n  </tr>\r\n`).join('');\r\n\r\nlet combinedHtml = `\r\n  <div style=\"font-family:Arial; padding:40px; width:100%;\">\r\n    <h2 style=\"margin-bottom:20px; font-size:20px;\">Tax Breakdown</h2>\r\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:13px;\">\r\n      <thead>\r\n        <tr style=\"background:#f4f6fa;\">\r\n          <th style=\"border:1px solid #011b56;\">S.No</th>\r\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\r\n          <th style=\"border:1px solid #011b56;\">Per/Amt</th>\r\n          <th style=\"border:1px solid #011b56;\">Tax Amt</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${taxRows}\r\n        <tr>\r\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${taxAmountConv.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${discountAmountConv.toFixed(2)}</b></td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n`;\r\n\r\n  const combinedContainer = document.createElement('div');\r\n  combinedContainer.id = 'pdf-preview-container';\r\n  combinedContainer.style.width = '794px';\r\n  combinedContainer.style.padding = '40px';\r\n  combinedContainer.style.fontFamily = 'Arial';\r\n  combinedContainer.style.fontSize = '10px'; // Ensure same font size as first page\r\n  combinedContainer.innerHTML = combinedHtml;\r\n  document.body.appendChild(combinedContainer);\r\n\r\n  const combinedCanvas = await html2canvas(combinedContainer, { scale: 2, useCORS: true });\r\n  const combinedImg = combinedCanvas.toDataURL('image/png');\r\n  pdf.addImage(combinedImg, 'PNG', 0, 0, width, combinedCanvas.height * width / combinedCanvas.width);\r\n\r\n  document.body.removeChild(combinedContainer);\r\n\r\n}\r\n\r\n  pdf.setFontSize(11);\r\n  pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\r\n  pdf.text('Authorized Signatory', width - 200, 800);\r\n\r\n  // 11. Show PDF\r\n  const blob = pdf.output('blob');\r\n  const url = URL.createObjectURL(blob);\r\n  const newWin = window.open();\r\n  newWin.document.write(`\r\n    <html><head><title>Quote PDF Preview</title></head>\r\n    <body style=\"margin:0;\">\r\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\r\n      <button onclick=\"document.querySelector('iframe').contentWindow.print()\" style=\"position:fixed;top:10px;right:110px;\"></button>\r\n      <a href=\"${url}\" download=\"Quote_${quote.quoteNo || 'PDF'}.pdf\" style=\"position:fixed;top:10px;right:10px;\"></a>\r\n    </body></html>\r\n  `);\r\n  newWin.document.close();\r\n};\r\n\r\n  showOverlay = (type) => this.setState({ overlayType: type, overlaySearch: '' });\r\n  hideOverlay = () => this.setState({ overlayType: '', overlaySearch: '' });\r\n\r\nselectOverlayValue = async (value) => {\r\n  if (this.state.overlayType === 'customer') {\r\n    // Fetch conversion rate from Firestore\r\n    let conversionRate = '';\r\n    if (value.currency && value.currency !== 'INR') {\r\n      const snap = await getDocs(collection(db, 'currencies'));\r\n      const currencies = snap.docs.map(d => ({ id: d.id, ...d.data() }));\r\n      const cur = currencies.find(c => c.code === value.currency);\r\n      conversionRate = cur ? cur.conversionRate : '';\r\n    }\r\n    this.setState(prev => ({\r\n      formData: {\r\n        ...prev.formData,\r\n        customer: value.custname || value.custcode || '', \r\n        billTo: this.formatAddress(value.billTo),\r\n        shipTo: this.formatAddress(value.shipTo),\r\n        currency: value.currency || '',\r\n        conversionRate: conversionRate,\r\n      },\r\n      overlayType: '',\r\n      overlaySearch: ''\r\n    }), () => {\r\n      if (this.customerInputRef.current) {\r\n        this.customerInputRef.current.value = value.custname || value.custcode || '';\r\n      }\r\n    });\r\n  }\r\n};\r\nrenderOverlay = () => {\r\n  const { overlayType, overlaySearch, customers, despatchModes, paymentTerms } = this.state;\r\n\r\n  const getFilteredRows = (list, nameKey = 'name', codeKey = 'shortName') =>\r\n    list.filter(item =>\r\n      (item[nameKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase()) ||\r\n      (item[codeKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase())\r\n    );\r\n\r\n  const handleSelect = (item) => {\r\n    if (overlayType === 'customer') {\r\n      this.selectOverlayValue(item);\r\n    } else if (overlayType === 'despatchMode') {\r\n      this.setState(prev => ({\r\n        formData: {\r\n          ...prev.formData,\r\n          despatchMode: item.name\r\n        },\r\n        overlayType: '',\r\n        overlaySearch: ''\r\n      }));\r\n    } else if (overlayType === 'paymentTerms') {\r\n      this.setState(prev => ({\r\n        formData: {\r\n          ...prev.formData,\r\n          paymentTerms: item.name\r\n        },\r\n        overlayType: '',\r\n        overlaySearch: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  let title = '';\r\n  let headers = [];\r\n  let rows = [];\r\n\r\n  if (overlayType === 'customer') {\r\n    title = 'Select Customer';\r\n    headers = ['Name', 'Code', 'Short Name'];\r\n    rows = getFilteredRows(customers, 'custname', 'custcode');\r\n  } else if (overlayType === 'despatchMode') {\r\n    title = 'Select Despatch Mode';\r\n    headers = ['Name', 'Short Name'];\r\n    rows = getFilteredRows(despatchModes);\r\n  } else if (overlayType === 'paymentTerms') {\r\n    title = 'Select Payment Terms';\r\n    headers = ['Name', 'Short Name'];\r\n    rows = getFilteredRows(paymentTerms);\r\n  } else {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-2\">\r\n          <div className=\"custom-overlay-title\">{title}</div>\r\n          <i className=\"mdi mdi-close-box-outline\"\r\n          style={{ fontSize: \"24px\", color: \"#2196F3\", cursor: \"pointer\" }} \r\n            onClick={this.handleOverlayClose}\r\n            aria-label=\"Close\"\r\n            type=\"button\"\r\n          >\r\n          </i>\r\n        </div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-control mb-2\"\r\n          placeholder={`Search ${overlayType}...`}\r\n          value={overlaySearch}\r\n          onChange={e => this.setState({ overlaySearch: e.target.value })}\r\n        />\r\n        <div style={{ maxHeight: 300, overflowY: 'auto' }}>\r\n          <table className=\"table table-bordered table-sm\">\r\n            <thead>\r\n              <tr>\r\n                {headers.map((h, i) => <th key={i}>{h}</th>)}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {rows.map((item, i) => (\r\n                <tr key={item.id || i} onClick={() => handleSelect(item)} style={{ cursor: 'pointer' }}>\r\n                  {headers.map((h, j) => (\r\n                    <td key={j}>\r\n                      {overlayType === 'customer'\r\n                        ? h === 'Name' ? item.custname\r\n                          : h === 'Code' ? item.custcode\r\n                          : item.custshortName\r\n                        : h === 'Name' ? item.name\r\n                          : item.shortName}\r\n                    </td>\r\n                  ))}\r\n                </tr>\r\n              ))}\r\n              {rows.length === 0 && (\r\n                <tr>\r\n                  <td colSpan={headers.length} className=\"text-center\">No records found</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nrenderProductOverlay = () => {\r\n  const { filteredProducts, productOverlaySearch, selectedProductIds, currentPage = 1 } = this.state;\r\n\r\n  const itemsPerPage = 10;\r\n  const filtered = filteredProducts.filter(p =>\r\n    (p.ptshortName || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) ||\r\n    (p.ptdescription || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) ||\r\n    (p.itemCode || '').toLowerCase().includes(productOverlaySearch.toLowerCase())\r\n  );\r\n  const totalPages = Math.ceil(filtered.length / itemsPerPage);\r\n  const paginated = filtered.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);\r\n\r\n  return (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-2\">\r\n  <div className=\"custom-overlay-title\">Select Products</div>\r\n  <div className=\"d-flex align-items-center\">\r\n    <button\r\n      className=\"btn btn-primary btn-sm mr-2\"\r\n      onClick={() => {\r\n        const selectedProducts = filteredProducts.filter(p =>\r\n          selectedProductIds.includes(p.id)\r\n        );\r\n        this.setState(prev => ({\r\n          formData: {\r\n            ...prev.formData,\r\n            lineItems: [\r\n              ...prev.formData.lineItems,\r\n              ...selectedProducts\r\n                .filter(p => !prev.formData.lineItems.some(item => item.id === p.id))\r\n                .map(p => ({\r\n                  id: p.id,\r\n                  itemCode: p.productId || '',\r\n                  itemDescription: p.ptdescription || '',\r\n                  itemType: p.itemType || '',\r\n                  materialType: p.materialType || '',\r\n                  onHand: p.onHand || 0,\r\n                  taxGroup: p.taxGroup || '',\r\n                  taxGroupName: p.taxGroup || '',\r\n                  custPartNo: p.custPartNo || '',\r\n                  hsnCode: p.hsnCode || '',\r\n                  unitPrice: p.unitPrice || 0,\r\n                  qty: 1,\r\n                  total: (p.unitPrice || 0).toFixed(2)\r\n                }))\r\n            ]\r\n          },\r\n          productOverlayVisible: false,\r\n          selectedProductIds: []\r\n        }));\r\n      }}\r\n      type=\"button\"\r\n    >\r\n      Add Selected\r\n    </button>\r\n \r\n  <i\r\n    className=\"mdi mdi-close-box-outline\"\r\n    style={{\r\n      fontSize: \"24px\",\r\n      color: \"#2196F3\",\r\n      cursor: \"pointer\",\r\n    }}\r\n    onClick={this.handleOverlayClose}\r\n    aria-label=\"Close\"\r\n    type=\"button\"\r\n  ></i>\r\n</div>\r\n</div>\r\n\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-control mb-2\"\r\n          placeholder=\"Search products...\"\r\n          value={productOverlaySearch}\r\n          onChange={e => this.setState({ productOverlaySearch: e.target.value, currentPage: 1 })}\r\n        />\r\n        <div style={{ flex: 1, overflowY: \"auto\" }}>\r\n          <table className=\"table table-bordered table-sm\">\r\n            <thead>\r\n              <tr>\r\n                <th></th>\r\n                <th>Item Code</th>\r\n                <th>Item Desc</th>\r\n                <th>Item Type</th>\r\n                <th>Material Type</th>\r\n                <th>On Hand</th>\r\n                <th>Tax Grp</th>\r\n                <th>Cust Part No</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {paginated.map(p => (\r\n                <tr key={p.id}>\r\n                  <td>\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedProductIds.includes(p.id)}\r\n                      onChange={e => {\r\n                        const checked = e.target.checked;\r\n                        this.setState(prev => ({\r\n                          selectedProductIds: checked\r\n                            ? [...prev.selectedProductIds, p.id]\r\n                            : prev.selectedProductIds.filter(id => id !== p.id)\r\n                        }));\r\n                      }}\r\n                    />\r\n                  </td>\r\n                  <td>{p.productId}</td>\r\n                  <td>{p.ptdescription || ''}</td>\r\n                  <td>{p.itemType || ''}</td>\r\n                  <td>{p.materialType || ''}</td>\r\n                  <td>{p.onHand || 0}</td>\r\n                  <td>{p.taxGroup || ''}</td>\r\n                  <td>{p.custPartNo || ''}</td>\r\n                </tr>\r\n              ))}\r\n              {paginated.length === 0 && (\r\n                <tr>\r\n                  <td colSpan=\"8\" className=\"text-center\">No products found</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        {/* Pagination at bottom */}\r\n        <nav aria-label=\"Product pagination example\">\r\n          <ul className=\"pagination justify-content-end\">\r\n            <li className={`page-item ${currentPage === 1 ? \"disabled\" : \"\"}`}>\r\n              <button\r\n                className=\"page-link\"\r\n                aria-label=\"Previous\"\r\n                onClick={() => this.setState({ currentPage: Math.max(currentPage - 1, 1) })}\r\n              >\r\n                <span aria-hidden=\"true\">&laquo;</span>\r\n              </button>\r\n            </li>\r\n            {[...Array(totalPages)].map((_, idx) => (\r\n              <li key={idx} className={`page-item ${currentPage === idx + 1 ? \"active\" : \"\"}`}>\r\n                <button\r\n                  className=\"page-link\"\r\n                  onClick={() => this.setState({ currentPage: idx + 1 })}\r\n                >\r\n                  {idx + 1}\r\n                </button>\r\n              </li>\r\n            ))}\r\n            <li className={`page-item ${currentPage === totalPages ? \"disabled\" : \"\"}`}>\r\n              <button\r\n                className=\"page-link\"\r\n                aria-label=\"Next\"\r\n                onClick={() => this.setState({ currentPage: Math.min(currentPage + 1, totalPages) })}\r\n              >\r\n                <span aria-hidden=\"true\">&raquo;</span>\r\n              </button>\r\n            </li>\r\n          </ul>\r\n        </nav>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Tax overlay with cross close and Done at top-right\r\nrenderTaxOverlay = () => {\r\n  const { taxGroups, currentTaxLineIdx, formData } = this.state;\r\n  if (currentTaxLineIdx === null) return null;\r\n\r\n  const item = formData.lineItems[currentTaxLineIdx];\r\n  const selected = new Set(item.taxGroupNames || []);\r\n\r\n  return (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-2\">\r\n          <div className=\"custom-overlay-title\">Select Tax Groups</div>\r\n          <div>\r\n            <button\r\n              className=\"btn btn-primary btn-sm mr-2\"\r\n              onClick={() => this.setState({ showTaxOverlay: false })}\r\n              type=\"button\"\r\n            >\r\n              Submit\r\n            </button>\r\n            <i className=\"mdi mdi-close-box-outline\"\r\n              style={{ fontSize: \"24px\", color: \"#2196F3\", cursor: \"pointer\" }} \r\n              onClick={this.handleOverlayClose}\r\n              aria-label=\"Close\"\r\n              type=\"button\"\r\n            >\r\n            </i>\r\n          </div>\r\n        </div>\r\n        <table className=\"table table-sm table-bordered\">\r\n          <thead style={{ background: '#f4f6fa' }}>\r\n            <tr>\r\n              <th></th>\r\n              <th>Group</th>\r\n              <th>Components</th>\r\n              <th>Type</th>\r\n              <th>% / Amount</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {taxGroups.map(tg => (\r\n              <tr key={tg.groupName}>\r\n                <td>\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selected.has(tg.groupName)}\r\n                    onChange={e =>\r\n                      this.toggleTaxGroupSelection(tg.groupName, currentTaxLineIdx, e.target.checked)\r\n                    }\r\n                  />\r\n                </td>\r\n                <td>{tg.groupName}</td>\r\n                <td>{tg.lineItems.map(li => li.component).join(', ')}</td>\r\n                <td>{tg.lineItems.map(li => li.type).join(', ')}</td>\r\n                <td>{tg.lineItems.map(li => li.percentOrAmt).join(', ')}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\naddBreakdownFromLineItems = () => {\r\n  const { formData, breakdownItems } = this.state;\r\n  const existing = new Set((breakdownItems || []).map(b => b.productId));\r\n  const toAdd = (formData.lineItems || [])\r\n    .filter(li => li.itemCode && !existing.has(li.itemCode))\r\n    .map((li, i) => ({\r\n      sno: (breakdownItems?.length || 0) + i + 1,\r\n      productId: li.itemCode,\r\n      desc: li.itemDescription || '',\r\n      subProducts: []\r\n    }));\r\n  if (toAdd.length) {\r\n    this.setState(\r\n      { breakdownItems: [...(breakdownItems || []), ...toAdd] },\r\n      this.saveBreakdownToSession\r\n    );\r\n  }\r\n};\r\nrenderBreakdownTab = () => {\r\n  const { breakdownItems, breakdownType, formData } = this.state;\r\n\r\n  // map item totals from lineItems (main product totals)\r\n  const itemTotals = (formData.lineItems || []).reduce((acc, li) => {\r\n    acc[li.itemCode] = parseFloat(li.total || 0) || 0;\r\n    return acc;\r\n  }, {});\r\n  const sumOfItemTotals = Object.values(itemTotals).reduce((s, v) => s + v, 0);\r\n\r\n  // compute subproducts sum\r\n  const getSubProductsSum = (bi) => {\r\n    const mainTotal = itemTotals[bi.productId] || 0;\r\n    const subs = Array.isArray(bi.subProducts) ? bi.subProducts : [];\r\n    return subs.reduce((s, sp) => {\r\n      const val = parseFloat(sp.value || 0) || 0;\r\n      return s + (breakdownType === \"Percentage\" ? (mainTotal * val / 100) : val);\r\n    }, 0);\r\n  };\r\n\r\n  const canSave = this.isBreakdownValid();\r\n  const isConverted = formData?.status === \" CO Created\"; // 🔑 single flag\r\n\r\n  return (\r\n    <div>\r\n      <h5>Milestone Breakdown</h5>\r\n\r\n      <div className=\"row mb-2\">\r\n        <div className=\"col\"><b>Quote Value:</b> {formData.quoteValue}</div>\r\n        <div className=\"col\"><b>After Discount Quote Value:</b> {formData.afterDiscountValue}</div>\r\n        <div className=\"col\"><b>Tax Amount:</b> {formData.taxAmount}</div>\r\n        <div className=\"col\"><b>Sum of Item Totals:</b> {sumOfItemTotals.toFixed(2)}</div>\r\n      </div>\r\n\r\n      {/* Mode selector + Add Breakdown button */}\r\n      <div className=\"row mb-2\">\r\n        <div className=\"col-md-3\">\r\n          <label>Subproduct Mode</label>\r\n          <select\r\n            className=\"form-control form-control-sm\"\r\n            value={breakdownType}\r\n            onChange={e => this.handleBreakdownTypeChange(e.target.value)}\r\n            disabled={isConverted} // disable if converted\r\n          >\r\n            <option value=\"Amount\">Amount</option>\r\n            <option value=\"Percentage\">Percentage</option>\r\n          </select>\r\n        </div>\r\n        <div className=\"col-md-9 text-right\">\r\n          {!isConverted && (\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-primary btn-sm\"\r\n              onClick={this.addBreakdownFromLineItems}\r\n            >\r\n              + Add Breakdown\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* ===== Table ===== */}\r\n      <table className=\"table table-bordered\">\r\n        <thead className=\"thead-light\">\r\n          <tr>\r\n            <th>S.No</th>\r\n            <th>ID</th>\r\n            <th>Desc / Subproduct name</th>\r\n            <th>SubProduct value ({breakdownType === \"Percentage\" ? \"%\" : \"₹\"})</th>\r\n            <th>Total (₹)</th>\r\n            <th>Due Date</th>\r\n            <th>Action</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {breakdownItems.map((item, idx) => {\r\n            const mainItemTotal = itemTotals[item.productId] || 0;\r\n            const subSum = getSubProductsSum(item);\r\n            const remaining = mainItemTotal - subSum;\r\n            const subs = Array.isArray(item.subProducts) ? item.subProducts : [];\r\n\r\n            return (\r\n              <React.Fragment key={idx}>\r\n                {/* parent product row */}\r\n                <tr style={{ background: \"#eef4ff\" }}>\r\n                  <td>{item.sno}</td>\r\n                  <td>{item.productId}</td>\r\n                  <td>{item.desc}</td>\r\n                  <td>\r\n                    <div>\r\n                      <div><small>Subproducts sum: <b>{subSum.toFixed(2)}</b></small></div>\r\n                      <div>\r\n                        <small>\r\n                          Remaining:{\" \"}\r\n                          <b style={{ color: remaining > 0.01 ? \"red\" : \"green\" }}>\r\n                            {remaining.toFixed(2)}\r\n                          </b>\r\n                        </small>\r\n                      </div>\r\n                    </div>\r\n                  </td>\r\n                  <td>{mainItemTotal.toFixed(2)}</td>\r\n                  <td></td>\r\n                  <td>\r\n                    {!isConverted && (\r\n                      <div className=\"d-flex\">\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"btn btn-sm btn-outline-primary mr-2\"\r\n                          onClick={() => this.handleAddInlineSubProduct(idx)}\r\n                        >+ Add</button>\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"btn btn-sm btn-outline-secondary\"\r\n                          onClick={() => {\r\n                            if (remaining <= 0) return;\r\n                            this.handleAddInlineSubProduct(idx, {\r\n                              name: \"New Product\",\r\n                              value: breakdownType === \"Percentage\"\r\n                                ? ((remaining * 100) / (mainItemTotal || 1)).toFixed(2)\r\n                                : remaining.toFixed(2)\r\n                            });\r\n                          }}\r\n                        >Auto-fill</button>\r\n                      </div>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n\r\n                {/* subproduct rows */}\r\n                {subs.length === 0 && (\r\n                  <tr key={`notice-${idx}`}>\r\n                    <td colSpan=\"6\" className=\"text-center text-muted\">\r\n                      No subproducts added for this item.\r\n                    </td>\r\n                  </tr>\r\n                )}\r\n\r\n                {subs.map((sp, spIdx) => {\r\n                  const spId = `${item.productId}_${spIdx + 1}`;\r\n                  const rawVal = parseFloat(sp.value || 0) || 0;\r\n                  const spTotal = breakdownType === \"Percentage\"\r\n                    ? (mainItemTotal * rawVal / 100)\r\n                    : rawVal;\r\n\r\n                  return (\r\n                    <tr key={spId} style={{ background: \"#f9f9f9\" }}>\r\n                      <td className=\"text-muted\">—</td>\r\n                      <td>{spId}</td>\r\n                      <td>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={sp.name || \"\"}\r\n                          onChange={(e) => this.handleSubProductChange(idx, spIdx, \"name\", e.target.value)}\r\n                          placeholder=\"Enter name\"\r\n                          disabled={isConverted}\r\n                          style={{ paddingLeft: \"18px\" }}\r\n                        />\r\n                      </td>\r\n                      <td>\r\n                        <input\r\n                          type=\"number\"\r\n                          step=\"any\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={sp.value || \"\"}\r\n                          onChange={(e) => this.handleSubProductChange(idx, spIdx, \"value\", e.target.value)}\r\n                          disabled={isConverted}\r\n                        />\r\n                      </td>\r\n                      <td>{spTotal.toFixed(2)}</td>\r\n                      <td>\r\n                      <input\r\n                        type=\"date\"\r\n                        className=\"form-control form-control-sm\"\r\n                        value={sp.dueDate || \"\"}\r\n                        onChange={(e) =>\r\n                          this.handleSubProductChange(idx, spIdx, \"dueDate\", e.target.value)\r\n                        }\r\n                        disabled={isConverted}\r\n                      />\r\n                    </td>\r\n\r\n                      <td>\r\n                        {!isConverted && (\r\n                          <button\r\n                            type=\"button\"\r\n                            className=\"btn btn-sm btn-danger\"\r\n                            onClick={() => this.handleRemoveSubProduct(idx, spIdx)}\r\n                          >-</button>\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </React.Fragment>\r\n            );\r\n          })}\r\n        </tbody>\r\n      </table>\r\n\r\n      {!canSave && !isConverted && (\r\n        <div className=\"alert alert-danger\">\r\n          Breakdown incomplete — for each product the sum of subproduct totals\r\n          must equal the product total. Save disabled until fixed.\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\nrenderSubProductDialog = () => {\r\n  const { showSubProductDialog, subProductForm } = this.state;\r\n  if (!showSubProductDialog) return null;\r\n  return (\r\n    <div className=\"custom-overlay\" onClick={(e) => e.stopPropagation()}>\r\n      <div className=\"custom-overlay-content\" style={{ width: 400 }}>\r\n        <div className=\"form-group\">\r\n          <label>Name</label>\r\n          <input className=\"form-control\" value={subProductForm.name} onChange={e => this.setState({ subProductForm: { ...subProductForm, name: e.target.value } })} />\r\n        </div>\r\n        <div className=\"form-group\">\r\n          <label>Type</label>\r\n          <select className=\"form-control\" value={subProductForm.type} onChange={e => this.setState({ subProductForm: { ...subProductForm, type: e.target.value } })}>\r\n            <option value=\"Amount\">Amount</option>\r\n            <option value=\"Percentage\">Percentage</option>\r\n          </select>\r\n        </div>\r\n        <div className=\"form-group\">\r\n          <label>{subProductForm.type}</label>\r\n          <input className=\"form-control\" type=\"number\" value={subProductForm.value} onChange={e => this.setState({ subProductForm: { ...subProductForm, value: e.target.value } })} />\r\n        </div>\r\n        <div className=\"form-group\">\r\n          <label>Due Date</label>\r\n          <input className=\"form-control\" type=\"date\" value={subProductForm.dueDate} onChange={e => this.setState({ subProductForm: { ...subProductForm, dueDate: e.target.value } })} />\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <button type=\"button\" className=\"btn btn-secondary mr-2\" onClick={() => this.setState({ showSubProductDialog: false })}>Cancel</button>\r\n\r\n          <button type=\"button\" className=\"btn btn-primary\" onClick={(e) => {\r\n            e.preventDefault();  //  this prevents the form submission\r\n            this.handleAddSubProduct();\r\n          }}>Add</button>\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n// Add inline subproduct (optionally with initial data)\r\nhandleAddInlineSubProduct = (breakdownIdx, initial = null) => {\r\n  this.setState(prev => {\r\n    const items = [...prev.breakdownItems];\r\n    const item = { ...items[breakdownIdx] };\r\n    const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\r\n    const defaultSP = { name: '', value: '', dueDate: '' };\r\n    subProducts.push(initial ? { ...defaultSP, ...initial } : defaultSP);\r\n    item.subProducts = subProducts;\r\n    items[breakdownIdx] = item;\r\n    return { breakdownItems: items };\r\n  }, this.saveBreakdownToSession);\r\n};\r\n\r\nhandleRemoveSubProduct = (biIdx, spIdx) => {\r\n  this.setState(prev => {\r\n    const items = [...prev.breakdownItems];\r\n    const item = { ...items[biIdx] };\r\n    const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\r\n    subProducts.splice(spIdx, 1);\r\n    item.subProducts = subProducts;\r\n    items[biIdx] = item;\r\n    return { breakdownItems: items };\r\n  }, this.saveBreakdownToSession);\r\n};\r\n\r\nhandleSubProductChange = (biIdx, spIdx, field, value) => {\r\n  this.setState(prev => {\r\n    const items = [...prev.breakdownItems];\r\n    const item = { ...items[biIdx] };\r\n    const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\r\n    const sp = { ...subProducts[spIdx], [field]: value };\r\n    subProducts[spIdx] = sp;\r\n    item.subProducts = subProducts;\r\n    items[biIdx] = item;\r\n    return { breakdownItems: items };\r\n  }, this.saveBreakdownToSession);\r\n};\r\n\r\n// sum of subproducts for a breakdown item (used in validation)\r\ngetSubProductsSum = (bi) => {\r\n  const { breakdownType, formData } = this.state;\r\n  const itemTotals = (formData.lineItems || []).reduce((acc, li) => {\r\n    acc[li.itemCode] = parseFloat(li.total || 0) || 0;\r\n    return acc;\r\n  }, {});\r\n  const mainTotal = itemTotals[bi.productId] || 0;\r\n  const subs = Array.isArray(bi.subProducts) ? bi.subProducts : [];\r\n  return subs.reduce((s, sp) => {\r\n    const val = parseFloat(sp.value || 0) || 0;\r\n    if (breakdownType === 'Percentage') {\r\n      return s + (mainTotal * val / 100);\r\n    }\r\n    return s + val;\r\n  }, 0);\r\n};\r\n\r\n// Check that for every main product, sum(subproducts) === mainTotal (tolerance)\r\nisBreakdownValid = () => {\r\n  const { breakdownItems, formData } = this.state;\r\n  const itemTotals = (formData.lineItems || []).reduce((acc, li) => {\r\n    acc[li.itemCode] = parseFloat(li.total || 0) || 0;\r\n    return acc;\r\n  }, {});\r\n  const TOL = 0.01;\r\n  for (let bi of breakdownItems) {\r\n    const mainTotal = itemTotals[bi.productId] || 0;\r\n    // require at least one subproduct for products with non-zero mainTotal\r\n    if (mainTotal > 0) {\r\n      const subSum = this.getSubProductsSum(bi);\r\n      if (Math.abs(subSum - mainTotal) > TOL) return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\nhandleAddSubProduct = () => {\r\n  const { currentBreakdownIdx, subProductForm, breakdownItems } = this.state;\r\n  if (!subProductForm.name || !subProductForm.value) return;\r\n  // Clone breakdownItems and subProducts for immutability\r\n  const items = breakdownItems.map((item, idx) => {\r\n    if (idx === currentBreakdownIdx) {\r\n      const subProducts = Array.isArray(item.subProducts) ? [...item.subProducts] : [];\r\n      subProducts.push({ ...subProductForm });\r\n      return { ...item, subProducts };\r\n    }\r\n    return item;\r\n  });\r\n  this.setState({\r\n    breakdownItems: items,\r\n    showSubProductDialog: false,\r\n    subProductForm: { name: '', value: '', type: 'Amount', dueDate: '' }\r\n  }, this.saveBreakdownToSession);\r\n};\r\n  renderQuoteTable = () => (\r\n    <div className=\"card mt-4 full-height\">\r\n      <div className=\"card-body\">\r\n       <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n  <h4 className=\"card-title mb-0\">Quotes</h4>\r\n\r\n  <div className=\"d-flex align-items-center\" style={{ gap: '10px', width: '40%' }}>\r\n    <input\r\n      type=\"text\"\r\n      className=\"form-control\"\r\n      placeholder=\"Search by Bill No, Customer, Status, Date...\"\r\n      value={this.state.searchTerm}\r\n      onChange={(e) => this.setState({ searchTerm: e.target.value })}\r\n    />\r\n    <button\r\n    type=\"button\"\r\n      className=\"btn btn-primary\"\r\n      onClick={() => this.setState({ showForm: true })}\r\n    >\r\n       Create\r\n    </button>\r\n  </div>\r\n</div>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr style={{ fontSize: '14px' }}>\r\n                <th>Quote No</th>\r\n                <th>Customer</th>\r\n                <th>Date</th>\r\n                <th>Quote Value</th>\r\n                <th>After Discount</th>\r\n                <th>Status</th>\r\n                <th>Print</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {this.state.quotes\r\n              .filter((q) =>{\r\n                const term =this.state.searchTerm.toLowerCase();\r\n                if(!term) return true;\r\n                return (\r\n                  (q.quoteNo || '').toLowerCase().includes(term) ||\r\n                  (q.customer || '').toLowerCase().includes(term) ||\r\n                  (q.status || '').toLowerCase().includes(term) ||\r\n                  (q.quoteDate || '').toLowerCase().includes(term) ||\r\n                  (q.quoteValue?.toString() || '').toLowerCase().includes(term) ||\r\n                  (q.afterDiscountValue?.toString() || '').toLowerCase().includes(term) \r\n                );\r\n              })\r\n              .map((q, i) => {\r\n                let statusClass = \"badge-info\";\r\n                if (q.status === \"Awaiting for Approval\") statusClass = \"badge-warning\";\r\n                else if (q.status === \"CO created\") statusClass = \"badge-secondary\";\r\n                else if (q.status === \"Cancelled\") statusClass = \"badge-danger\";\r\n                else if(q.status === \"Approved\")statusClass=\"badge-success\";\r\n                return (\r\n                  <tr key={i} style={{ fontSize: '14px' }}>\r\n                    <td>\r\n                      <button\r\n                        className=\"btn btn-link p-0\"\r\n                        onClick={() => this.loadQuotePreview(q)}\r\n                      >\r\n                        {q.quoteNo}\r\n                      </button>\r\n                    </td>\r\n                    <td>{q.customer}</td>\r\n                    <td>{q.quoteDate}</td>\r\n                    <td>{q.quoteValue}</td>\r\n                    <td>{q.afterDiscountValue}</td>\r\n                    <td>\r\n                      <label \r\n                      className={`badge ${statusClass}`}\r\n                      style={{ fontSize: '14px' }}>{q.status}</label>\r\n                    </td>\r\n                    <td>\r\n                      <i\r\n                        className=\"mdi mdi-printer menu-icon\"\r\n                        onClick={() => this.showQuotePDFWithOrg(q)}\r\n                        style={{ fontSize: '24px', color: '#2196F3', cursor: 'pointer' }}\r\n                      ></i>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n              {this.state.quotes.length === 0 && (\r\n                <tr><td colSpan=\"6\" className=\"text-center\">No quotes found.</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderQuoteForm = () => {\r\n    const { formData, overlayType, productOverlayVisible,recalculateQuoteTotals ,showTaxOverlay,taxGroups} = this.state;\r\n    const isFOB = formData.impExp === 'FOB';\r\n    return (\r\n      <div>\r\n        <div className=\"card full-height\">\r\n          <div style={{ flex: 1, overflowY: 'auto', padding: '24px' }}>\r\n            <h4 className=\"mb-3\">Quote Form</h4>\r\n            <ul className=\"nav nav-tabs\" role=\"tablist\">\r\n              <li className=\"nav-item\">\r\n                <button type=\"button\" className={`nav-link ${this.state.activeTab === 'co' ? 'active' : ''}`} onClick={() => this.setState({ activeTab: 'co' })}>CO Details</button>\r\n              </li>\r\n              <li className=\"nav-item\">\r\n              <button type=\"button\" className={`nav-link ${this.state.activeTab === 'breakdown' ? 'active' : ''}`} onClick={() => this.setState({ activeTab: 'breakdown' })}>Breakdown</button>\r\n            </li>\r\n            <li className=\"nav-item\">\r\n                <button type=\"button\" className={`nav-link ${this.state.activeTab === 'commercial' ? 'active' : ''}`} onClick={() => this.setState({ activeTab: 'commercial' })}>Commercial Terms</button>\r\n              </li>\r\n            </ul>\r\n            <form className=\"form-sample\" onSubmit={this.handleSubmit}>\r\n              <div className=\"tab-content pt-3\">\r\n                {this.state.activeTab === 'co' && (\r\n                  <>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Quote Type</label>\r\n                        <select className=\"form-control form-control-sm\" value={formData.quoteType} onChange={(e) => this.handleInputChange('quoteType', e.target.value)}>\r\n                          <option>Standard</option>\r\n                          <option>Manual</option>\r\n                        </select>\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                      <label>Quote No</label>\r\n                      {formData.quoteType === \"Standard\" ? (\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.quoteNo}\r\n                          readOnly\r\n                          placeholder=\"Auto\"\r\n                        />\r\n                      ) : (\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.quoteNo}\r\n                          onChange={e => this.handleInputChange('quoteNo', e.target.value)}\r\n                          placeholder=\"Enter Quote No\"\r\n                        />\r\n                      )}\r\n                    </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Quote Date</label>\r\n                        <input type=\"date\" className=\"form-control form-control-sm\" value={formData.quoteDate} onChange={(e) => this.handleInputChange('quoteDate', e.target.value)} />\r\n                      </div>\r\n                      \r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Status</label>\r\n                        <input type=\"text\" className=\"form-control form-control-sm\" value={formData.status}   style={{ backgroundColor: '#fff' }} readOnly />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Customer</label>\r\n                        <div className=\"input-group input-group-sm\">\r\n                          <input\r\n                            type=\"text\"\r\n                            className=\"form-control\"\r\n                            placeholder=\"Choose Customer\"\r\n                            ref={this.customerInputRef}\r\n                            value={formData.customer}\r\n                            readOnly\r\n                            onClick={() => this.showOverlay('customer')}\r\n                            style={{ cursor: 'pointer' }}\r\n                          />\r\n                          <div className=\"input-group-append\">\r\n                            <button className=\"btn btn-outline-secondary btn-sm\" type=\"button\" onClick={() => this.showOverlay('customer')}>Select</button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>IMP/EXP</label>\r\n                        <select\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.impExp}\r\n                          onChange={(e) => this.handleInputChange('impExp', e.target.value)}\r\n                        >\r\n                          <option>None</option>\r\n                          <option>COB</option>\r\n                          <option>FOB</option>\r\n                          <option>CIF</option>\r\n                        </select>\r\n                      </div>\r\n                      <div className=\"form-group col-md-2\">\r\n                        <label>Ref No.</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.qrefNo}\r\n                          onChange={(e) => this.handleInputChange('qrefNo', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Choose</label>\r\n                        <div className=\"d-flex align-items-center\">\r\n                          <div className=\"form-check mr-4\">\r\n                            <input type=\"radio\" className=\"form-check-input\" name=\"choose\" id=\"chooseService\" value=\"Service\"\r\n                              checked={formData.choose === 'Service'}\r\n                              onChange={e => this.handleChooseChange(e.target.value)}\r\n                            />\r\n                            <label className=\"form-check-label\" htmlFor=\"chooseService\">Service</label>\r\n                          </div>\r\n                          <div className=\"form-check mr-4\">\r\n                            <input type=\"radio\" className=\"form-check-input\" name=\"choose\" id=\"chooseProduct\" value=\"Product\"\r\n                              checked={formData.choose === 'Product'}\r\n                              onChange={e => this.handleChooseChange(e.target.value)}\r\n                            />\r\n                            <label className=\"form-check-label\" htmlFor=\"chooseProduct\">Product</label>\r\n                          </div>\r\n                          <div className=\"form-check\">\r\n                            <input type=\"radio\" className=\"form-check-input\" name=\"choose\" id=\"chooseBundle\" value=\"Bundle\"\r\n                              checked={formData.choose === 'Bundle'}\r\n                              onChange={e => this.handleChooseChange(e.target.value)}\r\n                            />\r\n                            <label className=\"form-check-label\" htmlFor=\"chooseBundle\">Service+Product</label>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Currency</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.currency}\r\n                          style={{ backgroundColor: '#fff' }}\r\n                          readOnly\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Conversion Rate</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.conversionRate}\r\n                          onChange={(e) => this.handleInputChange('conversionRate', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Tax Amount</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.taxAmount}\r\n                          onChange={(e) => this.handleInputChange('taxAmount', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Quote Value</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.quoteValue}\r\n                          onChange={(e) => this.handleInputChange('quoteValue', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-4\">\r\n                      <label>Discount %</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        className='form-control'\r\n                        value={formData.discountPercent}\r\n                        onChange={e => {\r\n                          this.handleDiscountChange('discountPercent', e.target.value);\r\n                          this.recalculateQuoteTotals();\r\n                        }}\r\n                      />\r\n                    </div>\r\n                    <div className=\"form-group col-md-4\">\r\n                    <label>Discount Amount</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      className=\"form-control\"\r\n                      value={this.state.formData.discountAmount}\r\n                      readOnly\r\n                    />\r\n                  </div>\r\n                  <div className=\"form-group col-md-4\">\r\n                    <label>After Discount - Quote Value</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      className=\"form-control\"\r\n                      value={formData.discountPercent > 0 ? formData.afterDiscountValue : \"\"}\r\n                      readOnly\r\n                      placeholder={formData.discountPercent > 0 ? \"\" : \"Enter Discount %\"}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                          <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n                            <h4 className=\"card-title\">Line Item</h4>\r\n                            <button type=\"button\" className=\"btn btn-primary btn-sm\" onClick={() => this.setState({ productOverlayVisible: true })}>\r\n                              + Add Product\r\n                            </button>\r\n                          </div>\r\n                       <div className=\"table-responsive\">\r\n        <table className=\"table table-bordered\">\r\n          <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Item Code</th>\r\n              <th>Item Desc</th>\r\n              <th>Cust Part No</th>\r\n              <th>HSN No</th>\r\n              <th>UOM</th>\r\n              <th>On Hand</th>\r\n              <th>Unit Price</th>\r\n              <th>Quantity</th>\r\n              <th>Tax Id</th>\r\n              <th>Item Total</th>\r\n             <th>Tax Amount</th>\r\n              <th>Grand Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {formData.lineItems.map((item, idx) => {\r\n              const itemTotal = item.unitPrice * item.qty;\r\n              const taxDetails = getTaxDetailsFromGroup(item.taxGroupName, this.state.taxGroups);\r\n              const taxAmt = (itemTotal * taxDetails.totalPercent / 100) + (itemTotal * taxDetails.totalAmount);\r\n              const totalWithTax = itemTotal + taxAmt;\r\n             \r\n              \r\n              return (\r\n                <tr key={item.id || idx}>\r\n                  <td>{item.itemCode}</td>\r\n                  <td>{item.itemDescription}</td>\r\n                  <td>{item.custPartNo}</td>\r\n                  <td>{item.hsnCode}</td>\r\n                  <td>{item.uom}</td>\r\n                  <td>{item.onHand}</td>\r\n                  <td>\r\n                    <input\r\n                      type=\"number\"\r\n                      value={item.unitPrice}\r\n                      onChange={e => this.handleLineItemChange(idx, 'unitPrice', e.target.value)}\r\n                      style={{ width: 80 }}\r\n                    />\r\n                  </td>\r\n                  <td>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"1\"\r\n                      value={item.qty}\r\n                      onChange={e => this.handleLineItemChange(idx, 'qty', e.target.value)}\r\n                      style={{ width: 60 }}\r\n                    />\r\n                  </td>\r\n                  <td>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn btn-outline-secondary btn-sm btn-rounded btn-icon\"\r\n                    style={{ padding: '2px 6px', fontSize: '12px', lineHeight: '1' }}\r\n                    onClick={() => this.setState({ showTaxOverlay: true, currentTaxLineIdx: idx })}\r\n                  >\r\n                    +\r\n                  </button>\r\n                  <div style={{ fontSize: '13px', marginTop: '4px' }}>\r\n                    {(item.taxGroupNames || []).join(', ') || '-'}\r\n                  </div>\r\n                </td>\r\n                <td>{parseFloat(item.baseTotal || 0).toFixed(2)}</td>\r\n            <td>{parseFloat(item.taxAmt || 0).toFixed(2)}</td>\r\n              <td>{parseFloat(item.itemTotal || 0).toFixed(2)}</td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n                      \r\n                  </>\r\n                )}\r\n                {this.state.activeTab === 'commercial' && (\r\n                  <>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-6\">\r\n                        <label>Bill To</label>\r\n                        <textarea\r\n                          className=\"form-control form-control-sm\"\r\n                          rows=\"3\"\r\n                          value={formData.billTo}\r\n                          onChange={(e) => this.handleInputChange('billTo', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-6\">\r\n                        <label>Ship To</label>\r\n                        <textarea\r\n                          className=\"form-control form-control-sm\"\r\n                          rows=\"3\"\r\n                          value={formData.shipTo}\r\n                          onChange={(e) => this.handleInputChange('shipTo', e.target.value)}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                    <div className=\"form-group col-md-4\">\r\n  <label>Despatch Mode</label>\r\n  <div className=\"input-group input-group-sm\">\r\n    <input\r\n      type=\"text\"\r\n      className=\"form-control\"\r\n      value={formData.despatchMode}\r\n      readOnly\r\n      onClick={() => !isFOB && this.showOverlay('despatchMode')}\r\n      style={{ cursor: isFOB ? 'not-allowed' : 'pointer', backgroundColor: '#fff' }}\r\n    />\r\n    <div className=\"input-group-append\">\r\n      <button\r\n        className=\"btn btn-outline-secondary btn-sm\"\r\n        type=\"button\"\r\n        disabled={isFOB}\r\n        onClick={() => this.showOverlay('despatchMode')}\r\n      >\r\n        Select\r\n      </button>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div className=\"form-group col-md-4\">\r\n  <label>Payment Terms</label>\r\n  <div className=\"input-group input-group-sm\">\r\n    <input\r\n      type=\"text\"\r\n      className=\"form-control\"\r\n      value={formData.paymentTerms}\r\n      readOnly\r\n      onClick={() => !isFOB && this.showOverlay('paymentTerms')}\r\n      style={{ cursor: isFOB ? 'not-allowed' : 'pointer', backgroundColor: '#fff' }}\r\n    />\r\n    <div className=\"input-group-append\">\r\n      <button\r\n        className=\"btn btn-outline-secondary btn-sm\"\r\n        type=\"button\"\r\n        disabled={isFOB}\r\n        onClick={() => this.showOverlay('paymentTerms')}\r\n      >\r\n        Select\r\n      </button>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Freight Charges</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.freightCharges}\r\n                          onChange={(e) => this.handleInputChange('freightCharges', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Tax %</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.taxPercent}\r\n                          onChange={(e) => this.handleInputChange('taxPercent', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Freight Tax Amount</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.freighttaxAmount}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Packing Charges</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.packingCharges}\r\n                          onChange={(e) => this.handleInputChange('packingCharges', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    \r\n                  </>\r\n                )}\r\n                {this.state.activeTab === 'breakdown' && (this.renderBreakdownTab())}\r\n              </div>\r\n              {this.renderSubProductDialog()}\r\n              <div className=\"fixed-card-footer text-right p-3 border-top bg-white\">\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"btn btn-secondary mr-2\"\r\n                  onClick={() => this.setState({ showForm: false, editingId: null })}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button type=\"submit\" className=\"btn btn-success mr-2\">Save All Details</button>\r\n              </div>\r\n            </form>\r\n            {overlayType && this.renderOverlay()}\r\n            {productOverlayVisible && this.renderProductOverlay()}\r\n            {this.state.showTaxOverlay && this.renderTaxOverlay()}\r\n\r\n          </div>\r\n          \r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n renderQuotePreview = () => {\r\n  const q = this.state.selectedQuote;\r\n  const { isApprovalMode } = this.props;\r\n  if (!q) return null;\r\n\r\n  const subtotal = q.lineItems?.reduce(\r\n    (sum, item) => sum + (parseFloat(item.total) || 0),\r\n    0\r\n  ) || 0;\r\n\r\n  const freightCharges = parseFloat(q.freightCharges || 0);\r\n  const taxAmount = parseFloat(q.taxAmount || 0);\r\n  const grandTotal = parseFloat(q.quoteValue || subtotal + freightCharges + taxAmount);\r\n\r\n  const amountWords = `INR ${window.toWords\r\n    ? window.toWords(Math.floor(grandTotal))\r\n    : grandTotal} Only`;\r\n\r\n  const customer = this.state.customers.find(\r\n    c => c.custshortName === q.customer || c.custname === q.customer\r\n  ) || {};\r\n\r\n  return (\r\n    <div className=\"card mt-4 p-4 shadow-sm full-height d-flex flex-column\">\r\n      {/* Header */}\r\n      <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n        <h4 className=\"card-title mb-0\">Quote Preview - {q.quoteNo}</h4>\r\n        <div className=\"flex items-center gap-x-4\">\r\n          <button\r\n            className=\"btn btn-sm btn-primary\"\r\n            onClick={() => this.loadQuoteForEdit(q)}\r\n            disabled={q.status === \"Approved\" || q.status === \"CO Created\"}\r\n          >\r\n            Edit\r\n          </button>\r\n          <button\r\n            className=\"btn btn-sm btn-outline-secondary\"\r\n            onClick={() => this.convertToOrder(q)}\r\n            disabled={q.status !== \"Approved\"}\r\n          >\r\n            Convert to Order\r\n          </button>\r\n              <i\r\n                className=\"mdi mdi-printer menu-icon ml-3\"\r\n                onClick={() => this.showQuotePDFWithOrg(q)}\r\n                style={{ marginBlockStart:'10px', gap:'10px',fontSize: '27px', color: '#2196F3', cursor: 'pointer' }}\r\n              ></i>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Quote Info */}\r\n      <div className=\"row mb-3\">\r\n        <div className=\"col-md-4\"><b>Customer:</b> {q.customer}</div>\r\n        <div className=\"col-md-4\"><b>Date:</b> {q.quoteDate}</div>\r\n        <div className=\"col-md-4\"><b>Status:</b> {q.status}</div>\r\n      </div>\r\n\r\n      <div className=\"row mb-4\">\r\n        <div className=\"col-md-6\">\r\n          <b>Bill To:</b><br />\r\n          {q.billTo || \"-\"}\r\n          <div className=\"mt-2\" style={{ fontSize: \"0.9em\" }}>\r\n            <b>GSTIN:</b> {customer.gstin || \"-\"}<br />\r\n            <b>Email:</b> {customer.email || \"-\"}<br />\r\n            <b>Phone:</b> {customer.phone || \"-\"}\r\n          </div>\r\n        </div>\r\n        <div className=\"col-md-6\">\r\n          <b>Ship To:</b><br />\r\n          {q.shipTo || \"-\"}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Line Items */}\r\n      <h5 className=\"mt-2\">Line Items</h5>\r\n      <table className=\"table table-bordered table-sm\">\r\n        <thead className=\"thead-light\">\r\n          <tr>\r\n            <th>Item Code</th>\r\n            <th>Description</th>\r\n            <th>Qty</th>\r\n            <th>Unit Price</th>\r\n            <th>Total</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {q.lineItems?.map((item, i) => (\r\n            <tr key={i}>\r\n              <td>{item.itemCode}</td>\r\n              <td>{item.itemDescription}</td>\r\n              <td>{item.qty}</td>\r\n              <td>{item.unitPrice}</td>\r\n              <td>{item.total}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      {/* Totals as Text */}\r\n      <div className=\"mt-3\">\r\n        <p><b>Subtotal:</b> {subtotal.toFixed(2)}</p>\r\n        <p><b>Freight Charges:</b> {freightCharges.toFixed(2)}</p>\r\n        <p><b>Tax Amount:</b> {taxAmount.toFixed(2)}</p>\r\n        <p className=\"h6\"><b>Grand Total:</b> {grandTotal.toFixed(2)}</p>\r\n        <p className=\"h6\"><b>Amount in Words:</b> {amountWords}</p>\r\n      </div>\r\n       <div className=\"mt-auto pt-3 text-right\">\r\n        {!isApprovalMode ? (\r\n          <>\r\n            \r\n            \r\n            <button\r\n              className=\"btn btn-secondary\"\r\n              onClick={() => this.setState({ previewMode: false })}\r\n            >\r\n              Back to List\r\n            </button>\r\n          </>\r\n            ) : (\r\n          <>\r\n            <button\r\n              className=\"btn btn-success mr-2\"\r\n              onClick={() => this.updateStatus(q.id, \"Approved\")}\r\n              disabled={q.status === \"Approved\" || q.status === \"CO Created\"}\r\n            >\r\n              Approve\r\n            </button>\r\n            <button\r\n              className=\"btn btn-danger mr-2\"\r\n              onClick={() => this.updateStatus(q.id, \"Rejected\")}\r\n              disabled={q.status === \"Rejected\" || q.status === \"CO Created\"}\r\n            >\r\n              Reject\r\n            </button>\r\n            <button\r\n              className=\"btn btn-secondary\"\r\n              onClick={() => this.setState({ previewMode: false })}\r\n            >\r\n              Back to List\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n  \r\n};\r\n\r\n\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        {this.state.previewMode? this.renderQuotePreview(): this.state.showForm ? this.renderQuoteForm() : this.renderQuoteTable()}\r\n        \r\n\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(Quote);\r\n"]},"metadata":{},"sourceType":"module"}