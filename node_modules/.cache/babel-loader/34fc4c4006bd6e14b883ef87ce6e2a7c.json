{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\psp\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\invoice\\\\tpbill\\\\ThirdPartyBillingApproval.js\";\n// ThirdPartyBillingApproval.js\nimport React, { Component } from \"react\";\nimport { db } from \"../../../../../firebase\";\nimport { collection, getDocs, updateDoc, doc, serverTimestamp } from \"firebase/firestore\";\n\nclass ThirdPartyBillingApproval extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      bills: [],\n      selected: null,\n      formData: null,\n      loading: false,\n      showRejectDialog: false,\n      rejectReason: \"\",\n      taxGroups: []\n    };\n\n    this.fetchBills = async () => {\n      const snap = await getDocs(collection(db, \"thirdPartyBills\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        bills: data.reverse()\n      });\n    };\n\n    this.fetchTaxGroups = async () => {\n      const snap = await getDocs(collection(db, \"taxGroups\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        taxGroups: data\n      });\n    };\n\n    this.openPreview = bill => {\n      const copy = JSON.parse(JSON.stringify(bill || {}));\n      this.setState({\n        selected: bill,\n        formData: copy\n      });\n    };\n\n    this.closePreview = () => this.setState({\n      selected: null,\n      formData: null,\n      showRejectDialog: false,\n      rejectReason: \"\"\n    });\n\n    this.handleInputChange = (field, value) => this.setState(prev => ({\n      formData: { ...prev.formData,\n        [field]: value\n      }\n    }));\n\n    this.handleLineItemChange = (idx, field, value) => {\n      const items = [...(this.state.formData.lineItems || [])];\n      items[idx] = { ...items[idx],\n        [field]: value\n      };\n      const qty = parseFloat(items[idx].qty || 0);\n      const unitPrice = parseFloat(items[idx].unitPrice || 0);\n      items[idx].itemTotal = (qty * unitPrice).toFixed(2);\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: items\n        }\n      }));\n    };\n\n    this.recalcTotals = () => {\n      const f = this.state.formData || {};\n      let total = 0;\n      const tgMap = this.state.taxGroups.reduce((m, tg) => {\n        m[tg.id || tg.name] = tg;\n        return m;\n      }, {});\n      const items = (f.lineItems || []).map(it => {\n        const itemTotal = parseFloat(it.itemTotal || 0);\n        const tg = it.taxGroup ? tgMap[it.taxGroup] || {} : {};\n        const pct = parseFloat(tg.percentage || 0);\n        const taxAmt = itemTotal * pct / 100;\n        total += itemTotal + taxAmt;\n        return { ...it,\n          taxAmt: taxAmt.toFixed(2)\n        };\n      });\n      if (f.conversionRate) total = total * parseFloat(f.conversionRate || 1);\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: items,\n          totalValue: total ? total.toFixed(2) : \"0.00\"\n        }\n      }));\n    };\n\n    this.saveChanges = async (setAwaiting = true) => {\n      const {\n        selected,\n        formData\n      } = this.state;\n      if (!selected || !formData) return;\n      this.setState({\n        loading: true\n      });\n\n      try {\n        const cRef = doc(db, \"thirdPartyBills\", selected.id);\n        const updatePayload = { ...formData,\n          updatedAt: serverTimestamp()\n        };\n        if (setAwaiting) updatePayload.status = \"Awaiting Approval\";\n        await updateDoc(cRef, updatePayload);\n        await this.fetchBills();\n        this.openPreview({ ...formData,\n          id: selected.id\n        });\n        alert(\"Saved.\");\n      } catch (err) {\n        console.error(err);\n        alert(\"Error saving: \" + err.message);\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this.approve = async () => {\n      const {\n        selected,\n        formData\n      } = this.state;\n      if (!selected || !formData) return;\n      if (!window.confirm(`Approve ${formData.billNo || selected.billNo}?`)) return;\n      this.setState({\n        loading: true\n      });\n\n      try {\n        const cRef = doc(db, \"thirdPartyBills\", selected.id);\n        await updateDoc(cRef, { ...formData,\n          status: \"Approved\",\n          approvedAt: serverTimestamp(),\n          updatedAt: serverTimestamp()\n        });\n        alert(\"Approved.\");\n        await this.fetchBills();\n        this.closePreview();\n      } catch (err) {\n        console.error(err);\n        alert(\"Error approving: \" + err.message);\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this.openRejectDialog = () => this.setState({\n      showRejectDialog: true,\n      rejectReason: \"\"\n    });\n\n    this.closeRejectDialog = () => this.setState({\n      showRejectDialog: false,\n      rejectReason: \"\"\n    });\n\n    this.handleRejectConfirm = async () => {\n      const {\n        selected,\n        formData,\n        rejectReason\n      } = this.state;\n      if (!selected) return;\n\n      if (!rejectReason || !rejectReason.trim()) {\n        alert(\"Please enter a reason for rejection.\");\n        return;\n      }\n\n      this.setState({\n        loading: true\n      });\n\n      try {\n        const cRef = doc(db, \"thirdPartyBills\", selected.id);\n        await updateDoc(cRef, { ...formData,\n          status: \"Rejected\",\n          rejectReason,\n          rejectedAt: serverTimestamp(),\n          updatedAt: serverTimestamp()\n        });\n        alert(\"Rejected.\");\n        await this.fetchBills();\n        this.closePreview();\n      } catch (err) {\n        console.error(err);\n        alert(\"Error rejecting: \" + err.message);\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this.getStatusBadge = status => {\n      let cls = \"badge-secondary\";\n      if (!status) status = \"Entered\";\n      if (status === \"Awaiting Approval\" || status === \"Entered\") cls = \"badge-warning\";else if (status === \"Approved\") cls = \"badge-success\";else if (status === \"Rejected\") cls = \"badge-success\";else if (status === \"Partial\") cls = \"badge-purple\";else if (status === \"Completed\") cls = \"badge-info\";\n      return /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${cls}`,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 12\n        }\n      }, status);\n    };\n\n    this.renderRejectDialog = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay-content\",\n      style: {\n        width: 420\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 9\n      }\n    }, \"Reject Reason\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control\",\n      rows: 3,\n      value: this.state.rejectReason,\n      onChange: e => this.setState({\n        rejectReason: e.target.value\n      }),\n      placeholder: \"Enter reason for rejection\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mt-3 text-right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-secondary mr-2\",\n      onClick: this.closeRejectDialog,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 11\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-danger\",\n      onClick: this.handleRejectConfirm,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }\n    }, \"Reject\"))));\n\n    this.renderPreview = () => {\n      const f = this.state.formData;\n      if (!f) return null;\n      const items = f.lineItems || [];\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card p-4 full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 9\n        }\n      }, \"Third Party Billing - Approval\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 37\n        }\n      }, \"Bill No:\"), \" \", f.billNo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 37\n        }\n      }, \"Date:\"), \" \", /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"date\",\n        value: f.billDate,\n        onChange: e => this.handleInputChange('billDate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 50\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 37\n        }\n      }, \"Vendor:\"), \" \", /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.vendorName,\n        onChange: e => this.handleInputChange('vendorName', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 52\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 37\n        }\n      }, \"Status:\"), \" \", this.getStatusBadge(f.status))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 13\n        }\n      }, \"Ref No\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.refNo,\n        onChange: e => this.handleInputChange('refNo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }\n      }, \"Currency\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.currency,\n        onChange: e => this.handleInputChange('currency', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 13\n        }\n      }, \"Conversion Rate\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"number\",\n        value: f.conversionRate,\n        onChange: e => this.handleInputChange('conversionRate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 9\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"table-responsive\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 20\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 24\n        }\n      }, \"Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 37\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 57\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 69\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 88\n        }\n      }, \"Item Total\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 107\n        }\n      }, \"Tax\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 13\n        }\n      }, items.map((it, idx) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: idx,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: it.serviceCode,\n        onChange: e => this.handleLineItemChange(idx, 'serviceCode', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: it.description,\n        onChange: e => this.handleLineItemChange(idx, 'description', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"number\",\n        value: it.qty,\n        onChange: e => this.handleLineItemChange(idx, 'qty', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"number\",\n        value: it.unitPrice,\n        onChange: e => this.handleLineItemChange(idx, 'unitPrice', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 19\n        }\n      }, it.itemTotal), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 19\n        }\n      }, it.taxAmt || \"0.00\"))), items.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 38\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: 6,\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 42\n        }\n      }, \"No items\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-auto pt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary mr-2\",\n        onClick: () => {\n          this.recalcTotals();\n          this.saveChanges(true);\n        },\n        disabled: this.state.loading,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 11\n        }\n      }, \"Save (Send for Approval)\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success mr-2\",\n        onClick: this.approve,\n        disabled: this.state.loading || f.status === \"Approved\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 11\n        }\n      }, \"Approve\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-danger mr-2\",\n        onClick: this.openRejectDialog,\n        disabled: this.state.loading || f.status === \"Rejected\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }\n      }, \"Reject\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: this.closePreview,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }\n      }, \"Back to List\")), this.state.showRejectDialog && this.renderRejectDialog());\n    };\n\n    this.renderTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card full-height mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }\n    }, \"Third Party Billing Approvals\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 19\n      }\n    }, \"Bill No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 35\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 48\n      }\n    }, \"Vendor\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 63\n      }\n    }, \"Total\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 77\n      }\n    }, \"Status\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 13\n      }\n    }, this.state.bills.map(b => /*#__PURE__*/React.createElement(\"tr\", {\n      key: b.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-link p-0\",\n      onClick: () => this.openPreview(b),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 23\n      }\n    }, b.billNo)), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 19\n      }\n    }, b.billDate), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 19\n      }\n    }, b.vendorName), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 19\n      }\n    }, b.totalValue), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 19\n      }\n    }, this.getStatusBadge(b.status)))), this.state.bills.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 49\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      colSpan: 5,\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 53\n      }\n    }, \"No records\")))))));\n  }\n\n  componentDidMount() {\n    this.fetchBills();\n    this.fetchTaxGroups();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 12\n      }\n    }, this.state.selected ? this.renderPreview() : this.renderTable());\n  }\n\n}\n\nexport default ThirdPartyBillingApproval;","map":{"version":3,"sources":["C:/Users/College/psp/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/invoice/tpbill/ThirdPartyBillingApproval.js"],"names":["React","Component","db","collection","getDocs","updateDoc","doc","serverTimestamp","ThirdPartyBillingApproval","state","bills","selected","formData","loading","showRejectDialog","rejectReason","taxGroups","fetchBills","snap","data","docs","map","d","id","setState","reverse","fetchTaxGroups","openPreview","bill","copy","JSON","parse","stringify","closePreview","handleInputChange","field","value","prev","handleLineItemChange","idx","items","lineItems","qty","parseFloat","unitPrice","itemTotal","toFixed","recalcTotals","f","total","tgMap","reduce","m","tg","name","it","taxGroup","pct","percentage","taxAmt","conversionRate","totalValue","saveChanges","setAwaiting","cRef","updatePayload","updatedAt","status","alert","err","console","error","message","approve","window","confirm","billNo","approvedAt","openRejectDialog","closeRejectDialog","handleRejectConfirm","trim","rejectedAt","getStatusBadge","cls","fontSize","renderRejectDialog","width","e","target","renderPreview","billDate","vendorName","refNo","currency","serviceCode","description","length","renderTable","b","componentDidMount","render"],"mappings":"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","sourcesContent":["// ThirdPartyBillingApproval.js\r\nimport React, { Component } from \"react\";\r\nimport { db } from \"../../../../../firebase\";\r\nimport {\r\n  collection,\r\n  getDocs,\r\n  updateDoc,\r\n  doc,\r\n  serverTimestamp,\r\n} from \"firebase/firestore\";\r\n\r\nclass ThirdPartyBillingApproval extends Component {\r\n  state = {\r\n    bills: [],\r\n    selected: null,\r\n    formData: null,\r\n    loading: false,\r\n    showRejectDialog: false,\r\n    rejectReason: \"\",\r\n    taxGroups: [],\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.fetchBills();\r\n    this.fetchTaxGroups();\r\n  }\r\n\r\n  fetchBills = async () => {\r\n    const snap = await getDocs(collection(db, \"thirdPartyBills\"));\r\n    const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));\r\n    this.setState({ bills: data.reverse() });\r\n  };\r\n\r\n  fetchTaxGroups = async () => {\r\n    const snap = await getDocs(collection(db, \"taxGroups\"));\r\n    const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n    this.setState({ taxGroups: data });\r\n  };\r\n\r\n  openPreview = (bill) => {\r\n    const copy = JSON.parse(JSON.stringify(bill || {}));\r\n    this.setState({ selected: bill, formData: copy });\r\n  };\r\n\r\n  closePreview = () => this.setState({ selected: null, formData: null, showRejectDialog: false, rejectReason: \"\" });\r\n\r\n  handleInputChange = (field, value) => this.setState(prev => ({ formData: { ...prev.formData, [field]: value } }));\r\n\r\n  handleLineItemChange = (idx, field, value) => {\r\n    const items = [...(this.state.formData.lineItems || [])];\r\n    items[idx] = { ...items[idx], [field]: value };\r\n    const qty = parseFloat(items[idx].qty || 0);\r\n    const unitPrice = parseFloat(items[idx].unitPrice || 0);\r\n    items[idx].itemTotal = (qty * unitPrice).toFixed(2);\r\n    this.setState(prev => ({ formData: { ...prev.formData, lineItems: items } }));\r\n  };\r\n\r\n  recalcTotals = () => {\r\n    const f = this.state.formData || {};\r\n    let total = 0;\r\n    const tgMap = this.state.taxGroups.reduce((m, tg) => { m[tg.id || tg.name] = tg; return m; }, {});\r\n    const items = (f.lineItems || []).map(it => {\r\n      const itemTotal = parseFloat(it.itemTotal || 0);\r\n      const tg = it.taxGroup ? (tgMap[it.taxGroup] || {}) : {};\r\n      const pct = parseFloat(tg.percentage || 0);\r\n      const taxAmt = (itemTotal * pct) / 100;\r\n      total += itemTotal + taxAmt;\r\n      return { ...it, taxAmt: taxAmt.toFixed(2) };\r\n    });\r\n    if (f.conversionRate) total = total * parseFloat(f.conversionRate || 1);\r\n    this.setState(prev => ({ formData: { ...prev.formData, lineItems: items, totalValue: total ? total.toFixed(2) : \"0.00\" } }));\r\n  };\r\n\r\n  saveChanges = async (setAwaiting = true) => {\r\n    const { selected, formData } = this.state;\r\n    if (!selected || !formData) return;\r\n    this.setState({ loading: true });\r\n    try {\r\n      const cRef = doc(db, \"thirdPartyBills\", selected.id);\r\n      const updatePayload = { ...formData, updatedAt: serverTimestamp() };\r\n      if (setAwaiting) updatePayload.status = \"Awaiting Approval\";\r\n      await updateDoc(cRef, updatePayload);\r\n      await this.fetchBills();\r\n      this.openPreview({ ...formData, id: selected.id });\r\n      alert(\"Saved.\");\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Error saving: \" + err.message);\r\n    } finally {\r\n      this.setState({ loading: false });\r\n    }\r\n  };\r\n\r\n  approve = async () => {\r\n    const { selected, formData } = this.state;\r\n    if (!selected || !formData) return;\r\n    if (!window.confirm(`Approve ${formData.billNo || selected.billNo}?`)) return;\r\n    this.setState({ loading: true });\r\n    try {\r\n      const cRef = doc(db, \"thirdPartyBills\", selected.id);\r\n      await updateDoc(cRef, { ...formData, status: \"Approved\", approvedAt: serverTimestamp(), updatedAt: serverTimestamp() });\r\n      alert(\"Approved.\");\r\n      await this.fetchBills();\r\n      this.closePreview();\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Error approving: \" + err.message);\r\n    } finally {\r\n      this.setState({ loading: false });\r\n    }\r\n  };\r\n\r\n  openRejectDialog = () => this.setState({ showRejectDialog: true, rejectReason: \"\" });\r\n  closeRejectDialog = () => this.setState({ showRejectDialog: false, rejectReason: \"\" });\r\n\r\n  handleRejectConfirm = async () => {\r\n    const { selected, formData, rejectReason } = this.state;\r\n    if (!selected) return;\r\n    if (!rejectReason || !rejectReason.trim()) {\r\n      alert(\"Please enter a reason for rejection.\");\r\n      return;\r\n    }\r\n    this.setState({ loading: true });\r\n    try {\r\n      const cRef = doc(db, \"thirdPartyBills\", selected.id);\r\n      await updateDoc(cRef, { ...formData, status: \"Rejected\", rejectReason, rejectedAt: serverTimestamp(), updatedAt: serverTimestamp() });\r\n      alert(\"Rejected.\");\r\n      await this.fetchBills();\r\n      this.closePreview();\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Error rejecting: \" + err.message);\r\n    } finally {\r\n      this.setState({ loading: false });\r\n    }\r\n  };\r\n\r\n  getStatusBadge = (status) => {\r\n    let cls = \"badge-secondary\";\r\n    if (!status) status = \"Entered\";\r\n    if (status === \"Awaiting Approval\" || status === \"Entered\") cls = \"badge-warning\";\r\n    else if (status === \"Approved\") cls = \"badge-success\";\r\n    else if (status === \"Rejected\") cls = \"badge-success\";\r\n    else if (status === \"Partial\") cls = \"badge-purple\";\r\n    else if (status === \"Completed\") cls = \"badge-info\";\r\n    return <label className={`badge ${cls}`} style={{ fontSize: '14px' }}>{status}</label>;\r\n  };\r\n\r\n  renderRejectDialog = () => (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\" style={{ width: 420 }}>\r\n        <h5>Reject Reason</h5>\r\n        <textarea className=\"form-control\" rows={3} value={this.state.rejectReason} onChange={e => this.setState({ rejectReason: e.target.value })} placeholder=\"Enter reason for rejection\" />\r\n        <div className=\"mt-3 text-right\">\r\n          <button className=\"btn btn-secondary mr-2\" onClick={this.closeRejectDialog}>Cancel</button>\r\n          <button className=\"btn btn-danger\" onClick={this.handleRejectConfirm}>Reject</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderPreview = () => {\r\n    const f = this.state.formData;\r\n    if (!f) return null;\r\n    const items = f.lineItems || [];\r\n    return (\r\n      <div className=\"card p-4 full-height d-flex flex-column\">\r\n        <h4>Third Party Billing - Approval</h4>\r\n\r\n        <div className=\"row mb-2\">\r\n          <div className=\"col-md-3\"><b>Bill No:</b> {f.billNo}</div>\r\n          <div className=\"col-md-3\"><b>Date:</b> <input className=\"form-control\" type=\"date\" value={f.billDate} onChange={e => this.handleInputChange('billDate', e.target.value)} /></div>\r\n          <div className=\"col-md-3\"><b>Vendor:</b> <input className=\"form-control\" value={f.vendorName} onChange={e => this.handleInputChange('vendorName', e.target.value)} /></div>\r\n          <div className=\"col-md-3\"><b>Status:</b> {this.getStatusBadge(f.status)}</div>\r\n        </div>\r\n\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Ref No</label>\r\n            <input className=\"form-control\" value={f.refNo} onChange={e => this.handleInputChange('refNo', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Currency</label>\r\n            <input className=\"form-control\" value={f.currency} onChange={e => this.handleInputChange('currency', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Conversion Rate</label>\r\n            <input className=\"form-control\" type=\"number\" value={f.conversionRate} onChange={e => this.handleInputChange('conversionRate', e.target.value)} />\r\n          </div>\r\n        </div>\r\n\r\n        <h5 className=\"mt-3\">Line Items</h5>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-sm\">\r\n            <thead><tr><th>Code</th><th>Description</th><th>Qty</th><th>Unit Price</th><th>Item Total</th><th>Tax</th></tr></thead>\r\n            <tbody>\r\n              {items.map((it, idx) => (\r\n                <tr key={idx}>\r\n                  <td><input className=\"form-control\" value={it.serviceCode} onChange={e => this.handleLineItemChange(idx, 'serviceCode', e.target.value)} /></td>\r\n                  <td><input className=\"form-control\" value={it.description} onChange={e => this.handleLineItemChange(idx, 'description', e.target.value)} /></td>\r\n                  <td><input className=\"form-control\" type=\"number\" value={it.qty} onChange={e => this.handleLineItemChange(idx, 'qty', e.target.value)} /></td>\r\n                  <td><input className=\"form-control\" type=\"number\" value={it.unitPrice} onChange={e => this.handleLineItemChange(idx, 'unitPrice', e.target.value)} /></td>\r\n                  <td>{it.itemTotal}</td>\r\n                  <td>{it.taxAmt || \"0.00\"}</td>\r\n                </tr>\r\n              ))}\r\n              {items.length === 0 && <tr><td colSpan={6} className=\"text-center\">No items</td></tr>}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"mt-auto pt-3 text-right\">\r\n          <button className=\"btn btn-secondary mr-2\" onClick={() => { this.recalcTotals(); this.saveChanges(true); }} disabled={this.state.loading}>Save (Send for Approval)</button>\r\n          <button className=\"btn btn-success mr-2\" onClick={this.approve} disabled={this.state.loading || f.status === \"Approved\"}>Approve</button>\r\n          <button className=\"btn btn-danger mr-2\" onClick={this.openRejectDialog} disabled={this.state.loading || f.status === \"Rejected\"}>Reject</button>\r\n          <button className=\"btn btn-secondary\" onClick={this.closePreview}>Back to List</button>\r\n        </div>\r\n\r\n        {this.state.showRejectDialog && this.renderRejectDialog()}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderTable = () => (\r\n    <div className=\"card full-height mt-3\">\r\n      <div className=\"card-body\">\r\n        <h4>Third Party Billing Approvals</h4>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr><th>Bill No</th><th>Date</th><th>Vendor</th><th>Total</th><th>Status</th></tr>\r\n            </thead>\r\n            <tbody>\r\n              {this.state.bills.map(b => (\r\n                <tr key={b.id}>\r\n                  <td><button className=\"btn btn-link p-0\" onClick={() => this.openPreview(b)}>{b.billNo}</button></td>\r\n                  <td>{b.billDate}</td>\r\n                  <td>{b.vendorName}</td>\r\n                  <td>{b.totalValue}</td>\r\n                  <td>{this.getStatusBadge(b.status)}</td>\r\n                </tr>\r\n              ))}\r\n              {this.state.bills.length === 0 && <tr><td colSpan={5} className=\"text-center\">No records</td></tr>}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  render() {\r\n    return <div className=\"container-fluid\">{this.state.selected ? this.renderPreview() : this.renderTable()}</div>;\r\n  }\r\n}\r\n\r\nexport default ThirdPartyBillingApproval;\r\n"]},"metadata":{},"sourceType":"module"}