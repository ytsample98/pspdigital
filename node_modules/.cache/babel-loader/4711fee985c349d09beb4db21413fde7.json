{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\admin\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\invoice\\\\CustomerOrderBilling.js\";\nimport React, { Component } from 'react';\nimport { db } from '../../../../firebase';\nimport { jsPDF } from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { toWords } from 'number-to-words';\nimport { runTransaction, getDoc, query, where } from 'firebase/firestore';\nimport { collection, getDocs, addDoc, updateDoc, doc, serverTimestamp, onSnapshot } from 'firebase/firestore';\nconst amount = 12345678;\nconst amountWords = `INR ${toWords(amount)} Only`;\n\nclass CustomerOrderBilling extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      cobilling: [],\n      orders: [],\n      customers: [],\n      taxGroups: [],\n      despatchModes: [],\n      paymentTerms: [],\n      activeTab: 0,\n      showForm: false,\n      editingId: null,\n      showOrderOverlay: false,\n      orderOverlaySearch: '',\n      showTaxOverlay: false,\n      currentTaxIdx: null,\n      notes: '',\n      searchTerm: '',\n      formData: this.getEmptyCOBillingForm()\n    };\n\n    this.getBilledQtyMap = async orderNo => {\n      const snap = await getDocs(collection(db, 'cobilling'));\n      const approved = snap.docs.map(doc => doc.data()).filter(inv => inv.customerOrderId === orderNo && inv.status === \"Approved\"); // Map: itemCode -> total billed qty\n\n      const billedQtyMap = {};\n      approved.forEach(inv => {\n        (inv.lineItems || []).forEach(item => {\n          const code = item.itemCode;\n          const qty = parseFloat(item.qty || 0);\n          billedQtyMap[code] = (billedQtyMap[code] || 0) + qty;\n        });\n      });\n      return billedQtyMap;\n    };\n\n    this.subscribeToCOBilling = () => {\n      this._unsubCOB = onSnapshot(collection(db, 'cobilling'), snap => {\n        const data = snap.docs.map(doc => ({\n          id: doc.id,\n          ...doc.data()\n        }));\n        data.sort((a, b) => {\n          var _a$createdAt, _a$createdAt$toDate, _b$createdAt, _b$createdAt$toDate;\n\n          const dateA = new Date(a.cobillingDate || ((_a$createdAt = a.createdAt) === null || _a$createdAt === void 0 ? void 0 : (_a$createdAt$toDate = _a$createdAt.toDate) === null || _a$createdAt$toDate === void 0 ? void 0 : _a$createdAt$toDate.call(_a$createdAt)) || a.createdAt || 0);\n          const dateB = new Date(b.cobillingDate || ((_b$createdAt = b.createdAt) === null || _b$createdAt === void 0 ? void 0 : (_b$createdAt$toDate = _b$createdAt.toDate) === null || _b$createdAt$toDate === void 0 ? void 0 : _b$createdAt$toDate.call(_b$createdAt)) || b.createdAt || 0);\n          return dateB - dateA;\n        });\n        this.setState({\n          cobilling: data.reverse()\n        });\n      }, err => {\n        console.error('cobilling snapshot error', err);\n      });\n    };\n\n    this.fetchCOBilling = async () => {\n      const snap = await getDocs(collection(db, 'cobilling'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      data.sort((a, b) => {\n        var _a$createdAt2, _a$createdAt2$toDate, _b$createdAt2, _b$createdAt2$toDate;\n\n        const dateA = new Date(a.cobillingDate || ((_a$createdAt2 = a.createdAt) === null || _a$createdAt2 === void 0 ? void 0 : (_a$createdAt2$toDate = _a$createdAt2.toDate) === null || _a$createdAt2$toDate === void 0 ? void 0 : _a$createdAt2$toDate.call(_a$createdAt2)) || a.createdAt || 0);\n        const dateB = new Date(b.cobillingDate || ((_b$createdAt2 = b.createdAt) === null || _b$createdAt2 === void 0 ? void 0 : (_b$createdAt2$toDate = _b$createdAt2.toDate) === null || _b$createdAt2$toDate === void 0 ? void 0 : _b$createdAt2$toDate.call(_b$createdAt2)) || b.createdAt || 0);\n        return dateB - dateA;\n      });\n      this.setState({\n        cobilling: data.reverse()\n      });\n    };\n\n    this.fetchOrders = async () => {\n      const snap = await getDocs(collection(db, 'orders'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        orders: data.reverse()\n      });\n    };\n\n    this.fetchCustomers = async () => {\n      const snap = await getDocs(collection(db, 'customers'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        customers: data\n      });\n    };\n\n    this.fetchTaxGroups = async () => {\n      const snap = await getDocs(collection(db, 'taxGroups'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        taxGroups: data\n      });\n    };\n\n    this.fetchDespatchModes = async () => {\n      const snap = await getDocs(collection(db, 'modes'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        despatchModes: data\n      });\n    };\n\n    this.fetchPaymentTerms = async () => {\n      const snap = await getDocs(collection(db, 'paymentTerms'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        paymentTerms: data\n      });\n    };\n\n    this.showOrderOverlay = () => this.setState({\n      showOrderOverlay: true,\n      orderOverlaySearch: ''\n    });\n\n    this.hideOrderOverlay = () => this.setState({\n      showOrderOverlay: false,\n      orderOverlaySearch: ''\n    });\n\n    this.selectOrderForInvoice = async order => {\n      const customerObj = this.state.customers.find(c => c.custname === order.customer || c.custcode === order.customer);\n      const billedQtyMap = await this.getBilledQtyMap(order.orderNo);\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          customerOrderId: order.orderNo,\n          customerOrderCompany: order.customer,\n          customerOrderDate: order.orderDate,\n          customer: order.customer,\n          customerCode: customerObj ? customerObj.custcode : '',\n          refNo: order.orderNo,\n          discountPercent: order.discountPercent || 0,\n          discountAmount: order.discountAmount || 0,\n          afterDiscountValue: order.afterDiscountValue || 0,\n          billTo: customerObj ? this.formatAddress(customerObj.billTo) : '',\n          shipTo: customerObj ? this.formatAddress(customerObj.shipTo) : '',\n          currency: customerObj ? customerObj.currency || '' : '',\n          despatchMode: order.despatchMode || '',\n          paymentTerms: order.paymentTerms || '',\n          freightCharges: order.freightCharges || '',\n          freighttaxAmount: order.freighttaxAmount || '',\n          packingCharges: order.packingCharges || '',\n          lineItems: (order.lineItems || []).map(item => {\n            const alreadyBilled = billedQtyMap[item.itemCode] || 0;\n            const orderQty = parseFloat(item.qty || item.orderQty || 0);\n            const recvQty = Math.max(orderQty - alreadyBilled, 0);\n            return {\n              itemCode: item.itemCode || '',\n              itemDescription: item.itemDescription || '',\n              custPartCode: item.custPartCode || '',\n              hsnCode: item.hsnCode || '',\n              locator: item.locator || '',\n              uom: item.uom || '',\n              onHand: item.onHand || 0,\n              unitPrice: item.unitPrice || 0,\n              orderQty: orderQty,\n              recvQty: recvQty,\n              // remaining to bill\n              qty: '',\n              // user will enter this\n              taxGroupNames: item.taxGroupNames || [],\n              taxAmt: item.taxAmt || 0,\n              total: this.calcItemTotal('', item.unitPrice || 0, item.taxAmt || 0)\n            };\n          })\n        },\n        showOrderOverlay: false\n      }));\n    };\n\n    this.recalculateDiscounts = () => {\n      const {\n        billValue,\n        discountPercent\n      } = this.state.formData;\n      const discountAmount = parseFloat(billValue || 0) * parseFloat(discountPercent || 0) / 100;\n      const afterDiscountValue = parseFloat(billValue || 0) - discountAmount; // add, not subtract\n\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          discountAmount: discountAmount.toFixed(2),\n          afterDiscountValue: afterDiscountValue.toFixed(2)\n        }\n      }));\n    };\n\n    this.formatAddress = addr => {\n      if (!addr) return '';\n      if (typeof addr === 'string') return addr;\n      return [addr.address, [addr.city, addr.state, addr.country].filter(Boolean).join(', '), addr.zip].filter(Boolean).join('\\n');\n    };\n\n    this.handleInputChange = (field, value) => {\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          [field]: value\n        }\n      }));\n    };\n\n    this.handleLineItemChange = (idx, field, value) => {\n      const updatedItems = [...this.state.formData.lineItems];\n      let val = value;\n\n      if (field === 'qty') {\n        const maxQty = parseFloat(updatedItems[idx].recvQty || 0);\n        val = Math.max(0, Math.min(parseFloat(value || 0), maxQty));\n      }\n\n      updatedItems[idx] = { ...updatedItems[idx],\n        [field]: val\n      };\n\n      if (field === 'qty' || field === 'unitPrice') {\n        // recalculate taxAmt and total\n        const taxAmt = this.calcTaxAmt(updatedItems[idx]);\n        updatedItems[idx].taxAmt = taxAmt;\n        updatedItems[idx].total = this.calcItemTotal(val, updatedItems[idx].unitPrice, taxAmt);\n      }\n\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: updatedItems\n        }\n      }), this.recalculateBillTotals);\n    };\n\n    this.approveInvoice = async invoiceId => {\n      const invoiceRef = doc(db, \"cobilling\", invoiceId);\n      const invoiceSnap = await getDoc(invoiceRef);\n      if (!invoiceSnap.exists()) return alert(\"Invoice not found!\");\n      const invoice = invoiceSnap.data();\n      const orderSnap = await getDocs(query(collection(db, \"orders\"), where(\"orderNo\", \"==\", invoice.customerOrderId)));\n      if (orderSnap.empty) return alert(\"Order not found!\");\n      const orderDoc = orderSnap.docs[0];\n      const orderRef = doc(db, \"orders\", orderDoc.id);\n      await runTransaction(db, async transaction => {\n        const orderData = (await transaction.get(orderRef)).data();\n        const updatedLineItems = (orderData.lineItems || []).map(item => {\n          const invItem = (invoice.lineItems || []).find(li => li.itemCode === item.itemCode);\n          const billedQty = parseFloat(item.billedQty || 0);\n          const addQty = invItem ? parseFloat(invItem.qty || 0) : 0;\n          const orderQty = parseFloat(item.qty || item.orderQty || 0);\n          const newBilledQty = billedQty + addQty;\n          return { ...item,\n            billedQty: newBilledQty,\n            status: newBilledQty >= orderQty ? \"Completed\" : \"Partial\"\n          };\n        });\n        const allCompleted = updatedLineItems.every(li => parseFloat(li.billedQty || 0) >= parseFloat(li.qty || li.orderQty || 0));\n        transaction.update(orderRef, {\n          lineItems: updatedLineItems,\n          status: allCompleted ? \"Completed\" : \"Partial\"\n        });\n        transaction.update(invoiceRef, {\n          status: \"Approved\"\n        });\n      });\n      alert(\"Invoice approved and order updated!\");\n      this.fetchCOBilling();\n      this.fetchOrders();\n    };\n\n    this.recalculateBillTotals = () => {\n      const {\n        lineItems\n      } = this.state.formData;\n      let taxAmount = 0;\n      let billValue = 0;\n      (lineItems || []).forEach(item => {\n        taxAmount += parseFloat(item.taxAmt || 0);\n        billValue += parseFloat(item.total || 0);\n      });\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          taxAmount: taxAmount.toFixed(2),\n          billValue: billValue.toFixed(2)\n        }\n      }), this.recalculateDiscounts); // <-- add this\n    };\n\n    this.calcTaxAmt = item => {\n      // Calculate tax based on selected tax group, unit price, qty\n      let percent = 0;\n      let amount = 0;\n      (item.taxGroupNames || []).forEach(groupName => {\n        const group = this.state.taxGroups.find(t => t.groupName === groupName);\n\n        if (group && Array.isArray(group.lineItems)) {\n          group.lineItems.forEach(comp => {\n            const val = parseFloat(comp.percentOrAmt || 0);\n            if (comp.type === 'Percentage') percent += val;\n            if (comp.type === 'Amount') amount += val;\n          });\n        }\n      });\n      const baseTotal = parseFloat(item.unitPrice || 0) * parseFloat(item.qty || 1);\n      return (baseTotal * percent / 100 + amount).toFixed(2);\n    };\n\n    this.calcItemTotal = (qty, unitPrice, taxAmt) => {\n      qty = parseFloat(qty) || 0;\n      unitPrice = parseFloat(unitPrice) || 0;\n      taxAmt = parseFloat(taxAmt) || 0;\n      return (qty * unitPrice + taxAmt).toFixed(2);\n    };\n\n    this.showCoBillingPDFWithOrg = async invoice => {\n      var _orgSnap$docs$, _invoice$billTo, _invoice$shipTo;\n\n      if (!invoice || !Array.isArray(invoice.lineItems) || invoice.lineItems.length === 0) {\n        alert(\"Invoice data is incomplete.\");\n        return;\n      } // 1. Fetch org and customer data\n\n\n      const orgSnap = await getDocs(collection(db, 'businessGroups'));\n      const org = ((_orgSnap$docs$ = orgSnap.docs[0]) === null || _orgSnap$docs$ === void 0 ? void 0 : _orgSnap$docs$.data()) || {};\n      const customer = this.state.customers.find(c => c.custshortName === invoice.customer || c.custname === invoice.customer) || {}; // GST State Map for Place of Supply\n\n      const gstStateMap = {\n        \"01\": \"Jammu & Kashmir\",\n        \"02\": \"Himachal Pradesh\",\n        \"03\": \"Punjab\",\n        \"04\": \"Chandigarh\",\n        \"05\": \"Uttarakhand\",\n        \"06\": \"Haryana\",\n        \"07\": \"Delhi\",\n        \"08\": \"Rajasthan\",\n        \"09\": \"Uttar Pradesh\",\n        \"10\": \"Bihar\",\n        \"11\": \"Sikkim\",\n        \"12\": \"Arunachal Pradesh\",\n        \"13\": \"Nagaland\",\n        \"14\": \"Manipur\",\n        \"15\": \"Mizoram\",\n        \"16\": \"Tripura\",\n        \"17\": \"Meghalaya\",\n        \"18\": \"Assam\",\n        \"19\": \"West Bengal\",\n        \"20\": \"Jharkhand\",\n        \"21\": \"Odisha\",\n        \"22\": \"Chhattisgarh\",\n        \"23\": \"Madhya Pradesh\",\n        \"24\": \"Gujarat\",\n        \"25\": \"Daman and Diu\",\n        \"26\": \"Dadra and Nagar Haveli\",\n        \"27\": \"Maharashtra\",\n        \"28\": \"Andhra Pradesh (Old)\",\n        \"29\": \"Karnataka\",\n        \"30\": \"Goa\",\n        \"31\": \"Lakshadweep\",\n        \"32\": \"Kerala\",\n        \"33\": \"Tamil Nadu\",\n        \"34\": \"Puducherry\",\n        \"35\": \"Andaman and Nicobar Islands\",\n        \"36\": \"Telangana\",\n        \"37\": \"Andhra Pradesh\",\n        \"97\": \"Other Territory\"\n      };\n\n      const getPlaceOfSupply = gstin => {\n        if (!gstin || gstin.length < 2) return '';\n        const code = gstin.substring(0, 2);\n        const state = gstStateMap[code];\n        return state ? `${code} - ${state}` : '';\n      }; // 2. Enrich line items\n\n\n      const enrichedItems = invoice.lineItems.map(item => ({ ...item,\n        hsnCode: item.hsnCode || '',\n        uom: item.uom || '',\n        ptshortName: item.ptshortName || '',\n        cgst: item.cgst || 0,\n        sgst: item.sgst || 0,\n        igst: item.igst || 0,\n        taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\n      })); // 3. Subtotal\n\n      const subtotal = enrichedItems.reduce((sum, item) => sum + (parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0), 0);\n      const freightCharges = parseFloat(invoice.freightCharges || 0);\n      const freightTax = parseFloat(invoice.freighttaxAmount || 0);\n      const totalTaxAmount = parseFloat(invoice.taxAmount || 0);\n      const grandTotal = parseFloat(invoice.invoiceValue || subtotal + totalTaxAmount);\n      const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`; // 4. Tax breakdown\n\n      let taxBreakdown = {};\n      let taxGroupDetails = [];\n      let sno = 1;\n      enrichedItems.forEach(item => {\n        const qty = parseFloat(item.qty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const base = qty * unitPrice;\n        (item.taxGroupNames || []).forEach(tgName => {\n          const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\n\n          if (group) {\n            group.lineItems.forEach(li => {\n              const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\n              let taxAmt = li.type === 'Amount' ? parseFloat(li.percentOrAmt || 0) : base * parseFloat(li.percentOrAmt || 0) / 100;\n              taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n              taxGroupDetails.push({\n                sno: sno++,\n                group: tgName,\n                peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\n                taxAmt: taxAmt.toFixed(2)\n              });\n            });\n          }\n        });\n\n        if (item.cgst) {\n          const key = `CGST ${item.cgst}%`;\n          const taxAmt = base * item.cgst / 100;\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n          taxGroupDetails.push({\n            sno: sno++,\n            group: key,\n            peramt: `${item.cgst}%`,\n            taxAmt: taxAmt.toFixed(2)\n          });\n        }\n\n        if (item.sgst) {\n          const key = `SGST ${item.sgst}%`;\n          const taxAmt = base * item.sgst / 100;\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n          taxGroupDetails.push({\n            sno: sno++,\n            group: key,\n            peramt: `${item.sgst}%`,\n            taxAmt: taxAmt.toFixed(2)\n          });\n        }\n\n        if (item.igst) {\n          const key = `IGST ${item.igst}%`;\n          const taxAmt = base * item.igst / 100;\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n          taxGroupDetails.push({\n            sno: sno++,\n            group: key,\n            peramt: `${item.igst}%`,\n            taxAmt: taxAmt.toFixed(2)\n          });\n        }\n      });\n\n      if (freightTax > 0) {\n        taxBreakdown[\"Freight Tax\"] = freightTax;\n        taxGroupDetails.push({\n          sno: sno++,\n          group: \"Freight Tax\",\n          peramt: \"-\",\n          taxAmt: freightTax.toFixed(2)\n        });\n      } // 5. Build HTML for PDF\n\n\n      const container = document.createElement('div');\n      container.id = 'pdf-preview-container';\n      container.style.width = '794px';\n      container.style.padding = '40px';\n      container.style.fontFamily = 'Arial';\n      container.innerHTML = `\n    <div style=\"display:flex; justify-content:space-between; align-items:center;\">\n      <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\n      <div style=\"font-size:18px; font-weight:bold;\">INVOICE</div>\n    </div>\n    <hr/>\n    <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\n      <div style=\"line-height:1.5; width:50%;\">\n        <b>${org.bgName || ''}</b><br/>\n        ${org.address || ''}<br/>\n        <b>Email:</b> ${org.email || ''}<br/>\n        <b>Website:</b> ${org.website || ''}<br/>\n        <b>GSTIN:</b> ${org.gstin || ''}<br/>\n        <b>Mobile:</b> ${org.mobile || ''}<br/>\n        <b>CIN:</b> ${org.cin || ''}\n      </div>\n      <table style=\"font-size:11px; text-align:left;\">\n        <tr><td><b>Invoice No</b></td><td>: ${invoice.cobillingNo}</td></tr>\n        <tr><td><b>Invoice Date</b></td><td>: ${invoice.cobillingDate}</td></tr>\n        <tr><td><b>Currency</b></td><td>: ${invoice.currency || 'INR'}</td></tr>\n        <tr><td><b>Cus.Code</b></td><td>: ${invoice.customerCode || ''}</td></tr>\n        <tr><td><b>Despatch</b></td><td>: ${invoice.despatchMode || ''}</td></tr>\n      </table>\n    </div>\n\n    <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\n      <div style=\"width:48%;\">\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\n        <div style=\"border:1px solid #ccc; padding:6px;\">\n         <b>${invoice.customer || ''}</b><br/>\n          ${((_invoice$billTo = invoice.billTo) === null || _invoice$billTo === void 0 ? void 0 : _invoice$billTo.replace(/\\n/g, '<br/>')) || ''}\n        </div>\n        <div style=\"font-size:10px; margin-top:6px;\">\n            <b>GSTIN:</b> ${customer.gstin || ''}<br/>\n            <b>Email:</b> ${customer.email || ''}<br/>\n            <b>Contact:</b> ${customer.contactPerson || ''}<br/>\n            <b>Phone:</b> ${customer.phone || ''}\n        </div>\n      </div>\n      <div style=\"width:48%;\">\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\n        <div style=\"border:1px solid #ccc; padding:6px;\">\n         <b>${invoice.customer || ''}</b><br/>\n          ${((_invoice$shipTo = invoice.shipTo) === null || _invoice$shipTo === void 0 ? void 0 : _invoice$shipTo.replace(/\\n/g, '<br/>')) || ''}\n        </div>\n        <div style=\"font-size:10px; margin-top:6px;\">\n          <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\n        </div>\n      </div>\n    </div>\n\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\n      <thead>\n        <tr style=\"background:#f4f6fa;\">\n          <th style=\"border:1px solid #011b56;\">Item Code</th>\n          <th style=\"border:1px solid #011b56;\">Description</th>\n          <th style=\"border:1px solid #011b56;\">HSN</th>\n          <th style=\"border:1px solid #011b56;\">UOM</th>\n          <th style=\"border:1px solid #011b56;\">Order Qty</th>\n          <th style=\"border:1px solid #011b56;\">Billed Qty</th>\n          <th style=\"border:1px solid #011b56;\">Unit Price</th>\n          <th style=\"border:1px solid #011b56;\">GST%</th>\n          <th style=\"border:1px solid #011b56;\">Item Total</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${enrichedItems.map(item => {\n        const gstLabel = item.taxGroupNames && item.taxGroupNames.length ? item.taxGroupNames.join(', ') : item.taxGroupName || item.taxId || '-';\n        return `\n            <tr>\n              <td style=\"border:1px solid #011b56;\">${item.itemCode}</td>\n              <td style=\"border:1px solid #011b56;\">${item.itemDescription}</td>\n              <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\n              <td style=\"border:1px solid #011b56;\">${item.uom}</td>\n              <td style=\"border:1px solid #011b56;\">${item.orderQty}</td>\n              <td style=\"border:1px solid #011b56;\">${item.qty}</td>\n              <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\n              <td style=\"border:1px solid #011b56;\">${gstLabel}</td>\n              <td style=\"border:1px solid #011b56;\">${item.total}</td>\n            </tr>`;\n      }).join('')}\n        <tr>\n          <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Grand Total</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${grandTotal.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n  <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\n  <td style=\"border:1px solid #011b56;\"><b>${invoice.discountAmount || '0.00'}</b></td>\n</tr>\n<tr>\n  <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>After Discount Value</b></td>\n  <td style=\"border:1px solid #011b56;\"><b>${invoice.afterDiscountValue || '0.00'}</b></td>\n</tr>\n      </tbody>\n    </table>\n    <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\n    <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\n  `;\n      document.body.appendChild(container);\n      const canvas = await html2canvas(container, {\n        scale: 2,\n        useCORS: true\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF('p', 'pt', 'a4');\n      const width = 595.28;\n      const height = canvas.height * width / canvas.width;\n      pdf.addImage(imgData, 'PNG', 0, 0, width, height);\n      document.body.removeChild(container); // 6. Tax Breakdown page\n\n      if (taxGroupDetails.length > 0) {\n        pdf.addPage();\n        let taxRows = taxGroupDetails.map(row => `\n      <tr>\n        <td style=\"border:1px solid #011b56;\">${row.sno}</td>\n        <td style=\"border:1px solid #011b56;\">${row.group}</td>\n        <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\n        <td style=\"border:1px solid #011b56;\">${row.taxAmt}</td>\n      </tr>`).join('');\n        let taxHtml = `<div style=\"font-family:Arial; padding:20px; width:100%;\">\n<h3 style=\"margin-bottom:10px; font-size:18px;\">Tax Breakdown</h3>\n<table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:14px;\">\n  <thead>\n    <tr style=\"background:#f4f6fa;\">\n      <th style=\"border:1px solid #011b56;\">S.No</th>\n      <th style=\"border:1px solid #011b56;\">Tax Group</th>\n      <th style=\"border:1px solid #011b56;\">Per/Amt</th>\n      <th style=\"border:1px solid #011b56;\">Tax Amt</th>\n    </tr>\n  </thead>\n  <tbody>\n    ${taxRows}\n    <tr>\n      <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n      <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\n    </tr>\n  </tbody>\n</table>\n</div>`;\n        const taxContainer = document.createElement('div');\n        taxContainer.innerHTML = taxHtml;\n        document.body.appendChild(taxContainer);\n        const taxCanvas = await html2canvas(taxContainer, {\n          scale: 1.5,\n          useCORS: true\n        });\n        const taxImg = taxCanvas.toDataURL('image/png');\n        pdf.addImage(taxImg, 'PNG', 0, 0, width, taxCanvas.height * width / taxCanvas.width);\n        document.body.removeChild(taxContainer);\n      }\n\n      pdf.setFontSize(11);\n      pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\n      pdf.text('Authorized Signatory', width - 200, 800); // 7. Show PDF\n\n      const blob = pdf.output('blob');\n      const url = URL.createObjectURL(blob);\n      const newWin = window.open();\n      newWin.document.write(`\n    <html><head><title>Invoice PDF Preview</title></head>\n    <body style=\"margin:0;\">\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\n    </body></html>\n  `);\n      newWin.document.close();\n    };\n\n    this.toggleTaxGroupSelection = (groupName, lineIdx, isChecked) => {\n      const formData = { ...this.state.formData\n      };\n      const item = formData.lineItems[lineIdx];\n      if (!item.taxGroupNames) item.taxGroupNames = [];\n\n      if (isChecked) {\n        if (!item.taxGroupNames.includes(groupName)) {\n          item.taxGroupNames.push(groupName);\n        }\n      } else {\n        item.taxGroupNames = item.taxGroupNames.filter(g => g !== groupName);\n      } // recalculate taxAmt and total\n\n\n      item.taxAmt = this.calcTaxAmt(item);\n      item.total = this.calcItemTotal(item.qty, item.unitPrice, item.taxAmt);\n      this.setState({\n        formData\n      }, this.recalculateBillTotals);\n    };\n\n    this.handleTabChange = idx => this.setState({\n      activeTab: idx\n    });\n\n    this.handleNotesChange = e => this.setState({\n      notes: e.target.value\n    });\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      const {\n        editingId,\n        formData,\n        cobilling,\n        notes\n      } = this.state;\n      if (!formData.customer) return alert(\"Customer is required\");\n      if (formData.lineItems.length === 0) return alert(\"At least one line item is required\");\n      const saveData = { ...formData,\n        notes,\n        status: \"Awaiting Approval\",\n        createdAt: serverTimestamp()\n      };\n\n      if (editingId) {\n        await updateDoc(doc(db, \"cobilling\", editingId), saveData);\n      } else {\n        if (formData.cobillingType === 'Standard') {\n          saveData.cobillingNo = `COB${101 + cobilling.length}`;\n        }\n\n        await addDoc(collection(db, \"cobilling\"), saveData);\n      }\n\n      this.setState({\n        showForm: false,\n        editingId: null,\n        formData: this.getEmptyCOBillingForm(),\n        notes: ''\n      });\n      this.fetchCOBilling();\n    };\n\n    this.renderOrderOverlay = () => {\n      const {\n        orders,\n        orderOverlaySearch = '',\n        currentOrderPage = 1\n      } = this.state;\n      const filtered = orders.filter(o => (o.orderNo || '').toLowerCase().includes(orderOverlaySearch.toLowerCase()) || (o.customer || '').toLowerCase().includes(orderOverlaySearch.toLowerCase()));\n      const itemsPerPage = 10;\n      const totalPages = Math.ceil(filtered.length / itemsPerPage);\n      const startIdx = (currentOrderPage - 1) * itemsPerPage;\n      const paginated = filtered.slice(startIdx, startIdx + itemsPerPage);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 686,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 687,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 688,\n          columnNumber: 9\n        }\n      }, \"Select Customer Order\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control mb-2\",\n        placeholder: \"Search by ID or Company...\",\n        value: orderOverlaySearch,\n        onChange: e => this.setState({\n          orderOverlaySearch: e.target.value,\n          currentOrderPage: 1\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 690,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"overlay-table-container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 698,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 699,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 700,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 701,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 702,\n          columnNumber: 17\n        }\n      }, \"ID\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 703,\n          columnNumber: 17\n        }\n      }, \"Company\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 704,\n          columnNumber: 17\n        }\n      }, \"Date\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 707,\n          columnNumber: 13\n        }\n      }, paginated.map((o, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: o.id || i,\n        onClick: () => this.selectOrderForInvoice(o),\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 709,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 714,\n          columnNumber: 19\n        }\n      }, o.orderNo), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 715,\n          columnNumber: 19\n        }\n      }, o.customer), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 716,\n          columnNumber: 19\n        }\n      }, o.orderDate))), paginated.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 720,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: 3,\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 721,\n          columnNumber: 19\n        }\n      }, \"No orders found\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"overlay-pagination\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 729,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"nav\", {\n        \"aria-label\": \"Order pagination\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 730,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"pagination justify-content-end mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 731,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"li\", {\n        className: `page-item ${currentOrderPage === 1 ? 'disabled' : ''}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 732,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"page-link\",\n        onClick: () => this.setState({\n          currentOrderPage: Math.max(currentOrderPage - 1, 1)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 733,\n          columnNumber: 17\n        }\n      }, \"\\xAB\")), [...Array(totalPages)].map((_, idx) => /*#__PURE__*/React.createElement(\"li\", {\n        key: idx,\n        className: `page-item ${currentOrderPage === idx + 1 ? 'active' : ''}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 745,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"page-link\",\n        onClick: () => this.setState({\n          currentOrderPage: idx + 1\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 746,\n          columnNumber: 19\n        }\n      }, idx + 1))), /*#__PURE__*/React.createElement(\"li\", {\n        className: `page-item ${currentOrderPage === totalPages ? 'disabled' : ''}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 756,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"page-link\",\n        onClick: () => this.setState({\n          currentOrderPage: Math.min(currentOrderPage + 1, totalPages)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 757,\n          columnNumber: 17\n        }\n      }, \"\\xBB\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"overlay-footer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 772,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-secondary btn-sm\",\n        onClick: this.hideOrderOverlay,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 773,\n          columnNumber: 11\n        }\n      }, \"Cancel\"))));\n    };\n\n    this.renderTaxOverlay = () => {\n      const {\n        taxGroups,\n        currentTaxIdx,\n        formData,\n        taxSearch = '',\n        currentTaxPage = 1\n      } = this.state;\n      if (currentTaxIdx === null) return null;\n      const item = formData.lineItems[currentTaxIdx];\n      const selected = new Set(item.taxGroupNames || []);\n      const itemsPerPage = 6;\n      const filtered = taxGroups.filter(tg => tg.groupName.toLowerCase().includes(taxSearch.toLowerCase()));\n      const totalPages = Math.ceil(filtered.length / itemsPerPage);\n      const startIdx = (currentTaxPage - 1) * itemsPerPage;\n      const paginated = filtered.slice(startIdx, startIdx + itemsPerPage);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 802,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 803,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 804,\n          columnNumber: 9\n        }\n      }, \"Select Tax Groups\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control mb-2\",\n        placeholder: \"Search Tax Group...\",\n        value: taxSearch,\n        onChange: e => this.setState({\n          taxSearch: e.target.value,\n          currentTaxPage: 1\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 806,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"overlay-table-container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 814,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-sm table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 815,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 816,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 817,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        style: {\n          width: '5%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 818,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"th\", {\n        style: {\n          width: '25%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 819,\n          columnNumber: 17\n        }\n      }, \"Group\"), /*#__PURE__*/React.createElement(\"th\", {\n        style: {\n          width: '50%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 820,\n          columnNumber: 17\n        }\n      }, \"Components\"), /*#__PURE__*/React.createElement(\"th\", {\n        style: {\n          width: '20%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 821,\n          columnNumber: 17\n        }\n      }, \"%\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 824,\n          columnNumber: 13\n        }\n      }, paginated.map(tg => /*#__PURE__*/React.createElement(\"tr\", {\n        key: tg.groupName,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 826,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 827,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: selected.has(tg.groupName),\n        onChange: e => this.toggleTaxGroupSelection(tg.groupName, currentTaxIdx, e.target.checked),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 828,\n          columnNumber: 21\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 19\n        }\n      }, tg.groupName), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 837,\n          columnNumber: 19\n        }\n      }, tg.lineItems.map(li => li.component).join(', ')), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 838,\n          columnNumber: 19\n        }\n      }, tg.lineItems.map(li => li.percentOrAmt).join(', ')))), paginated.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 842,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: \"4\",\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 843,\n          columnNumber: 19\n        }\n      }, \"No tax groups found\"))))), /*#__PURE__*/React.createElement(\"nav\", {\n        \"aria-label\": \"Tax pagination example\",\n        className: \"mt-auto\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 851,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"pagination justify-content-end mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 852,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"li\", {\n        className: `page-item ${currentTaxPage === 1 ? 'disabled' : ''}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 853,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"page-link\",\n        onClick: () => this.setState({\n          currentTaxPage: Math.max(currentTaxPage - 1, 1)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 854,\n          columnNumber: 15\n        }\n      }, \"\\xAB\")), [...Array(totalPages)].map((_, idx) => /*#__PURE__*/React.createElement(\"li\", {\n        key: idx,\n        className: `page-item ${currentTaxPage === idx + 1 ? 'active' : ''}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 864,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"page-link\",\n        onClick: () => this.setState({\n          currentTaxPage: idx + 1\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 865,\n          columnNumber: 17\n        }\n      }, idx + 1))), /*#__PURE__*/React.createElement(\"li\", {\n        className: `page-item ${currentTaxPage === totalPages ? 'disabled' : ''}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 875,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"page-link\",\n        onClick: () => this.setState({\n          currentTaxPage: Math.min(currentTaxPage + 1, totalPages)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 876,\n          columnNumber: 15\n        }\n      }, \"\\xBB\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"overlay-footer text-start\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 888,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-success btn-sm float-start\",\n        onClick: () => this.setState({\n          showTaxOverlay: false,\n          currentTaxIdx: null\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 889,\n          columnNumber: 3\n        }\n      }, \"Done\"))));\n    };\n\n    this.renderTabs = () => {\n      const {\n        activeTab\n      } = this.state;\n      const tabNames = ['Billing Details', 'Commercial Details', 'Notes'];\n      return /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"nav nav-tabs mb-3\",\n        style: {\n          fontSize: '16px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 908,\n          columnNumber: 7\n        }\n      }, tabNames.map((tab, idx) => /*#__PURE__*/React.createElement(\"li\", {\n        className: \"nav-item\",\n        key: tab,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 910,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: `nav-link${activeTab === idx ? ' active' : ''}`,\n        onClick: () => this.handleTabChange(idx),\n        style: {\n          background: activeTab === idx ? '#e9ecef' : '#fff',\n          border: '1px solid #dee2e6',\n          borderBottom: activeTab === idx ? 'none' : undefined,\n          fontWeight: activeTab === idx ? 'bold' : 'normal'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 911,\n          columnNumber: 13\n        }\n      }, tab))));\n    };\n\n    this.renderBillingTab = () => {\n      const {\n        formData,\n        showOrderOverlay,\n        showTaxOverlay,\n        currentTaxIdx\n      } = this.state;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 933,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 934,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 935,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 936,\n          columnNumber: 13\n        }\n      }, \"Bill Type\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control form-control-sm\",\n        value: formData.cobillingType,\n        onChange: e => this.handleInputChange('cobillingType', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 937,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Standard\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 942,\n          columnNumber: 15\n        }\n      }, \"Standard\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Manual\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 943,\n          columnNumber: 15\n        }\n      }, \"Manual\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 946,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 947,\n          columnNumber: 13\n        }\n      }, \"Bill No\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.cobillingNo,\n        onChange: e => this.handleInputChange('cobillingNo', e.target.value),\n        readOnly: formData.cobillingType === 'Standard',\n        placeholder: formData.cobillingType === 'Standard' ? 'Auto' : 'Enter Bill No',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 948,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 957,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 958,\n          columnNumber: 13\n        }\n      }, \"Bill Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control form-control-sm\",\n        value: formData.cobillingDate,\n        onChange: e => this.handleInputChange('cobillingDate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 959,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 966,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 967,\n          columnNumber: 13\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.status,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 968,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 970,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 971,\n          columnNumber: 13\n        }\n      }, \"Ref No\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.refNo,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 972,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 974,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 975,\n          columnNumber: 13\n        }\n      }, \"Customer Order\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group input-group-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 976,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: formData.customerOrderId,\n        readOnly: true,\n        onClick: this.showOrderOverlay,\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 977,\n          columnNumber: 15\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-append\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 985,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-outline-secondary btn-sm\",\n        type: \"button\",\n        onClick: this.showOrderOverlay,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 986,\n          columnNumber: 17\n        }\n      }, \"Select\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 991,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 992,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 993,\n          columnNumber: 13\n        }\n      }, \"Currency\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.currency,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 994,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 996,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 997,\n          columnNumber: 13\n        }\n      }, \"Conversion Rate\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.conversionRate,\n        onChange: e => this.handleInputChange('conversionRate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 998,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1000,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1001,\n          columnNumber: 13\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.taxAmount,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1002,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1004,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1005,\n          columnNumber: 13\n        }\n      }, \"Bill Value\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.billValue,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1006,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1009,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1010,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1011,\n          columnNumber: 11\n        }\n      }, \"Discount %\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.discountPercent,\n        onChange: e => {\n          this.handleInputChange('discountPercent', e.target.value);\n          this.recalculateDiscounts();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1012,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1020,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1021,\n          columnNumber: 11\n        }\n      }, \"Discount Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.discountAmount,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1022,\n          columnNumber: 11\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1027,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1028,\n          columnNumber: 11\n        }\n      }, \"After Discount Value\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.discountPercent > 0 ? formData.afterDiscountValue : \"\",\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1029,\n          columnNumber: 11\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"table-responsive mt-3\",\n        style: {\n          overflowX: 'auto'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1035,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered\",\n        style: {\n          minWidth: 1200\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1036,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1037,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1038,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        style: {\n          position: 'sticky',\n          left: 0,\n          background: '#f9f9f9',\n          zIndex: 2\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1039,\n          columnNumber: 17\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        style: {\n          position: 'sticky',\n          left: 90,\n          width: '100px',\n          background: '#f9f9f9',\n          zIndex: 2\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1040,\n          columnNumber: 17\n        }\n      }, \"Item Desc\"), /*#__PURE__*/React.createElement(\"th\", {\n        style: {\n          position: 'sticky',\n          left: 160,\n          background: '#f9f9f9',\n          zIndex: 2\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1041,\n          columnNumber: 17\n        }\n      }, \"Cust Part Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1042,\n          columnNumber: 17\n        }\n      }, \"HSN/SAC\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1043,\n          columnNumber: 17\n        }\n      }, \"Locator\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1044,\n          columnNumber: 17\n        }\n      }, \"UOM\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1045,\n          columnNumber: 17\n        }\n      }, \"On Hand\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1046,\n          columnNumber: 17\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1047,\n          columnNumber: 17\n        }\n      }, \"Order Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1048,\n          columnNumber: 17\n        }\n      }, \"Recv Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1049,\n          columnNumber: 17\n        }\n      }, \"Quantity\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1050,\n          columnNumber: 17\n        }\n      }, \"Tax Group\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1051,\n          columnNumber: 17\n        }\n      }, \"Tax Amt\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1052,\n          columnNumber: 17\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1055,\n          columnNumber: 13\n        }\n      }, (formData.lineItems || []).map((item, idx) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: idx,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1057,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        style: {\n          position: 'sticky',\n          left: 0,\n          background: '#f9f9f9',\n          zIndex: 1\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1058,\n          columnNumber: 19\n        }\n      }, item.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        style: {\n          position: 'sticky',\n          left: 90,\n          width: '100px',\n          background: '#f9f9f9',\n          zIndex: 1\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1059,\n          columnNumber: 19\n        }\n      }, item.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        style: {\n          position: 'sticky',\n          left: 160,\n          background: '#f9f9f9',\n          zIndex: 1\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1060,\n          columnNumber: 19\n        }\n      }, item.custPartCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1061,\n          columnNumber: 19\n        }\n      }, item.hsnCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1062,\n          columnNumber: 19\n        }\n      }, item.locator), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1063,\n          columnNumber: 19\n        }\n      }, item.uom), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1064,\n          columnNumber: 19\n        }\n      }, item.onHand), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1065,\n          columnNumber: 19\n        }\n      }, item.unitPrice), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1066,\n          columnNumber: 19\n        }\n      }, item.orderQty), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1067,\n          columnNumber: 19\n        }\n      }, item.recvQty), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1068,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: item.qty,\n        min: \"1\",\n        style: {\n          width: 80\n        },\n        onChange: e => this.handleLineItemChange(idx, 'qty', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1069,\n          columnNumber: 21\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1078,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-outline-primary btn-sm\",\n        onClick: () => this.setState({\n          showTaxOverlay: true,\n          currentTaxIdx: idx\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1079,\n          columnNumber: 21\n        }\n      }, \"Select Tax\"), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          fontSize: '10px',\n          marginTop: '4px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1086,\n          columnNumber: 21\n        }\n      }, (item.taxGroupNames || []).join(', ') || '-')), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1090,\n          columnNumber: 19\n        }\n      }, item.taxAmt), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1091,\n          columnNumber: 19\n        }\n      }, item.total))), (!formData.lineItems || formData.lineItems.length === 0) && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1095,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: \"14\",\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1096,\n          columnNumber: 19\n        }\n      }, \"No items\"))))), showOrderOverlay && this.renderOrderOverlay(), showTaxOverlay && this.renderTaxOverlay());\n    };\n\n    this.renderCommercialTab = () => {\n      const {\n        formData\n      } = this.state;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1111,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1112,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1113,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1114,\n          columnNumber: 13\n        }\n      }, \"Despatch Mode\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.despatchMode,\n        onChange: e => this.handleInputChange('despatchMode', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1115,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1117,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1118,\n          columnNumber: 13\n        }\n      }, \"Payment Terms\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.paymentTerms,\n        onChange: e => this.handleInputChange('paymentTerms', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1119,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1121,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1122,\n          columnNumber: 13\n        }\n      }, \"Currency\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.currency,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1123,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1126,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1127,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1128,\n          columnNumber: 13\n        }\n      }, \"Freight Charges\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.freightCharges,\n        onChange: e => this.handleInputChange('freightCharges', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1129,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1131,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1132,\n          columnNumber: 13\n        }\n      }, \"Freight Tax Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.freighttaxAmount,\n        onChange: e => this.handleInputChange('freighttaxAmount', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1133,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1135,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1136,\n          columnNumber: 13\n        }\n      }, \"Packing Charges\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.packingCharges,\n        onChange: e => this.handleInputChange('packingCharges', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1137,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1140,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1141,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1142,\n          columnNumber: 13\n        }\n      }, \"Bill To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control form-control-sm\",\n        rows: \"2\",\n        value: formData.billTo,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1143,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1145,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1146,\n          columnNumber: 13\n        }\n      }, \"Ship To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control form-control-sm\",\n        rows: \"2\",\n        value: formData.shipTo,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1147,\n          columnNumber: 13\n        }\n      }))));\n    };\n\n    this.renderNotesTab = () => /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1155,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1156,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1157,\n        columnNumber: 9\n      }\n    }, \"Notes / Remarks\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control form-control-sm\",\n      rows: \"4\",\n      value: this.state.notes,\n      onChange: this.handleNotesChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1158,\n        columnNumber: 9\n      }\n    })));\n\n    this.renderForm = () => {\n      const {\n        activeTab\n      } = this.state;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card full-height\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1166,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"form\", {\n        className: \"form-sample\",\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1167,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          flex: 1,\n          overflowY: 'auto',\n          padding: '24px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1168,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1169,\n          columnNumber: 13\n        }\n      }, \"Customer Order Billing\"), this.renderTabs(), activeTab === 0 && this.renderBillingTab(), activeTab === 1 && this.renderCommercialTab(), activeTab === 2 && this.renderNotesTab(), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"fixed-card-footer text-right p-3 border-top bg-white\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1174,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-success mr-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1175,\n          columnNumber: 15\n        }\n      }, \"Save Invoice\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary\",\n        onClick: () => this.setState({\n          showForm: false,\n          editingId: null,\n          formData: this.getEmptyCOBillingForm(),\n          notes: ''\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1176,\n          columnNumber: 15\n        }\n      }, \"Cancel\")))));\n    };\n\n    this.renderTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-4 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1185,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1186,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-between align-items-center mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1187,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"card-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1188,\n        columnNumber: 11\n      }\n    }, \"Customer Order Billing\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: () => this.setState({\n        showForm: true\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1189,\n        columnNumber: 11\n      }\n    }, \"Create\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1191,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      className: \"form-control\",\n      placeholder: \"Search by Bill No, Customer, Status, Date...\",\n      value: this.state.searchTerm,\n      onChange: e => this.setState({\n        searchTerm: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1192,\n        columnNumber: 3\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1201,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1202,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1203,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1204,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1205,\n        columnNumber: 17\n      }\n    }, \"Bill No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1206,\n        columnNumber: 17\n      }\n    }, \"Customer Order\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1207,\n        columnNumber: 17\n      }\n    }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1208,\n        columnNumber: 17\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1209,\n        columnNumber: 17\n      }\n    }, \"Bill Value\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1210,\n        columnNumber: 17\n      }\n    }, \"After Discount\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1211,\n        columnNumber: 17\n      }\n    }, \"Status\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1212,\n        columnNumber: 17\n      }\n    }, \"Print\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1215,\n        columnNumber: 1\n      }\n    }, this.state.cobilling.filter(inv => {\n      var _inv$billValue, _inv$afterDiscountVal;\n\n      const term = this.state.searchTerm.toLowerCase();\n      if (!term) return true; // no filter if empty\n\n      return (inv.cobillingNo || \"\").toLowerCase().includes(term) || (inv.customerOrderId || \"\").toLowerCase().includes(term) || (inv.customer || \"\").toLowerCase().includes(term) || (inv.cobillingDate || \"\").toLowerCase().includes(term) || (inv.status || \"\").toLowerCase().includes(term) || (((_inv$billValue = inv.billValue) === null || _inv$billValue === void 0 ? void 0 : _inv$billValue.toString()) || \"\").toLowerCase().includes(term) || (((_inv$afterDiscountVal = inv.afterDiscountValue) === null || _inv$afterDiscountVal === void 0 ? void 0 : _inv$afterDiscountVal.toString()) || \"\").toLowerCase().includes(term);\n    }).map((inv, i) => {\n      let statusClass = \"badge-secondary\";\n      if (inv.status === \"Approved\") statusClass = \"badge-success\";else if (inv.status === \"Amended\") statusClass = \"badge-info\";else if (inv.status === \"Cancelled\") statusClass = \"badge-danger\";else if (inv.status === \"Awaiting Approval\" || inv.status === \"Pending\") statusClass = \"badge-warning\";else if (inv.status === \"Partial\") statusClass = \"badge-secondary\"; // ✅ new option\n\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1239,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1240,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-link p-0\",\n        style: {\n          color: \"#2196F3\",\n          cursor: \"pointer\"\n        },\n        onClick: () => this.setState({\n          showForm: true,\n          editingId: inv.id,\n          formData: { ...inv\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1241,\n          columnNumber: 13\n        }\n      }, inv.cobillingNo)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1255,\n          columnNumber: 9\n        }\n      }, inv.customerOrderId), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1256,\n          columnNumber: 9\n        }\n      }, inv.customer), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1257,\n          columnNumber: 9\n        }\n      }, inv.cobillingDate), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1258,\n          columnNumber: 9\n        }\n      }, inv.billValue), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1259,\n          columnNumber: 9\n        }\n      }, inv.afterDiscountValue), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1260,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${statusClass}`,\n        style: {\n          fontSize: \"14px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1261,\n          columnNumber: 11\n        }\n      }, inv.status)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1268,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-printer menu-icon\",\n        onClick: () => this.showCoBillingPDFWithOrg(inv),\n        style: {\n          fontSize: \"24px\",\n          color: \"#2196F3\",\n          cursor: \"pointer\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1269,\n          columnNumber: 11\n        }\n      })));\n    }), this.state.cobilling.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1280,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      colSpan: \"8\",\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1281,\n        columnNumber: 7\n      }\n    }, \"No cobilling found.\")))))));\n  }\n\n  getEmptyCOBillingForm() {\n    return {\n      cobillingType: 'Standard',\n      cobillingNo: '',\n      cobillingDate: new Date().toISOString().split('T')[0],\n      status: 'Entered',\n      refNo: '',\n      customerOrderId: '',\n      customerOrderCompany: '',\n      customerOrderDate: '',\n      customer: '',\n      currency: '',\n      conversionRate: '',\n      taxAmount: '',\n      billValue: '',\n      discountPercent: 0,\n      discountAmount: 0,\n      afterDiscountValue: 0,\n      billTo: '',\n      shipTo: '',\n      lineItems: [],\n      despatchMode: '',\n      paymentTerms: '',\n      freightCharges: '',\n      freighttaxAmount: '',\n      packingCharges: '',\n      notes: ''\n    };\n  }\n\n  componentDidMount() {\n    this.subscribeToCOBilling();\n    this.fetchOrders();\n    this.fetchCustomers();\n    this.fetchTaxGroups();\n    this.fetchDespatchModes();\n    this.fetchPaymentTerms();\n  }\n\n  componentWillUnmount() {\n    if (this._unsubCOB) this._unsubCOB();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1296,\n        columnNumber: 7\n      }\n    }, this.state.showForm ? this.renderForm() : this.renderTable());\n  }\n\n}\n\nexport default CustomerOrderBilling;","map":{"version":3,"sources":["C:/Users/College/admin/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/invoice/CustomerOrderBilling.js"],"names":["React","Component","db","jsPDF","html2canvas","toWords","runTransaction","getDoc","query","where","collection","getDocs","addDoc","updateDoc","doc","serverTimestamp","onSnapshot","amount","amountWords","CustomerOrderBilling","state","cobilling","orders","customers","taxGroups","despatchModes","paymentTerms","activeTab","showForm","editingId","showOrderOverlay","orderOverlaySearch","showTaxOverlay","currentTaxIdx","notes","searchTerm","formData","getEmptyCOBillingForm","getBilledQtyMap","orderNo","snap","approved","docs","map","data","filter","inv","customerOrderId","status","billedQtyMap","forEach","lineItems","item","code","itemCode","qty","parseFloat","subscribeToCOBilling","_unsubCOB","id","sort","a","b","dateA","Date","cobillingDate","createdAt","toDate","dateB","setState","reverse","err","console","error","fetchCOBilling","fetchOrders","fetchCustomers","fetchTaxGroups","fetchDespatchModes","fetchPaymentTerms","hideOrderOverlay","selectOrderForInvoice","order","customerObj","find","c","custname","customer","custcode","prev","customerOrderCompany","customerOrderDate","orderDate","customerCode","refNo","discountPercent","discountAmount","afterDiscountValue","billTo","formatAddress","shipTo","currency","despatchMode","freightCharges","freighttaxAmount","packingCharges","alreadyBilled","orderQty","recvQty","Math","max","itemDescription","custPartCode","hsnCode","locator","uom","onHand","unitPrice","taxGroupNames","taxAmt","total","calcItemTotal","recalculateDiscounts","billValue","toFixed","addr","address","city","country","Boolean","join","zip","handleInputChange","field","value","handleLineItemChange","idx","updatedItems","val","maxQty","min","calcTaxAmt","recalculateBillTotals","approveInvoice","invoiceId","invoiceRef","invoiceSnap","exists","alert","invoice","orderSnap","empty","orderDoc","orderRef","transaction","orderData","get","updatedLineItems","invItem","li","billedQty","addQty","newBilledQty","allCompleted","every","update","taxAmount","percent","groupName","group","t","Array","isArray","comp","percentOrAmt","type","baseTotal","showCoBillingPDFWithOrg","length","orgSnap","org","custshortName","gstStateMap","getPlaceOfSupply","gstin","substring","enrichedItems","ptshortName","cgst","sgst","igst","taxGroupName","split","s","trim","subtotal","reduce","sum","freightTax","totalTaxAmount","grandTotal","invoiceValue","floor","taxBreakdown","taxGroupDetails","sno","base","tgName","g","key","component","push","peramt","container","document","createElement","style","width","padding","fontFamily","innerHTML","logoUrl","bgName","email","website","mobile","cin","cobillingNo","replace","contactPerson","phone","gstLabel","taxId","toLocaleString","body","appendChild","canvas","scale","useCORS","imgData","toDataURL","pdf","height","addImage","removeChild","addPage","taxRows","row","taxHtml","taxContainer","taxCanvas","taxImg","setFontSize","text","blob","output","url","URL","createObjectURL","newWin","window","open","write","close","toggleTaxGroupSelection","lineIdx","isChecked","includes","handleTabChange","handleNotesChange","e","target","handleSubmit","preventDefault","saveData","cobillingType","renderOrderOverlay","currentOrderPage","filtered","o","toLowerCase","itemsPerPage","totalPages","ceil","startIdx","paginated","slice","i","cursor","_","renderTaxOverlay","taxSearch","currentTaxPage","selected","Set","tg","has","checked","renderTabs","tabNames","fontSize","tab","background","border","borderBottom","undefined","fontWeight","renderBillingTab","conversionRate","overflowX","minWidth","position","left","zIndex","marginTop","renderCommercialTab","renderNotesTab","renderForm","flex","overflowY","renderTable","term","toString","statusClass","color","toISOString","componentDidMount","componentWillUnmount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { db } from '../../../../firebase';\r\nimport { jsPDF } from 'jspdf';\r\nimport html2canvas from 'html2canvas';\r\nimport { toWords } from 'number-to-words';\r\nimport { runTransaction,getDoc,query,where } from 'firebase/firestore';\r\nimport { collection, getDocs, addDoc, updateDoc, doc, serverTimestamp,onSnapshot } from 'firebase/firestore';\r\n\r\n\r\nconst amount = 12345678;\r\nconst amountWords = `INR ${toWords(amount)} Only`;\r\n\r\nclass CustomerOrderBilling extends Component {\r\n  state = {\r\n    cobilling: [],\r\n    orders: [],\r\n    customers: [],\r\n    taxGroups: [],\r\n    despatchModes: [],\r\n    paymentTerms: [],\r\n    activeTab: 0,\r\n    showForm: false,\r\n    editingId: null,\r\n    showOrderOverlay: false,\r\n    orderOverlaySearch: '',\r\n    showTaxOverlay: false,\r\n    currentTaxIdx: null,\r\n    notes: '',\r\n    searchTerm: '',\r\n    formData: this.getEmptyCOBillingForm()\r\n  };\r\n\r\n  getEmptyCOBillingForm() {\r\n    return {\r\n      cobillingType: 'Standard',\r\n      cobillingNo: '',\r\n      cobillingDate: new Date().toISOString().split('T')[0],\r\n      status: 'Entered',\r\n      refNo: '',\r\n      customerOrderId: '',\r\n      customerOrderCompany: '',\r\n      customerOrderDate: '',\r\n      customer: '',\r\n      currency: '',\r\n      conversionRate: '',\r\n      taxAmount: '',\r\n      billValue: '',\r\n      discountPercent: 0,\r\n      discountAmount: 0,\r\n      afterDiscountValue: 0,\r\n      billTo: '',\r\n      shipTo: '',\r\n      lineItems: [],\r\n      despatchMode: '',\r\n      paymentTerms: '',\r\n      freightCharges: '',\r\n      freighttaxAmount: '',\r\n      packingCharges: '',\r\n      notes: ''\r\n    };\r\n  }\r\n   getBilledQtyMap = async (orderNo) => {\r\n  const snap = await getDocs(collection(db, 'cobilling'));\r\n  const approved = snap.docs\r\n    .map(doc => doc.data())\r\n    .filter(inv => inv.customerOrderId === orderNo && inv.status === \"Approved\");\r\n  // Map: itemCode -> total billed qty\r\n  const billedQtyMap = {};\r\n  approved.forEach(inv => {\r\n    (inv.lineItems || []).forEach(item => {\r\n      const code = item.itemCode;\r\n      const qty = parseFloat(item.qty || 0);\r\n      billedQtyMap[code] = (billedQtyMap[code] || 0) + qty;\r\n    });\r\n  });\r\n  return billedQtyMap;\r\n};\r\ncomponentDidMount() {\r\n  this.subscribeToCOBilling();\r\n  this.fetchOrders();\r\n  this.fetchCustomers();\r\n  this.fetchTaxGroups();\r\n  this.fetchDespatchModes();\r\n  this.fetchPaymentTerms();\r\n}\r\n\r\ncomponentWillUnmount() {\r\n  if (this._unsubCOB) this._unsubCOB();\r\n}\r\n\r\nsubscribeToCOBilling = () => {\r\n  this._unsubCOB = onSnapshot(collection(db, 'cobilling'), snap => {\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    data.sort((a,b)=>{\r\n      const dateA=new Date(a.cobillingDate || a.createdAt?.toDate?.() || a.createdAt || 0);\r\n      const dateB=new Date(b.cobillingDate || b.createdAt?.toDate?.() || b.createdAt || 0);\r\n      return dateB - dateA;\r\n    });\r\n    this.setState({ cobilling: data.reverse() });\r\n  }, err => {\r\n    console.error('cobilling snapshot error', err);\r\n  });\r\n};\r\n\r\n  fetchCOBilling = async () => {\r\n    const snap = await getDocs(collection(db, 'cobilling'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    data.sort((a,b)=>{\r\n      const dateA=new Date(a.cobillingDate || a.createdAt?.toDate?.() || a.createdAt || 0);\r\n      const dateB=new Date(b.cobillingDate || b.createdAt?.toDate?.() || b.createdAt || 0);\r\n      return dateB - dateA;\r\n    });\r\n    this.setState({ cobilling: data.reverse() });\r\n  };\r\n\r\n  fetchOrders = async () => {\r\n    const snap = await getDocs(collection(db, 'orders'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ orders: data.reverse() });\r\n  };\r\n\r\n  fetchCustomers = async () => {\r\n    const snap = await getDocs(collection(db, 'customers'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ customers: data });\r\n  };\r\n\r\n  fetchTaxGroups = async () => {\r\n    const snap = await getDocs(collection(db, 'taxGroups'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ taxGroups: data });\r\n  };\r\n\r\n  fetchDespatchModes = async () => {\r\n    const snap = await getDocs(collection(db, 'modes'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ despatchModes: data });\r\n  };\r\n\r\n  fetchPaymentTerms = async () => {\r\n    const snap = await getDocs(collection(db, 'paymentTerms'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ paymentTerms: data });\r\n  };\r\n\r\n  showOrderOverlay = () => this.setState({ showOrderOverlay: true, orderOverlaySearch: '' });\r\n  hideOrderOverlay = () => this.setState({ showOrderOverlay: false, orderOverlaySearch: '' });\r\n\r\n selectOrderForInvoice = async (order) => {\r\n  const customerObj = this.state.customers.find(\r\n    c => c.custname === order.customer || c.custcode === order.customer\r\n  );\r\n  const billedQtyMap = await this.getBilledQtyMap(order.orderNo);\r\n\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      customerOrderId: order.orderNo,\r\n      customerOrderCompany: order.customer,\r\n      customerOrderDate: order.orderDate,\r\n      customer: order.customer,\r\n      customerCode: customerObj ? customerObj.custcode : '',\r\n      refNo: order.orderNo,\r\n      discountPercent: order.discountPercent || 0,\r\n      discountAmount: order.discountAmount || 0,\r\n      afterDiscountValue: order.afterDiscountValue || 0,\r\n      billTo: customerObj ? this.formatAddress(customerObj.billTo) : '',\r\n      shipTo: customerObj ? this.formatAddress(customerObj.shipTo) : '',\r\n      currency: customerObj ? customerObj.currency || '' : '',\r\n      despatchMode: order.despatchMode || '',\r\n      paymentTerms: order.paymentTerms || '',\r\n      freightCharges: order.freightCharges || '',\r\n      freighttaxAmount: order.freighttaxAmount || '',\r\n      packingCharges: order.packingCharges || '',\r\n      lineItems: (order.lineItems || []).map(item => {\r\n        const alreadyBilled = billedQtyMap[item.itemCode] || 0;\r\n        const orderQty = parseFloat(item.qty || item.orderQty || 0);\r\n        const recvQty = Math.max(orderQty - alreadyBilled, 0);\r\n        return {\r\n            itemCode: item.itemCode || '',\r\n            itemDescription: item.itemDescription || '',\r\n            custPartCode: item.custPartCode || '',\r\n            hsnCode: item.hsnCode || '',\r\n            locator: item.locator || '',\r\n            uom: item.uom || '',\r\n            onHand: item.onHand || 0,\r\n            unitPrice: item.unitPrice || 0,\r\n            orderQty: orderQty,\r\n            recvQty: recvQty, // remaining to bill\r\n            qty: '', // user will enter this\r\n            taxGroupNames: item.taxGroupNames || [],\r\n            taxAmt: item.taxAmt || 0,\r\n            total: this.calcItemTotal('', item.unitPrice || 0, item.taxAmt || 0)\r\n          };\r\n        })\r\n      },\r\n      showOrderOverlay: false\r\n    }));\r\n  };\r\n\r\n  recalculateDiscounts = () => {\r\n  const { billValue, discountPercent } = this.state.formData;\r\n  const discountAmount = (parseFloat(billValue || 0) * parseFloat(discountPercent || 0)) / 100;\r\n  const afterDiscountValue = parseFloat(billValue || 0) - discountAmount; // add, not subtract\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      discountAmount: discountAmount.toFixed(2),\r\n      afterDiscountValue: afterDiscountValue.toFixed(2)\r\n    }\r\n  }));\r\n};\r\n\r\n  formatAddress = (addr) => {\r\n    if (!addr) return '';\r\n    if (typeof addr === 'string') return addr;\r\n    return [\r\n      addr.address,\r\n      [addr.city, addr.state, addr.country].filter(Boolean).join(', '),\r\n      addr.zip\r\n    ].filter(Boolean).join('\\n');\r\n  };\r\n\r\n  handleInputChange = (field, value) => {\r\n    this.setState(prev => ({\r\n      formData: { ...prev.formData, [field]: value }\r\n    }));\r\n  };\r\n\r\nhandleLineItemChange = (idx, field, value) => {\r\n    const updatedItems = [...this.state.formData.lineItems];\r\n    let val = value;\r\n    if (field === 'qty') {\r\n      const maxQty = parseFloat(updatedItems[idx].recvQty || 0);\r\n      val = Math.max(0, Math.min(parseFloat(value || 0), maxQty));\r\n    }\r\n    updatedItems[idx] = { ...updatedItems[idx], [field]: val };\r\n    if (field === 'qty' || field === 'unitPrice') {\r\n      // recalculate taxAmt and total\r\n      const taxAmt = this.calcTaxAmt(updatedItems[idx]);\r\n      updatedItems[idx].taxAmt = taxAmt;\r\n      updatedItems[idx].total = this.calcItemTotal(val, updatedItems[idx].unitPrice, taxAmt);\r\n    }\r\n    this.setState(prev => ({\r\n      formData: {\r\n        ...prev.formData,\r\n        lineItems: updatedItems\r\n      }\r\n    }), this.recalculateBillTotals);\r\n  };\r\n approveInvoice = async (invoiceId) => {\r\n    const invoiceRef = doc(db, \"cobilling\", invoiceId);\r\n    const invoiceSnap = await getDoc(invoiceRef);\r\n    if (!invoiceSnap.exists()) return alert(\"Invoice not found!\");\r\n    const invoice = invoiceSnap.data();\r\n    const orderSnap = await getDocs(\r\n      query(collection(db, \"orders\"), where(\"orderNo\", \"==\", invoice.customerOrderId))\r\n    );\r\n    if (orderSnap.empty) return alert(\"Order not found!\");\r\n    const orderDoc = orderSnap.docs[0];\r\n    const orderRef = doc(db, \"orders\", orderDoc.id);\r\n\r\n    await runTransaction(db, async (transaction) => {\r\n      const orderData = (await transaction.get(orderRef)).data();\r\n      const updatedLineItems = (orderData.lineItems || []).map(item => {\r\n        const invItem = (invoice.lineItems || []).find(li => li.itemCode === item.itemCode);\r\n        const billedQty = parseFloat(item.billedQty || 0);\r\n        const addQty = invItem ? parseFloat(invItem.qty || 0) : 0;\r\n        const orderQty = parseFloat(item.qty || item.orderQty || 0);\r\n        const newBilledQty = billedQty + addQty;\r\n        return {\r\n          ...item,\r\n          billedQty: newBilledQty,\r\n          status: newBilledQty >= orderQty ? \"Completed\" : \"Partial\"\r\n        };\r\n      });\r\n      const allCompleted = updatedLineItems.every(li => (parseFloat(li.billedQty || 0) >= parseFloat(li.qty || li.orderQty || 0)));\r\n      transaction.update(orderRef, {\r\n        lineItems: updatedLineItems,\r\n        status: allCompleted ? \"Completed\" : \"Partial\"\r\n      });\r\n      transaction.update(invoiceRef, { status: \"Approved\" });\r\n    });\r\n    alert(\"Invoice approved and order updated!\");\r\n    this.fetchCOBilling();\r\n    this.fetchOrders();\r\n  };\r\n  recalculateBillTotals = () => {\r\n  const { lineItems } = this.state.formData;\r\n  let taxAmount = 0;\r\n  let billValue = 0;\r\n  (lineItems || []).forEach(item => {\r\n    taxAmount += parseFloat(item.taxAmt || 0);\r\n    billValue += parseFloat(item.total || 0);\r\n  });\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      taxAmount: taxAmount.toFixed(2),\r\n      billValue: billValue.toFixed(2)\r\n    }\r\n  }), this.recalculateDiscounts);  // <-- add this\r\n};\r\n\r\n  calcTaxAmt = (item) => {\r\n    // Calculate tax based on selected tax group, unit price, qty\r\n    let percent = 0;\r\n    let amount = 0;\r\n    (item.taxGroupNames || []).forEach(groupName => {\r\n      const group = this.state.taxGroups.find(t => t.groupName === groupName);\r\n      if (group && Array.isArray(group.lineItems)) {\r\n        group.lineItems.forEach(comp => {\r\n          const val = parseFloat(comp.percentOrAmt || 0);\r\n          if (comp.type === 'Percentage') percent += val;\r\n          if (comp.type === 'Amount') amount += val;\r\n        });\r\n      }\r\n    });\r\n    const baseTotal = (parseFloat(item.unitPrice || 0) * parseFloat(item.qty || 1));\r\n    return ((baseTotal * percent) / 100 + amount).toFixed(2);\r\n  };\r\n\r\n  calcItemTotal = (qty, unitPrice, taxAmt) => {\r\n    qty = parseFloat(qty) || 0;\r\n    unitPrice = parseFloat(unitPrice) || 0;\r\n    taxAmt = parseFloat(taxAmt) || 0;\r\n    return ((qty * unitPrice) + taxAmt).toFixed(2);\r\n  };\r\n\r\n  showCoBillingPDFWithOrg = async (invoice) => {\r\n  if (!invoice || !Array.isArray(invoice.lineItems) || invoice.lineItems.length === 0) {\r\n    alert(\"Invoice data is incomplete.\");\r\n    return;\r\n  }\r\n\r\n  // 1. Fetch org and customer data\r\n  const orgSnap = await getDocs(collection(db, 'businessGroups'));\r\n  const org = orgSnap.docs[0]?.data() || {};\r\n  const customer = this.state.customers.find(\r\n    c => c.custshortName === invoice.customer || c.custname === invoice.customer\r\n  ) || {};\r\n\r\n  // GST State Map for Place of Supply\r\n  const gstStateMap = {\r\n    \"01\": \"Jammu & Kashmir\",\"02\": \"Himachal Pradesh\",\"03\": \"Punjab\",\"04\": \"Chandigarh\",\"05\": \"Uttarakhand\",\r\n    \"06\": \"Haryana\",\"07\": \"Delhi\",\"08\": \"Rajasthan\",\"09\": \"Uttar Pradesh\",\"10\": \"Bihar\",\"11\": \"Sikkim\",\r\n    \"12\": \"Arunachal Pradesh\",\"13\": \"Nagaland\",\"14\": \"Manipur\",\"15\": \"Mizoram\",\"16\": \"Tripura\",\"17\": \"Meghalaya\",\r\n    \"18\": \"Assam\",\"19\": \"West Bengal\",\"20\": \"Jharkhand\",\"21\": \"Odisha\",\"22\": \"Chhattisgarh\",\"23\": \"Madhya Pradesh\",\r\n    \"24\": \"Gujarat\",\"25\": \"Daman and Diu\",\"26\": \"Dadra and Nagar Haveli\",\"27\": \"Maharashtra\",\"28\": \"Andhra Pradesh (Old)\",\r\n    \"29\": \"Karnataka\",\"30\": \"Goa\",\"31\": \"Lakshadweep\",\"32\": \"Kerala\",\"33\": \"Tamil Nadu\",\"34\": \"Puducherry\",\r\n    \"35\": \"Andaman and Nicobar Islands\",\"36\": \"Telangana\",\"37\": \"Andhra Pradesh\",\"97\": \"Other Territory\"\r\n  };\r\n  const getPlaceOfSupply = (gstin) => {\r\n    if (!gstin || gstin.length < 2) return '';\r\n    const code = gstin.substring(0, 2);\r\n    const state = gstStateMap[code];\r\n    return state ? `${code} - ${state}` : '';\r\n  };\r\n\r\n  // 2. Enrich line items\r\n  const enrichedItems = invoice.lineItems.map(item => ({\r\n  ...item,\r\n  hsnCode: item.hsnCode || '',\r\n  uom: item.uom || '',\r\n  ptshortName: item.ptshortName || '',\r\n  cgst: item.cgst || 0,\r\n  sgst: item.sgst || 0,\r\n  igst: item.igst || 0,\r\n  taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\r\n}));\r\n\r\n\r\n  // 3. Subtotal\r\n  const subtotal = enrichedItems.reduce((sum, item) =>\r\n    sum + ((parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0)), 0\r\n  );\r\n  const freightCharges = parseFloat(invoice.freightCharges || 0);\r\n  const freightTax = parseFloat(invoice.freighttaxAmount || 0);\r\n  const totalTaxAmount = parseFloat(invoice.taxAmount || 0);\r\n  const grandTotal = parseFloat(invoice.invoiceValue || (subtotal + totalTaxAmount));\r\n  const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`;\r\n\r\n  // 4. Tax breakdown\r\n  let taxBreakdown = {};\r\n  let taxGroupDetails = [];\r\n  let sno = 1;\r\n  enrichedItems.forEach(item => {\r\n    const qty = parseFloat(item.qty || 0);\r\n    const unitPrice = parseFloat(item.unitPrice || 0);\r\n    const base = qty * unitPrice;\r\n    (item.taxGroupNames || []).forEach(tgName => {\r\n      const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\r\n      if (group) {\r\n        group.lineItems.forEach(li => {\r\n          const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\r\n          let taxAmt = li.type === 'Amount'\r\n            ? parseFloat(li.percentOrAmt || 0)\r\n            : (base * parseFloat(li.percentOrAmt || 0)) / 100;\r\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n          taxGroupDetails.push({\r\n            sno: sno++,\r\n            group: tgName,\r\n            peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\r\n            taxAmt: taxAmt.toFixed(2)\r\n          });\r\n        });\r\n      }\r\n    });\r\n    if (item.cgst) {\r\n      const key = `CGST ${item.cgst}%`;\r\n      const taxAmt = (base * item.cgst) / 100;\r\n      taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n      taxGroupDetails.push({ sno: sno++, group: key, peramt: `${item.cgst}%`, taxAmt: taxAmt.toFixed(2) });\r\n    }\r\n    if (item.sgst) {\r\n      const key = `SGST ${item.sgst}%`;\r\n      const taxAmt = (base * item.sgst) / 100;\r\n      taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n      taxGroupDetails.push({ sno: sno++, group: key, peramt: `${item.sgst}%`, taxAmt: taxAmt.toFixed(2) });\r\n    }\r\n    if (item.igst) {\r\n      const key = `IGST ${item.igst}%`;\r\n      const taxAmt = (base * item.igst) / 100;\r\n      taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n      taxGroupDetails.push({ sno: sno++, group: key, peramt: `${item.igst}%`, taxAmt: taxAmt.toFixed(2) });\r\n    }\r\n  });\r\n  if (freightTax > 0) {\r\n    taxBreakdown[\"Freight Tax\"] = freightTax;\r\n    taxGroupDetails.push({ sno: sno++, group: \"Freight Tax\", peramt: \"-\", taxAmt: freightTax.toFixed(2) });\r\n  }\r\n\r\n  // 5. Build HTML for PDF\r\n  const container = document.createElement('div');\r\n  container.id = 'pdf-preview-container';\r\n  container.style.width = '794px';\r\n  container.style.padding = '40px';\r\n  container.style.fontFamily = 'Arial';\r\n\r\n  container.innerHTML = `\r\n    <div style=\"display:flex; justify-content:space-between; align-items:center;\">\r\n      <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\r\n      <div style=\"font-size:18px; font-weight:bold;\">INVOICE</div>\r\n    </div>\r\n    <hr/>\r\n    <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n      <div style=\"line-height:1.5; width:50%;\">\r\n        <b>${org.bgName || ''}</b><br/>\r\n        ${org.address || ''}<br/>\r\n        <b>Email:</b> ${org.email || ''}<br/>\r\n        <b>Website:</b> ${org.website || ''}<br/>\r\n        <b>GSTIN:</b> ${org.gstin || ''}<br/>\r\n        <b>Mobile:</b> ${org.mobile || ''}<br/>\r\n        <b>CIN:</b> ${org.cin || ''}\r\n      </div>\r\n      <table style=\"font-size:11px; text-align:left;\">\r\n        <tr><td><b>Invoice No</b></td><td>: ${invoice.cobillingNo}</td></tr>\r\n        <tr><td><b>Invoice Date</b></td><td>: ${invoice.cobillingDate}</td></tr>\r\n        <tr><td><b>Currency</b></td><td>: ${invoice.currency || 'INR'}</td></tr>\r\n        <tr><td><b>Cus.Code</b></td><td>: ${invoice.customerCode || ''}</td></tr>\r\n        <tr><td><b>Despatch</b></td><td>: ${invoice.despatchMode || ''}</td></tr>\r\n      </table>\r\n    </div>\r\n\r\n    <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\r\n      <div style=\"width:48%;\">\r\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\r\n        <div style=\"border:1px solid #ccc; padding:6px;\">\r\n         <b>${invoice.customer || ''}</b><br/>\r\n          ${invoice.billTo?.replace(/\\n/g, '<br/>') || ''}\r\n        </div>\r\n        <div style=\"font-size:10px; margin-top:6px;\">\r\n            <b>GSTIN:</b> ${customer.gstin || ''}<br/>\r\n            <b>Email:</b> ${customer.email || ''}<br/>\r\n            <b>Contact:</b> ${customer.contactPerson || ''}<br/>\r\n            <b>Phone:</b> ${customer.phone || ''}\r\n        </div>\r\n      </div>\r\n      <div style=\"width:48%;\">\r\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\r\n        <div style=\"border:1px solid #ccc; padding:6px;\">\r\n         <b>${invoice.customer || ''}</b><br/>\r\n          ${invoice.shipTo?.replace(/\\n/g, '<br/>') || ''}\r\n        </div>\r\n        <div style=\"font-size:10px; margin-top:6px;\">\r\n          <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\r\n      <thead>\r\n        <tr style=\"background:#f4f6fa;\">\r\n          <th style=\"border:1px solid #011b56;\">Item Code</th>\r\n          <th style=\"border:1px solid #011b56;\">Description</th>\r\n          <th style=\"border:1px solid #011b56;\">HSN</th>\r\n          <th style=\"border:1px solid #011b56;\">UOM</th>\r\n          <th style=\"border:1px solid #011b56;\">Order Qty</th>\r\n          <th style=\"border:1px solid #011b56;\">Billed Qty</th>\r\n          <th style=\"border:1px solid #011b56;\">Unit Price</th>\r\n          <th style=\"border:1px solid #011b56;\">GST%</th>\r\n          <th style=\"border:1px solid #011b56;\">Item Total</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${enrichedItems.map(item => {\r\n          const gstLabel = (item.taxGroupNames && item.taxGroupNames.length)\r\n            ? item.taxGroupNames.join(', ')\r\n            : (item.taxGroupName || item.taxId || '-');\r\n          return `\r\n            <tr>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemCode}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemDescription}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.uom}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.orderQty}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.qty}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\r\n              <td style=\"border:1px solid #011b56;\">${gstLabel}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.total}</td>\r\n            </tr>`;\r\n        }).join('')}\r\n        <tr>\r\n          <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Grand Total</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${grandTotal.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n  <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\r\n  <td style=\"border:1px solid #011b56;\"><b>${invoice.discountAmount || '0.00'}</b></td>\r\n</tr>\r\n<tr>\r\n  <td colspan=\"8\" style=\"text-align:right; border:1px solid #011b56;\"><b>After Discount Value</b></td>\r\n  <td style=\"border:1px solid #011b56;\"><b>${invoice.afterDiscountValue || '0.00'}</b></td>\r\n</tr>\r\n      </tbody>\r\n    </table>\r\n    <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\r\n    <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\r\n  `;\r\n\r\n  document.body.appendChild(container);\r\n  const canvas = await html2canvas(container, { scale: 2, useCORS: true });\r\n  const imgData = canvas.toDataURL('image/png');\r\n  const pdf = new jsPDF('p', 'pt', 'a4');\r\n  const width = 595.28;\r\n  const height = canvas.height * width / canvas.width;\r\n  pdf.addImage(imgData, 'PNG', 0, 0, width, height);\r\n  document.body.removeChild(container);\r\n\r\n  // 6. Tax Breakdown page\r\n  if (taxGroupDetails.length > 0) {\r\n    pdf.addPage();\r\n    let taxRows = taxGroupDetails.map(row => `\r\n      <tr>\r\n        <td style=\"border:1px solid #011b56;\">${row.sno}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.group}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.taxAmt}</td>\r\n      </tr>`).join('');\r\n\r\nlet taxHtml = `<div style=\"font-family:Arial; padding:20px; width:100%;\">\r\n<h3 style=\"margin-bottom:10px; font-size:18px;\">Tax Breakdown</h3>\r\n<table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:14px;\">\r\n  <thead>\r\n    <tr style=\"background:#f4f6fa;\">\r\n      <th style=\"border:1px solid #011b56;\">S.No</th>\r\n      <th style=\"border:1px solid #011b56;\">Tax Group</th>\r\n      <th style=\"border:1px solid #011b56;\">Per/Amt</th>\r\n      <th style=\"border:1px solid #011b56;\">Tax Amt</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    ${taxRows}\r\n    <tr>\r\n      <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n      <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n</div>`;\r\n\r\n    const taxContainer = document.createElement('div');\r\n    taxContainer.innerHTML = taxHtml;\r\n    document.body.appendChild(taxContainer);\r\n\r\n    const taxCanvas = await html2canvas(taxContainer, { scale: 1.5, useCORS: true });    const taxImg = taxCanvas.toDataURL('image/png');\r\n    pdf.addImage(taxImg, 'PNG', 0, 0, width, taxCanvas.height * width / taxCanvas.width);\r\n\r\n    document.body.removeChild(taxContainer);\r\n  }\r\n\r\n  pdf.setFontSize(11);\r\n  pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\r\n  pdf.text('Authorized Signatory', width - 200, 800);\r\n\r\n  // 7. Show PDF\r\n  const blob = pdf.output('blob');\r\n  const url = URL.createObjectURL(blob);\r\n  const newWin = window.open();\r\n  newWin.document.write(`\r\n    <html><head><title>Invoice PDF Preview</title></head>\r\n    <body style=\"margin:0;\">\r\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\r\n    </body></html>\r\n  `);\r\n  newWin.document.close();\r\n};\r\n\r\n\r\n  toggleTaxGroupSelection = (groupName, lineIdx, isChecked) => {\r\n    const formData = { ...this.state.formData };\r\n    const item = formData.lineItems[lineIdx];\r\n    if (!item.taxGroupNames) item.taxGroupNames = [];\r\n    if (isChecked) {\r\n      if (!item.taxGroupNames.includes(groupName)) {\r\n        item.taxGroupNames.push(groupName);\r\n      }\r\n    } else {\r\n      item.taxGroupNames = item.taxGroupNames.filter(g => g !== groupName);\r\n    }\r\n    // recalculate taxAmt and total\r\n    item.taxAmt = this.calcTaxAmt(item);\r\n    item.total = this.calcItemTotal(item.qty, item.unitPrice, item.taxAmt);\r\n    this.setState({ formData }, this.recalculateBillTotals);\r\n  };\r\n\r\n  \r\n\r\n  handleTabChange = (idx) => this.setState({ activeTab: idx });\r\n\r\n  handleNotesChange = (e) => this.setState({ notes: e.target.value });\r\n\r\n  handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const { editingId, formData, cobilling, notes } = this.state;\r\n    if (!formData.customer) return alert(\"Customer is required\");\r\n    if (formData.lineItems.length === 0) return alert(\"At least one line item is required\");\r\n\r\n    const saveData = {\r\n      ...formData,\r\n      notes,\r\n      status: \"Awaiting Approval\",\r\n      createdAt: serverTimestamp()\r\n    };\r\n\r\n    if (editingId) {\r\n      await updateDoc(doc(db, \"cobilling\", editingId), saveData);\r\n    } else {\r\n      if (formData.cobillingType === 'Standard') {\r\n        saveData.cobillingNo = `COB${101 + cobilling.length}`;\r\n      }\r\n      await addDoc(collection(db, \"cobilling\"), saveData);\r\n    }\r\n\r\n    this.setState({\r\n      showForm: false,\r\n      editingId: null,\r\n      formData: this.getEmptyCOBillingForm(),\r\n      notes: ''\r\n    });\r\n    this.fetchCOBilling();\r\n  };\r\n\r\nrenderOrderOverlay = () => {\r\n  const { orders, orderOverlaySearch = '', currentOrderPage = 1 } = this.state;\r\n\r\n  const filtered = orders.filter(o =>\r\n    (o.orderNo || '').toLowerCase().includes(orderOverlaySearch.toLowerCase()) ||\r\n    (o.customer || '').toLowerCase().includes(orderOverlaySearch.toLowerCase())\r\n  );\r\n\r\n  const itemsPerPage = 10;\r\n  const totalPages = Math.ceil(filtered.length / itemsPerPage);\r\n  const startIdx = (currentOrderPage - 1) * itemsPerPage;\r\n  const paginated = filtered.slice(startIdx, startIdx + itemsPerPage);\r\n\r\n  return (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\">\r\n        <div className=\"custom-overlay-title\">Select Customer Order</div>\r\n\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-control mb-2\"\r\n          placeholder=\"Search by ID or Company...\"\r\n          value={orderOverlaySearch}\r\n          onChange={e => this.setState({ orderOverlaySearch: e.target.value, currentOrderPage: 1 })}\r\n        />\r\n\r\n        <div className=\"overlay-table-container\">\r\n          <table className=\"table table-bordered table-sm\">\r\n            <thead>\r\n              <tr>\r\n                <th>ID</th>\r\n                <th>Company</th>\r\n                <th>Date</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {paginated.map((o, i) => (\r\n                <tr\r\n                  key={o.id || i}\r\n                  onClick={() => this.selectOrderForInvoice(o)}\r\n                  style={{ cursor: 'pointer' }}\r\n                >\r\n                  <td>{o.orderNo}</td>\r\n                  <td>{o.customer}</td>\r\n                  <td>{o.orderDate}</td>\r\n                </tr>\r\n              ))}\r\n              {paginated.length === 0 && (\r\n                <tr>\r\n                  <td colSpan={3} className=\"text-center\">No orders found</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Pagination */}\r\n        <div className=\"overlay-pagination\">\r\n          <nav aria-label=\"Order pagination\">\r\n            <ul className=\"pagination justify-content-end mb-2\">\r\n              <li className={`page-item ${currentOrderPage === 1 ? 'disabled' : ''}`}>\r\n                <button\r\n                type='button'\r\n                  className=\"page-link\"\r\n                  onClick={() =>\r\n                    this.setState({ currentOrderPage: Math.max(currentOrderPage - 1, 1) })\r\n                  }\r\n                >\r\n                  &laquo;\r\n                </button>\r\n              </li>\r\n\r\n              {[...Array(totalPages)].map((_, idx) => (\r\n                <li key={idx} className={`page-item ${currentOrderPage === idx + 1 ? 'active' : ''}`}>\r\n                  <button\r\n                   type='button'\r\n                    className=\"page-link\"\r\n                    onClick={() => this.setState({ currentOrderPage: idx + 1 })}\r\n                  >\r\n                    {idx + 1}\r\n                  </button>\r\n                </li>\r\n              ))}\r\n\r\n              <li className={`page-item ${currentOrderPage === totalPages ? 'disabled' : ''}`}>\r\n                <button\r\n                 type='button'\r\n                  className=\"page-link\"\r\n                  onClick={() =>\r\n                    this.setState({ currentOrderPage: Math.min(currentOrderPage + 1, totalPages) })\r\n                  }\r\n                >\r\n                  &raquo;\r\n                </button>\r\n              </li>\r\n            </ul>\r\n          </nav>\r\n        </div>\r\n\r\n        {/* Footer buttons */}\r\n        <div className=\"overlay-footer\">\r\n          <button\r\n          type='submit'\r\n            className=\"btn btn-secondary btn-sm\"\r\n            onClick={this.hideOrderOverlay}\r\n          >\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n renderTaxOverlay = () => {\r\n  const { taxGroups, currentTaxIdx, formData, taxSearch = '', currentTaxPage = 1 } = this.state;\r\n  if (currentTaxIdx === null) return null;\r\n  const item = formData.lineItems[currentTaxIdx];\r\n  const selected = new Set(item.taxGroupNames || []);\r\n\r\n  const itemsPerPage = 6;\r\n  const filtered = taxGroups.filter(tg =>\r\n    tg.groupName.toLowerCase().includes(taxSearch.toLowerCase())\r\n  );\r\n  const totalPages = Math.ceil(filtered.length / itemsPerPage);\r\n  const startIdx = (currentTaxPage - 1) * itemsPerPage;\r\n  const paginated = filtered.slice(startIdx, startIdx + itemsPerPage);\r\n\r\n  return (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\">\r\n        <div className=\"custom-overlay-title\">Select Tax Groups</div>\r\n\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-control mb-2\"\r\n          placeholder=\"Search Tax Group...\"\r\n          value={taxSearch}\r\n          onChange={e => this.setState({ taxSearch: e.target.value, currentTaxPage: 1 })}\r\n        />\r\n\r\n        <div className=\"overlay-table-container\">\r\n          <table className=\"table table-sm table-bordered\">\r\n            <thead>\r\n              <tr>\r\n                <th style={{ width: '5%' }}></th>\r\n                <th style={{ width: '25%' }}>Group</th>\r\n                <th style={{ width: '50%' }}>Components</th>\r\n                <th style={{ width: '20%' }}>%</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {paginated.map(tg => (\r\n                <tr key={tg.groupName}>\r\n                  <td>\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selected.has(tg.groupName)}\r\n                      onChange={e =>\r\n                        this.toggleTaxGroupSelection(tg.groupName, currentTaxIdx, e.target.checked)\r\n                      }\r\n                    />\r\n                  </td>\r\n                  <td>{tg.groupName}</td>\r\n                  <td>{tg.lineItems.map(li => li.component).join(', ')}</td>\r\n                  <td>{tg.lineItems.map(li => li.percentOrAmt).join(', ')}</td>\r\n                </tr>\r\n              ))}\r\n              {paginated.length === 0 && (\r\n                <tr>\r\n                  <td colSpan=\"4\" className=\"text-center\">No tax groups found</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Pagination */}\r\n        <nav aria-label=\"Tax pagination example\" className=\"mt-auto\">\r\n          <ul className=\"pagination justify-content-end mb-3\">\r\n            <li className={`page-item ${currentTaxPage === 1 ? 'disabled' : ''}`}>\r\n              <button\r\n              type='button'\r\n                className=\"page-link\"\r\n                onClick={() => this.setState({ currentTaxPage: Math.max(currentTaxPage - 1, 1) })}\r\n              >\r\n                &laquo;\r\n              </button>\r\n            </li>\r\n\r\n            {[...Array(totalPages)].map((_, idx) => (\r\n              <li key={idx} className={`page-item ${currentTaxPage === idx + 1 ? 'active' : ''}`}>\r\n                <button\r\n                type='button'\r\n                  className=\"page-link\"\r\n                  onClick={() => this.setState({ currentTaxPage: idx + 1 })}\r\n                >\r\n                  {idx + 1}\r\n                </button>\r\n              </li>\r\n            ))}\r\n\r\n            <li className={`page-item ${currentTaxPage === totalPages ? 'disabled' : ''}`}>\r\n              <button\r\n              type='button'\r\n                className=\"page-link\"\r\n                onClick={() => this.setState({ currentTaxPage: Math.min(currentTaxPage + 1, totalPages) })}\r\n              >\r\n                &raquo;\r\n              </button>\r\n            </li>\r\n          </ul>\r\n        </nav>\r\n\r\n        {/* Footer buttons */}\r\n        <div className=\"overlay-footer text-start\">\r\n  <button\r\n    type=\"submit\"\r\n    className=\"btn btn-success btn-sm float-start\"\r\n    onClick={() => this.setState({ showTaxOverlay: false, currentTaxIdx: null })}\r\n  >\r\n    Done\r\n  </button>\r\n</div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n  renderTabs = () => {\r\n    const { activeTab } = this.state;\r\n    const tabNames = ['Billing Details', 'Commercial Details', 'Notes'];\r\n    return (\r\n      <ul className=\"nav nav-tabs mb-3\" style={{ fontSize: '16px' }}>\r\n        {tabNames.map((tab, idx) => (\r\n          <li className=\"nav-item\" key={tab}>\r\n            <button\r\n              type=\"button\"\r\n              className={`nav-link${activeTab === idx ? ' active' : ''}`}\r\n              onClick={() => this.handleTabChange(idx)}\r\n              style={{\r\n                background: activeTab === idx ? '#e9ecef' : '#fff',\r\n                border: '1px solid #dee2e6',\r\n                borderBottom: activeTab === idx ? 'none' : undefined,\r\n                fontWeight: activeTab === idx ? 'bold' : 'normal'\r\n              }}\r\n            >\r\n              {tab}\r\n            </button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    );\r\n  };\r\n\r\n  renderBillingTab = () => {\r\n    const { formData, showOrderOverlay, showTaxOverlay, currentTaxIdx } = this.state;\r\n    return (\r\n      <div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill Type</label>\r\n            <select\r\n              className=\"form-control form-control-sm\"\r\n              value={formData.cobillingType}\r\n              onChange={e => this.handleInputChange('cobillingType', e.target.value)}\r\n            >\r\n              <option value=\"Standard\">Standard</option>\r\n              <option value=\"Manual\">Manual</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill No</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control form-control-sm\"\r\n              value={formData.cobillingNo}\r\n              onChange={e => this.handleInputChange('cobillingNo', e.target.value)}\r\n              readOnly={formData.cobillingType === 'Standard'}\r\n              placeholder={formData.cobillingType === 'Standard' ? 'Auto' : 'Enter Bill No'}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill Date</label>\r\n            <input\r\n              type=\"date\"\r\n              className=\"form-control form-control-sm\"\r\n              value={formData.cobillingDate}\r\n              onChange={e => this.handleInputChange('cobillingDate', e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Status</label>\r\n            <input type=\"text\" className=\"form-control form-control-sm\" value={formData.status} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Ref No</label>\r\n            <input type=\"text\" className=\"form-control form-control-sm\" value={formData.refNo} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Customer Order</label>\r\n            <div className=\"input-group input-group-sm\">\r\n              <input\r\n                type=\"text\"\r\n                className=\"form-control\"\r\n                value={formData.customerOrderId}\r\n                readOnly\r\n                onClick={this.showOrderOverlay}\r\n                style={{ cursor: 'pointer' }}\r\n              />\r\n              <div className=\"input-group-append\">\r\n                <button className=\"btn btn-outline-secondary btn-sm\" type=\"button\" onClick={this.showOrderOverlay}>Select</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Currency</label>\r\n            <input type=\"text\" className=\"form-control form-control-sm\" value={formData.currency} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Conversion Rate</label>\r\n            <input type=\"text\" className=\"form-control form-control-sm\" value={formData.conversionRate} onChange={e => this.handleInputChange('conversionRate', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Tax Amount</label>\r\n            <input type=\"number\" className=\"form-control form-control-sm\" value={formData.taxAmount} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill Value</label>\r\n            <input type=\"number\" className=\"form-control form-control-sm\" value={formData.billValue} readOnly />\r\n          </div>\r\n        </div>\r\n        <div className=\"form-row\">\r\n        <div className=\"form-group col-md-2\">\r\n          <label>Discount %</label>\r\n          <input type=\"number\" className=\"form-control form-control-sm\"\r\n          value={formData.discountPercent}\r\n          onChange={e => {\r\n            this.handleInputChange('discountPercent', e.target.value);\r\n            this.recalculateDiscounts();\r\n          }}\r\n        />\r\n        </div>\r\n        <div className=\"form-group col-md-2\">\r\n          <label>Discount Amount</label>\r\n          <input type=\"number\" className=\"form-control form-control-sm\"\r\n            value={formData.discountAmount}\r\n            readOnly\r\n          />\r\n        </div>\r\n        <div className=\"form-group col-md-2\">\r\n          <label>After Discount Value</label>\r\n          <input type=\"number\" className=\"form-control form-control-sm\"\r\n            value={formData.discountPercent > 0 ? formData.afterDiscountValue : \"\"}\r\n            readOnly\r\n          />\r\n        </div>\r\n      </div>\r\n        <div className=\"table-responsive mt-3\" style={{ overflowX: 'auto' }}>\r\n          <table className=\"table table-bordered\" style={{ minWidth: 1200 }}>\r\n            <thead>\r\n              <tr>\r\n                <th style={{ position: 'sticky', left: 0, background: '#f9f9f9', zIndex: 2 }}>Item Code</th>\r\n                <th style={{ position: 'sticky', left: 90, width:'100px',background: '#f9f9f9', zIndex: 2 }}>Item Desc</th>\r\n                <th style={{ position: 'sticky', left: 160, background: '#f9f9f9', zIndex: 2 }}>Cust Part Code</th>\r\n                <th>HSN/SAC</th>\r\n                <th>Locator</th>\r\n                <th>UOM</th>\r\n                <th>On Hand</th>\r\n                <th>Unit Price</th>\r\n                <th>Order Qty</th>\r\n                <th>Recv Qty</th>\r\n                <th>Quantity</th>\r\n                <th>Tax Group</th>\r\n                <th>Tax Amt</th>\r\n                <th>Item Total</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {(formData.lineItems || []).map((item, idx) => (\r\n                <tr key={idx}>\r\n                  <td style={{ position: 'sticky', left: 0, background: '#f9f9f9', zIndex: 1 }}>{item.itemCode}</td>\r\n                  <td style={{ position: 'sticky', left: 90, width:'100px',background: '#f9f9f9', zIndex: 1 }}>{item.itemDescription}</td>\r\n                  <td style={{ position: 'sticky', left: 160, background: '#f9f9f9', zIndex: 1 }}>{item.custPartCode}</td>\r\n                  <td>{item.hsnCode}</td>\r\n                  <td>{item.locator}</td>\r\n                  <td>{item.uom}</td>\r\n                  <td>{item.onHand}</td> \r\n                  <td>{item.unitPrice}</td>\r\n                  <td>{item.orderQty}</td>\r\n                  <td>{item.recvQty}</td>\r\n                  <td>\r\n                    <input\r\n                      type=\"number\"\r\n                      className=\"form-control form-control-sm\"\r\n                      value={item.qty}\r\n                      min=\"1\"\r\n                      style={{ width: 80 }}\r\n                      onChange={e => this.handleLineItemChange(idx, 'qty', e.target.value)}\r\n                    />\r\n                  </td>\r\n                  <td>\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"btn btn-outline-primary btn-sm\"\r\n                      onClick={() => this.setState({ showTaxOverlay: true, currentTaxIdx: idx })}\r\n                    >\r\n                      Select Tax\r\n                    </button>\r\n                    <div style={{ fontSize: '10px', marginTop: '4px' }}>\r\n                      {(item.taxGroupNames || []).join(', ') || '-'}\r\n                    </div>\r\n                  </td>\r\n                  <td>{item.taxAmt}</td>\r\n                  <td>{item.total}</td>\r\n                </tr>\r\n              ))}\r\n              {(!formData.lineItems || formData.lineItems.length === 0) && (\r\n                <tr>\r\n                  <td colSpan=\"14\" className=\"text-center\">No items</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        {showOrderOverlay && this.renderOrderOverlay()}\r\n        {showTaxOverlay && this.renderTaxOverlay()}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderCommercialTab = () => {\r\n    const { formData } = this.state;\r\n    return (\r\n      <div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Despatch Mode</label>\r\n            <input type=\"text\" className=\"form-control form-control-sm\" value={formData.despatchMode} onChange={e => this.handleInputChange('despatchMode', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Payment Terms</label>\r\n            <input type=\"text\" className=\"form-control form-control-sm\" value={formData.paymentTerms} onChange={e => this.handleInputChange('paymentTerms', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Currency</label>\r\n            <input type=\"text\" className=\"form-control form-control-sm\" value={formData.currency} readOnly />\r\n          </div>\r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Freight Charges</label>\r\n            <input type=\"number\" className=\"form-control form-control-sm\" value={formData.freightCharges} onChange={e => this.handleInputChange('freightCharges', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Freight Tax Amount</label>\r\n            <input type=\"number\" className=\"form-control form-control-sm\" value={formData.freighttaxAmount} onChange={e => this.handleInputChange('freighttaxAmount', e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Packing Charges</label>\r\n            <input type=\"number\" className=\"form-control form-control-sm\" value={formData.packingCharges} onChange={e => this.handleInputChange('packingCharges', e.target.value)} />\r\n          </div>\r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-6\">\r\n            <label>Bill To</label>\r\n            <textarea className=\"form-control form-control-sm\" rows=\"2\" value={formData.billTo} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-6\">\r\n            <label>Ship To</label>\r\n            <textarea className=\"form-control form-control-sm\" rows=\"2\" value={formData.shipTo} readOnly />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderNotesTab = () => (\r\n    <div>\r\n      <div className=\"form-group\">\r\n        <label>Notes / Remarks</label>\r\n        <textarea className=\"form-control form-control-sm\" rows=\"4\" value={this.state.notes} onChange={this.handleNotesChange} />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderForm = () => {\r\n    const { activeTab } = this.state;\r\n    return (\r\n      <div className=\"card full-height\">\r\n        <form className=\"form-sample\" onSubmit={this.handleSubmit}>\r\n          <div style={{ flex: 1, overflowY: 'auto', padding: '24px' }}>\r\n            <h4 className=\"mb-3\">Customer Order Billing</h4>\r\n            {this.renderTabs()}\r\n            {activeTab === 0 && this.renderBillingTab()}\r\n            {activeTab === 1 && this.renderCommercialTab()}\r\n            {activeTab === 2 && this.renderNotesTab()}\r\n            <div className=\"fixed-card-footer text-right p-3 border-top bg-white\">\r\n              <button type=\"submit\" className=\"btn btn-success mr-2\">Save Invoice</button>\r\n              <button type=\"button\" className=\"btn btn-secondary\" onClick={() => this.setState({ showForm: false, editingId: null, formData: this.getEmptyCOBillingForm(), notes: '' })}>Cancel</button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderTable = () => (\r\n    <div className=\"card mt-4 full-height\">\r\n      <div className=\"card-body\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n          <h4 className=\"card-title\">Customer Order Billing</h4>\r\n          <button className=\"btn btn-primary\" onClick={() => this.setState({ showForm: true })}>Create</button>\r\n        </div>\r\n        <div className=\"mb-3\">\r\n  <input\r\n    type=\"text\"\r\n    className=\"form-control\"\r\n    placeholder=\"Search by Bill No, Customer, Status, Date...\"\r\n    value={this.state.searchTerm}\r\n    onChange={(e) => this.setState({ searchTerm: e.target.value })}\r\n  />\r\n</div>\r\n\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr>\r\n                <th>Bill No</th>\r\n                <th>Customer Order</th>\r\n                <th>Customer</th>\r\n                <th>Date</th>\r\n                <th>Bill Value</th>\r\n                <th>After Discount</th>\r\n                <th>Status</th>\r\n                <th>Print</th>\r\n              </tr>\r\n            </thead>\r\n<tbody>\r\n  {this.state.cobilling\r\n    .filter((inv) => {\r\n      const term = this.state.searchTerm.toLowerCase();\r\n      if (!term) return true; // no filter if empty\r\n\r\n      return (\r\n        (inv.cobillingNo || \"\").toLowerCase().includes(term) ||\r\n        (inv.customerOrderId || \"\").toLowerCase().includes(term) ||\r\n        (inv.customer || \"\").toLowerCase().includes(term) ||\r\n        (inv.cobillingDate || \"\").toLowerCase().includes(term) ||\r\n        (inv.status || \"\").toLowerCase().includes(term) ||\r\n        (inv.billValue?.toString() || \"\").toLowerCase().includes(term) ||\r\n        (inv.afterDiscountValue?.toString() || \"\").toLowerCase().includes(term)\r\n      );\r\n    }).map((inv, i) => {\r\n    let statusClass = \"badge-secondary\";\r\n    if (inv.status === \"Approved\") statusClass = \"badge-success\";\r\n    else if (inv.status === \"Amended\") statusClass = \"badge-info\";\r\n    else if (inv.status === \"Cancelled\") statusClass = \"badge-danger\";\r\n    else if (inv.status === \"Awaiting Approval\" || inv.status === \"Pending\") statusClass = \"badge-warning\";\r\n    else if (inv.status === \"Partial\") statusClass = \"badge-secondary\"; // ✅ new option\r\n\r\n    return (\r\n      <tr key={i}>\r\n        <td>\r\n            <button\r\n              className=\"btn btn-link p-0\"\r\n              style={{ color: \"#2196F3\", cursor: \"pointer\" }}\r\n              onClick={() =>\r\n                this.setState({\r\n                  showForm: true,\r\n                  editingId: inv.id,\r\n                  formData: { ...inv }\r\n                })\r\n              }\r\n            >\r\n              {inv.cobillingNo}\r\n            </button>\r\n        </td>\r\n        <td>{inv.customerOrderId}</td>\r\n        <td>{inv.customer}</td>\r\n        <td>{inv.cobillingDate}</td>\r\n        <td>{inv.billValue}</td>\r\n        <td>{inv.afterDiscountValue}</td>\r\n        <td>\r\n          <label\r\n            className={`badge ${statusClass}`}\r\n            style={{ fontSize: \"14px\" }}\r\n          >\r\n            {inv.status}\r\n          </label>\r\n        </td>\r\n        <td>\r\n          <i\r\n            className=\"mdi mdi-printer menu-icon\"\r\n            onClick={() => this.showCoBillingPDFWithOrg(inv)}\r\n            style={{ fontSize: \"24px\", color: \"#2196F3\", cursor: \"pointer\" }}\r\n          ></i>\r\n        </td>\r\n        \r\n      </tr>\r\n    );\r\n  })}\r\n  {this.state.cobilling.length === 0 && (\r\n    <tr>\r\n      <td colSpan=\"8\" className=\"text-center\">\r\n        No cobilling found.\r\n      </td>\r\n    </tr>\r\n  )}\r\n</tbody>\r\n\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        {this.state.showForm ? this.renderForm() : this.renderTable()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CustomerOrderBilling;"]},"metadata":{},"sourceType":"module"}