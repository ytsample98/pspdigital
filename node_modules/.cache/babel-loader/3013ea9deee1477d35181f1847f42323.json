{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\admin\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\invoice\\\\DirectBilling.js\";\nimport React, { Component } from 'react';\nimport { Form } from 'react-bootstrap';\nimport bsCustomFileInput from 'bs-custom-file-input';\nimport { db } from '../../../../firebase';\nimport { collection, getDocs, addDoc, doc, updateDoc, serverTimestamp } from 'firebase/firestore';\nimport html2canvas from 'html2canvas';\nimport { jsPDF } from 'jspdf';\nimport { toWords } from 'number-to-words';\nimport { withRouter } from 'react-router-dom';\nimport { recalculateTotals, getTaxDetailsFromGroup } from '../calculation';\n\nconst numberToWords = num => {\n  const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];\n  const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];\n  if (num === 0) return 'Zero';\n  if (num < 20) return a[num];\n  if (num < 100) return b[Math.floor(num / 10)] + ' ' + a[num % 10];\n  if (num < 1000) return a[Math.floor(num / 100)] + ' Hundred ' + numberToWords(num % 100);\n  if (num < 100000) return numberToWords(Math.floor(num / 1000)) + ' Thousand ' + numberToWords(num % 1000);\n  return 'Amount too large';\n};\n\nclass DirectBilling extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      activeTab: 'co',\n      invoices: [],\n      customers: [],\n      products: [],\n      despatchModes: [],\n      paymentTerms: [],\n      showForm: false,\n      editingId: null,\n      showTaxOverlay: false,\n      currentTaxIdx: null,\n      overlayType: '',\n      overlaySearch: '',\n      productOverlayVisible: false,\n      productOverlaySearch: '',\n      selectedProductIds: [],\n      taxGroups: [],\n      formData: {\n        invoiceNo: '',\n        invoiceDate: new Date().toISOString().split('T')[0],\n        invoiceType: 'Standard',\n        customer: '',\n        status: 'Entered',\n        choose: 'Service',\n        qrefNo: '',\n        impExp: 'None',\n        currency: '',\n        conversionRate: '',\n        taxAmount: '',\n        invoiceValue: '',\n        discountPercent: 0,\n        discountAmount: 0,\n        afterDiscountValue: 0,\n        billTo: '',\n        shipTo: '',\n        despatchMode: 'By Air',\n        paymentTerms: '',\n        freightCharges: '',\n        freighttaxAmount: '',\n        taxPercent: '',\n        packingCharges: '',\n        lineItems: []\n      }\n    };\n    this.customerInputRef = React.createRef();\n\n    this.formatAddress = addr => {\n      if (!addr) return '';\n      if (typeof addr === 'string') return addr;\n      return [addr.address, [addr.city, addr.state, addr.country].filter(Boolean).join(', '), addr.zip].filter(Boolean).join('\\n');\n    };\n\n    this.showDirectBillingPDFWithOrg = async invoice => {\n      var _orgSnap$docs$, _invoice$billTo, _invoice$shipTo;\n\n      if (!invoice || !Array.isArray(invoice.lineItems) || invoice.lineItems.length === 0) {\n        alert(\"Invoice data is incomplete.\");\n        return;\n      } // 1. Fetch org and customer data\n\n\n      const orgSnap = await getDocs(collection(db, 'businessGroups'));\n      const org = ((_orgSnap$docs$ = orgSnap.docs[0]) === null || _orgSnap$docs$ === void 0 ? void 0 : _orgSnap$docs$.data()) || {};\n      const customer = this.state.customers.find(c => c.custshortName === invoice.customer || c.custname === invoice.customer) || {}; // GST State Map\n\n      const gstStateMap = {\n        \"01\": \"Jammu & Kashmir\",\n        \"02\": \"Himachal Pradesh\",\n        \"03\": \"Punjab\",\n        \"04\": \"Chandigarh\",\n        \"05\": \"Uttarakhand\",\n        \"06\": \"Haryana\",\n        \"07\": \"Delhi\",\n        \"08\": \"Rajasthan\",\n        \"09\": \"Uttar Pradesh\",\n        \"10\": \"Bihar\",\n        \"11\": \"Sikkim\",\n        \"12\": \"Arunachal Pradesh\",\n        \"13\": \"Nagaland\",\n        \"14\": \"Manipur\",\n        \"15\": \"Mizoram\",\n        \"16\": \"Tripura\",\n        \"17\": \"Meghalaya\",\n        \"18\": \"Assam\",\n        \"19\": \"West Bengal\",\n        \"20\": \"Jharkhand\",\n        \"21\": \"Odisha\",\n        \"22\": \"Chhattisgarh\",\n        \"23\": \"Madhya Pradesh\",\n        \"24\": \"Gujarat\",\n        \"25\": \"Daman and Diu\",\n        \"26\": \"Dadra and Nagar Haveli\",\n        \"27\": \"Maharashtra\",\n        \"28\": \"Andhra Pradesh (Old)\",\n        \"29\": \"Karnataka\",\n        \"30\": \"Goa\",\n        \"31\": \"Lakshadweep\",\n        \"32\": \"Kerala\",\n        \"33\": \"Tamil Nadu\",\n        \"34\": \"Puducherry\",\n        \"35\": \"Andaman and Nicobar Islands\",\n        \"36\": \"Telangana\",\n        \"37\": \"Andhra Pradesh\",\n        \"97\": \"Other Territory\"\n      };\n\n      const getPlaceOfSupply = gstin => {\n        if (!gstin || gstin.length < 2) return '';\n        const code = gstin.substring(0, 2);\n        const state = gstStateMap[code];\n        return state ? `${code} - ${state}` : '';\n      }; // 2. Enrich line items\n\n\n      const enrichedItems = invoice.lineItems.map(item => ({ ...item,\n        hsnCode: item.hsnCode || '',\n        uom: item.uom || '',\n        ptshortName: item.ptshortName || '',\n        taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\n      })); // 3. Totals\n\n      const subtotal = enrichedItems.reduce((sum, item) => sum + (parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0), 0);\n      const freightCharges = parseFloat(invoice.freightCharges || 0);\n      const packingCharges = parseFloat(invoice.packingCharges || 0);\n      const freightTax = parseFloat(invoice.freighttaxAmount || 0);\n      const totalTaxAmount = parseFloat(invoice.taxAmount || 0);\n      const discountAmount = invoice.discountAmount ? parseFloat(invoice.discountAmount) : 0;\n      const afterDiscountValue = invoice.afterDiscountValue ? parseFloat(invoice.afterDiscountValue) : null;\n      const invoiceValue = parseFloat(invoice.invoiceValue || subtotal + totalTaxAmount + freightCharges + packingCharges);\n      const grandTotal = afterDiscountValue !== null ? afterDiscountValue : invoiceValue;\n      const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`; // 4. Tax breakdown\n\n      let taxBreakdown = {};\n      let taxGroupDetails = [];\n      let sno = 1;\n      enrichedItems.forEach(item => {\n        const qty = parseFloat(item.qty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const base = qty * unitPrice;\n        (item.taxGroupNames || []).forEach(tgName => {\n          const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\n\n          if (group) {\n            group.lineItems.forEach(li => {\n              const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\n              let taxAmt = li.type === 'Amount' ? parseFloat(li.percentOrAmt || 0) : base * parseFloat(li.percentOrAmt || 0) / 100;\n              taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n              taxGroupDetails.push({\n                sno: sno++,\n                group: tgName,\n                peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\n                taxAmt: taxAmt.toFixed(2)\n              });\n            });\n          }\n        });\n      });\n\n      if (freightTax > 0) {\n        taxBreakdown[\"Freight Tax\"] = freightTax;\n        taxGroupDetails.push({\n          sno: sno++,\n          group: \"Freight Tax\",\n          peramt: \"-\",\n          taxAmt: freightTax.toFixed(2)\n        });\n      } // 5. Build HTML for PDF\n\n\n      const container = document.createElement('div');\n      container.id = 'pdf-preview-container';\n      container.style.width = '794px';\n      container.style.padding = '40px';\n      container.style.fontFamily = 'Arial';\n      container.innerHTML = `\n    <div style=\"display:flex; justify-content:space-between; align-items:center;\">\n      <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\n      <div style=\"font-size:18px; font-weight:bold;\">DIRECT BILLING INVOICE</div>\n    </div>\n    <hr/>\n    <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\n      <div style=\"line-height:1.5; width:50%;\">\n        <b>${org.bgName || ''}</b><br/>\n        ${org.address || ''}<br/>\n        <b>Email:</b> ${org.email || ''}<br/>\n        <b>Website:</b> ${org.website || ''}<br/>\n        <b>GSTIN:</b> ${org.gstin || ''}<br/>\n        <b>Mobile:</b> ${org.mobile || ''}<br/>\n        <b>CIN:</b> ${org.cin || ''}\n      </div>\n      <table style=\"font-size:11px; text-align:left;\">\n        <tr><td><b>Invoice No</b></td><td>: ${invoice.directbillingNo || ''}</td></tr>\n        <tr><td><b>Invoice Date</b></td><td>: ${invoice.directbillingDate || ''}</td></tr>\n        <tr><td><b>Currency</b></td><td>: ${invoice.currency || 'INR'}</td></tr>\n        <tr><td><b>Despatch</b></td><td>: ${invoice.despatchMode || ''}</td></tr>\n      </table>\n    </div>\n\n    <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\n      <div style=\"width:48%;\">\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\n        <div style=\"border:1px solid #ccc; padding:6px;\">\n         <b>${invoice.customer || ''}</b><br/>\n          ${((_invoice$billTo = invoice.billTo) === null || _invoice$billTo === void 0 ? void 0 : _invoice$billTo.replace(/\\n/g, '<br/>')) || ''}\n        </div>\n        <div style=\"font-size:10px; margin-top:6px;\">\n            <b>GSTIN:</b> ${customer.gstin || ''}<br/>\n            <b>Email:</b> ${customer.email || ''}<br/>\n            <b>Contact:</b> ${customer.contactPerson || ''}<br/>\n            <b>Phone:</b> ${customer.phone || ''}\n        </div>\n      </div>\n      <div style=\"width:48%;\">\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\n        <div style=\"border:1px solid #ccc; padding:6px;\">\n         <b>${invoice.customer || ''}</b><br/>\n          ${((_invoice$shipTo = invoice.shipTo) === null || _invoice$shipTo === void 0 ? void 0 : _invoice$shipTo.replace(/\\n/g, '<br/>')) || ''}\n        </div>\n        <div style=\"font-size:10px; margin-top:6px;\">\n          <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\n        </div>\n      </div>\n    </div>\n\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\n      <thead>\n        <tr style=\"background:#f4f6fa;\">\n          <th style=\"border:1px solid #011b56;\">Item Code</th>\n          <th style=\"border:1px solid #011b56;\">Description</th>\n          <th style=\"border:1px solid #011b56;\">HSN</th>\n          <th style=\"border:1px solid #011b56;\">UOM</th>\n          <th style=\"border:1px solid #011b56;\">Qty</th>\n          <th style=\"border:1px solid #011b56;\">Unit Price</th>\n          <th style=\"border:1px solid #011b56;\">GST Group</th>\n          <th style=\"border:1px solid #011b56;\">Item Total</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${enrichedItems.map(item => {\n        const gstLabel = item.taxGroupNames && item.taxGroupNames.length ? item.taxGroupNames.join(', ') : item.taxGroupName || item.taxId || '-';\n        return `\n            <tr>\n              <td style=\"border:1px solid #011b56;\">${item.itemCode || ''}</td>\n              <td style=\"border:1px solid #011b56;\">${item.itemDescription || ''}</td>\n              <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\n              <td style=\"border:1px solid #011b56;\">${item.uom}</td>\n              <td style=\"border:1px solid #011b56;\">${item.qty}</td>\n              <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\n              <td style=\"border:1px solid #011b56;\">${gstLabel}</td>\n              <td style=\"border:1px solid #011b56;\">${item.itemTotal}</td>\n            </tr>`;\n      }).join('')}\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Freight Charges</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${freightCharges.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Packing Charges</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${packingCharges.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Invoice Value</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${invoiceValue.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${invoice.discountAmount || ''}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>After Discount Value</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${invoice.afterDiscountValue || ''}</b></td>\n        </tr>\n      </tbody>\n    </table>\n    <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\n    <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\n  `;\n      document.body.appendChild(container);\n      const canvas = await html2canvas(container, {\n        scale: 2,\n        useCORS: true\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF('p', 'pt', 'a4');\n      const width = 595.28;\n      const height = canvas.height * width / canvas.width;\n      pdf.addImage(imgData, 'PNG', 0, 0, width, height);\n      document.body.removeChild(container); // 6. Tax Breakdown page\n\n      if (taxGroupDetails.length > 0) {\n        pdf.addPage();\n        let taxRows = taxGroupDetails.map(row => `\n      <tr>\n        <td style=\"border:1px solid #011b56;\">${row.sno}</td>\n        <td style=\"border:1px solid #011b56;\">${row.group}</td>\n        <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\n        <td style=\"border:1px solid #011b56;\">${row.taxAmt}</td>\n      </tr>`).join('');\n        let taxHtml = `<div style=\"font-family:Arial; padding:20px; width:100%;\">\n    <h3 style=\"margin-bottom:10px; font-size:18px;\">Tax Breakdown</h3>\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:14px;\">\n      <thead>\n        <tr style=\"background:#f4f6fa;\">\n          <th style=\"border:1px solid #011b56;\">S.No</th>\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\n          <th style=\"border:1px solid #011b56;\">Per/Amt</th>\n          <th style=\"border:1px solid #011b56;\">Tax Amt</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${taxRows}\n        <tr>\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\n        </tr>\n      </tbody>\n    </table>\n    </div>`;\n        const taxContainer = document.createElement('div');\n        taxContainer.innerHTML = taxHtml;\n        document.body.appendChild(taxContainer);\n        const taxCanvas = await html2canvas(taxContainer, {\n          scale: 1.5,\n          useCORS: true\n        });\n        const taxImg = taxCanvas.toDataURL('image/png');\n        pdf.addImage(taxImg, 'PNG', 0, 0, width, taxCanvas.height * width / taxCanvas.width);\n        document.body.removeChild(taxContainer);\n      }\n\n      pdf.setFontSize(11);\n      pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\n      pdf.text('Authorized Signatory', width - 200, 800); // 7. Show PDF\n\n      const blob = pdf.output('blob');\n      const url = URL.createObjectURL(blob);\n      const newWin = window.open();\n      newWin.document.write(`\n    <html><head><title>Direct Billing PDF Preview</title></head>\n    <body style=\"margin:0;\">\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\n    </body></html>\n  `);\n      newWin.document.close();\n    };\n\n    this.calculateinvoiceTotals = () => {\n      const {\n        impExp,\n        freightCharges,\n        taxPercent,\n        packingCharges,\n        lineItems\n      } = this.state.formData;\n      let freight = parseFloat(freightCharges) || 0;\n      let packing = parseFloat(packingCharges) || 0;\n      let taxOnFreight = 0;\n\n      if (['None', 'CIF'].includes(impExp)) {\n        taxOnFreight = freight * (parseFloat(taxPercent) || 0) / 100;\n      }\n\n      let lineTotal = 0;\n      let itemTaxTotal = 0;\n      const updatedLineItems = lineItems.map(item => {\n        var _item$taxGroupNames;\n\n        const qty = parseFloat(item.qty || 1);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const baseTotal = unitPrice * qty;\n        const groupNames = ((_item$taxGroupNames = item.taxGroupNames) === null || _item$taxGroupNames === void 0 ? void 0 : _item$taxGroupNames.length) ? item.taxGroupNames : [item.taxGroup || ''];\n        let percent = 0;\n        let amount = 0;\n        groupNames.forEach(groupName => {\n          const group = this.state.taxGroups.find(t => t.groupName === groupName);\n\n          if (group && Array.isArray(group.lineItems)) {\n            group.lineItems.forEach(comp => {\n              const val = parseFloat(comp.percentOrAmt || 0);\n              if (comp.type === 'Percentage') percent += val;\n              if (comp.type === 'Amount') amount += val;\n            });\n          }\n        });\n        const taxAmt = baseTotal * percent / 100 + amount;\n        const total = baseTotal;\n        item.taxAmt = taxAmt.toFixed(2);\n        item.total = total.toFixed(2);\n        lineTotal += baseTotal;\n        itemTaxTotal += taxAmt;\n        return item;\n      });\n      const totalTaxAmount = itemTaxTotal + taxOnFreight;\n      const invoiceValue = lineTotal + freight + packing + itemTaxTotal;\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          taxAmount: totalTaxAmount.toFixed(2),\n          // ✅ Top-level field\n          invoiceValue: invoiceValue.toFixed(2),\n          lineItems: updatedLineItems\n        }\n      }));\n    };\n\n    this.handleDiscountChange = (field, value) => {\n      let {\n        formData\n      } = this.state;\n      formData[field] = value;\n      const quoteValue = parseFloat(formData.quoteValue || 0);\n      const discountPercent = parseFloat(formData.discountPercent || 0);\n      const discountAmount = quoteValue * discountPercent / 100;\n      const afterDiscountValue = quoteValue - discountAmount;\n      formData.discountAmount = discountAmount;\n      formData.afterDiscountValue = afterDiscountValue;\n      this.setState({\n        formData\n      });\n    };\n\n    this.fetchTaxGroups = async () => {\n      const snap = await getDocs(collection(db, 'taxGroups'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        taxGroups: data\n      });\n    };\n\n    this.fetchinvoice = async () => {\n      const snap = await getDocs(collection(db, 'invoices')); // <-- Correct collection name\n\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        invoices: data.reverse()\n      });\n    };\n\n    this.fetchCustomers = async () => {\n      const snap = await getDocs(collection(db, 'customers'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        customers: data\n      });\n    };\n\n    this.fetchProducts = async () => {\n      const snap = await getDocs(collection(db, 'products'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        products: data\n      });\n    };\n\n    this.fetchDespatchModes = async () => {\n      const snap = await getDocs(collection(db, 'modes'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        despatchModes: data\n      });\n    };\n\n    this.fetchPaymentTerms = async () => {\n      const snap = await getDocs(collection(db, 'paymentTerms'));\n      const data = snap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      this.setState({\n        paymentTerms: data\n      });\n    };\n\n    this.handleInputChange = (field, value) => {\n      this.setState(prev => {\n        const newForm = { ...prev.formData,\n          [field]: value\n        }; // When switching to FOB clear freight-related fields\n\n        if (field === 'impExp' && value === 'FOB') {\n          newForm.freightCharges = '';\n          newForm.taxPercent = '';\n          newForm.freighttaxAmount = '';\n          newForm.taxAmount = '';\n          newForm.packingCharges = '';\n          newForm.invoiceValue = '';\n        }\n\n        return {\n          formData: newForm\n        };\n      }, () => {\n        // Recalculate whenever fields that affect totals are changed\n        if (['freightCharges', 'packingCharges', 'taxPercent', 'impExp', 'discountPercent'].includes(field)) {\n          this.recalculateDirectBillingTotals();\n        }\n      });\n    };\n\n    this.handleLineItemChange = (idx, field, value) => {\n      const updatedItems = [...this.state.formData.lineItems];\n      updatedItems[idx] = { ...updatedItems[idx],\n        [field]: value\n      };\n      const qty = parseFloat(updatedItems[idx].qty || 0);\n      const unitPrice = parseFloat(updatedItems[idx].unitPrice || 0); // compute tax & item total numerically\n\n      const taxAmtNum = this.calcTaxAmt(updatedItems[idx]);\n      updatedItems[idx].taxAmt = taxAmtNum; // numeric here; will be formatted in recalc\n\n      updatedItems[idx].itemTotal = this.calcItemTotal(qty, unitPrice, taxAmtNum);\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: updatedItems\n        }\n      }), this.recalculateDirectBillingTotals);\n    };\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      const {\n        editingId,\n        formData,\n        invoices\n      } = this.state;\n      if (!formData.customer) return alert(\"Customer is required\");\n      if (formData.lineItems.length === 0) return alert(\"At least one line item is required\");\n\n      if (editingId) {\n        const {\n          id,\n          ...formDataWithoutId\n        } = formData;\n        await updateDoc(doc(db, \"invoices\", editingId), { ...formDataWithoutId,\n          status: \"Entered\",\n          updatedAt: serverTimestamp()\n        });\n      } else {\n        formData.invoiceNo = `INV${1000 + invoices.length}`;\n        await addDoc(collection(db, \"invoices\"), { ...formData,\n          status: \"Entered\",\n          createdAt: serverTimestamp()\n        });\n      }\n\n      this.setState({\n        showForm: false,\n        editingId: null,\n        formData: this.getEmptyInvoiceForm()\n      });\n      this.fetchinvoice();\n    };\n\n    this.getEmptyInvoiceForm = () => ({\n      invoiceNo: '',\n      invoiceDate: new Date().toISOString().split('T')[0],\n      invoiceType: 'Standard',\n      customer: '',\n      status: 'Entered',\n      choose: 'Service',\n      qrefNo: '',\n      impExp: 'None',\n      currency: '',\n      conversionRate: '',\n      taxAmount: '',\n      invoiceValue: '',\n      discountPercent: 0,\n      discountAmount: 0,\n      afterDiscountValue: 0,\n      billTo: '',\n      shipTo: '',\n      despatchMode: 'By Air',\n      paymentTerms: '',\n      freightCharges: '',\n      freighttaxAmount: '',\n      taxPercent: '',\n      packingCharges: '',\n      lineItems: []\n    });\n\n    this.openNewForm = () => {\n      this.setState({\n        showForm: true,\n        editingId: null,\n        formData: this.getEmptyInvoiceForm() // fresh blank form\n\n      });\n    };\n\n    this.loadinvoiceForEdit = invoice => {\n      const normalizedLineItems = (invoice.lineItems || []).map(item => {\n        const qty = parseFloat(item.qty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const baseTotal = qty * unitPrice;\n        const taxAmt = item.taxAmt ? parseFloat(item.taxAmt) : this.calcTaxAmt(item);\n        const itemTotal = item.itemTotal ? parseFloat(item.itemTotal) : baseTotal + taxAmt;\n        return { ...item,\n          qty,\n          unitPrice,\n          taxAmt: taxAmt.toFixed(2),\n          itemTotal: itemTotal.toFixed(2),\n          taxGroupNames: item.taxGroupNames || (item.taxGroup ? [item.taxGroup] : [])\n        };\n      });\n      this.setState({\n        formData: { ...invoice,\n          lineItems: normalizedLineItems\n        },\n        editingId: invoice.id,\n        showForm: true,\n        activeTab: 'co'\n      }, this.recalculateDirectBillingTotals);\n    };\n\n    this.toggleInvoiceForm = () => {\n      this.setState({\n        showForm: true,\n        editingId: null,\n        formData: this.getEmptyInvoiceForm()\n      });\n    };\n\n    this.showOverlay = type => this.setState({\n      overlayType: type,\n      overlaySearch: ''\n    });\n\n    this.hideOverlay = () => this.setState({\n      overlayType: '',\n      overlaySearch: ''\n    });\n\n    this.selectOverlayValue = value => {\n      if (this.state.overlayType === 'customer') {\n        this.setState(prev => ({\n          formData: { ...prev.formData,\n            customer: value.custname || value.custcode || '',\n            // Use custname or custcode\n            billTo: this.formatAddress(value.billTo),\n            shipTo: this.formatAddress(value.shipTo),\n            currency: value.currency || '' // despatchMode: value.despatchMode || '', // No auto-fill for despatch mode\n            // paymentTerms: value.paymentTerms || '' // No auto-fill for payment terms\n\n          },\n          overlayType: '',\n          overlaySearch: ''\n        }), () => {\n          if (this.customerInputRef.current) {\n            this.customerInputRef.current.value = value.custname || value.custcode || '';\n          }\n        });\n      }\n    };\n\n    this.renderOverlay = () => {\n      const {\n        overlayType,\n        overlaySearch,\n        customers,\n        despatchModes,\n        paymentTerms\n      } = this.state;\n\n      const getFilteredRows = (list, nameKey = 'name', codeKey = 'shortName') => list.filter(item => (item[nameKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase()) || (item[codeKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase()));\n\n      const handleSelect = item => {\n        if (overlayType === 'customer') {\n          this.selectOverlayValue(item);\n        } else if (overlayType === 'despatchMode') {\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              despatchMode: item.name\n            },\n            overlayType: '',\n            overlaySearch: ''\n          }));\n        } else if (overlayType === 'paymentTerms') {\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              paymentTerms: item.name\n            },\n            overlayType: '',\n            overlaySearch: ''\n          }));\n        }\n      };\n\n      let title = '';\n      let headers = [];\n      let rows = [];\n\n      if (overlayType === 'customer') {\n        title = 'Select Customer';\n        headers = ['Name', 'Code', 'Short Name'];\n        rows = getFilteredRows(customers, 'custname', 'custcode');\n      } else if (overlayType === 'despatchMode') {\n        title = 'Select Despatch Mode';\n        headers = ['Name'];\n        rows = getFilteredRows(despatchModes);\n      } else if (overlayType === 'paymentTerms') {\n        title = 'Select Payment Terms';\n        headers = ['Name'];\n        rows = getFilteredRows(paymentTerms);\n      } else {\n        return null;\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 750,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 751,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 752,\n          columnNumber: 9\n        }\n      }, title), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control mb-2\",\n        placeholder: `Search ${overlayType}...`,\n        value: overlaySearch,\n        onChange: e => this.setState({\n          overlaySearch: e.target.value\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 753,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          maxHeight: 300,\n          overflowY: 'auto'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 760,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 761,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 762,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 763,\n          columnNumber: 15\n        }\n      }, headers.map((h, i) => /*#__PURE__*/React.createElement(\"th\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 764,\n          columnNumber: 40\n        }\n      }, h)))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 767,\n          columnNumber: 13\n        }\n      }, rows.map((item, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: item.id || i,\n        onClick: () => handleSelect(item),\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 769,\n          columnNumber: 17\n        }\n      }, headers.map((h, j) => /*#__PURE__*/React.createElement(\"td\", {\n        key: j,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 771,\n          columnNumber: 21\n        }\n      }, overlayType === 'customer' ? h === 'Name' ? item.custname : h === 'Code' ? item.custcode : item.custshortName : h === 'Name' ? item.name : item.shortName)))), rows.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 783,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: headers.length,\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 784,\n          columnNumber: 19\n        }\n      }, \"No records found\"))))), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary btn-sm mt-2\",\n        onClick: this.hideOverlay,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 790,\n          columnNumber: 9\n        }\n      }, \"Cancel\")));\n    };\n\n    this.renderTaxOverlay = () => {\n      const {\n        taxGroups,\n        currentTaxIdx,\n        formData\n      } = this.state;\n      if (currentTaxIdx === null) return null;\n      const item = formData.lineItems[currentTaxIdx];\n      const selected = new Set(item.taxGroupNames || []);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          position: 'fixed',\n          zIndex: 1000,\n          top: '10%',\n          left: '15%',\n          background: '#fff',\n          border: '1px solid #ccc',\n          padding: '20px',\n          boxShadow: '0 0 10px rgba(0,0,0,0.3)',\n          width: '70%',\n          maxHeight: '70vh',\n          overflowY: 'auto'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 803,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"h5\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 809,\n          columnNumber: 7\n        }\n      }, \"Select Tax Groups\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-sm table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 810,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 811,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 812,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 812,\n          columnNumber: 15\n        }\n      }), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 812,\n          columnNumber: 24\n        }\n      }, \"Group\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 812,\n          columnNumber: 38\n        }\n      }, \"Components\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 812,\n          columnNumber: 57\n        }\n      }, \"%\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 814,\n          columnNumber: 9\n        }\n      }, taxGroups.map(tg => /*#__PURE__*/React.createElement(\"tr\", {\n        key: tg.groupName,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 816,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 817,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: selected.has(tg.groupName),\n        onChange: e => this.toggleTaxGroupSelection(tg.groupName, currentTaxIdx, e.target.checked),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 818,\n          columnNumber: 17\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 826,\n          columnNumber: 15\n        }\n      }, tg.groupName), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 827,\n          columnNumber: 15\n        }\n      }, tg.lineItems.map(li => li.component).join(', ')), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 828,\n          columnNumber: 15\n        }\n      }, tg.lineItems.map(li => li.percentOrAmt).join(', ')))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"text-right mt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 833,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-sm btn-success\",\n        onClick: () => this.setState({\n          showTaxOverlay: false,\n          currentTaxIdx: null\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 834,\n          columnNumber: 9\n        }\n      }, \"Done\")));\n    };\n\n    this.toggleTaxGroupSelection = (groupName, lineIdx, isChecked) => {\n      const formData = { ...this.state.formData\n      };\n      const item = formData.lineItems[lineIdx];\n      if (!item.taxGroupNames) item.taxGroupNames = [];\n\n      if (isChecked) {\n        if (!item.taxGroupNames.includes(groupName)) {\n          item.taxGroupNames.push(groupName);\n        }\n      } else {\n        item.taxGroupNames = item.taxGroupNames.filter(g => g !== groupName);\n      } // recalculate taxAmt and total// after changing taxGroupNames on the item:\n\n\n      item.taxAmt = this.calcTaxAmt(item); // numeric\n\n      item.itemTotal = this.calcItemTotal(item.qty, item.unitPrice, item.taxAmt); // numeric\n\n      this.setState({\n        formData\n      }, this.recalculateDirectBillingTotals);\n    };\n\n    this.calcTaxAmt = item => {\n      let percent = 0;\n      let amount = 0;\n      (item.taxGroupNames || []).forEach(groupName => {\n        const group = this.state.taxGroups.find(t => t.groupName === groupName);\n\n        if (group && Array.isArray(group.lineItems)) {\n          group.lineItems.forEach(comp => {\n            const val = parseFloat(comp.percentOrAmt || 0);\n            if (comp.type === 'Percentage') percent += val;\n            if (comp.type === 'Amount') amount += val;\n          });\n        }\n      });\n      const baseTotal = parseFloat(item.unitPrice || 0) * parseFloat(item.qty || 0);\n      const tax = baseTotal * percent / 100 + amount;\n      return isNaN(tax) ? 0 : tax;\n    };\n\n    this.calcItemTotal = (qty, unitPrice, taxAmt) => {\n      qty = parseFloat(qty) || 0;\n      unitPrice = parseFloat(unitPrice) || 0;\n      taxAmt = parseFloat(taxAmt) || 0;\n      return qty * unitPrice + taxAmt;\n    };\n\n    this.recalculateDirectBillingTotals = () => {\n      const fd = this.state.formData;\n      const lineItems = fd.lineItems || [];\n      let lineBaseTotal = 0;\n      let lineTaxTotal = 0;\n      const updatedLineItems = lineItems.map(item => {\n        const qty = parseFloat(item.qty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const baseTotal = qty * unitPrice;\n        const taxAmt = this.calcTaxAmt(item); // numeric\n\n        const itemTotal = baseTotal + taxAmt;\n        lineBaseTotal += baseTotal;\n        lineTaxTotal += taxAmt;\n        return { ...item,\n          taxAmt: taxAmt.toFixed(2),\n          itemTotal: itemTotal.toFixed(2)\n        };\n      });\n      const freight = parseFloat(fd.freightCharges) || 0;\n      const packing = parseFloat(fd.packingCharges) || 0;\n      const taxPercent = parseFloat(fd.taxPercent) || 0; // freight tax only applies for None/CIF\n\n      const freightTax = ['None', 'CIF'].includes(fd.impExp) ? freight * taxPercent / 100 : 0;\n      const totalTaxAmount = lineTaxTotal + freightTax;\n      const invoiceValue = lineBaseTotal + freight + packing + totalTaxAmount;\n      let discountAmount = '';\n      let afterDiscountValue = '';\n\n      if (fd.discountPercent !== '' && fd.discountPercent !== null && !isNaN(fd.discountPercent)) {\n        const dPercent = parseFloat(fd.discountPercent) || 0;\n        discountAmount = (invoiceValue * dPercent / 100).toFixed(2);\n        afterDiscountValue = (invoiceValue - parseFloat(discountAmount)).toFixed(2);\n      }\n\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: updatedLineItems,\n          taxAmount: totalTaxAmount.toFixed(2),\n          freighttaxAmount: freightTax.toFixed(2),\n          invoiceValue: invoiceValue.toFixed(2),\n          discountAmount,\n          afterDiscountValue\n        }\n      }));\n    };\n\n    this.renderProductOverlay = () => {\n      const {\n        products,\n        productOverlaySearch,\n        selectedProductIds\n      } = this.state;\n      const filtered = products.filter(p => (p.ptshortName || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) || (p.ptdescription || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) || (p.itemCode || '').toLowerCase().includes(productOverlaySearch.toLowerCase()));\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 949,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 950,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 951,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 952,\n          columnNumber: 13\n        }\n      }, \"Select Products\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success btn-sm\",\n        onClick: () => {\n          const selectedProducts = products.filter(p => this.state.selectedProductIds.includes(p.id));\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              lineItems: [...prev.formData.lineItems, ...selectedProducts.filter(p => !prev.formData.lineItems.some(item => item.id === p.id)).map(p => ({\n                id: p.id,\n                itemCode: p.productId || '',\n                itemDescription: p.ptdescription || '',\n                itemType: p.itemType || '',\n                materialType: p.materialType || '',\n                onHand: p.onHand || 0,\n                taxGroup: p.taxGroup || '',\n                custPartNo: p.custPartNo || '',\n                // Assuming this is cust part table\n                hsnNo: p.hsnNo || '',\n                // Assuming HSN No.\n                unitPrice: p.unitPrice || 0,\n                qty: 1,\n                taxAmt: 0,\n                itemTotal: (p.unitPrice || 0).toFixed(2)\n              }))]\n            },\n            productOverlayVisible: false,\n            selectedProductIds: []\n          }));\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 953,\n          columnNumber: 13\n        }\n      }, \"Add Selected\")), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control mb-2\",\n        placeholder: \"Search products...\",\n        value: productOverlaySearch,\n        onChange: e => this.setState({\n          productOverlaySearch: e.target.value\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 987,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          maxHeight: 300,\n          overflowY: 'auto'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 994,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 995,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 996,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 997,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 998,\n          columnNumber: 19\n        }\n      }), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 999,\n          columnNumber: 19\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1000,\n          columnNumber: 19\n        }\n      }, \"Item Desc\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1001,\n          columnNumber: 19\n        }\n      }, \"Item Type\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1002,\n          columnNumber: 19\n        }\n      }, \"Material Type\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1003,\n          columnNumber: 19\n        }\n      }, \"On Hand\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1004,\n          columnNumber: 19\n        }\n      }, \"Tax Grp\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1005,\n          columnNumber: 19\n        }\n      }, \"Cust Part No\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1008,\n          columnNumber: 15\n        }\n      }, filtered.map(p => /*#__PURE__*/React.createElement(\"tr\", {\n        key: p.id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1010,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1011,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: selectedProductIds.includes(p.id),\n        onChange: e => {\n          const checked = e.target.checked;\n          this.setState(prev => ({\n            selectedProductIds: checked ? [...prev.selectedProductIds, p.id] : prev.selectedProductIds.filter(id => id !== p.id)\n          }));\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1012,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1025,\n          columnNumber: 21\n        }\n      }, p.productId), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1026,\n          columnNumber: 21\n        }\n      }, p.ptdescription || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1027,\n          columnNumber: 21\n        }\n      }, p.itemType || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1028,\n          columnNumber: 21\n        }\n      }, p.materialType || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1029,\n          columnNumber: 21\n        }\n      }, p.onHand || 0), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1030,\n          columnNumber: 21\n        }\n      }, p.taxGroup || ''), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1031,\n          columnNumber: 21\n        }\n      }, p.custPartNo || ''))), filtered.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1035,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: \"8\",\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1036,\n          columnNumber: 21\n        }\n      }, \"No products found\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1043,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1044,\n          columnNumber: 13\n        }\n      }, \"Page 1 of 1\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary btn-sm\",\n        onClick: () => this.setState({\n          productOverlayVisible: false,\n          selectedProductIds: []\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1045,\n          columnNumber: 13\n        }\n      }, \"Cancel\"))));\n    };\n\n    this.renderinvoiceTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-4 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1053,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1054,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-between align-items-center mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1055,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"card-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1056,\n        columnNumber: 11\n      }\n    }, \"Invoices\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: this.openNewForm,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1057,\n        columnNumber: 11\n      }\n    }, \"Create Invoice\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1059,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1060,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1061,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      style: {\n        fontSize: '14px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1062,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1063,\n        columnNumber: 17\n      }\n    }, \"Bill No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1064,\n        columnNumber: 17\n      }\n    }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1065,\n        columnNumber: 17\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1066,\n        columnNumber: 17\n      }\n    }, \"Bill Value\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1067,\n        columnNumber: 17\n      }\n    }, \"After Discount\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1068,\n        columnNumber: 17\n      }\n    }, \"Status\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1069,\n        columnNumber: 17\n      }\n    }, \"Print\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1072,\n        columnNumber: 13\n      }\n    }, this.state.invoices.map((q, i) => {\n      let statusClass = \"badge-secondary\";\n      if (q.status === \"Entered\") statusClass = \"badge-warning\";else if (q.status === \"Submitted\") statusClass = \"badge-info\";else if (q.status === \"Cancelled\") statusClass = \"badge-danger\";\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1080,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1081,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-link p-0\",\n        onClick: () => this.loadinvoiceForEdit(q),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1082,\n          columnNumber: 21\n        }\n      }, q.invoiceNo)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1089,\n          columnNumber: 19\n        }\n      }, q.customer), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1090,\n          columnNumber: 19\n        }\n      }, q.invoiceDate), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1091,\n          columnNumber: 19\n        }\n      }, q.invoiceValue), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1092,\n          columnNumber: 19\n        }\n      }, q.afterDiscountValue), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1093,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${statusClass}`,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1094,\n          columnNumber: 21\n        }\n      }, q.status)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1097,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-printer menu-icon\",\n        onClick: () => this.showDirectBillingPDFWithOrg(q),\n        style: {\n          fontSize: '24px',\n          color: '#2196F3',\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1098,\n          columnNumber: 23\n        }\n      })));\n    }), this.state.invoices.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1109,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      colSpan: \"6\",\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1109,\n        columnNumber: 21\n      }\n    }, \"No Direct Bill found.\")))))));\n\n    this.renderinvoiceForm = () => {\n      const {\n        formData,\n        overlayType,\n        productOverlayVisible\n      } = this.state;\n      const isFOB = formData.impExp === 'FOB';\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1123,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card full-height\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1124,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          flex: 1,\n          overflowY: 'auto',\n          padding: '24px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1125,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1126,\n          columnNumber: 13\n        }\n      }, \"Direct Bill Form\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"nav nav-tabs\",\n        role: \"tablist\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1127,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"li\", {\n        className: \"nav-item\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1128,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: `nav-link ${this.state.activeTab === 'co' ? 'active' : ''}`,\n        onClick: () => this.setState({\n          activeTab: 'co'\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1129,\n          columnNumber: 17\n        }\n      }, \"CO Details\")), /*#__PURE__*/React.createElement(\"li\", {\n        className: \"nav-item\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1131,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: `nav-link ${this.state.activeTab === 'commercial' ? 'active' : ''}`,\n        onClick: () => this.setState({\n          activeTab: 'commercial'\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1132,\n          columnNumber: 17\n        }\n      }, \"Commercial Terms\"))), /*#__PURE__*/React.createElement(\"form\", {\n        className: \"form-sample\",\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1135,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"tab-content pt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1136,\n          columnNumber: 15\n        }\n      }, this.state.activeTab === 'co' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1139,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1140,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1141,\n          columnNumber: 25\n        }\n      }, \"Bill No\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.invoiceNo,\n        onChange: e => this.handleInputChange('invoiceNo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1142,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1144,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1145,\n          columnNumber: 25\n        }\n      }, \"Bill Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control form-control-sm\",\n        value: formData.invoiceDate,\n        onChange: e => this.handleInputChange('invoiceDate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1146,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1148,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1149,\n          columnNumber: 25\n        }\n      }, \"Bill Type\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control form-control-sm\",\n        value: formData.invoiceType,\n        onChange: e => this.handleInputChange('invoiceType', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1150,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1151,\n          columnNumber: 27\n        }\n      }, \"Standard\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1152,\n          columnNumber: 27\n        }\n      }, \"Manual\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1155,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1156,\n          columnNumber: 25\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.status,\n        style: {\n          backgroundColor: '#fff'\n        },\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1157,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1160,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1161,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1162,\n          columnNumber: 25\n        }\n      }, \"Customer\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group input-group-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1163,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        placeholder: \"Choose Customer\",\n        ref: this.customerInputRef,\n        value: formData.customer,\n        readOnly: true,\n        onClick: () => this.showOverlay('customer'),\n        style: {\n          cursor: 'pointer'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1164,\n          columnNumber: 27\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-append\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1174,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-outline-secondary btn-sm\",\n        type: \"button\",\n        onClick: () => this.showOverlay('customer'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1175,\n          columnNumber: 29\n        }\n      }, \"Select\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1179,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1180,\n          columnNumber: 25\n        }\n      }, \"IMP/EXP\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control form-control-sm\",\n        value: formData.impExp,\n        onChange: e => this.handleInputChange('impExp', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1181,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1186,\n          columnNumber: 27\n        }\n      }, \"None\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1187,\n          columnNumber: 27\n        }\n      }, \"COB\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1188,\n          columnNumber: 27\n        }\n      }, \"FOB\"), /*#__PURE__*/React.createElement(\"option\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1189,\n          columnNumber: 27\n        }\n      }, \"CIF\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1192,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1193,\n          columnNumber: 25\n        }\n      }, \"Ref No.\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.qrefNo,\n        onChange: e => this.handleInputChange('qrefNo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1194,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1201,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1202,\n          columnNumber: 25\n        }\n      }, \"Choose\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex align-items-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1203,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-check mr-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1204,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"radio\",\n        className: \"form-check-input\",\n        name: \"choose\",\n        id: \"chooseService\",\n        value: \"Service\",\n        checked: formData.choose === 'Service',\n        onChange: e => this.handleInputChange('choose', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1205,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(\"label\", {\n        className: \"form-check-label\",\n        htmlFor: \"chooseService\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1206,\n          columnNumber: 29\n        }\n      }, \"Service\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-check\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1208,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"radio\",\n        className: \"form-check-input\",\n        name: \"choose\",\n        id: \"chooseProduct\",\n        value: \"Product\",\n        checked: formData.choose === 'Product',\n        onChange: e => this.handleInputChange('choose', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1209,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(\"label\", {\n        className: \"form-check-label\",\n        htmlFor: \"chooseProduct\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1210,\n          columnNumber: 29\n        }\n      }, \"Product\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1215,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1216,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1217,\n          columnNumber: 25\n        }\n      }, \"Currency\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.currency,\n        style: {\n          backgroundColor: '#fff'\n        },\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1218,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1226,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1227,\n          columnNumber: 25\n        }\n      }, \"Conversion Rate\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control form-control-sm\",\n        value: formData.conversionRate,\n        onChange: e => this.handleInputChange('conversionRate', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1228,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1235,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1236,\n          columnNumber: 25\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.taxAmount,\n        onChange: e => this.handleInputChange('taxAmount', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1237,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1245,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1246,\n          columnNumber: 25\n        }\n      }, \"Bill Value\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.invoiceValue,\n        onChange: e => this.handleInputChange('invoiceValue', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1247,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1256,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1257,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1258,\n          columnNumber: 23\n        }\n      }, \"Discount %\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        value: formData.discountPercent,\n        onChange: e => {\n          this.handleInputChange('discountPercent', e.target.value);\n          this.recalculateDirectBillingTotals();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1259,\n          columnNumber: 23\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1268,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1269,\n          columnNumber: 21\n        }\n      }, \"Discount Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: this.state.formData.discountAmount,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1270,\n          columnNumber: 21\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1277,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1278,\n          columnNumber: 23\n        }\n      }, \"After Discount - Quote Value\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: this.state.formData.afterDiscountValue,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1279,\n          columnNumber: 23\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1288,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1289,\n          columnNumber: 29\n        }\n      }, \"Line Item\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-primary btn-sm\",\n        onClick: () => this.setState({\n          productOverlayVisible: true\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1290,\n          columnNumber: 29\n        }\n      }, \"+ Add Product\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"table-responsive\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1294,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1295,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1296,\n          columnNumber: 31\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1297,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1298,\n          columnNumber: 35\n        }\n      }, \"Item Code \"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1299,\n          columnNumber: 35\n        }\n      }, \"Item Desc \"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1300,\n          columnNumber: 35\n        }\n      }, \"Cust Part No \"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1301,\n          columnNumber: 35\n        }\n      }, \"HSN No \"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1302,\n          columnNumber: 35\n        }\n      }, \"On Hand \"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1303,\n          columnNumber: 35\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1304,\n          columnNumber: 35\n        }\n      }, \"Quantity\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1305,\n          columnNumber: 35\n        }\n      }, \"Tax Id\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1306,\n          columnNumber: 35\n        }\n      }, \"Item Total\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1307,\n          columnNumber: 35\n        }\n      }, \"Tax Amt\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1310,\n          columnNumber: 31\n        }\n      }, formData.lineItems.map((item, idx) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: item.id || idx,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1312,\n          columnNumber: 35\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1313,\n          columnNumber: 37\n        }\n      }, item.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1314,\n          columnNumber: 37\n        }\n      }, item.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1315,\n          columnNumber: 37\n        }\n      }, item.custPartNo), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1316,\n          columnNumber: 37\n        }\n      }, item.hsnNo), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1317,\n          columnNumber: 37\n        }\n      }, item.onHand), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1318,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        value: item.unitPrice,\n        onChange: e => this.handleLineItemChange(idx, 'unitPrice', e.target.value),\n        style: {\n          width: 80\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1319,\n          columnNumber: 39\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1326,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        min: \"1\",\n        value: item.qty,\n        onChange: e => this.handleLineItemChange(idx, 'qty', e.target.value),\n        style: {\n          width: 60\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1327,\n          columnNumber: 39\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1335,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-outline-primary btn-sm\",\n        onClick: () => this.setState({\n          showTaxOverlay: true,\n          currentTaxIdx: idx\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1336,\n          columnNumber: 35\n        }\n      }, \"Select Tax\"), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          fontSize: '10px',\n          marginTop: '4px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1343,\n          columnNumber: 35\n        }\n      }, (item.taxGroupNames || []).join(', ') || '-')), this.state.showTaxOverlay && this.renderTaxOverlay(), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1349,\n          columnNumber: 37\n        }\n      }, item.itemTotal || '0.00'), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1350,\n          columnNumber: 39\n        }\n      }, item.taxAmt || '0.00'))), formData.lineItems.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1355,\n          columnNumber: 35\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        colSpan: \"9\",\n        className: \"text-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1356,\n          columnNumber: 37\n        }\n      }, \"No items\"))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"d-flex justify-content-between align-items-center mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1363,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1364,\n          columnNumber: 29\n        }\n      }, \"Page 1 of 1\"))), this.state.activeTab === 'commercial' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1371,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1372,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1373,\n          columnNumber: 25\n        }\n      }, \"Bill To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control form-control-sm\",\n        rows: \"3\",\n        value: formData.billTo,\n        onChange: e => this.handleInputChange('billTo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1374,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1381,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1382,\n          columnNumber: 25\n        }\n      }, \"Ship To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control form-control-sm\",\n        rows: \"3\",\n        value: formData.shipTo,\n        onChange: e => this.handleInputChange('shipTo', e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1383,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1391,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1392,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1393,\n          columnNumber: 3\n        }\n      }, \"Despatch Mode\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group input-group-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1394,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: formData.despatchMode,\n        readOnly: true,\n        onClick: () => !isFOB && this.showOverlay('despatchMode'),\n        style: {\n          cursor: isFOB ? 'not-allowed' : 'pointer',\n          backgroundColor: '#fff'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1395,\n          columnNumber: 5\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-append\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1403,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-outline-secondary btn-sm\",\n        type: \"button\",\n        disabled: isFOB,\n        onClick: () => this.showOverlay('despatchMode'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1404,\n          columnNumber: 7\n        }\n      }, \"Select\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1416,\n          columnNumber: 1\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1417,\n          columnNumber: 3\n        }\n      }, \"Payment Terms\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group input-group-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1418,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: formData.paymentTerms,\n        readOnly: true,\n        onClick: () => !isFOB && this.showOverlay('paymentTerms'),\n        style: {\n          cursor: isFOB ? 'not-allowed' : 'pointer',\n          backgroundColor: '#fff'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1419,\n          columnNumber: 5\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-append\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1427,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-outline-secondary btn-sm\",\n        type: \"button\",\n        disabled: isFOB,\n        onClick: () => this.showOverlay('paymentTerms'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1428,\n          columnNumber: 7\n        }\n      }, \"Select\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1440,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1441,\n          columnNumber: 25\n        }\n      }, \"Freight Charges\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.freightCharges,\n        onChange: e => this.handleInputChange('freightCharges', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1442,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1451,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1452,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1453,\n          columnNumber: 25\n        }\n      }, \"Tax %\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.taxPercent,\n        onChange: e => this.handleInputChange('taxPercent', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1454,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1462,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1463,\n          columnNumber: 25\n        }\n      }, \"Freight Tax Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.freighttaxAmount || '',\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1464,\n          columnNumber: 1\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1472,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1473,\n          columnNumber: 25\n        }\n      }, \"Packing Charges\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control form-control-sm\",\n        value: formData.packingCharges,\n        onChange: e => this.handleInputChange('packingCharges', e.target.value),\n        readOnly: isFOB // Read-only if FOB\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1474,\n          columnNumber: 25\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"text-right mt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1483,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-success\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1484,\n          columnNumber: 23\n        }\n      }, \"Save All Details\")))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"fixed-card-footer text-right p-3 border-top bg-white\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1489,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-success mr-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1490,\n          columnNumber: 17\n        }\n      }, \"Save All Details\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary\",\n        onClick: () => this.setState({\n          showForm: false,\n          editingId: null\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1491,\n          columnNumber: 17\n        }\n      }, \"Cancel\"))), overlayType && this.renderOverlay(), productOverlayVisible && this.renderProductOverlay())));\n    };\n  }\n\n  getTaxDetailsFromGroup(groupName) {\n    if (!groupName || groupName === 'nill' || groupName === 'more') return {\n      totalPercent: 0,\n      totalAmount: 0\n    };\n    const group = this.state.taxGroups.find(tg => tg.groupName === groupName);\n    if (!group || !Array.isArray(group.lineItems)) return {\n      totalPercent: 0,\n      totalAmount: 0\n    };\n    let totalPercent = 0;\n    let totalAmount = 0;\n    group.lineItems.forEach(item => {\n      if (item.type === 'Percentage') {\n        totalPercent += parseFloat(item.percentOrAmt || 0);\n      } else if (item.type === 'Amount') {\n        totalAmount += parseFloat(item.percentOrAmt || 0);\n      }\n    });\n    return {\n      totalPercent,\n      totalAmount\n    };\n  }\n\n  componentDidMount() {\n    bsCustomFileInput.init();\n    this.fetchinvoice();\n    this.fetchCustomers();\n    this.fetchProducts();\n    this.fetchDespatchModes();\n    this.fetchPaymentTerms();\n    this.fetchTaxGroups();\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    // Customer details auto-fill (keep this)\n    if (this.state.showForm && this.state.customers.length > 0 && this.state.formData.customer && (prevState.formData.customer !== this.state.formData.customer || !this.state.formData.billTo && !this.state.formData.shipTo)) {\n      const customerObj = this.state.customers.find(c => c.custname === this.state.formData.customer || c.custcode === this.state.formData.customer);\n\n      if (customerObj) {\n        this.setState(prev => ({\n          formData: { ...prev.formData,\n            billTo: this.formatAddress(customerObj.billTo),\n            shipTo: this.formatAddress(customerObj.shipTo),\n            currency: customerObj.currency || ''\n          }\n        }));\n      }\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1511,\n        columnNumber: 5\n      }\n    }, this.state.previewMode ? this.renderinvoicePreview() : this.state.showForm ? this.renderinvoiceForm() : this.renderinvoiceTable());\n  }\n\n}\n\nexport default DirectBilling;","map":{"version":3,"sources":["C:/Users/College/admin/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/invoice/DirectBilling.js"],"names":["React","Component","Form","bsCustomFileInput","db","collection","getDocs","addDoc","doc","updateDoc","serverTimestamp","html2canvas","jsPDF","toWords","withRouter","recalculateTotals","getTaxDetailsFromGroup","numberToWords","num","a","b","Math","floor","DirectBilling","state","activeTab","invoices","customers","products","despatchModes","paymentTerms","showForm","editingId","showTaxOverlay","currentTaxIdx","overlayType","overlaySearch","productOverlayVisible","productOverlaySearch","selectedProductIds","taxGroups","formData","invoiceNo","invoiceDate","Date","toISOString","split","invoiceType","customer","status","choose","qrefNo","impExp","currency","conversionRate","taxAmount","invoiceValue","discountPercent","discountAmount","afterDiscountValue","billTo","shipTo","despatchMode","freightCharges","freighttaxAmount","taxPercent","packingCharges","lineItems","customerInputRef","createRef","formatAddress","addr","address","city","country","filter","Boolean","join","zip","showDirectBillingPDFWithOrg","invoice","Array","isArray","length","alert","orgSnap","org","docs","data","find","c","custshortName","custname","gstStateMap","getPlaceOfSupply","gstin","code","substring","enrichedItems","map","item","hsnCode","uom","ptshortName","taxGroupNames","taxGroupName","s","trim","subtotal","reduce","sum","parseFloat","unitPrice","qty","freightTax","totalTaxAmount","grandTotal","amountWords","taxBreakdown","taxGroupDetails","sno","forEach","base","tgName","group","g","groupName","li","key","component","percentOrAmt","type","taxAmt","push","peramt","toFixed","container","document","createElement","id","style","width","padding","fontFamily","innerHTML","logoUrl","bgName","email","website","mobile","cin","directbillingNo","directbillingDate","replace","contactPerson","phone","gstLabel","taxId","itemCode","itemDescription","itemTotal","toLocaleString","body","appendChild","canvas","scale","useCORS","imgData","toDataURL","pdf","height","addImage","removeChild","addPage","taxRows","row","taxHtml","taxContainer","taxCanvas","taxImg","setFontSize","text","blob","output","url","URL","createObjectURL","newWin","window","open","write","close","calculateinvoiceTotals","freight","packing","taxOnFreight","includes","lineTotal","itemTaxTotal","updatedLineItems","baseTotal","groupNames","taxGroup","percent","amount","t","comp","val","total","setState","prev","handleDiscountChange","field","value","quoteValue","fetchTaxGroups","snap","fetchinvoice","reverse","fetchCustomers","fetchProducts","fetchDespatchModes","fetchPaymentTerms","handleInputChange","newForm","recalculateDirectBillingTotals","handleLineItemChange","idx","updatedItems","taxAmtNum","calcTaxAmt","calcItemTotal","handleSubmit","e","preventDefault","formDataWithoutId","updatedAt","createdAt","getEmptyInvoiceForm","openNewForm","loadinvoiceForEdit","normalizedLineItems","toggleInvoiceForm","showOverlay","hideOverlay","selectOverlayValue","custcode","current","renderOverlay","getFilteredRows","list","nameKey","codeKey","toLowerCase","handleSelect","name","title","headers","rows","target","maxHeight","overflowY","h","i","cursor","j","shortName","renderTaxOverlay","selected","Set","position","zIndex","top","left","background","border","boxShadow","tg","has","toggleTaxGroupSelection","checked","lineIdx","isChecked","tax","isNaN","fd","lineBaseTotal","lineTaxTotal","dPercent","renderProductOverlay","filtered","p","ptdescription","selectedProducts","some","productId","itemType","materialType","onHand","custPartNo","hsnNo","renderinvoiceTable","fontSize","q","statusClass","color","renderinvoiceForm","isFOB","flex","backgroundColor","marginTop","totalPercent","totalAmount","componentDidMount","init","componentDidUpdate","prevProps","prevState","customerObj","render","previewMode","renderinvoicePreview"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Form } from 'react-bootstrap';\r\nimport bsCustomFileInput from 'bs-custom-file-input';\r\nimport { db } from '../../../../firebase';\r\nimport { collection, getDocs, addDoc, doc, updateDoc ,serverTimestamp} from 'firebase/firestore';\r\nimport html2canvas from 'html2canvas';\r\nimport { jsPDF } from 'jspdf'; \r\nimport { toWords } from 'number-to-words';\r\n\r\nimport { withRouter } from 'react-router-dom';\r\nimport { recalculateTotals, getTaxDetailsFromGroup } from '../calculation';\r\n\r\nconst numberToWords = (num) => {\r\n  const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine',\r\n    'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen',\r\n    'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];\r\n  const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];\r\n\r\n  if (num === 0) return 'Zero';\r\n  if (num < 20) return a[num];\r\n  if (num < 100) return b[Math.floor(num / 10)] + ' ' + a[num % 10];\r\n  if (num < 1000)\r\n    return a[Math.floor(num / 100)] + ' Hundred ' + numberToWords(num % 100);\r\n  if (num < 100000)\r\n    return numberToWords(Math.floor(num / 1000)) + ' Thousand ' + numberToWords(num % 1000);\r\n  return 'Amount too large';\r\n};\r\n\r\nclass DirectBilling extends Component {\r\n  state = {\r\n    activeTab: 'co',\r\n    invoices: [],\r\n    customers: [],\r\n    products: [],\r\n    despatchModes: [],\r\n    paymentTerms: [],\r\n\r\n    showForm: false,\r\n    editingId: null,\r\n    \r\n    showTaxOverlay: false,\r\n    currentTaxIdx: null,\r\n    \r\n    overlayType: '',\r\n    overlaySearch: '',\r\n    productOverlayVisible: false,\r\n    productOverlaySearch: '',\r\n    selectedProductIds: [],\r\n    taxGroups: [],\r\n    formData: {\r\n      invoiceNo: '',\r\n      invoiceDate: new Date().toISOString().split('T')[0],\r\n      invoiceType: 'Standard',\r\n      customer: '',\r\n      status: 'Entered', \r\n      choose: 'Service',\r\n      qrefNo: '',\r\n      impExp: 'None',\r\n      currency: '',\r\n      conversionRate: '',\r\n      taxAmount: '',\r\n      invoiceValue: '',\r\n      discountPercent: 0,\r\n      discountAmount: 0,\r\n      afterDiscountValue: 0,\r\n      billTo: '',\r\n      shipTo: '',\r\n      despatchMode: 'By Air',\r\n      paymentTerms: '',\r\n      freightCharges: '',\r\n      freighttaxAmount: '',\r\n      taxPercent: '',\r\n      packingCharges: '',\r\n      lineItems: [],\r\n    }\r\n  };\r\n  customerInputRef = React.createRef();\r\n\r\n  // Helper to format address for Bill To / Ship To\r\n  formatAddress = (addr) => {\r\n    if (!addr) return '';\r\n    if (typeof addr === 'string') return addr;\r\n    return [\r\n      addr.address,\r\n      [addr.city, addr.state, addr.country].filter(Boolean).join(', '),\r\n      addr.zip\r\n    ].filter(Boolean).join('\\n');\r\n  };\r\n\r\n  showDirectBillingPDFWithOrg = async (invoice) => {\r\n  if (!invoice || !Array.isArray(invoice.lineItems) || invoice.lineItems.length === 0) {\r\n    alert(\"Invoice data is incomplete.\");\r\n    return;\r\n  }\r\n\r\n  // 1. Fetch org and customer data\r\n  const orgSnap = await getDocs(collection(db, 'businessGroups'));\r\n  const org = orgSnap.docs[0]?.data() || {};\r\n  const customer = this.state.customers.find(\r\n    c => c.custshortName === invoice.customer || c.custname === invoice.customer\r\n  ) || {};\r\n\r\n  // GST State Map\r\n  const gstStateMap = { \"01\": \"Jammu & Kashmir\",\"02\": \"Himachal Pradesh\",\"03\": \"Punjab\",\"04\": \"Chandigarh\",\"05\": \"Uttarakhand\",\r\n    \"06\": \"Haryana\",\"07\": \"Delhi\",\"08\": \"Rajasthan\",\"09\": \"Uttar Pradesh\",\"10\": \"Bihar\",\"11\": \"Sikkim\",\"12\": \"Arunachal Pradesh\",\r\n    \"13\": \"Nagaland\",\"14\": \"Manipur\",\"15\": \"Mizoram\",\"16\": \"Tripura\",\"17\": \"Meghalaya\",\"18\": \"Assam\",\"19\": \"West Bengal\",\r\n    \"20\": \"Jharkhand\",\"21\": \"Odisha\",\"22\": \"Chhattisgarh\",\"23\": \"Madhya Pradesh\",\"24\": \"Gujarat\",\"25\": \"Daman and Diu\",\r\n    \"26\": \"Dadra and Nagar Haveli\",\"27\": \"Maharashtra\",\"28\": \"Andhra Pradesh (Old)\",\"29\": \"Karnataka\",\"30\": \"Goa\",\"31\": \"Lakshadweep\",\r\n    \"32\": \"Kerala\",\"33\": \"Tamil Nadu\",\"34\": \"Puducherry\",\"35\": \"Andaman and Nicobar Islands\",\"36\": \"Telangana\",\"37\": \"Andhra Pradesh\",\r\n    \"97\": \"Other Territory\" };\r\n  const getPlaceOfSupply = (gstin) => {\r\n    if (!gstin || gstin.length < 2) return '';\r\n    const code = gstin.substring(0, 2);\r\n    const state = gstStateMap[code];\r\n    return state ? `${code} - ${state}` : '';\r\n  };\r\n\r\n  // 2. Enrich line items\r\n  const enrichedItems = invoice.lineItems.map(item => ({\r\n    ...item,\r\n    hsnCode: item.hsnCode || '',\r\n    uom: item.uom || '',\r\n    ptshortName: item.ptshortName || '',\r\n    taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\r\n  }));\r\n\r\n  // 3. Totals\r\n  const subtotal = enrichedItems.reduce((sum, item) =>\r\n    sum + ((parseFloat(item.unitPrice) || 0) * (parseFloat(item.qty) || 0)), 0\r\n  );\r\n  const freightCharges = parseFloat(invoice.freightCharges || 0);\r\n  const packingCharges = parseFloat(invoice.packingCharges || 0);\r\n  const freightTax = parseFloat(invoice.freighttaxAmount || 0);\r\n  const totalTaxAmount = parseFloat(invoice.taxAmount || 0);\r\n  const discountAmount = invoice.discountAmount ? parseFloat(invoice.discountAmount) : 0;\r\n  const afterDiscountValue = invoice.afterDiscountValue ? parseFloat(invoice.afterDiscountValue) : null;\r\n  const invoiceValue = parseFloat(invoice.invoiceValue || (subtotal + totalTaxAmount + freightCharges + packingCharges));\r\n  const grandTotal = afterDiscountValue !== null ? afterDiscountValue : invoiceValue;\r\n  const amountWords = `INR ${toWords(Math.floor(grandTotal))} Only`;\r\n\r\n  // 4. Tax breakdown\r\n  let taxBreakdown = {};\r\n  let taxGroupDetails = [];\r\n  let sno = 1;\r\n  enrichedItems.forEach(item => {\r\n    const qty = parseFloat(item.qty || 0);\r\n    const unitPrice = parseFloat(item.unitPrice || 0);\r\n    const base = qty * unitPrice;\r\n    (item.taxGroupNames || []).forEach(tgName => {\r\n      const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\r\n      if (group) {\r\n        group.lineItems.forEach(li => {\r\n          const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\r\n          let taxAmt = li.type === 'Amount'\r\n            ? parseFloat(li.percentOrAmt || 0)\r\n            : (base * parseFloat(li.percentOrAmt || 0)) / 100;\r\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n          taxGroupDetails.push({\r\n            sno: sno++,\r\n            group: tgName,\r\n            peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\r\n            taxAmt: taxAmt.toFixed(2)\r\n          });\r\n        });\r\n      }\r\n    });\r\n  });\r\n  if (freightTax > 0) {\r\n    taxBreakdown[\"Freight Tax\"] = freightTax;\r\n    taxGroupDetails.push({ sno: sno++, group: \"Freight Tax\", peramt: \"-\", taxAmt: freightTax.toFixed(2) });\r\n  }\r\n\r\n  // 5. Build HTML for PDF\r\n  const container = document.createElement('div');\r\n  container.id = 'pdf-preview-container';\r\n  container.style.width = '794px';\r\n  container.style.padding = '40px';\r\n  container.style.fontFamily = 'Arial';\r\n\r\n  container.innerHTML = `\r\n    <div style=\"display:flex; justify-content:space-between; align-items:center;\">\r\n      <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\r\n      <div style=\"font-size:18px; font-weight:bold;\">DIRECT BILLING INVOICE</div>\r\n    </div>\r\n    <hr/>\r\n    <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n      <div style=\"line-height:1.5; width:50%;\">\r\n        <b>${org.bgName || ''}</b><br/>\r\n        ${org.address || ''}<br/>\r\n        <b>Email:</b> ${org.email || ''}<br/>\r\n        <b>Website:</b> ${org.website || ''}<br/>\r\n        <b>GSTIN:</b> ${org.gstin || ''}<br/>\r\n        <b>Mobile:</b> ${org.mobile || ''}<br/>\r\n        <b>CIN:</b> ${org.cin || ''}\r\n      </div>\r\n      <table style=\"font-size:11px; text-align:left;\">\r\n        <tr><td><b>Invoice No</b></td><td>: ${invoice.directbillingNo || ''}</td></tr>\r\n        <tr><td><b>Invoice Date</b></td><td>: ${invoice.directbillingDate || ''}</td></tr>\r\n        <tr><td><b>Currency</b></td><td>: ${invoice.currency || 'INR'}</td></tr>\r\n        <tr><td><b>Despatch</b></td><td>: ${invoice.despatchMode || ''}</td></tr>\r\n      </table>\r\n    </div>\r\n\r\n    <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\r\n      <div style=\"width:48%;\">\r\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\r\n        <div style=\"border:1px solid #ccc; padding:6px;\">\r\n         <b>${invoice.customer || ''}</b><br/>\r\n          ${invoice.billTo?.replace(/\\n/g, '<br/>') || ''}\r\n        </div>\r\n        <div style=\"font-size:10px; margin-top:6px;\">\r\n            <b>GSTIN:</b> ${customer.gstin || ''}<br/>\r\n            <b>Email:</b> ${customer.email || ''}<br/>\r\n            <b>Contact:</b> ${customer.contactPerson || ''}<br/>\r\n            <b>Phone:</b> ${customer.phone || ''}\r\n        </div>\r\n      </div>\r\n      <div style=\"width:48%;\">\r\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\r\n        <div style=\"border:1px solid #ccc; padding:6px;\">\r\n         <b>${invoice.customer || ''}</b><br/>\r\n          ${invoice.shipTo?.replace(/\\n/g, '<br/>') || ''}\r\n        </div>\r\n        <div style=\"font-size:10px; margin-top:6px;\">\r\n          <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\r\n      <thead>\r\n        <tr style=\"background:#f4f6fa;\">\r\n          <th style=\"border:1px solid #011b56;\">Item Code</th>\r\n          <th style=\"border:1px solid #011b56;\">Description</th>\r\n          <th style=\"border:1px solid #011b56;\">HSN</th>\r\n          <th style=\"border:1px solid #011b56;\">UOM</th>\r\n          <th style=\"border:1px solid #011b56;\">Qty</th>\r\n          <th style=\"border:1px solid #011b56;\">Unit Price</th>\r\n          <th style=\"border:1px solid #011b56;\">GST Group</th>\r\n          <th style=\"border:1px solid #011b56;\">Item Total</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${enrichedItems.map(item => {\r\n          const gstLabel = (item.taxGroupNames && item.taxGroupNames.length)\r\n            ? item.taxGroupNames.join(', ')\r\n            : (item.taxGroupName || item.taxId || '-');\r\n          return `\r\n            <tr>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemCode || ''}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemDescription || ''}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.uom}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.qty}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\r\n              <td style=\"border:1px solid #011b56;\">${gstLabel}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemTotal}</td>\r\n            </tr>`;\r\n        }).join('')}\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Freight Charges</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${freightCharges.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Packing Charges</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${packingCharges.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Invoice Value</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${invoiceValue.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>Discount Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${invoice.discountAmount || ''}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"7\" style=\"text-align:right; border:1px solid #011b56;\"><b>After Discount Value</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${invoice.afterDiscountValue || ''}</b></td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\r\n    <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\r\n  `;\r\n\r\n  document.body.appendChild(container);\r\n  const canvas = await html2canvas(container, { scale: 2, useCORS: true });\r\n  const imgData = canvas.toDataURL('image/png');\r\n  const pdf = new jsPDF('p', 'pt', 'a4');\r\n  const width = 595.28;\r\n  const height = canvas.height * width / canvas.width;\r\n  pdf.addImage(imgData, 'PNG', 0, 0, width, height);\r\n  document.body.removeChild(container);\r\n\r\n  // 6. Tax Breakdown page\r\n  if (taxGroupDetails.length > 0) {\r\n    pdf.addPage();\r\n    let taxRows = taxGroupDetails.map(row => `\r\n      <tr>\r\n        <td style=\"border:1px solid #011b56;\">${row.sno}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.group}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.taxAmt}</td>\r\n      </tr>`).join('');\r\n\r\n    let taxHtml = `<div style=\"font-family:Arial; padding:20px; width:100%;\">\r\n    <h3 style=\"margin-bottom:10px; font-size:18px;\">Tax Breakdown</h3>\r\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:14px;\">\r\n      <thead>\r\n        <tr style=\"background:#f4f6fa;\">\r\n          <th style=\"border:1px solid #011b56;\">S.No</th>\r\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\r\n          <th style=\"border:1px solid #011b56;\">Per/Amt</th>\r\n          <th style=\"border:1px solid #011b56;\">Tax Amt</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${taxRows}\r\n        <tr>\r\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    </div>`;\r\n\r\n    const taxContainer = document.createElement('div');\r\n    taxContainer.innerHTML = taxHtml;\r\n    document.body.appendChild(taxContainer);\r\n\r\n    const taxCanvas = await html2canvas(taxContainer, { scale: 1.5, useCORS: true });\r\n    const taxImg = taxCanvas.toDataURL('image/png');\r\n    pdf.addImage(taxImg, 'PNG', 0, 0, width, taxCanvas.height * width / taxCanvas.width);\r\n\r\n    document.body.removeChild(taxContainer);\r\n  }\r\n\r\n  pdf.setFontSize(11);\r\n  pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\r\n  pdf.text('Authorized Signatory', width - 200, 800);\r\n\r\n  // 7. Show PDF\r\n  const blob = pdf.output('blob');\r\n  const url = URL.createObjectURL(blob);\r\n  const newWin = window.open();\r\n  newWin.document.write(`\r\n    <html><head><title>Direct Billing PDF Preview</title></head>\r\n    <body style=\"margin:0;\">\r\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\r\n    </body></html>\r\n  `);\r\n  newWin.document.close();\r\n};\r\n\r\n  getTaxDetailsFromGroup(groupName) {\r\n  if (!groupName || groupName === 'nill' || groupName === 'more') return { totalPercent: 0, totalAmount: 0 };\r\n\r\n  const group = this.state.taxGroups.find(tg => tg.groupName === groupName);\r\n  if (!group || !Array.isArray(group.lineItems)) return { totalPercent: 0, totalAmount: 0 };\r\n\r\n  let totalPercent = 0;\r\n  let totalAmount = 0;\r\n\r\n  group.lineItems.forEach(item => {\r\n    if (item.type === 'Percentage') {\r\n      totalPercent += parseFloat(item.percentOrAmt || 0);\r\n    } else if (item.type === 'Amount') {\r\n      totalAmount += parseFloat(item.percentOrAmt || 0);\r\n    }\r\n  });\r\n\r\n  return { totalPercent, totalAmount };\r\n}\r\n\r\ncalculateinvoiceTotals = () => {\r\n  const { impExp, freightCharges, taxPercent, packingCharges, lineItems } = this.state.formData;\r\n  let freight = parseFloat(freightCharges) || 0;\r\n  let packing = parseFloat(packingCharges) || 0;\r\n  let taxOnFreight = 0;\r\n  if (['None', 'CIF'].includes(impExp)) {\r\n    taxOnFreight = (freight * (parseFloat(taxPercent) || 0)) / 100;\r\n  }\r\n\r\n  let lineTotal = 0;\r\n  let itemTaxTotal = 0;\r\n\r\n  const updatedLineItems = lineItems.map(item => {\r\n  const qty = parseFloat(item.qty || 1);\r\n  const unitPrice = parseFloat(item.unitPrice || 0);\r\n  const baseTotal = unitPrice * qty;\r\n\r\n  const groupNames = item.taxGroupNames?.length ? item.taxGroupNames : [item.taxGroup || ''];\r\n\r\n  let percent = 0;\r\n  let amount = 0;\r\n  groupNames.forEach(groupName => {\r\n    const group = this.state.taxGroups.find(t => t.groupName === groupName);\r\n    if (group && Array.isArray(group.lineItems)) {\r\n      group.lineItems.forEach(comp => {\r\n        const val = parseFloat(comp.percentOrAmt || 0);\r\n        if (comp.type === 'Percentage') percent += val;\r\n        if (comp.type === 'Amount') amount += val;\r\n      });\r\n    }\r\n  });\r\n\r\n  const taxAmt = (baseTotal * percent) / 100 + amount;\r\n  const total = baseTotal;\r\n\r\n  item.taxAmt = taxAmt.toFixed(2);\r\n  item.total = total.toFixed(2);\r\n\r\n  lineTotal += baseTotal;\r\n  itemTaxTotal += taxAmt;\r\n\r\n  return item;\r\n});\r\n\r\n\r\n\r\n  const totalTaxAmount = itemTaxTotal + taxOnFreight;\r\n  const invoiceValue = lineTotal + freight + packing + itemTaxTotal;\r\n\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      taxAmount: totalTaxAmount.toFixed(2),  // ✅ Top-level field\r\n      invoiceValue: invoiceValue.toFixed(2),\r\n      lineItems: updatedLineItems\r\n    }\r\n  }));\r\n};\r\nhandleDiscountChange = (field, value) => {\r\n  let { formData } = this.state;\r\n  formData[field] = value;\r\n\r\n  const quoteValue = parseFloat(formData.quoteValue || 0);\r\n  const discountPercent = parseFloat(formData.discountPercent || 0);\r\n  const discountAmount = (quoteValue * discountPercent) / 100;\r\n  const afterDiscountValue = quoteValue - discountAmount;\r\n\r\n  formData.discountAmount = discountAmount;\r\n  formData.afterDiscountValue = afterDiscountValue;\r\n\r\n  this.setState({ formData });\r\n};\r\n\r\n\r\n\r\n\r\ncomponentDidMount() {\r\n  bsCustomFileInput.init();\r\n  this.fetchinvoice();\r\n  this.fetchCustomers();\r\n  this.fetchProducts();\r\n  this.fetchDespatchModes();\r\n  this.fetchPaymentTerms();\r\n  this.fetchTaxGroups();\r\n\r\n}\r\ncomponentDidUpdate(prevProps, prevState) {\r\n  // Customer details auto-fill (keep this)\r\n  if (\r\n    this.state.showForm &&\r\n    this.state.customers.length > 0 &&\r\n    this.state.formData.customer &&\r\n    (prevState.formData.customer !== this.state.formData.customer ||\r\n     (!this.state.formData.billTo && !this.state.formData.shipTo))\r\n  ) {\r\n    const customerObj = this.state.customers.find(\r\n      c => c.custname === this.state.formData.customer || c.custcode === this.state.formData.customer\r\n    );\r\n    if (customerObj) {\r\n      this.setState(prev => ({\r\n        formData: {\r\n          ...prev.formData,\r\n          billTo: this.formatAddress(customerObj.billTo),\r\n          shipTo: this.formatAddress(customerObj.shipTo),\r\n          currency: customerObj.currency || '',\r\n        }\r\n      }));\r\n    }\r\n  }\r\n}\r\n\r\nfetchTaxGroups = async () => {\r\n  const snap = await getDocs(collection(db, 'taxGroups'));\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ taxGroups: data });\r\n};\r\n\r\n  fetchinvoice = async () => {\r\n  const snap = await getDocs(collection(db, 'invoices')); // <-- Correct collection name\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ invoices: data.reverse() });\r\n};\r\n\r\n  fetchCustomers = async () => {\r\n    const snap = await getDocs(collection(db, 'customers'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ customers: data });\r\n  };\r\n\r\n  fetchProducts = async () => {\r\n    const snap = await getDocs(collection(db, 'products'));\r\n    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    this.setState({ products: data });\r\n  };\r\n  fetchDespatchModes = async () => {\r\n  const snap = await getDocs(collection(db, 'modes'));\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ despatchModes: data });\r\n};\r\n\r\nfetchPaymentTerms = async () => {\r\n  const snap = await getDocs(collection(db, 'paymentTerms'));\r\n  const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  this.setState({ paymentTerms: data });\r\n};\r\n\r\n\r\n  handleInputChange = (field, value) => {\r\n  this.setState(prev => {\r\n    const newForm = { ...prev.formData, [field]: value };\r\n\r\n    // When switching to FOB clear freight-related fields\r\n    if (field === 'impExp' && value === 'FOB') {\r\n      newForm.freightCharges = '';\r\n      newForm.taxPercent = '';\r\n      newForm.freighttaxAmount = '';\r\n      newForm.taxAmount = '';\r\n      newForm.packingCharges = '';\r\n      newForm.invoiceValue = '';\r\n    }\r\n\r\n    return { formData: newForm };\r\n  }, () => {\r\n    // Recalculate whenever fields that affect totals are changed\r\n    if (['freightCharges', 'packingCharges', 'taxPercent', 'impExp', 'discountPercent'].includes(field)) {\r\n      this.recalculateDirectBillingTotals();\r\n    }\r\n  });\r\n};\r\n\r\nhandleLineItemChange = (idx, field, value) => {\r\n  const updatedItems = [...this.state.formData.lineItems];\r\n  updatedItems[idx] = { ...updatedItems[idx], [field]: value };\r\n\r\n  const qty = parseFloat(updatedItems[idx].qty || 0);\r\n  const unitPrice = parseFloat(updatedItems[idx].unitPrice || 0);\r\n\r\n  // compute tax & item total numerically\r\n  const taxAmtNum = this.calcTaxAmt(updatedItems[idx]);\r\n  updatedItems[idx].taxAmt = taxAmtNum; // numeric here; will be formatted in recalc\r\n  updatedItems[idx].itemTotal = this.calcItemTotal(qty, unitPrice, taxAmtNum);\r\n\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      lineItems: updatedItems\r\n    }\r\n  }), this.recalculateDirectBillingTotals);\r\n};\r\n\r\nhandleSubmit = async (e) => {\r\n  e.preventDefault();\r\n  const { editingId, formData, invoices } = this.state;\r\n  if (!formData.customer) return alert(\"Customer is required\");\r\n  if (formData.lineItems.length === 0) return alert(\"At least one line item is required\");\r\n\r\n  if (editingId) {\r\n    const { id, ...formDataWithoutId } = formData;\r\n    await updateDoc(doc(db, \"invoices\", editingId), {\r\n      ...formDataWithoutId,\r\n      status: \"Entered\",\r\n      updatedAt: serverTimestamp()\r\n    });\r\n  } else {\r\n    formData.invoiceNo = `INV${1000 + invoices.length}`;\r\n    await addDoc(collection(db, \"invoices\"), {\r\n      ...formData,\r\n      status: \"Entered\",\r\n      createdAt: serverTimestamp()\r\n    });\r\n  }\r\n\r\n  this.setState({ showForm: false, editingId: null, formData: this.getEmptyInvoiceForm() });\r\n  this.fetchinvoice();\r\n};\r\n// Helper to reset formData\r\ngetEmptyInvoiceForm = () => ({\r\n  invoiceNo: '',\r\n  invoiceDate: new Date().toISOString().split('T')[0],\r\n  invoiceType: 'Standard',\r\n  customer: '',\r\n  status: 'Entered',\r\n  choose: 'Service',\r\n  qrefNo: '',\r\n  impExp: 'None',\r\n  currency: '',\r\n  conversionRate: '',\r\n  taxAmount: '',\r\n  invoiceValue: '',\r\n  discountPercent: 0,\r\n  discountAmount: 0,\r\n  afterDiscountValue: 0,\r\n  billTo: '',\r\n  shipTo: '',\r\n  despatchMode: 'By Air',\r\n  paymentTerms: '',\r\n  freightCharges: '',\r\n  freighttaxAmount: '',\r\n  taxPercent: '',\r\n  packingCharges: '',\r\n  lineItems: [],\r\n});\r\nopenNewForm = () => {\r\n  this.setState({\r\n    showForm: true,\r\n    editingId: null,\r\n    formData: this.getEmptyInvoiceForm() // fresh blank form\r\n  });\r\n};\r\n\r\n  loadinvoiceForEdit = (invoice) => {\r\n  const normalizedLineItems = (invoice.lineItems || []).map(item => {\r\n    const qty = parseFloat(item.qty || 0);\r\n    const unitPrice = parseFloat(item.unitPrice || 0);\r\n    const baseTotal = qty * unitPrice;\r\n    const taxAmt = item.taxAmt ? parseFloat(item.taxAmt) : this.calcTaxAmt(item);\r\n    const itemTotal = item.itemTotal ? parseFloat(item.itemTotal) : (baseTotal + taxAmt);\r\n\r\n    return {\r\n      ...item,\r\n      qty,\r\n      unitPrice,\r\n      taxAmt: taxAmt.toFixed(2),\r\n      itemTotal: itemTotal.toFixed(2),\r\n      taxGroupNames: item.taxGroupNames || (item.taxGroup ? [item.taxGroup] : [])\r\n    };\r\n  });\r\n\r\n  this.setState({\r\n    formData: {\r\n      ...invoice,\r\n      lineItems: normalizedLineItems\r\n    },\r\n    editingId: invoice.id,\r\n    showForm: true,\r\n    activeTab: 'co'\r\n  }, this.recalculateDirectBillingTotals);\r\n};\r\n\r\ntoggleInvoiceForm = () => {\r\n  this.setState({\r\n    showForm: true,\r\n    editingId: null,\r\n    formData: this.getEmptyInvoiceForm(),\r\n  });\r\n};\r\n\r\n  showOverlay = (type) => this.setState({ overlayType: type, overlaySearch: '' });\r\n  hideOverlay = () => this.setState({ overlayType: '', overlaySearch: '' });\r\n\r\n  selectOverlayValue = (value) => {\r\n    if (this.state.overlayType === 'customer') {\r\n      this.setState(prev => ({\r\n        formData: {\r\n          ...prev.formData,\r\n          customer: value.custname || value.custcode || '', // Use custname or custcode\r\n          billTo: this.formatAddress(value.billTo),\r\n          shipTo: this.formatAddress(value.shipTo),\r\n          currency: value.currency || '',\r\n          // despatchMode: value.despatchMode || '', // No auto-fill for despatch mode\r\n          // paymentTerms: value.paymentTerms || '' // No auto-fill for payment terms\r\n        },\r\n        overlayType: '',\r\n        overlaySearch: ''\r\n      }), () => {\r\n        if (this.customerInputRef.current) {\r\n          this.customerInputRef.current.value = value.custname || value.custcode || '';\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n\r\n renderOverlay = () => {\r\n  const { overlayType, overlaySearch, customers, despatchModes, paymentTerms } = this.state;\r\n\r\n  const getFilteredRows = (list, nameKey = 'name', codeKey = 'shortName') =>\r\n    list.filter(item =>\r\n      (item[nameKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase()) ||\r\n      (item[codeKey] || '').toLowerCase().includes((overlaySearch || '').toLowerCase())\r\n    );\r\n\r\n  const handleSelect = (item) => {\r\n    if (overlayType === 'customer') {\r\n      this.selectOverlayValue(item);\r\n    } else if (overlayType === 'despatchMode') {\r\n      this.setState(prev => ({\r\n        formData: {\r\n          ...prev.formData,\r\n          despatchMode: item.name\r\n        },\r\n        overlayType: '',\r\n        overlaySearch: ''\r\n      }));\r\n    } else if (overlayType === 'paymentTerms') {\r\n      this.setState(prev => ({\r\n        formData: {\r\n          ...prev.formData,\r\n          paymentTerms: item.name\r\n        },\r\n        overlayType: '',\r\n        overlaySearch: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n  let title = '';\r\n  let headers = [];\r\n  let rows = [];\r\n\r\n  if (overlayType === 'customer') {\r\n    title = 'Select Customer';\r\n    headers = ['Name', 'Code', 'Short Name'];\r\n    rows = getFilteredRows(customers, 'custname', 'custcode');\r\n  } else if (overlayType === 'despatchMode') {\r\n    title = 'Select Despatch Mode';\r\n    headers = ['Name'];\r\n    rows = getFilteredRows(despatchModes);\r\n  } else if (overlayType === 'paymentTerms') {\r\n    title = 'Select Payment Terms';\r\n    headers = ['Name'];\r\n    rows = getFilteredRows(paymentTerms);\r\n  } else {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\">\r\n        <div className=\"custom-overlay-title\">{title}</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-control mb-2\"\r\n          placeholder={`Search ${overlayType}...`}\r\n          value={overlaySearch}\r\n          onChange={e => this.setState({ overlaySearch: e.target.value })}\r\n        />\r\n        <div style={{ maxHeight: 300, overflowY: 'auto' }}>\r\n          <table className=\"table table-bordered table-sm\">\r\n            <thead>\r\n              <tr>\r\n                {headers.map((h, i) => <th key={i}>{h}</th>)}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {rows.map((item, i) => (\r\n                <tr key={item.id || i} onClick={() => handleSelect(item)} style={{ cursor: 'pointer' }}>\r\n                  {headers.map((h, j) => (\r\n                    <td key={j}>\r\n                      {overlayType === 'customer'\r\n                        ? h === 'Name' ? item.custname\r\n                          : h === 'Code' ? item.custcode\r\n                          : item.custshortName\r\n                        : h === 'Name' ? item.name\r\n                          : item.shortName}\r\n                    </td>\r\n                  ))}\r\n                </tr>\r\n              ))}\r\n              {rows.length === 0 && (\r\n                <tr>\r\n                  <td colSpan={headers.length} className=\"text-center\">No records found</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        <button className=\"btn btn-secondary btn-sm mt-2\" onClick={this.hideOverlay}>Cancel</button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\nrenderTaxOverlay = () => {\r\n  const { taxGroups, currentTaxIdx, formData } = this.state;\r\n  if (currentTaxIdx === null) return null;\r\n  const item = formData.lineItems[currentTaxIdx];\r\n  const selected = new Set(item.taxGroupNames || []);\r\n  return (\r\n    <div style={{\r\n      position: 'fixed', zIndex: 1000, top: '10%', left: '15%',\r\n      background: '#fff', border: '1px solid #ccc', padding: '20px',\r\n      boxShadow: '0 0 10px rgba(0,0,0,0.3)', width: '70%',\r\n      maxHeight: '70vh', overflowY: 'auto'\r\n    }}>\r\n      <h5>Select Tax Groups</h5>\r\n      <table className=\"table table-sm table-bordered\">\r\n        <thead>\r\n          <tr><th></th><th>Group</th><th>Components</th><th>%</th></tr>\r\n        </thead>\r\n        <tbody>\r\n          {taxGroups.map(tg => (\r\n            <tr key={tg.groupName}>\r\n              <td>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={selected.has(tg.groupName)}\r\n                  onChange={e =>\r\n                    this.toggleTaxGroupSelection(tg.groupName, currentTaxIdx, e.target.checked)\r\n                  }\r\n                />\r\n              </td>\r\n              <td>{tg.groupName}</td>\r\n              <td>{tg.lineItems.map(li => li.component).join(', ')}</td>\r\n              <td>{tg.lineItems.map(li => li.percentOrAmt).join(', ')}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n      <div className=\"text-right mt-3\">\r\n        <button className=\"btn btn-sm btn-success\" onClick={() => this.setState({ showTaxOverlay: false, currentTaxIdx: null })}>\r\n          Done\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\ntoggleTaxGroupSelection = (groupName, lineIdx, isChecked) => {\r\n  const formData = { ...this.state.formData };\r\n  const item = formData.lineItems[lineIdx];\r\n  if (!item.taxGroupNames) item.taxGroupNames = [];\r\n  if (isChecked) {\r\n    if (!item.taxGroupNames.includes(groupName)) {\r\n      item.taxGroupNames.push(groupName);\r\n    }\r\n  } else {\r\n    item.taxGroupNames = item.taxGroupNames.filter(g => g !== groupName);\r\n  }\r\n  // recalculate taxAmt and total// after changing taxGroupNames on the item:\r\nitem.taxAmt = this.calcTaxAmt(item); // numeric\r\nitem.itemTotal = this.calcItemTotal(item.qty, item.unitPrice, item.taxAmt); // numeric\r\nthis.setState({ formData }, this.recalculateDirectBillingTotals);\r\n\r\n};\r\n\r\ncalcTaxAmt = (item) => {\r\n  let percent = 0;\r\n  let amount = 0;\r\n  (item.taxGroupNames || []).forEach(groupName => {\r\n    const group = this.state.taxGroups.find(t => t.groupName === groupName);\r\n    if (group && Array.isArray(group.lineItems)) {\r\n      group.lineItems.forEach(comp => {\r\n        const val = parseFloat(comp.percentOrAmt || 0);\r\n        if (comp.type === 'Percentage') percent += val;\r\n        if (comp.type === 'Amount') amount += val;\r\n      });\r\n    }\r\n  });\r\n  const baseTotal = (parseFloat(item.unitPrice || 0) * parseFloat(item.qty || 0));\r\n  const tax = ((baseTotal * percent) / 100 + amount);\r\n  return isNaN(tax) ? 0 : tax;\r\n};\r\n\r\ncalcItemTotal = (qty, unitPrice, taxAmt) => {\r\n  qty = parseFloat(qty) || 0;\r\n  unitPrice = parseFloat(unitPrice) || 0;\r\n  taxAmt = parseFloat(taxAmt) || 0;\r\n  return (qty * unitPrice) + taxAmt;\r\n};\r\n\r\nrecalculateDirectBillingTotals = () => {\r\n  const fd = this.state.formData;\r\n  const lineItems = fd.lineItems || [];\r\n\r\n  let lineBaseTotal = 0;\r\n  let lineTaxTotal = 0;\r\n\r\n  const updatedLineItems = lineItems.map(item => {\r\n    const qty = parseFloat(item.qty || 0);\r\n    const unitPrice = parseFloat(item.unitPrice || 0);\r\n    const baseTotal = qty * unitPrice;\r\n    const taxAmt = this.calcTaxAmt(item); // numeric\r\n    const itemTotal = baseTotal + taxAmt;\r\n\r\n    lineBaseTotal += baseTotal;\r\n    lineTaxTotal += taxAmt;\r\n\r\n    return {\r\n      ...item,\r\n      taxAmt: taxAmt.toFixed(2),\r\n      itemTotal: itemTotal.toFixed(2)\r\n    };\r\n  });\r\n\r\n  const freight = parseFloat(fd.freightCharges) || 0;\r\n  const packing = parseFloat(fd.packingCharges) || 0;\r\n  const taxPercent = parseFloat(fd.taxPercent) || 0;\r\n\r\n  // freight tax only applies for None/CIF\r\n  const freightTax = (['None', 'CIF'].includes(fd.impExp)) ? (freight * taxPercent) / 100 : 0;\r\n\r\n  const totalTaxAmount = lineTaxTotal + freightTax;\r\n  const invoiceValue = lineBaseTotal + freight + packing + totalTaxAmount;\r\n\r\n    let discountAmount = '';\r\n  let afterDiscountValue = '';\r\n\r\n  if (fd.discountPercent !== '' && fd.discountPercent !== null && !isNaN(fd.discountPercent)) {\r\n    const dPercent = parseFloat(fd.discountPercent) || 0;\r\n    discountAmount = ((invoiceValue * dPercent) / 100).toFixed(2);\r\n    afterDiscountValue = (invoiceValue - parseFloat(discountAmount)).toFixed(2);\r\n  }\r\n\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      lineItems: updatedLineItems,\r\n      taxAmount: totalTaxAmount.toFixed(2),\r\n      freighttaxAmount: freightTax.toFixed(2),\r\n      invoiceValue: invoiceValue.toFixed(2),\r\n      discountAmount,\r\n      afterDiscountValue,\r\n    }\r\n  }));\r\n};\r\n\r\n  renderProductOverlay = () => {\r\n    const { products, productOverlaySearch, selectedProductIds } = this.state;\r\n    const filtered = products.filter(p =>\r\n      (p.ptshortName || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) ||\r\n      (p.ptdescription || '').toLowerCase().includes(productOverlaySearch.toLowerCase()) ||\r\n      (p.itemCode || '').toLowerCase().includes(productOverlaySearch.toLowerCase())\r\n    );\r\n    return (\r\n      <div className=\"custom-overlay\">\r\n        <div className=\"custom-overlay-content\">\r\n          <div className=\"d-flex justify-content-between align-items-center mb-2\">\r\n            <div className=\"custom-overlay-title\">Select Products</div>\r\n            <button\r\n              className=\"btn btn-success btn-sm\"\r\n              onClick={() => {\r\n                const selectedProducts = products.filter(p => this.state.selectedProductIds.includes(p.id));\r\n                this.setState(prev => ({\r\n                  formData: {\r\n                    ...prev.formData,\r\n                    lineItems: [\r\n                      ...prev.formData.lineItems,\r\n                      ...selectedProducts\r\n                        .filter(p => !prev.formData.lineItems.some(item => item.id === p.id))\r\n                        .map(p => ({\r\n                          id: p.id,\r\n                          itemCode: p.productId || '',\r\n                          itemDescription: p.ptdescription || '',\r\n                          itemType: p.itemType || '',\r\n                          materialType: p.materialType || '',\r\n                          onHand: p.onHand || 0,\r\n                          taxGroup: p.taxGroup || '',\r\n                          custPartNo: p.custPartNo || '', // Assuming this is cust part table\r\n                          hsnNo: p.hsnNo || '', // Assuming HSN No.\r\n                          unitPrice: p.unitPrice || 0,\r\n                          qty: 1,\r\n                          taxAmt:0,\r\n                          itemTotal: (p.unitPrice || 0).toFixed(2)\r\n                        }))\r\n                    ]\r\n                  },\r\n                  productOverlayVisible: false,\r\n                  selectedProductIds: []\r\n                }));\r\n              }}\r\n            >Add Selected</button>\r\n          </div>\r\n          <input\r\n            type=\"text\"\r\n            className=\"form-control mb-2\"\r\n            placeholder=\"Search products...\"\r\n            value={productOverlaySearch}\r\n            onChange={e => this.setState({ productOverlaySearch: e.target.value })}\r\n          />\r\n          <div style={{ maxHeight: 300, overflowY: 'auto' }}>\r\n            <table className=\"table table-bordered table-sm\">\r\n              <thead>\r\n                <tr>\r\n                  <th></th>\r\n                  <th>Item Code</th>\r\n                  <th>Item Desc</th>\r\n                  <th>Item Type</th>\r\n                  <th>Material Type</th>\r\n                  <th>On Hand</th>\r\n                  <th>Tax Grp</th>\r\n                  <th>Cust Part No</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filtered.map(p => (\r\n                  <tr key={p.id}>\r\n                    <td>\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedProductIds.includes(p.id)}\r\n                        onChange={e => {\r\n                          const checked = e.target.checked;\r\n                          this.setState(prev => ({\r\n                            selectedProductIds: checked\r\n                              ? [...prev.selectedProductIds, p.id]\r\n                              : prev.selectedProductIds.filter(id => id !== p.id)\r\n                          }));\r\n                        }}\r\n                      />\r\n                    </td>\r\n                    <td>{p.productId}</td>\r\n                    <td>{p.ptdescription || ''}</td>\r\n                    <td>{p.itemType || ''}</td>\r\n                    <td>{p.materialType || ''}</td>\r\n                    <td>{p.onHand || 0}</td>\r\n                    <td>{p.taxGroup || ''}</td>\r\n                    <td>{p.custPartNo || ''}</td>\r\n                  </tr>\r\n                ))}\r\n                {filtered.length === 0 && (\r\n                  <tr>\r\n                    <td colSpan=\"8\" className=\"text-center\">No products found</td>\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          {/* Add pagination here if needed, for now, it's just a placeholder */}\r\n          <div className=\"d-flex justify-content-between align-items-center mt-2\">\r\n            <span>Page 1 of 1</span>\r\n            <button className=\"btn btn-secondary btn-sm\" onClick={() => this.setState({ productOverlayVisible: false, selectedProductIds: [] })}>Cancel</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderinvoiceTable = () => (\r\n    <div className=\"card mt-4 full-height\">\r\n      <div className=\"card-body\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n          <h4 className=\"card-title\">Invoices</h4>\r\n          <button className=\"btn btn-primary\" onClick={this.openNewForm}>Create Invoice</button>\r\n        </div>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr style={{ fontSize: '14px' }}>\r\n                <th>Bill No</th>\r\n                <th>Customer</th>\r\n                <th>Date</th>\r\n                <th>Bill Value</th>\r\n                <th>After Discount</th>\r\n                <th>Status</th>\r\n                <th>Print</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {this.state.invoices.map((q, i) =>  {\r\n                let statusClass = \"badge-secondary\";\r\n                if (q.status === \"Entered\") statusClass = \"badge-warning\";\r\n                else if (q.status === \"Submitted\") statusClass = \"badge-info\";\r\n                else if (q.status === \"Cancelled\") statusClass = \"badge-danger\";\r\n\r\n                return (\r\n                <tr key={i} style={{ fontSize: '14px' }}>\r\n                  <td>\r\n                    <button\r\n                      className=\"btn btn-link p-0\"\r\n                      onClick={() => this.loadinvoiceForEdit(q)}\r\n                    >\r\n                      {q.invoiceNo}\r\n                    </button>\r\n                  </td>\r\n                  <td>{q.customer}</td>\r\n                  <td>{q.invoiceDate}</td>\r\n                  <td>{q.invoiceValue}</td>\r\n                  <td>{q.afterDiscountValue}</td>\r\n                  <td>\r\n                    <label className={`badge ${statusClass}`}\r\n                      style={{ fontSize: '14px' }}>\r\n                    {q.status}</label></td>\r\n                    <td>\r\n                      <i\r\n                        className=\"mdi mdi-printer menu-icon\"\r\n                        onClick={() => this.showDirectBillingPDFWithOrg(q)}\r\n                        style={{ fontSize: '24px', color: '#2196F3', cursor: 'pointer' }}\r\n                      ></i>\r\n                    </td>\r\n                 \r\n                </tr>\r\n                );\r\n})}\r\n              {this.state.invoices.length === 0 && (\r\n                <tr><td colSpan=\"6\" className=\"text-center\">No Direct Bill found.</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderinvoiceForm = () => {\r\n    const { formData, overlayType, productOverlayVisible } = this.state;\r\n    const isFOB = formData.impExp === 'FOB';\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"card full-height\">\r\n          <div style={{ flex: 1, overflowY: 'auto', padding: '24px' }}>\r\n            <h4 className=\"mb-3\">Direct Bill Form</h4>\r\n            <ul className=\"nav nav-tabs\" role=\"tablist\">\r\n              <li className=\"nav-item\">\r\n                <button type=\"button\" className={`nav-link ${this.state.activeTab === 'co' ? 'active' : ''}`} onClick={() => this.setState({ activeTab: 'co' })}>CO Details</button>\r\n              </li>\r\n              <li className=\"nav-item\">\r\n                <button type=\"button\" className={`nav-link ${this.state.activeTab === 'commercial' ? 'active' : ''}`} onClick={() => this.setState({ activeTab: 'commercial' })}>Commercial Terms</button>\r\n              </li>\r\n            </ul>\r\n            <form className=\"form-sample\" onSubmit={this.handleSubmit}>\r\n              <div className=\"tab-content pt-3\">\r\n                {this.state.activeTab === 'co' && (\r\n                  <>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Bill No</label>\r\n                        <input type=\"text\" className=\"form-control form-control-sm\" value={formData.invoiceNo} onChange={(e) => this.handleInputChange('invoiceNo', e.target.value)} />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Bill Date</label>\r\n                        <input type=\"date\" className=\"form-control form-control-sm\" value={formData.invoiceDate} onChange={(e) => this.handleInputChange('invoiceDate', e.target.value)} />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Bill Type</label>\r\n                        <select className=\"form-control form-control-sm\" value={formData.invoiceType} onChange={(e) => this.handleInputChange('invoiceType', e.target.value)}>\r\n                          <option>Standard</option>\r\n                          <option>Manual</option>\r\n                        </select>\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Status</label>\r\n                        <input type=\"text\" className=\"form-control form-control-sm\" value={formData.status}   style={{ backgroundColor: '#fff' }} readOnly />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Customer</label>\r\n                        <div className=\"input-group input-group-sm\">\r\n                          <input\r\n                            type=\"text\"\r\n                            className=\"form-control\"\r\n                            placeholder=\"Choose Customer\"\r\n                            ref={this.customerInputRef}\r\n                            value={formData.customer}\r\n                            readOnly\r\n                            onClick={() => this.showOverlay('customer')}\r\n                            style={{ cursor: 'pointer' }}\r\n                          />\r\n                          <div className=\"input-group-append\">\r\n                            <button className=\"btn btn-outline-secondary btn-sm\" type=\"button\" onClick={() => this.showOverlay('customer')}>Select</button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>IMP/EXP</label>\r\n                        <select\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.impExp}\r\n                          onChange={(e) => this.handleInputChange('impExp', e.target.value)}\r\n                        >\r\n                          <option>None</option>\r\n                          <option>COB</option>\r\n                          <option>FOB</option>\r\n                          <option>CIF</option>\r\n                        </select>\r\n                      </div>\r\n                      <div className=\"form-group col-md-2\">\r\n                        <label>Ref No.</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.qrefNo}\r\n                          onChange={(e) => this.handleInputChange('qrefNo', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Choose</label>\r\n                        <div className=\"d-flex align-items-center\">\r\n                          <div className=\"form-check mr-4\">\r\n                            <input type=\"radio\" className=\"form-check-input\" name=\"choose\" id=\"chooseService\" value=\"Service\" checked={formData.choose === 'Service'} onChange={(e) => this.handleInputChange('choose', e.target.value)} />\r\n                            <label className=\"form-check-label\" htmlFor=\"chooseService\">Service</label>\r\n                          </div>\r\n                          <div className=\"form-check\">\r\n                            <input type=\"radio\" className=\"form-check-input\" name=\"choose\" id=\"chooseProduct\" value=\"Product\" checked={formData.choose === 'Product'} onChange={(e) => this.handleInputChange('choose', e.target.value)} />\r\n                            <label className=\"form-check-label\" htmlFor=\"chooseProduct\">Product</label>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Currency</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.currency}\r\n                          style={{ backgroundColor: '#fff' }}\r\n                          readOnly\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Conversion Rate</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.conversionRate}\r\n                          onChange={(e) => this.handleInputChange('conversionRate', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Tax Amount</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.taxAmount}\r\n                          onChange={(e) => this.handleInputChange('taxAmount', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-3\">\r\n                        <label>Bill Value</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.invoiceValue}\r\n                          onChange={(e) => this.handleInputChange('invoiceValue', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-4\">\r\n                      <label>Discount %</label>\r\n                      <input\r\n                      type=\"number\"\r\n                      value={formData.discountPercent}\r\n                      onChange={e => {\r\n                        this.handleInputChange('discountPercent', e.target.value);\r\n                        this.recalculateDirectBillingTotals();\r\n                      }}\r\n                    />\r\n                    </div>\r\n                    <div className=\"form-group col-md-4\">\r\n                    <label>Discount Amount</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      className=\"form-control\"\r\n                      value={this.state.formData.discountAmount}\r\n                      readOnly\r\n                    />\r\n                  </div>\r\n                  <div className=\"form-group col-md-4\">\r\n                      <label>After Discount - Quote Value</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        className=\"form-control\"\r\n                        value={this.state.formData.afterDiscountValue}\r\n                        readOnly\r\n                      />\r\n                    </div>\r\n                </div>\r\n                   \r\n                          <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n                            <h4 className=\"card-title\">Line Item</h4>\r\n                            <button type=\"button\" className=\"btn btn-primary btn-sm\" onClick={() => this.setState({ productOverlayVisible: true })}>\r\n                              + Add Product\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"table-responsive\">\r\n                            <table className=\"table table-bordered\">\r\n                              <thead className=\"thead-light\">\r\n                                <tr >\r\n                                  <th>Item Code </th>\r\n                                  <th>Item Desc </th>\r\n                                  <th>Cust Part No </th>\r\n                                  <th>HSN No </th>\r\n                                  <th>On Hand </th> \r\n                                  <th>Unit Price</th>\r\n                                  <th>Quantity</th>\r\n                                  <th>Tax Id</th>\r\n                                  <th>Item Total</th>\r\n                                  <th>Tax Amt</th>\r\n                                </tr>\r\n                              </thead>\r\n                              <tbody>\r\n                                {formData.lineItems.map((item, idx) => (\r\n                                  <tr key={item.id || idx}>\r\n                                    <td>{item.itemCode}</td>\r\n                                    <td>{item.itemDescription}</td>\r\n                                    <td>{item.custPartNo}</td>\r\n                                    <td>{item.hsnNo}</td>\r\n                                    <td>{item.onHand}</td>\r\n                                    <td>\r\n                                      <input\r\n                                        type=\"number\"\r\n                                        value={item.unitPrice}\r\n                                        onChange={e => this.handleLineItemChange(idx, 'unitPrice', e.target.value)}\r\n                                        style={{ width: 80 }}\r\n                                      />\r\n                                    </td>\r\n                                    <td>\r\n                                      <input\r\n                                        type=\"number\"\r\n                                        min=\"1\"\r\n                                        value={item.qty}\r\n                                        onChange={e => this.handleLineItemChange(idx, 'qty', e.target.value)}\r\n                                        style={{ width: 60 }}\r\n                                      />\r\n                                    </td>\r\n                                    <td>\r\n                                  <button\r\n                                    type=\"button\"\r\n                                    className=\"btn btn-outline-primary btn-sm\"\r\n                                    onClick={() => this.setState({ showTaxOverlay: true, currentTaxIdx: idx })}\r\n                                  >\r\n                                    Select Tax\r\n                                  </button>\r\n                                  <div style={{ fontSize: '10px', marginTop: '4px' }}>\r\n                                    {(item.taxGroupNames || []).join(', ') || '-'}\r\n                                  </div>\r\n                                </td>\r\n                                \r\n                                {this.state.showTaxOverlay && this.renderTaxOverlay()}\r\n                                    <td>{item.itemTotal || '0.00'}</td>\r\n                                      <td>{item.taxAmt || '0.00'}</td>\r\n                                      \r\n                                  </tr>\r\n                                ))}\r\n                                {formData.lineItems.length === 0 && (\r\n                                  <tr>\r\n                                    <td colSpan=\"9\" className=\"text-center\">No items</td>\r\n                                  </tr>\r\n                                )}\r\n                              </tbody>\r\n                            </table>\r\n                          </div>\r\n                          {/* Add pagination for line items here if needed */}\r\n                          <div className=\"d-flex justify-content-between align-items-center mt-2\">\r\n                            <span>Page 1 of 1</span>\r\n                          </div>\r\n                      \r\n                  </>\r\n                )}\r\n                {this.state.activeTab === 'commercial' && (\r\n                  <>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-6\">\r\n                        <label>Bill To</label>\r\n                        <textarea\r\n                          className=\"form-control form-control-sm\"\r\n                          rows=\"3\"\r\n                          value={formData.billTo}\r\n                          onChange={(e) => this.handleInputChange('billTo', e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-6\">\r\n                        <label>Ship To</label>\r\n                        <textarea\r\n                          className=\"form-control form-control-sm\"\r\n                          rows=\"3\"\r\n                          value={formData.shipTo}\r\n                          onChange={(e) => this.handleInputChange('shipTo', e.target.value)}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                    <div className=\"form-group col-md-4\">\r\n  <label>Despatch Mode</label>\r\n  <div className=\"input-group input-group-sm\">\r\n    <input\r\n      type=\"text\"\r\n      className=\"form-control\"\r\n      value={formData.despatchMode}\r\n      readOnly\r\n      onClick={() => !isFOB && this.showOverlay('despatchMode')}\r\n      style={{ cursor: isFOB ? 'not-allowed' : 'pointer', backgroundColor: '#fff' }}\r\n    />\r\n    <div className=\"input-group-append\">\r\n      <button\r\n        className=\"btn btn-outline-secondary btn-sm\"\r\n        type=\"button\"\r\n        disabled={isFOB}\r\n        onClick={() => this.showOverlay('despatchMode')}\r\n      >\r\n        Select\r\n      </button>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div className=\"form-group col-md-4\">\r\n  <label>Payment Terms</label>\r\n  <div className=\"input-group input-group-sm\">\r\n    <input\r\n      type=\"text\"\r\n      className=\"form-control\"\r\n      value={formData.paymentTerms}\r\n      readOnly\r\n      onClick={() => !isFOB && this.showOverlay('paymentTerms')}\r\n      style={{ cursor: isFOB ? 'not-allowed' : 'pointer', backgroundColor: '#fff' }}\r\n    />\r\n    <div className=\"input-group-append\">\r\n      <button\r\n        className=\"btn btn-outline-secondary btn-sm\"\r\n        type=\"button\"\r\n        disabled={isFOB}\r\n        onClick={() => this.showOverlay('paymentTerms')}\r\n      >\r\n        Select\r\n      </button>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Freight Charges</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.freightCharges}\r\n                          onChange={(e) => this.handleInputChange('freightCharges', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-row\">\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Tax %</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.taxPercent}\r\n                          onChange={(e) => this.handleInputChange('taxPercent', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Freight Tax Amount</label>\r\n<input\r\n  type=\"number\"\r\n  className=\"form-control form-control-sm\"\r\n  value={formData.freighttaxAmount || ''}\r\n  readOnly\r\n/>\r\n\r\n                      </div>\r\n                      <div className=\"form-group col-md-4\">\r\n                        <label>Packing Charges</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"form-control form-control-sm\"\r\n                          value={formData.packingCharges}\r\n                          onChange={(e) => this.handleInputChange('packingCharges', e.target.value)}\r\n                          readOnly={isFOB} // Read-only if FOB\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-right mt-3\">\r\n                      <button type=\"submit\" className=\"btn btn-success\">Save All Details</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n              <div className=\"fixed-card-footer text-right p-3 border-top bg-white\">\r\n                <button type=\"submit\" className=\"btn btn-success mr-2\">Save All Details</button>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"btn btn-secondary\"\r\n                  onClick={() => this.setState({ showForm: false, editingId: null })}\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </form>\r\n            {overlayType && this.renderOverlay()}\r\n            {productOverlayVisible && this.renderProductOverlay()}\r\n          </div>\r\n           \r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  render() {\r\n  return (\r\n    <div className=\"container-fluid\">\r\n      {this.state.previewMode\r\n        ? this.renderinvoicePreview()\r\n        : this.state.showForm\r\n        ? this.renderinvoiceForm()\r\n        : this.renderinvoiceTable()}\r\n    </div>\r\n  );\r\n}\r\n\r\n}\r\n\r\n\r\nexport default DirectBilling;"]},"metadata":{},"sourceType":"module"}