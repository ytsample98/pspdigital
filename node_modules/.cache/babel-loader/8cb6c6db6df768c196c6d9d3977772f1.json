{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\admin\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\invoice\\\\cbill\\\\contractfinalbill.js\";\n// src/app/sales/salestransactions/servicecontract/contractfinalbilling.js\nimport React, { Component } from \"react\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { db } from \"../../../../../firebase\";\nimport { collection, getDocs, addDoc, updateDoc, doc, serverTimestamp } from \"firebase/firestore\";\nimport html2canvas from 'html2canvas';\nimport { jsPDF } from 'jspdf';\nimport { toWords } from 'number-to-words';\n\nclass ContractFinalBilling extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      contracts: [],\n      taxGroups: [],\n      bills: [],\n      showForm: false,\n      editingId: null,\n      activeTab: 0,\n      showContractOverlay: false,\n      contractOverlaySearch: \"\",\n      formData: this.getEmptyForm(),\n      notes: \"\"\n    };\n\n    this.fetchContracts = async () => {\n      const snap = await getDocs(collection(db, \"contracts\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      const filtered = data.filter(c => c.status === 'Approved' || c.status === 'Partial');\n      this.setState({\n        contracts: filtered\n      });\n    };\n\n    this.fetchBills = async () => {\n      const snap = await getDocs(collection(db, \"finalBills\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        bills: data.reverse()\n      });\n    };\n\n    this.fetchTaxGroups = async () => {\n      const snap = await getDocs(collection(db, \"taxGroups\"));\n      const data = snap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      }));\n      this.setState({\n        taxGroups: data\n      });\n    };\n\n    this.autoGenerateBills = async () => {\n      const today = new Date();\n      const contractsSnap = await getDocs(collection(db, \"contracts\"));\n      const contracts = contractsSnap.docs.map(d => ({\n        id: d.id,\n        ...d.data()\n      })).filter(c => c.autoBill && c.status === \"Approved\");\n\n      for (const contract of contracts) {\n        let lastTo = new Date(contract.durationTo);\n        let tillDate = contract.tillDate ? new Date(contract.tillDate) : null;\n        let billingType = contract.billingTypes && contract.billingTypes[0] || 'yearly';\n        let monthsPerCycle = billingType === 'yearly' ? 12 : billingType === 'half-yearly' ? 6 : 3; // Find last bill for this contract\n\n        const billsSnap = await getDocs(collection(db, \"finalBills\"));\n        const bills = billsSnap.docs.map(d => ({\n          id: d.id,\n          ...d.data()\n        })).filter(b => b.contractId === contract.id);\n        let nextFrom = new Date(contract.durationFrom);\n\n        if (bills.length > 0) {\n          // Get last bill's durationTo\n          const lastBill = bills.reduce((a, b) => new Date(a.durationTo) > new Date(b.durationTo) ? a : b);\n          nextFrom = new Date(lastBill.durationTo);\n          nextFrom.setDate(nextFrom.getDate() + 1);\n        } // Generate bills until today < tillDate\n\n\n        while (tillDate && nextFrom <= today && nextFrom <= tillDate) {\n          let nextTo = new Date(nextFrom);\n          nextTo.setMonth(nextTo.getMonth() + monthsPerCycle);\n          nextTo.setDate(nextTo.getDate() - 1); // End of cycle\n          // Check if bill already exists for this period\n\n          const exists = bills.some(b => b.durationFrom === nextFrom.toISOString().split('T')[0] && b.durationTo === nextTo.toISOString().split('T')[0]);\n\n          if (!exists) {\n            // Create bill\n            const billData = {\n              billType: \"Standard\",\n              billNo: `CB${Math.floor(Math.random() * 100000)}`,\n              billDate: new Date().toISOString().split(\"T\")[0],\n              status: \"Yet to Bill\",\n              contractId: contract.id,\n              contractNo: contract.contractNo,\n              nameofwrk: contract.nameofwrk,\n              customer: contract.customer,\n              currency: contract.currency,\n              conversionRate: contract.conversionRate,\n              amtAgreed: contract.amtAgreed,\n              durationFrom: nextFrom.toISOString().split('T')[0],\n              durationTo: nextTo.toISOString().split('T')[0],\n              billTo: contract.billTo,\n              shipTo: contract.shipTo,\n              despatchMode: contract.despatchMode,\n              paymentTerms: contract.paymentTerms,\n              freightCharges: contract.freightCharges,\n              freightPercent: contract.freightTaxPercent,\n              freightTaxAmt: contract.freightTaxAmt,\n              packingCharges: contract.packingCharges,\n              lineItems: contract.lineItems.map(item => ({ ...item,\n                months: monthsPerCycle,\n                days: 0,\n                qty: item.qty,\n                unitPrice: item.unitPrice,\n                taxGroupNames: item.taxGroupNames,\n                taxAmt: 0,\n                itemTotal: 0\n              })),\n              createdAt: serverTimestamp()\n            };\n            await addDoc(collection(db, \"finalBills\"), billData);\n          } // Prepare for next cycle\n\n\n          nextFrom = new Date(nextTo);\n          nextFrom.setDate(nextFrom.getDate() + 1);\n        }\n      }\n    };\n\n    this.formatAddress = addr => {\n      if (!addr) return '';\n      if (typeof addr === 'string') return addr;\n      return [addr.address, [addr.city, addr.state, addr.country].filter(Boolean).join(', '), addr.zip].filter(Boolean).join('\\n');\n    };\n\n    this.handleInputChange = (field, value) => {\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          [field]: value\n        }\n      }), () => {\n        if (field === 'discountPercent') {\n          const amtAgreed = parseFloat(this.state.formData.amtAgreed || 0);\n          const discountPercent = parseFloat(this.state.formData.discountPercent || 0);\n          const discountAmount = (amtAgreed * discountPercent / 100).toFixed(2);\n          this.setState(prev => ({\n            formData: { ...prev.formData,\n              discountAmount\n            }\n          }), this.recalculateBillTotals);\n        }\n\n        if (['freightCharges', 'freightPercent', 'packingCharges', 'conversionRate', 'stdDays', 'amtAgreed', 'discountPercent'].includes(field)) {\n          this.recalculateBillTotals();\n        }\n      });\n    };\n\n    this.getRecvQtyMap = async contractId => {\n      const snap = await getDocs(collection(db, \"finalBills\"));\n      const approvedBills = snap.docs.map(doc => doc.data()).filter(bill => bill.contractId === contractId && bill.status === \"Approved\");\n      const recvQtyMap = {};\n      approvedBills.forEach(bill => {\n        (bill.lineItems || []).forEach(item => {\n          const code = item.itemCode;\n          const qty = parseFloat(item.qty || 0);\n          recvQtyMap[code] = (recvQtyMap[code] || 0) + qty;\n        });\n      });\n      return recvQtyMap;\n    };\n\n    this.selectContract = async contract => {\n      // Prepare line items from contract\n      const lineItems = (contract.lineItems || []).map(li => ({\n        itemCode: li.itemCode,\n        itemDesc: li.itemDesc,\n        hsnCode: li.hsnCode,\n        uom: li.uom,\n        duration: li.duration || `${contract.durationFrom} to ${contract.durationTo}`,\n        qty: li.qty || '',\n        // user can edit\n        unitPrice: li.unitPrice || '',\n        months: li.months || 1,\n        taxGroupNames: li.taxGroupNames || [],\n        taxAmt: 0,\n        itemTotal: 0,\n        days: '' // for prorate, user can edit\n\n      }));\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          contractId: contract.id,\n          contractNo: contract.contractNo,\n          nameofwrk: contract.nameofwrk || \"\",\n          customer: contract.customer,\n          currency: contract.currency,\n          conversionRate: contract.conversionRate,\n          amtAgreed: contract.amtAgreed,\n          durationFrom: contract.durationFrom,\n          durationTo: contract.durationTo,\n          billTo: this.formatAddress(contract.billTo),\n          shipTo: this.formatAddress(contract.shipTo),\n          despatchMode: contract.despatchMode,\n          paymentTerms: contract.paymentTerms,\n          freightCharges: contract.freightCharges || \"\",\n          freightPercent: contract.freightTaxPercent || \"\",\n          freightTaxAmt: contract.freightTaxAmt || \"\",\n          packingCharges: contract.packingCharges || \"\",\n          lineItems\n        },\n        showContractOverlay: false\n      }), this.recalculateBillTotals);\n    };\n\n    this.handleInputChange = (field, value) => {\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          [field]: value\n        }\n      }), () => {\n        if (['freightCharges', 'freightPercent', 'packingCharges', 'conversionRate', 'stdDays', 'amtAgreed'].includes(field)) {\n          this.recalculateBillTotals();\n        }\n      });\n    };\n\n    this.handleLineItemChange = (idx, field, value) => {\n      const items = [...this.state.formData.lineItems];\n      items[idx] = { ...items[idx],\n        [field]: value\n      }; // Calculation\n\n      const qty = parseFloat(items[idx].qty || 0);\n      const unitPrice = parseFloat(items[idx].unitPrice || 0);\n      const months = parseFloat(items[idx].months || 1);\n      const days = parseFloat(items[idx].days || 0);\n      let totalMonths = months;\n\n      if (days > 0) {\n        let daysInMonth = 30;\n        const {\n          durationFrom\n        } = this.state.formData;\n\n        if (durationFrom) {\n          const d = new Date(durationFrom);\n          daysInMonth = new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();\n        }\n\n        totalMonths = months + days / daysInMonth;\n      }\n\n      const baseTotal = qty * unitPrice * totalMonths;\n      items[idx].itemTotal = baseTotal.toFixed(2);\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          lineItems: items\n        }\n      }), this.recalculateBillTotals);\n    };\n\n    this.recalculateBillTotals = () => {\n      const {\n        lineItems,\n        freightCharges,\n        freightPercent,\n        packingCharges,\n        conversionRate,\n        discountAmount\n      } = this.state.formData;\n      let billValue = 0;\n      let taxAmt = 0;\n      (lineItems || []).forEach(item => {\n        billValue += parseFloat(item.itemTotal || 0);\n        taxAmt += parseFloat(item.taxAmt || 0);\n      });\n      const freightTaxAmt = parseFloat(freightCharges || 0) * parseFloat(freightPercent || 0) / 100;\n      billValue += parseFloat(freightCharges || 0) + parseFloat(packingCharges || 0) + freightTaxAmt; // Apply discount\n\n      billValue -= parseFloat(discountAmount || 0); // Apply conversion rate if needed\n\n      let finalValue = billValue;\n\n      if (conversionRate) {\n        finalValue = billValue * parseFloat(conversionRate);\n      }\n\n      this.setState(prev => ({\n        formData: { ...prev.formData,\n          billValue: finalValue.toFixed(2),\n          taxAmt: taxAmt.toFixed(2),\n          freightTaxAmt: freightTaxAmt.toFixed(2)\n        }\n      }));\n    };\n\n    this.handleTabChange = i => this.setState({\n      activeTab: i\n    });\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      this.setState({\n        loading: true,\n        error: null\n      });\n\n      try {\n        const {\n          editingId,\n          formData,\n          bills\n        } = this.state;\n        const saveData = { ...formData,\n          notes: this.state.notes,\n          createdAt: serverTimestamp(),\n          status: \"Awaiting For Approval\"\n        };\n\n        if (editingId) {\n          await updateDoc(doc(db, \"finalBills\", editingId), saveData);\n        } else {\n          saveData.billNo = `CB${1000 + bills.length}`;\n          await addDoc(collection(db, \"finalBills\"), saveData);\n        }\n\n        await this.fetchBills(); // Ensure bills are refreshed before hiding form\n\n        this.setState({\n          showForm: false,\n          editingId: null,\n          formData: this.getEmptyForm(),\n          notes: \"\",\n          loading: false\n        });\n      } catch (err) {\n        this.setState({\n          error: err.message,\n          loading: false\n        });\n        alert(\"Error saving bill: \" + err.message);\n      }\n    };\n\n    this.showContractBillingPDFWithOrg = async bill => {\n      var _orgSnap$docs$;\n\n      // 1. Fetch org and customer data\n      const orgSnap = await getDocs(collection(db, 'businessGroups'));\n      const org = ((_orgSnap$docs$ = orgSnap.docs[0]) === null || _orgSnap$docs$ === void 0 ? void 0 : _orgSnap$docs$.data()) || {};\n      const customerSnap = await getDocs(collection(db, 'customers'));\n      const customers = customerSnap.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      const customer = customers.find(c => c.custname === bill.customer || c.custcode === bill.customer) || {}; // GST State Map\n\n      const gstStateMap = {\n        \"01\": \"Jammu & Kashmir\",\n        \"02\": \"Himachal Pradesh\",\n        \"03\": \"Punjab\",\n        \"04\": \"Chandigarh\",\n        \"05\": \"Uttarakhand\",\n        \"06\": \"Haryana\",\n        \"07\": \"Delhi\",\n        \"08\": \"Rajasthan\",\n        \"09\": \"Uttar Pradesh\",\n        \"10\": \"Bihar\",\n        \"11\": \"Sikkim\",\n        \"12\": \"Arunachal Pradesh\",\n        \"13\": \"Nagaland\",\n        \"14\": \"Manipur\",\n        \"15\": \"Mizoram\",\n        \"16\": \"Tripura\",\n        \"17\": \"Meghalaya\",\n        \"18\": \"Assam\",\n        \"19\": \"West Bengal\",\n        \"20\": \"Jharkhand\",\n        \"21\": \"Odisha\",\n        \"22\": \"Chhattisgarh\",\n        \"23\": \"Madhya Pradesh\",\n        \"24\": \"Gujarat\",\n        \"25\": \"Daman and Diu\",\n        \"26\": \"Dadra and Nagar Haveli\",\n        \"27\": \"Maharashtra\",\n        \"28\": \"Andhra Pradesh (Old)\",\n        \"29\": \"Karnataka\",\n        \"30\": \"Goa\",\n        \"31\": \"Lakshadweep\",\n        \"32\": \"Kerala\",\n        \"33\": \"Tamil Nadu\",\n        \"34\": \"Puducherry\",\n        \"35\": \"Andaman and Nicobar Islands\",\n        \"36\": \"Telangana\",\n        \"37\": \"Andhra Pradesh\",\n        \"97\": \"Other Territory\"\n      };\n\n      const getPlaceOfSupply = gstin => {\n        if (!gstin || gstin.length < 2) return '';\n        const code = gstin.substring(0, 2);\n        const state = gstStateMap[code];\n        return state ? `${code} - ${state}` : '';\n      }; // 2. Enrich line items\n      // In showContractBillingPDFWithOrg\n\n\n      const enrichedItems = (bill.lineItems || []).filter(item => parseFloat(item.qty || 0) > 0).map(item => ({ ...item,\n        hsnCode: item.hsnCode || '',\n        uom: item.uom || '',\n        itemDesc: item.itemDesc || '',\n        taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\n      })); // 3. Totals\n\n      const subtotal = enrichedItems.reduce((sum, item) => sum + (parseFloat(item.unitPrice) || 0) * (parseFloat(item.billQty) || 0) * (parseFloat(item.unitDayOrWk) || 1) * (parseFloat(item.months) || 1) * (parseFloat(bill.stdDays) || 30), 0);\n      const freightCharges = parseFloat(bill.freightCharges || 0);\n      const packingCharges = parseFloat(bill.packingCharges || 0);\n      const freightTax = parseFloat(bill.freightTaxAmt || 0);\n      const totalTaxAmount = parseFloat(bill.taxAmt || 0);\n      const billValue = parseFloat(bill.billValue || subtotal + totalTaxAmount + freightCharges + packingCharges);\n      const amountWords = `INR ${toWords(Math.floor(billValue))} Only`; // 4. Tax breakdown\n\n      let taxBreakdown = {};\n      let taxGroupDetails = [];\n      let sno = 1;\n      enrichedItems.forEach(item => {\n        const qty = parseFloat(item.billQty || 0);\n        const unitPrice = parseFloat(item.unitPrice || 0);\n        const months = parseFloat(item.months || 1);\n        const unitDayOrWk = parseFloat(item.unitDayOrWk || 1);\n        const stdDays = parseFloat(bill.stdDays || 30);\n        const base = qty * unitPrice * months * unitDayOrWk * stdDays;\n        (item.taxGroupNames || []).forEach(tgName => {\n          const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\n\n          if (group) {\n            group.lineItems.forEach(li => {\n              const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\n              let taxAmt = li.type === 'Amount' ? parseFloat(li.percentOrAmt || 0) : base * parseFloat(li.percentOrAmt || 0) / 100;\n              taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\n              taxGroupDetails.push({\n                sno: sno++,\n                group: tgName,\n                peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\n                taxAmt: taxAmt.toFixed(2)\n              });\n            });\n          }\n        });\n      });\n\n      if (freightTax > 0) {\n        taxBreakdown[\"Freight Tax\"] = freightTax;\n        taxGroupDetails.push({\n          sno: sno++,\n          group: \"Freight Tax\",\n          peramt: \"-\",\n          taxAmt: freightTax.toFixed(2)\n        });\n      } // 5. Build HTML for PDF\n\n\n      const container = document.createElement('div');\n      container.id = 'pdf-preview-container';\n      container.style.width = '794px';\n      container.style.padding = '40px';\n      container.style.fontFamily = 'Arial';\n      container.innerHTML = `\n    <div style=\"display:flex; justify-content:space-between; align-items:center;\">\n      <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\n      <div style=\"font-size:18px; font-weight:bold;\">CONTRACT BILLING INVOICE</div>\n    </div>\n    <hr/>\n    <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\n      <div style=\"line-height:1.5; width:50%;\">\n        <b>${org.bgName || ''}</b><br/>\n        ${org.address || ''}<br/>\n        <b>Email:</b> ${org.email || ''}<br/>\n        <b>Website:</b> ${org.website || ''}<br/>\n        <b>GSTIN:</b> ${org.gstin || ''}<br/>\n        <b>Mobile:</b> ${org.mobile || ''}<br/>\n        <b>CIN:</b> ${org.cin || ''}\n      </div>\n      <table style=\"font-size:11px; text-align:left;\">\n        <tr><td><b>Bill No</b></td><td>: ${bill.billNo || ''}</td></tr>\n        <tr><td><b>Bill Date</b></td><td>: ${bill.billDate || ''}</td></tr>\n        <tr><td><b>Due Date</b></td><td>: ${bill.scheduleDate || ''}</td></tr>\n        <tr><td><b>Customer</b></td><td>: ${bill.customer || ''}</td></tr>\n        <tr><td><b>Currency</b></td><td>: ${bill.currency || 'INR'}</td></tr>\n      </table>\n    </div>\n\n    <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\n      <div style=\"width:48%;\">\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\n        <div style=\"border:1px solid #ccc; padding:6px;\">\n         <b>${bill.customer || ''}</b><br/>\n          ${(bill.billTo || '').replace(/\\n/g, '<br/>')}\n        </div>\n        <div style=\"font-size:10px; margin-top:6px;\">\n            <b>GSTIN:</b> ${customer.gstin || ''}<br/>\n            <b>Email:</b> ${customer.email || ''}<br/>\n            <b>Contact:</b> ${customer.contactPerson || ''}<br/>\n            <b>Phone:</b> ${customer.phone || ''}\n        </div>\n      </div>\n      <div style=\"width:48%;\">\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\n        <div style=\"border:1px solid #ccc; padding:6px;\">\n         <b>${bill.customer || ''}</b><br/>\n          ${(bill.shipTo || '').replace(/\\n/g, '<br/>')}\n        </div>\n        <div style=\"font-size:10px; margin-top:6px;\">\n          <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\n        </div>\n      </div>\n    </div>\n\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\n      <thead>\n        <tr style=\"background:#f4f6fa;\">\n          <th style=\"border:1px solid #011b56;\">Item Code</th>\n          <th style=\"border:1px solid #011b56;\">Description</th>\n          <th style=\"border:1px solid #011b56;\">HSN/SAC</th>\n          <th style=\"border:1px solid #011b56;\">UOM</th>\n          <th style=\"border:1px solid #011b56;\">Qty</th>\n          <th style=\"border:1px solid #011b56;\">Unit Price</th>\n          <th style=\"border:1px solid #011b56;\">Months</th>\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\n          <th style=\"border:1px solid #011b56;\">Item Total</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${enrichedItems.map(item => {\n        const gstLabel = item.taxGroupNames && item.taxGroupNames.length ? item.taxGroupNames.join(', ') : item.taxGroupName || item.taxId || '-';\n        return `\n            <tr>\n              <td style=\"border:1px solid #011b56;\">${item.itemCode || ''}</td>\n              <td style=\"border:1px solid #011b56;\">${item.itemDesc || ''}</td>\n              <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\n              <td style=\"border:1px solid #011b56;\">${item.uom}</td>\n              <td style=\"border:1px solid #011b56;\">${item.billQty}</td>\n              <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\n              <td style=\"border:1px solid #011b56;\">${item.months}</td>\n<td style=\"border:1px solid #011b56;\">${gstLabel}</td>\n              <td style=\"border:1px solid #011b56;\">${item.itemTotal}</td>\n            </tr>`;\n      }).join('')}\n        <tr>\n          <td colspan=\"9\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"9\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\n        </tr>\n        <tr>\n          <td colspan=\"9\" style=\"text-align:right; border:1px solid #011b56;\"><b>Bill Value</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${billValue.toFixed(2)}</b></td>\n        </tr>\n      </tbody>\n    </table>\n    <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\n    <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\n  `;\n      document.body.appendChild(container);\n      const canvas = await html2canvas(container, {\n        scale: 2,\n        useCORS: true\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF('p', 'pt', 'a4');\n      const width = 595.28;\n      const height = canvas.height * width / canvas.width;\n      pdf.addImage(imgData, 'PNG', 0, 0, width, height);\n      document.body.removeChild(container); // 6. Tax Breakdown page\n\n      if (taxGroupDetails.length > 0) {\n        pdf.addPage();\n        let taxRows = taxGroupDetails.map(row => `\n      <tr>\n        <td style=\"border:1px solid #011b56;\">${row.sno}</td>\n        <td style=\"border:1px solid #011b56;\">${row.group}</td>\n        <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\n        <td style=\"border:1px solid #011b56;\">${row.taxAmt}</td>\n      </tr>`).join('');\n        let taxHtml = `<div style=\"font-family:Arial; padding:20px; width:100%;\">\n    <h3 style=\"margin-bottom:10px; font-size:18px;\">Tax Breakdown</h3>\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:14px;\">\n      <thead>\n        <tr style=\"background:#f4f6fa;\">\n          <th style=\"border:1px solid #011b56;\">S.No</th>\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\n          <th style=\"border:1px solid #011b56;\">Per/Amt</th>\n          <th style=\"border:1px solid #011b56;\">Tax Amt</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${taxRows}\n        <tr>\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\n        </tr>\n      </tbody>\n    </table>\n    </div>`;\n        const taxContainer = document.createElement('div');\n        taxContainer.innerHTML = taxHtml;\n        document.body.appendChild(taxContainer);\n        const taxCanvas = await html2canvas(taxContainer, {\n          scale: 1.5,\n          useCORS: true\n        });\n        const taxImg = taxCanvas.toDataURL('image/png');\n        pdf.addImage(taxImg, 'PNG', 0, 0, width, taxCanvas.height * width / taxCanvas.width);\n        document.body.removeChild(taxContainer);\n      }\n\n      pdf.setFontSize(11);\n      pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\n      pdf.text('Authorized Signatory', width - 200, 800); // 7. Show PDF\n\n      const blob = pdf.output('blob');\n      const url = URL.createObjectURL(blob);\n      const newWin = window.open();\n      newWin.document.write(`\n    <html><head><title>Contract Billing PDF Preview</title></head>\n    <body style=\"margin:0;\">\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\n    </body></html>\n  `);\n      newWin.document.close();\n    };\n\n    this.renderBillingDetailsTab = () => {\n      const f = this.state.formData;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 614,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 615,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 616,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 617,\n          columnNumber: 13\n        }\n      }, \"Bill Type\"), /*#__PURE__*/React.createElement(\"select\", {\n        className: \"form-control\",\n        value: f.billType,\n        onChange: e => this.handleInputChange(\"billType\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 618,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Standard\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 623,\n          columnNumber: 15\n        }\n      }, \"Standard\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Manual\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 624,\n          columnNumber: 15\n        }\n      }, \"Manual\"))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 627,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 628,\n          columnNumber: 13\n        }\n      }, \"Bill No\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.billNo,\n        readOnly: true,\n        placeholder: \"Auto\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 629,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 636,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 637,\n          columnNumber: 13\n        }\n      }, \"Bill Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control\",\n        value: f.billDate,\n        onChange: e => this.handleInputChange(\"billDate\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 638,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 645,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 646,\n          columnNumber: 13\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.status,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 647,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 649,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 650,\n          columnNumber: 13\n        }\n      }, \"Ref No\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.refNo,\n        onChange: e => this.handleInputChange(\"refNo\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 651,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 659,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 660,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 661,\n          columnNumber: 13\n        }\n      }, \"Contract\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        placeholder: \"Select Contract\",\n        value: f.contractNo,\n        readOnly: true,\n        onClick: () => this.setState({\n          showContractOverlay: true\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 662,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 671,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 672,\n          columnNumber: 13\n        }\n      }, \"Currency\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.currency,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 673,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 675,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 676,\n          columnNumber: 13\n        }\n      }, \"Conversion Rate\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: f.conversionRate,\n        onChange: e => this.handleInputChange(\"conversionRate\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 677,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 679,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 680,\n          columnNumber: 13\n        }\n      }, \"Name of Work\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.nameofwrk,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 681,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 683,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 684,\n          columnNumber: 13\n        }\n      }, \"Change Inv Unit Price\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: f.changeInvUnitPrice,\n        onChange: e => this.handleInputChange(\"changeInvUnitPrice\", e.target.checked),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 685,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 689,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 690,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 691,\n          columnNumber: 13\n        }\n      }, \"Amt Agreed\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.amtAgreed,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 692,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 694,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 695,\n          columnNumber: 13\n        }\n      }, \"Duration From\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control\",\n        value: f.durationFrom,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 696,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 698,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 699,\n          columnNumber: 13\n        }\n      }, \"Duration To\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control\",\n        value: f.durationTo,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 700,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 702,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 703,\n          columnNumber: 13\n        }\n      }, \"Schedule Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"date\",\n        value: f.scheduleDate,\n        onChange: e => this.handleInputChange(\"scheduleDate\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 704,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 706,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 707,\n          columnNumber: 13\n        }\n      }, \"Repeat\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: f.repeat,\n        onChange: e => this.handleInputChange(\"repeat\", e.target.checked),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 708,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 711,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 712,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 713,\n          columnNumber: 13\n        }\n      }, \"Tax Amount (INR)\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.taxAmt,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 714,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 716,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 717,\n          columnNumber: 13\n        }\n      }, \"Bill Value (INR)\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.billValue,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 718,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 720,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 721,\n          columnNumber: 5\n        }\n      }, \"Prorate\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"checkbox\",\n        checked: this.state.formData.prorate,\n        onChange: e => this.handleInputChange(\"prorate\", e.target.checked),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 722,\n          columnNumber: 5\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 728,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 729,\n          columnNumber: 5\n        }\n      }, \"Discount (%)\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: this.state.formData.discountPercent,\n        onChange: e => this.handleInputChange(\"discountPercent\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 730,\n          columnNumber: 5\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 737,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 738,\n          columnNumber: 5\n        }\n      }, \"Discount Amount\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        className: \"form-control\",\n        value: this.state.formData.discountAmount,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 739,\n          columnNumber: 5\n        }\n      }))));\n    };\n\n    this.renderTermsTab = () => {\n      const f = this.state.formData;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 754,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 755,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 756,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 757,\n          columnNumber: 13\n        }\n      }, \"Bill To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control\",\n        value: f.billTo,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 758,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 760,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 761,\n          columnNumber: 13\n        }\n      }, \"Ship To\"), /*#__PURE__*/React.createElement(\"textarea\", {\n        className: \"form-control\",\n        value: f.shipTo,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 762,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 765,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 766,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 767,\n          columnNumber: 13\n        }\n      }, \"Place Of Delivery\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.placeOfDelivery,\n        onChange: e => this.handleInputChange(\"placeOfDelivery\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 768,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 770,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 771,\n          columnNumber: 13\n        }\n      }, \"Despatch Mode\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.despatchMode,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 772,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 774,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 775,\n          columnNumber: 13\n        }\n      }, \"Payment Terms\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.paymentTerms,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 776,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 779,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 780,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 781,\n          columnNumber: 13\n        }\n      }, \"Freight Charges (INR)\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.freightCharges,\n        onChange: e => this.handleInputChange(\"freightCharges\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 782,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 784,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 785,\n          columnNumber: 13\n        }\n      }, \"Freight %\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.freightPercent,\n        onChange: e => this.handleInputChange(\"freightPercent\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 786,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 788,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 789,\n          columnNumber: 13\n        }\n      }, \"Freight Tax Amount (INR)\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.freightTaxAmt,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 790,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 792,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 793,\n          columnNumber: 13\n        }\n      }, \"Packing Charges (INR)\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control\",\n        value: f.packingCharges,\n        onChange: e => this.handleInputChange(\"packingCharges\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 794,\n          columnNumber: 13\n        }\n      }))));\n    };\n\n    this.renderLineItems = () => {\n      const items = this.state.formData.lineItems || [];\n      const isINR = (this.state.formData.currency || 'INR') === 'INR';\n      const showProrate = this.state.formData.prorate; // Calculate days in month from duration\n\n      let daysInMonth = 30;\n      const {\n        durationFrom,\n        durationTo\n      } = this.state.formData;\n\n      if (durationFrom && durationTo) {\n        const from = new Date(durationFrom);\n        const to = new Date(durationTo);\n        daysInMonth = Math.max(1, (to - from) / (1000 * 60 * 60 * 24));\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"table-responsive\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 816,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered\",\n        style: {\n          minWidth: '800px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 817,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 818,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 819,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 820,\n          columnNumber: 13\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 821,\n          columnNumber: 13\n        }\n      }, \"Item Desc\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 822,\n          columnNumber: 13\n        }\n      }, \"Duration\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 823,\n          columnNumber: 13\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 824,\n          columnNumber: 13\n        }\n      }, \"Unit Price\"), showProrate && /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 825,\n          columnNumber: 29\n        }\n      }, \"Days\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 826,\n          columnNumber: 13\n        }\n      }, \"Months\"), isINR && /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 827,\n          columnNumber: 23\n        }\n      }, \"Tax Group\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 828,\n          columnNumber: 13\n        }\n      }, \"Tax Amount\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 829,\n          columnNumber: 13\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 832,\n          columnNumber: 9\n        }\n      }, items.map((it, i) => {\n        var _it$taxGroupNames;\n\n        return /*#__PURE__*/React.createElement(\"tr\", {\n          key: i,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 834,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 835,\n            columnNumber: 15\n          }\n        }, it.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 836,\n            columnNumber: 15\n          }\n        }, it.itemDesc), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 837,\n            columnNumber: 15\n          }\n        }, it.duration), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 838,\n            columnNumber: 15\n          }\n        }, /*#__PURE__*/React.createElement(\"input\", {\n          type: \"number\",\n          className: \"form-control\",\n          value: it.qty,\n          onChange: e => this.handleLineItemChange(i, \"qty\", e.target.value),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 839,\n            columnNumber: 17\n          }\n        })), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 846,\n            columnNumber: 15\n          }\n        }, /*#__PURE__*/React.createElement(\"input\", {\n          type: \"number\",\n          className: \"form-control\",\n          value: it.unitPrice,\n          onChange: e => this.handleLineItemChange(i, \"unitPrice\", e.target.value),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 847,\n            columnNumber: 17\n          }\n        })), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 854,\n            columnNumber: 15\n          }\n        }, /*#__PURE__*/React.createElement(\"input\", {\n          type: \"number\",\n          className: \"form-control\",\n          value: it.days || '',\n          onChange: e => this.handleLineItemChange(i, \"days\", e.target.value),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 855,\n            columnNumber: 3\n          }\n        })), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 862,\n            columnNumber: 1\n          }\n        }, /*#__PURE__*/React.createElement(\"input\", {\n          type: \"number\",\n          className: \"form-control\",\n          value: it.months,\n          onChange: e => this.handleLineItemChange(i, \"months\", e.target.value),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 863,\n            columnNumber: 3\n          }\n        })), isINR && /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 871,\n            columnNumber: 17\n          }\n        }, /*#__PURE__*/React.createElement(\"select\", {\n          className: \"form-control\",\n          value: ((_it$taxGroupNames = it.taxGroupNames) === null || _it$taxGroupNames === void 0 ? void 0 : _it$taxGroupNames[0]) || '',\n          onChange: e => {\n            const val = e.target.value;\n            const arr = val ? [val] : [];\n            this.handleLineItemChange(i, \"taxGroupNames\", arr);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 872,\n            columnNumber: 19\n          }\n        }, /*#__PURE__*/React.createElement(\"option\", {\n          value: \"\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 881,\n            columnNumber: 21\n          }\n        }, \"-Select-\"), this.state.taxGroups.map((tg, idx) => /*#__PURE__*/React.createElement(\"option\", {\n          key: idx,\n          value: tg.groupName,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 883,\n            columnNumber: 23\n          }\n        }, tg.groupName)))), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 888,\n            columnNumber: 15\n          }\n        }, it.taxAmt), /*#__PURE__*/React.createElement(\"td\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 889,\n            columnNumber: 15\n          }\n        }, it.itemTotal));\n      }))));\n    };\n\n    this.renderTabs = () => {\n      const tabs = [\"Billing Details\", \"Port & Terms\", \"Notes\"];\n      return /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"nav nav-tabs mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 901,\n          columnNumber: 7\n        }\n      }, tabs.map((t, i) => /*#__PURE__*/React.createElement(\"li\", {\n        key: i,\n        className: \"nav-item\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 903,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: `nav-link ${this.state.activeTab === i ? \"active\" : \"\"}`,\n        onClick: () => this.handleTabChange(i),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 904,\n          columnNumber: 13\n        }\n      }, t))));\n    };\n\n    this.renderNotesTab = () => /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 917,\n        columnNumber: 3\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 918,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 919,\n        columnNumber: 7\n      }\n    }, \"Notes / Remarks\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control form-control-sm\",\n      rows: 2,\n      value: this.state.notes,\n      onChange: e => this.setState({\n        notes: e.target.value\n      }),\n      style: {\n        resize: \"vertical\",\n        minHeight: \"40px\",\n        maxHeight: \"120px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 920,\n        columnNumber: 7\n      }\n    })));\n\n    this.renderForm = () => {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card full-height\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 932,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 933,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card-body\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 934,\n          columnNumber: 11\n        }\n      }, this.renderTabs(), this.state.activeTab === 0 && /*#__PURE__*/React.createElement(React.Fragment, null, this.renderBillingDetailsTab(), this.renderLineItems()), this.state.activeTab === 1 && this.renderTermsTab(), this.state.activeTab === 2 && this.renderNotesTab()), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"fixed-card-footer text-right p-3 border-top bg-white\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 945,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary ml-2\",\n        type: \"button\",\n        onClick: () => this.setState({\n          showForm: false,\n          editingId: null,\n          formData: this.getEmptyForm(),\n          notes: \"\"\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 947,\n          columnNumber: 13\n        }\n      }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success\",\n        type: \"submit\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 961,\n          columnNumber: 13\n        }\n      }, this.state.editingId ? \"Update\" : \"Create\"))));\n    };\n\n    this.renderTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-4 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 971,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 972,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-between align-items-center mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 973,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"card-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 974,\n        columnNumber: 11\n      }\n    }, \"Contract Billing\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: () => this.setState({\n        showForm: true\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 975,\n        columnNumber: 11\n      }\n    }, \"Create\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 977,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 978,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 979,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 980,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 981,\n        columnNumber: 15\n      }\n    }, \"Bill No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 982,\n        columnNumber: 15\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 983,\n        columnNumber: 15\n      }\n    }, \"Contract\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 984,\n        columnNumber: 15\n      }\n    }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 985,\n        columnNumber: 15\n      }\n    }, \"Currency\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 986,\n        columnNumber: 15\n      }\n    }, \"Bill Value\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 987,\n        columnNumber: 15\n      }\n    }, \"Status\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 988,\n        columnNumber: 15\n      }\n    }, \"Print\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 991,\n        columnNumber: 11\n      }\n    }, this.state.bills.map((b, i) => {\n      let statusClass = \"badge-secondary\";\n      if (b.status === \"Entered\") statusClass = \"badge-warning\";else if (b.status === \"Submitted\") statusClass = \"badge-info\";else if (b.status === \"Cancelled\") statusClass = \"badge-danger\";else if (b.status === \"Approved\") statusClass = \"badge-success\"; // optional extra\n\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1000,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1001,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-link\",\n        onClick: () => this.setState({\n          showForm: true,\n          editingId: b.id,\n          formData: { ...b\n          },\n          notes: b.notes || \"\"\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1002,\n          columnNumber: 11\n        }\n      }, b.billNo)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1016,\n          columnNumber: 9\n        }\n      }, b.billDate), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1017,\n          columnNumber: 9\n        }\n      }, b.contractNo), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1018,\n          columnNumber: 9\n        }\n      }, b.customer), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1019,\n          columnNumber: 9\n        }\n      }, b.currency), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1020,\n          columnNumber: 9\n        }\n      }, b.billValue), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1021,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${statusClass}`,\n        style: {\n          fontSize: \"14px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1022,\n          columnNumber: 11\n        }\n      }, b.status)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1026,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"mdi mdi-printer menu-icon\",\n        onClick: () => this.showContractBillingPDFWithOrg(b),\n        style: {\n          fontSize: \"24px\",\n          color: \"#2196F3\",\n          cursor: \"pointer\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1027,\n          columnNumber: 11\n        }\n      })));\n    }))))));\n\n    this.renderContractOverlay = () => {\n      const {\n        contracts,\n        contractOverlaySearch\n      } = this.state;\n      const filtered = contracts.filter(c => (c.contractNo || \"\").toLowerCase().includes(contractOverlaySearch.toLowerCase()));\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1052,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"custom-overlay-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1053,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"h5\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1054,\n          columnNumber: 11\n        }\n      }, \"Select Contract\"), /*#__PURE__*/React.createElement(\"input\", {\n        className: \"form-control mb-2\",\n        value: contractOverlaySearch,\n        onChange: e => this.setState({\n          contractOverlaySearch: e.target.value\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1055,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-sm table-bordered\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1062,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1063,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1064,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1065,\n          columnNumber: 17\n        }\n      }, \"Contract No\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1066,\n          columnNumber: 17\n        }\n      }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1067,\n          columnNumber: 17\n        }\n      }, \"Value\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1070,\n          columnNumber: 13\n        }\n      }, filtered.map(c => /*#__PURE__*/React.createElement(\"tr\", {\n        key: c.id,\n        style: {\n          cursor: \"pointer\"\n        },\n        onClick: () => this.selectContract(c),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1072,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1077,\n          columnNumber: 19\n        }\n      }, c.contractNo), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1078,\n          columnNumber: 19\n        }\n      }, c.customer), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1079,\n          columnNumber: 19\n        }\n      }, c.contractValue))))), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary btn-sm\",\n        onClick: () => this.setState({\n          showContractOverlay: false\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1084,\n          columnNumber: 11\n        }\n      }, \"Close\")));\n    };\n  }\n\n  getEmptyForm() {\n    return {\n      billType: \"Standard\",\n      billNo: \"\",\n      billDate: new Date().toISOString().split(\"T\")[0],\n      status: \"Entered\",\n      refNo: \"\",\n      contractId: \"\",\n      contractNo: \"\",\n      nameofwrk: \"\",\n      customer: \"\",\n      currency: \"\",\n      conversionRate: \"\",\n      amtAgreed: \"\",\n      prorate: false,\n      discountPercent: 0,\n      discountAmount: '',\n      durationFrom: \"\",\n      durationTo: \"\",\n      scheduleDate: \"\",\n      taxAmt: \"\",\n      billValue: \"\",\n      billTo: \"\",\n      shipTo: \"\",\n      placeOfDelivery: \"\",\n      despatchMode: \"\",\n      paymentTerms: \"\",\n      freightCharges: \"\",\n      freightPercent: \"\",\n      freightTaxAmt: \"\",\n      packingCharges: \"\",\n      lineItems: []\n    };\n  }\n\n  componentDidMount() {\n    this.fetchContracts();\n    this.fetchBills();\n    this.fetchTaxGroups();\n    this.autoGenerateBills();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1097,\n        columnNumber: 7\n      }\n    }, this.state.showForm ? this.renderForm() : this.renderTable(), this.state.showContractOverlay && this.renderContractOverlay());\n  }\n\n}\n\nexport default ContractFinalBilling;","map":{"version":3,"sources":["C:/Users/College/admin/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/invoice/cbill/contractfinalbill.js"],"names":["React","Component","DatePicker","db","collection","getDocs","addDoc","updateDoc","doc","serverTimestamp","html2canvas","jsPDF","toWords","ContractFinalBilling","state","contracts","taxGroups","bills","showForm","editingId","activeTab","showContractOverlay","contractOverlaySearch","formData","getEmptyForm","notes","fetchContracts","snap","data","docs","map","d","id","filtered","filter","c","status","setState","fetchBills","reverse","fetchTaxGroups","autoGenerateBills","today","Date","contractsSnap","autoBill","contract","lastTo","durationTo","tillDate","billingType","billingTypes","monthsPerCycle","billsSnap","b","contractId","nextFrom","durationFrom","length","lastBill","reduce","a","setDate","getDate","nextTo","setMonth","getMonth","exists","some","toISOString","split","billData","billType","billNo","Math","floor","random","billDate","contractNo","nameofwrk","customer","currency","conversionRate","amtAgreed","billTo","shipTo","despatchMode","paymentTerms","freightCharges","freightPercent","freightTaxPercent","freightTaxAmt","packingCharges","lineItems","item","months","days","qty","unitPrice","taxGroupNames","taxAmt","itemTotal","createdAt","formatAddress","addr","address","city","country","Boolean","join","zip","handleInputChange","field","value","prev","parseFloat","discountPercent","discountAmount","toFixed","recalculateBillTotals","includes","getRecvQtyMap","approvedBills","bill","recvQtyMap","forEach","code","itemCode","selectContract","li","itemDesc","hsnCode","uom","duration","handleLineItemChange","idx","items","totalMonths","daysInMonth","getFullYear","baseTotal","billValue","finalValue","handleTabChange","i","handleSubmit","e","preventDefault","loading","error","saveData","err","message","alert","showContractBillingPDFWithOrg","orgSnap","org","customerSnap","customers","find","custname","custcode","gstStateMap","getPlaceOfSupply","gstin","substring","enrichedItems","taxGroupName","s","trim","subtotal","sum","billQty","unitDayOrWk","stdDays","freightTax","totalTaxAmount","amountWords","taxBreakdown","taxGroupDetails","sno","base","tgName","group","g","groupName","key","component","percentOrAmt","type","push","peramt","container","document","createElement","style","width","padding","fontFamily","innerHTML","logoUrl","bgName","email","website","mobile","cin","scheduleDate","replace","contactPerson","phone","gstLabel","taxId","toLocaleString","body","appendChild","canvas","scale","useCORS","imgData","toDataURL","pdf","height","addImage","removeChild","addPage","taxRows","row","taxHtml","taxContainer","taxCanvas","taxImg","setFontSize","text","blob","output","url","URL","createObjectURL","newWin","window","open","write","close","renderBillingDetailsTab","f","target","refNo","changeInvUnitPrice","checked","repeat","prorate","renderTermsTab","placeOfDelivery","renderLineItems","isINR","showProrate","from","to","max","minWidth","it","val","arr","tg","renderTabs","tabs","t","renderNotesTab","resize","minHeight","maxHeight","renderForm","renderTable","statusClass","fontSize","color","cursor","renderContractOverlay","toLowerCase","contractValue","componentDidMount","render"],"mappings":"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","sourcesContent":["// src/app/sales/salestransactions/servicecontract/contractfinalbilling.js\r\nimport React, { Component } from \"react\";\r\nimport DatePicker from \"react-datepicker\";\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\nimport { db } from \"../../../../../firebase\";\r\nimport {  collection,  getDocs,  addDoc,  updateDoc,  doc,serverTimestamp,} from \"firebase/firestore\";\r\nimport html2canvas from 'html2canvas';\r\nimport { jsPDF } from 'jspdf';\r\nimport { toWords } from 'number-to-words';\r\n\r\n\r\n\r\nclass ContractFinalBilling extends Component {\r\n  state = {\r\n    contracts: [],\r\n    taxGroups: [],\r\n    bills: [],\r\n    showForm: false,\r\n    editingId: null,\r\n    activeTab: 0,\r\n    showContractOverlay: false,\r\n    contractOverlaySearch: \"\",\r\n    formData: this.getEmptyForm(),\r\n    notes: \"\",\r\n\r\n  };\r\n\r\n  getEmptyForm() {\r\n    return{\r\n      billType: \"Standard\",\r\n      billNo: \"\",\r\n      billDate: new Date().toISOString().split(\"T\")[0],\r\n      status: \"Entered\",\r\n      refNo: \"\",\r\n      contractId: \"\",\r\n      contractNo: \"\",\r\n      nameofwrk: \"\",\r\n      customer: \"\",\r\n      currency: \"\",\r\n      conversionRate: \"\",\r\n      amtAgreed: \"\",\r\n    prorate: false,\r\n    discountPercent: 0,\r\n    discountAmount:'',\r\n      durationFrom: \"\",\r\n      durationTo: \"\",\r\n      scheduleDate: \"\",\r\n      taxAmt: \"\",\r\n      billValue: \"\",\r\n      billTo: \"\",\r\n      shipTo: \"\",\r\n      placeOfDelivery: \"\",\r\n      despatchMode: \"\",\r\n      paymentTerms: \"\",\r\n      freightCharges: \"\",\r\n      freightPercent: \"\",\r\n      freightTaxAmt: \"\",\r\n      packingCharges: \"\",\r\n      lineItems: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n  this.fetchContracts();\r\n  this.fetchBills();\r\n  this.fetchTaxGroups();\r\n  this.autoGenerateBills();\r\n}\r\n\r\n  fetchContracts = async () => {\r\n  const snap = await getDocs(collection(db, \"contracts\"));\r\n  const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n  const filtered = data.filter(c => c.status === 'Approved' || c.status === 'Partial');\r\n  this.setState({ contracts: filtered });\r\n};\r\n\r\n  fetchBills = async () => {\r\n    const snap = await getDocs(collection(db, \"finalBills\"));\r\n    const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n    this.setState({ bills: data.reverse() });\r\n  };\r\n\r\n  fetchTaxGroups = async () => {\r\n    const snap = await getDocs(collection(db, \"taxGroups\"));\r\n    const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n    this.setState({ taxGroups: data });\r\n  };\r\nautoGenerateBills = async () => {\r\n  const today = new Date();\r\n  const contractsSnap = await getDocs(collection(db, \"contracts\"));\r\n  const contracts = contractsSnap.docs.map(d => ({ id: d.id, ...d.data() }))\r\n    .filter(c => c.autoBill && c.status === \"Approved\");\r\n\r\n  for (const contract of contracts) {\r\n    let lastTo = new Date(contract.durationTo);\r\n    let tillDate = contract.tillDate ? new Date(contract.tillDate) : null;\r\n    let billingType = (contract.billingTypes && contract.billingTypes[0]) || 'yearly';\r\n    let monthsPerCycle = billingType === 'yearly' ? 12 : billingType === 'half-yearly' ? 6 : 3;\r\n\r\n    // Find last bill for this contract\r\n    const billsSnap = await getDocs(collection(db, \"finalBills\"));\r\n    const bills = billsSnap.docs.map(d => ({ id: d.id, ...d.data() }))\r\n      .filter(b => b.contractId === contract.id);\r\n\r\n    let nextFrom = new Date(contract.durationFrom);\r\n    if (bills.length > 0) {\r\n      // Get last bill's durationTo\r\n      const lastBill = bills.reduce((a, b) => new Date(a.durationTo) > new Date(b.durationTo) ? a : b);\r\n      nextFrom = new Date(lastBill.durationTo);\r\n      nextFrom.setDate(nextFrom.getDate() + 1);\r\n    }\r\n\r\n    // Generate bills until today < tillDate\r\n    while (tillDate && nextFrom <= today && nextFrom <= tillDate) {\r\n      let nextTo = new Date(nextFrom);\r\n      nextTo.setMonth(nextTo.getMonth() + monthsPerCycle);\r\n      nextTo.setDate(nextTo.getDate() - 1); // End of cycle\r\n\r\n      // Check if bill already exists for this period\r\n      const exists = bills.some(b => b.durationFrom === nextFrom.toISOString().split('T')[0] && b.durationTo === nextTo.toISOString().split('T')[0]);\r\n      if (!exists) {\r\n        // Create bill\r\n        const billData = {\r\n          billType: \"Standard\",\r\n          billNo: `CB${Math.floor(Math.random() * 100000)}`,\r\n          billDate: new Date().toISOString().split(\"T\")[0],\r\n          status: \"Yet to Bill\",\r\n          contractId: contract.id,\r\n          contractNo: contract.contractNo,\r\n          nameofwrk: contract.nameofwrk,\r\n          customer: contract.customer,\r\n          currency: contract.currency,\r\n          conversionRate: contract.conversionRate,\r\n          amtAgreed: contract.amtAgreed,\r\n          durationFrom: nextFrom.toISOString().split('T')[0],\r\n          durationTo: nextTo.toISOString().split('T')[0],\r\n          billTo: contract.billTo,\r\n          shipTo: contract.shipTo,\r\n          despatchMode: contract.despatchMode,\r\n          paymentTerms: contract.paymentTerms,\r\n          freightCharges: contract.freightCharges,\r\n          freightPercent: contract.freightTaxPercent,\r\n          freightTaxAmt: contract.freightTaxAmt,\r\n          packingCharges: contract.packingCharges,\r\n          lineItems: contract.lineItems.map(item => ({\r\n            ...item,\r\n            months: monthsPerCycle,\r\n            days: 0,\r\n            qty: item.qty,\r\n            unitPrice: item.unitPrice,\r\n            taxGroupNames: item.taxGroupNames,\r\n            taxAmt: 0,\r\n            itemTotal: 0\r\n          })),\r\n          createdAt: serverTimestamp()\r\n        };\r\n        await addDoc(collection(db, \"finalBills\"), billData);\r\n      }\r\n      // Prepare for next cycle\r\n      nextFrom = new Date(nextTo);\r\n      nextFrom.setDate(nextFrom.getDate() + 1);\r\n    }\r\n  }\r\n};\r\n\r\n  formatAddress = (addr) => {\r\n    if (!addr) return '';\r\n    if (typeof addr === 'string') return addr;\r\n    return [\r\n      addr.address,\r\n      [addr.city, addr.state, addr.country].filter(Boolean).join(', '),\r\n      addr.zip\r\n    ].filter(Boolean).join('\\n');\r\n  };\r\n  handleInputChange = (field, value) => {\r\n  this.setState((prev) => ({\r\n    formData: { ...prev.formData, [field]: value },\r\n  }), () => {\r\n    if (field === 'discountPercent') {\r\n      const amtAgreed = parseFloat(this.state.formData.amtAgreed || 0);\r\n      const discountPercent = parseFloat(this.state.formData.discountPercent || 0);\r\n      const discountAmount = ((amtAgreed * discountPercent) / 100).toFixed(2);\r\n      this.setState(prev => ({\r\n        formData: { ...prev.formData, discountAmount }\r\n      }), this.recalculateBillTotals);\r\n    }\r\n    if ([\r\n      'freightCharges', 'freightPercent', 'packingCharges', 'conversionRate',\r\n      'stdDays', 'amtAgreed', 'discountPercent'\r\n    ].includes(field)) {\r\n      this.recalculateBillTotals();\r\n    }\r\n  });\r\n};\r\ngetRecvQtyMap = async (contractId) => {\r\n  const snap = await getDocs(collection(db, \"finalBills\"));\r\n  const approvedBills = snap.docs\r\n    .map(doc => doc.data())\r\n    .filter(bill => bill.contractId === contractId && bill.status === \"Approved\");\r\n  const recvQtyMap = {};\r\n  approvedBills.forEach(bill => {\r\n    (bill.lineItems || []).forEach(item => {\r\n      const code = item.itemCode;\r\n      const qty = parseFloat(item.qty || 0);\r\n      recvQtyMap[code] = (recvQtyMap[code] || 0) + qty;\r\n    });\r\n  });\r\n  return recvQtyMap;\r\n};\r\nselectContract = async (contract) => {\r\n  // Prepare line items from contract\r\n  const lineItems = (contract.lineItems || []).map(li => ({\r\n    itemCode: li.itemCode,\r\n    itemDesc: li.itemDesc,\r\n    hsnCode: li.hsnCode,\r\n    uom: li.uom,\r\n    duration: li.duration || `${contract.durationFrom} to ${contract.durationTo}`,\r\n    qty: li.qty || '', // user can edit\r\n    unitPrice: li.unitPrice || '',\r\n    months: li.months || 1,\r\n    taxGroupNames: li.taxGroupNames || [],\r\n    taxAmt: 0,\r\n    itemTotal: 0,\r\n    days: '', // for prorate, user can edit\r\n  }));\r\n\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      contractId: contract.id,\r\n      contractNo: contract.contractNo,\r\n      nameofwrk: contract.nameofwrk || \"\",\r\n      customer: contract.customer,\r\n      currency: contract.currency,\r\n      conversionRate: contract.conversionRate,\r\n      amtAgreed: contract.amtAgreed,\r\n      durationFrom: contract.durationFrom,\r\n      durationTo: contract.durationTo,\r\n      billTo: this.formatAddress(contract.billTo),\r\n      shipTo: this.formatAddress(contract.shipTo),\r\n      despatchMode: contract.despatchMode,\r\n      paymentTerms: contract.paymentTerms,\r\n      freightCharges: contract.freightCharges || \"\",\r\n      freightPercent: contract.freightTaxPercent || \"\",\r\n      freightTaxAmt: contract.freightTaxAmt || \"\",\r\n      packingCharges: contract.packingCharges || \"\",\r\n      lineItems,\r\n    },\r\n    showContractOverlay: false,\r\n  }), this.recalculateBillTotals);\r\n};\r\n  handleInputChange = (field, value) => {\r\n    this.setState((prev) => ({\r\n      formData: { ...prev.formData, [field]: value },\r\n    }), () => {\r\n      if ([\r\n        'freightCharges', 'freightPercent', 'packingCharges', 'conversionRate',\r\n        'stdDays', 'amtAgreed'\r\n      ].includes(field)) {\r\n        this.recalculateBillTotals();\r\n      }\r\n    });\r\n  };\r\n\r\nhandleLineItemChange = (idx, field, value) => {\r\n  const items = [...this.state.formData.lineItems];\r\n  items[idx] = { ...items[idx], [field]: value };\r\n  // Calculation\r\n  const qty = parseFloat(items[idx].qty || 0);\r\n  const unitPrice = parseFloat(items[idx].unitPrice || 0);\r\n  const months = parseFloat(items[idx].months || 1);\r\n  const days = parseFloat(items[idx].days || 0);\r\n  let totalMonths = months;\r\n  if (days > 0) {\r\n    let daysInMonth = 30;\r\n    const { durationFrom } = this.state.formData;\r\n    if (durationFrom) {\r\n      const d = new Date(durationFrom);\r\n      daysInMonth = new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();\r\n    }\r\n    totalMonths = (months) + (days / daysInMonth);\r\n  }\r\n  const baseTotal = qty * unitPrice * totalMonths;\r\n  items[idx].itemTotal = baseTotal.toFixed(2);\r\n  this.setState((prev) => ({\r\n    formData: { ...prev.formData, lineItems: items },\r\n  }), this.recalculateBillTotals);\r\n};\r\n\r\nrecalculateBillTotals = () => {\r\n  const { lineItems, freightCharges, freightPercent, packingCharges, conversionRate, discountAmount } = this.state.formData;\r\n  let billValue = 0;\r\n  let taxAmt = 0;\r\n  (lineItems || []).forEach(item => {\r\n    billValue += parseFloat(item.itemTotal || 0);\r\n    taxAmt += parseFloat(item.taxAmt || 0);\r\n  });\r\n  const freightTaxAmt = (parseFloat(freightCharges || 0) * parseFloat(freightPercent || 0)) / 100;\r\n  billValue += parseFloat(freightCharges || 0) + parseFloat(packingCharges || 0) + freightTaxAmt;\r\n\r\n  // Apply discount\r\n  billValue -= parseFloat(discountAmount || 0);\r\n\r\n  // Apply conversion rate if needed\r\n  let finalValue = billValue;\r\n  if (conversionRate) {\r\n    finalValue = billValue * parseFloat(conversionRate);\r\n  }\r\n\r\n  this.setState(prev => ({\r\n    formData: {\r\n      ...prev.formData,\r\n      billValue: finalValue.toFixed(2),\r\n      taxAmt: taxAmt.toFixed(2),\r\n      freightTaxAmt: freightTaxAmt.toFixed(2)\r\n    }\r\n  }));\r\n};\r\n\r\n  handleTabChange = (i) => this.setState({ activeTab: i });\r\nhandleSubmit = async (e) => {\r\n  e.preventDefault();\r\n  this.setState({ loading: true, error: null });\r\n  try {\r\n    const { editingId, formData, bills } = this.state;\r\n    const saveData = {\r\n      ...formData,\r\n      notes: this.state.notes,\r\n      createdAt: serverTimestamp(),\r\n      status: \"Awaiting For Approval\"\r\n    };\r\n    if (editingId) {\r\n      await updateDoc(doc(db, \"finalBills\", editingId), saveData);\r\n    } else {\r\n      saveData.billNo = `CB${1000 + bills.length}`;\r\n      await addDoc(collection(db, \"finalBills\"), saveData);\r\n      \r\n    }\r\n    await this.fetchBills(); // Ensure bills are refreshed before hiding form\r\n    this.setState({\r\n      showForm: false,\r\n      editingId: null,\r\n      formData: this.getEmptyForm(),\r\n      notes: \"\",\r\n      loading: false,\r\n    });\r\n  } catch (err) {\r\n    this.setState({ error: err.message, loading: false });\r\n    alert(\"Error saving bill: \" + err.message);\r\n  }\r\n};\r\n\r\nshowContractBillingPDFWithOrg = async (bill) => {\r\n  // 1. Fetch org and customer data\r\n  const orgSnap = await getDocs(collection(db, 'businessGroups'));\r\n  const org = orgSnap.docs[0]?.data() || {};\r\n  const customerSnap = await getDocs(collection(db, 'customers'));\r\n  const customers = customerSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n  const customer = customers.find(\r\n    c => c.custname === bill.customer || c.custcode === bill.customer\r\n  ) || {};\r\n\r\n  // GST State Map\r\n  const gstStateMap = { \"01\": \"Jammu & Kashmir\",\"02\": \"Himachal Pradesh\",\"03\": \"Punjab\",\"04\": \"Chandigarh\",\"05\": \"Uttarakhand\",\r\n    \"06\": \"Haryana\",\"07\": \"Delhi\",\"08\": \"Rajasthan\",\"09\": \"Uttar Pradesh\",\"10\": \"Bihar\",\"11\": \"Sikkim\",\"12\": \"Arunachal Pradesh\",\r\n    \"13\": \"Nagaland\",\"14\": \"Manipur\",\"15\": \"Mizoram\",\"16\": \"Tripura\",\"17\": \"Meghalaya\",\"18\": \"Assam\",\"19\": \"West Bengal\",\r\n    \"20\": \"Jharkhand\",\"21\": \"Odisha\",\"22\": \"Chhattisgarh\",\"23\": \"Madhya Pradesh\",\"24\": \"Gujarat\",\"25\": \"Daman and Diu\",\r\n    \"26\": \"Dadra and Nagar Haveli\",\"27\": \"Maharashtra\",\"28\": \"Andhra Pradesh (Old)\",\"29\": \"Karnataka\",\"30\": \"Goa\",\"31\": \"Lakshadweep\",\r\n    \"32\": \"Kerala\",\"33\": \"Tamil Nadu\",\"34\": \"Puducherry\",\"35\": \"Andaman and Nicobar Islands\",\"36\": \"Telangana\",\"37\": \"Andhra Pradesh\",\r\n    \"97\": \"Other Territory\" };\r\n  const getPlaceOfSupply = (gstin) => {\r\n    if (!gstin || gstin.length < 2) return '';\r\n    const code = gstin.substring(0, 2);\r\n    const state = gstStateMap[code];\r\n    return state ? `${code} - ${state}` : '';\r\n  };\r\n\r\n  // 2. Enrich line items\r\n// In showContractBillingPDFWithOrg\r\nconst enrichedItems = (bill.lineItems || []).filter(item => parseFloat(item.qty || 0) > 0).map(item => ({\r\n  ...item,\r\n  hsnCode: item.hsnCode || '',\r\n  uom: item.uom || '',\r\n  itemDesc: item.itemDesc || '',\r\n  taxGroupNames: item.taxGroupNames || (item.taxGroupName ? item.taxGroupName.split(',').map(s => s.trim()) : [])\r\n}));\r\n\r\n  // 3. Totals\r\n  const subtotal = enrichedItems.reduce((sum, item) =>\r\n    sum + ((parseFloat(item.unitPrice) || 0) * (parseFloat(item.billQty) || 0) * (parseFloat(item.unitDayOrWk) || 1) * (parseFloat(item.months) || 1) * (parseFloat(bill.stdDays) || 30)), 0\r\n  );\r\n  const freightCharges = parseFloat(bill.freightCharges || 0);\r\n  const packingCharges = parseFloat(bill.packingCharges || 0);\r\n  const freightTax = parseFloat(bill.freightTaxAmt || 0);\r\n  const totalTaxAmount = parseFloat(bill.taxAmt || 0);\r\n  const billValue = parseFloat(bill.billValue || (subtotal + totalTaxAmount + freightCharges + packingCharges));\r\n  const amountWords = `INR ${toWords(Math.floor(billValue))} Only`;\r\n\r\n  // 4. Tax breakdown\r\n  let taxBreakdown = {};\r\n  let taxGroupDetails = [];\r\n  let sno = 1;\r\n  enrichedItems.forEach(item => {\r\n    const qty = parseFloat(item.billQty || 0);\r\n    const unitPrice = parseFloat(item.unitPrice || 0);\r\n    const months = parseFloat(item.months || 1);\r\n    const unitDayOrWk = parseFloat(item.unitDayOrWk || 1);\r\n    const stdDays = parseFloat(bill.stdDays || 30);\r\n    const base = qty * unitPrice * months * unitDayOrWk * stdDays;\r\n    (item.taxGroupNames || []).forEach(tgName => {\r\n      const group = (this.state.taxGroups || []).find(g => g.groupName === tgName);\r\n      if (group) {\r\n        group.lineItems.forEach(li => {\r\n          const key = `${tgName} - ${li.component} (${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'})`;\r\n          let taxAmt = li.type === 'Amount'\r\n            ? parseFloat(li.percentOrAmt || 0)\r\n            : (base * parseFloat(li.percentOrAmt || 0)) / 100;\r\n          taxBreakdown[key] = (taxBreakdown[key] || 0) + taxAmt;\r\n          taxGroupDetails.push({\r\n            sno: sno++,\r\n            group: tgName,\r\n            peramt: `${li.percentOrAmt}${li.type === 'Amount' ? '' : '%'}`,\r\n            taxAmt: taxAmt.toFixed(2)\r\n          });\r\n        });\r\n      }\r\n    });\r\n  });\r\n  if (freightTax > 0) {\r\n    taxBreakdown[\"Freight Tax\"] = freightTax;\r\n    taxGroupDetails.push({ sno: sno++, group: \"Freight Tax\", peramt: \"-\", taxAmt: freightTax.toFixed(2) });\r\n  }\r\n\r\n  // 5. Build HTML for PDF\r\n  const container = document.createElement('div');\r\n  container.id = 'pdf-preview-container';\r\n  container.style.width = '794px';\r\n  container.style.padding = '40px';\r\n  container.style.fontFamily = 'Arial';\r\n\r\n  container.innerHTML = `\r\n    <div style=\"display:flex; justify-content:space-between; align-items:center;\">\r\n      <img src=\"${org.logoUrl || ''}\" style=\"height:50px;\" />\r\n      <div style=\"font-size:18px; font-weight:bold;\">CONTRACT BILLING INVOICE</div>\r\n    </div>\r\n    <hr/>\r\n    <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n      <div style=\"line-height:1.5; width:50%;\">\r\n        <b>${org.bgName || ''}</b><br/>\r\n        ${org.address || ''}<br/>\r\n        <b>Email:</b> ${org.email || ''}<br/>\r\n        <b>Website:</b> ${org.website || ''}<br/>\r\n        <b>GSTIN:</b> ${org.gstin || ''}<br/>\r\n        <b>Mobile:</b> ${org.mobile || ''}<br/>\r\n        <b>CIN:</b> ${org.cin || ''}\r\n      </div>\r\n      <table style=\"font-size:11px; text-align:left;\">\r\n        <tr><td><b>Bill No</b></td><td>: ${bill.billNo || ''}</td></tr>\r\n        <tr><td><b>Bill Date</b></td><td>: ${bill.billDate || ''}</td></tr>\r\n        <tr><td><b>Due Date</b></td><td>: ${bill.scheduleDate || ''}</td></tr>\r\n        <tr><td><b>Customer</b></td><td>: ${bill.customer || ''}</td></tr>\r\n        <tr><td><b>Currency</b></td><td>: ${bill.currency || 'INR'}</td></tr>\r\n      </table>\r\n    </div>\r\n\r\n    <div style=\"margin-top:15px; display:flex; justify-content:space-between; font-size:11px;\">\r\n      <div style=\"width:48%;\">\r\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Bill To</b>\r\n        <div style=\"border:1px solid #ccc; padding:6px;\">\r\n         <b>${bill.customer || ''}</b><br/>\r\n          ${(bill.billTo || '').replace(/\\n/g, '<br/>')}\r\n        </div>\r\n        <div style=\"font-size:10px; margin-top:6px;\">\r\n            <b>GSTIN:</b> ${customer.gstin || ''}<br/>\r\n            <b>Email:</b> ${customer.email || ''}<br/>\r\n            <b>Contact:</b> ${customer.contactPerson || ''}<br/>\r\n            <b>Phone:</b> ${customer.phone || ''}\r\n        </div>\r\n      </div>\r\n      <div style=\"width:48%;\">\r\n        <b style=\"background:#011b56; color:#fff; display:block; padding:4px;\">Ship To</b>\r\n        <div style=\"border:1px solid #ccc; padding:6px;\">\r\n         <b>${bill.customer || ''}</b><br/>\r\n          ${(bill.shipTo || '').replace(/\\n/g, '<br/>')}\r\n        </div>\r\n        <div style=\"font-size:10px; margin-top:6px;\">\r\n          <b>Place of Supply:</b> ${getPlaceOfSupply(customer.gstin || '')}\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:10px;\">\r\n      <thead>\r\n        <tr style=\"background:#f4f6fa;\">\r\n          <th style=\"border:1px solid #011b56;\">Item Code</th>\r\n          <th style=\"border:1px solid #011b56;\">Description</th>\r\n          <th style=\"border:1px solid #011b56;\">HSN/SAC</th>\r\n          <th style=\"border:1px solid #011b56;\">UOM</th>\r\n          <th style=\"border:1px solid #011b56;\">Qty</th>\r\n          <th style=\"border:1px solid #011b56;\">Unit Price</th>\r\n          <th style=\"border:1px solid #011b56;\">Months</th>\r\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\r\n          <th style=\"border:1px solid #011b56;\">Item Total</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${enrichedItems.map(item => {\r\n          const gstLabel = (item.taxGroupNames && item.taxGroupNames.length)\r\n            ? item.taxGroupNames.join(', ')\r\n            : (item.taxGroupName || item.taxId || '-');\r\n          return `\r\n            <tr>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemCode || ''}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemDesc || ''}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.hsnCode}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.uom}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.billQty}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.unitPrice}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.months}</td>\r\n<td style=\"border:1px solid #011b56;\">${gstLabel}</td>\r\n              <td style=\"border:1px solid #011b56;\">${item.itemTotal}</td>\r\n            </tr>`;\r\n        }).join('')}\r\n        <tr>\r\n          <td colspan=\"9\" style=\"text-align:right; border:1px solid #011b56;\"><b>Subtotal</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${subtotal.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"9\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\"9\" style=\"text-align:right; border:1px solid #011b56;\"><b>Bill Value</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${billValue.toFixed(2)}</b></td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    <div style=\"margin-top:8px; font-size:11px;\"><b>Amount in Words:</b> ${amountWords}</div>\r\n    <div style=\"margin-top:20px; text-align:right; font-size:10px;\">Printed on ${new Date().toLocaleString()}</div>\r\n  `;\r\n\r\n  document.body.appendChild(container);\r\n  const canvas = await html2canvas(container, { scale: 2, useCORS: true });\r\n  const imgData = canvas.toDataURL('image/png');\r\n  const pdf = new jsPDF('p', 'pt', 'a4');\r\n  const width = 595.28;\r\n  const height = canvas.height * width / canvas.width;\r\n  pdf.addImage(imgData, 'PNG', 0, 0, width, height);\r\n  document.body.removeChild(container);\r\n\r\n  // 6. Tax Breakdown page\r\n  if (taxGroupDetails.length > 0) {\r\n    pdf.addPage();\r\n    let taxRows = taxGroupDetails.map(row => `\r\n      <tr>\r\n        <td style=\"border:1px solid #011b56;\">${row.sno}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.group}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.peramt}</td>\r\n        <td style=\"border:1px solid #011b56;\">${row.taxAmt}</td>\r\n      </tr>`).join('');\r\n\r\n    let taxHtml = `<div style=\"font-family:Arial; padding:20px; width:100%;\">\r\n    <h3 style=\"margin-bottom:10px; font-size:18px;\">Tax Breakdown</h3>\r\n    <table style=\"width:100%; border-collapse:collapse; margin-top:20px; font-size:14px;\">\r\n      <thead>\r\n        <tr style=\"background:#f4f6fa;\">\r\n          <th style=\"border:1px solid #011b56;\">S.No</th>\r\n          <th style=\"border:1px solid #011b56;\">Tax Group</th>\r\n          <th style=\"border:1px solid #011b56;\">Per/Amt</th>\r\n          <th style=\"border:1px solid #011b56;\">Tax Amt</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${taxRows}\r\n        <tr>\r\n          <td colspan=\"3\" style=\"text-align:right; border:1px solid #011b56;\"><b>Total Tax Amount</b></td>\r\n          <td style=\"border:1px solid #011b56;\"><b>${totalTaxAmount.toFixed(2)}</b></td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    </div>`;\r\n\r\n    const taxContainer = document.createElement('div');\r\n    taxContainer.innerHTML = taxHtml;\r\n    document.body.appendChild(taxContainer);\r\n\r\n    const taxCanvas = await html2canvas(taxContainer, { scale: 1.5, useCORS: true });\r\n    const taxImg = taxCanvas.toDataURL('image/png');\r\n    pdf.addImage(taxImg, 'PNG', 0, 0, width, taxCanvas.height * width / taxCanvas.width);\r\n\r\n    document.body.removeChild(taxContainer);\r\n  }\r\n\r\n  pdf.setFontSize(11);\r\n  pdf.text(`For ${org.bgName || ''}`, width - 200, 780);\r\n  pdf.text('Authorized Signatory', width - 200, 800);\r\n\r\n  // 7. Show PDF\r\n  const blob = pdf.output('blob');\r\n  const url = URL.createObjectURL(blob);\r\n  const newWin = window.open();\r\n  newWin.document.write(`\r\n    <html><head><title>Contract Billing PDF Preview</title></head>\r\n    <body style=\"margin:0;\">\r\n      <iframe width=\"100%\" height=\"100%\" style=\"border:none;\" src=\"${url}\"></iframe>\r\n    </body></html>\r\n  `);\r\n  newWin.document.close();\r\n};\r\n\r\n  renderBillingDetailsTab = () => {\r\n    const f = this.state.formData;\r\n    return (\r\n      <div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill Type</label>\r\n            <select\r\n              className=\"form-control\"\r\n              value={f.billType}\r\n              onChange={(e) => this.handleInputChange(\"billType\", e.target.value)}\r\n            >\r\n              <option value=\"Standard\">Standard</option>\r\n              <option value=\"Manual\">Manual</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill No</label>\r\n            <input\r\n              className=\"form-control\"\r\n              value={f.billNo}\r\n              readOnly\r\n              placeholder=\"Auto\"\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Bill Date</label>\r\n            <input\r\n              type=\"date\"\r\n              className=\"form-control\"\r\n              value={f.billDate}\r\n              onChange={(e) => this.handleInputChange(\"billDate\", e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Status</label>\r\n            <input className=\"form-control\" value={f.status} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Ref No</label>\r\n            <input\r\n              className=\"form-control\"\r\n              value={f.refNo}\r\n              onChange={(e) => this.handleInputChange(\"refNo\", e.target.value)}\r\n            />\r\n          </div>\r\n          \r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Contract</label>\r\n            <input\r\n              className=\"form-control\"\r\n              placeholder=\"Select Contract\"\r\n              value={f.contractNo}\r\n              readOnly\r\n              onClick={() => this.setState({ showContractOverlay: true })}\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"form-group col-md-2\">\r\n            <label>Currency</label>\r\n            <input className=\"form-control\" value={f.currency} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Conversion Rate</label>\r\n            <input type=\"number\" className=\"form-control\" value={f.conversionRate} onChange={e => this.handleInputChange(\"conversionRate\", e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Name of Work</label>\r\n            <input className=\"form-control\" value={f.nameofwrk} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Change Inv Unit Price</label>\r\n            <input type=\"checkbox\" checked={f.changeInvUnitPrice} onChange={e => this.handleInputChange(\"changeInvUnitPrice\", e.target.checked)} />\r\n          </div>\r\n          \r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Amt Agreed</label>\r\n            <input className=\"form-control\" value={f.amtAgreed} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Duration From</label>\r\n            <input type=\"date\" className=\"form-control\" value={f.durationFrom} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Duration To</label>\r\n            <input type=\"date\" className=\"form-control\" value={f.durationTo} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Schedule Date</label>\r\n            <input className=\"form-control\" type=\"date\" value={f.scheduleDate} onChange={e => this.handleInputChange(\"scheduleDate\", e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-mb-2\">\r\n            <label>Repeat</label>\r\n            <input type=\"checkbox\" checked={f.repeat} onChange={e => this.handleInputChange(\"repeat\", e.target.checked)} />\r\n          </div>\r\n          </div>\r\n          <div className=\"form-row\">\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Tax Amount (INR)</label>\r\n            <input className=\"form-control\" value={f.taxAmt} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-2\">\r\n            <label>Bill Value (INR)</label>\r\n            <input className=\"form-control\" value={f.billValue} readOnly />\r\n          </div>\r\n  <div className=\"form-group col-md-2\">\r\n    <label>Prorate</label>\r\n    <input\r\n      type=\"checkbox\"\r\n      checked={this.state.formData.prorate}\r\n      onChange={e => this.handleInputChange(\"prorate\", e.target.checked)}\r\n    />\r\n  </div>\r\n  <div className=\"form-group col-md-2\">\r\n    <label>Discount (%)</label>\r\n    <input\r\n      type=\"number\"\r\n      className=\"form-control\"\r\n      value={this.state.formData.discountPercent}\r\n      onChange={e => this.handleInputChange(\"discountPercent\", e.target.value)}\r\n    />\r\n  </div>\r\n  <div className=\"form-group col-md-2\">\r\n    <label>Discount Amount</label>\r\n    <input\r\n      type=\"number\"\r\n      className=\"form-control\"\r\n      value={this.state.formData.discountAmount}\r\n      readOnly\r\n    />\r\n  </div>\r\n</div>\r\n        </div>\r\n    );\r\n  };\r\n\r\n  renderTermsTab = () => {\r\n    const f = this.state.formData;\r\n    return (\r\n      <div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-6\">\r\n            <label>Bill To</label>\r\n            <textarea className=\"form-control\" value={f.billTo} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-6\">\r\n            <label>Ship To</label>\r\n            <textarea className=\"form-control\" value={f.shipTo} readOnly />\r\n          </div>\r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Place Of Delivery</label>\r\n            <input className=\"form-control\" value={f.placeOfDelivery} onChange={e => this.handleInputChange(\"placeOfDelivery\", e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Despatch Mode</label>\r\n            <input className=\"form-control\" value={f.despatchMode} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-4\">\r\n            <label>Payment Terms</label>\r\n            <input className=\"form-control\" value={f.paymentTerms} readOnly />\r\n          </div>\r\n        </div>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Freight Charges (INR)</label>\r\n            <input className=\"form-control\" value={f.freightCharges} onChange={e => this.handleInputChange(\"freightCharges\", e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Freight %</label>\r\n            <input className=\"form-control\" value={f.freightPercent} onChange={e => this.handleInputChange(\"freightPercent\", e.target.value)} />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Freight Tax Amount (INR)</label>\r\n            <input className=\"form-control\" value={f.freightTaxAmt} readOnly />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Packing Charges (INR)</label>\r\n            <input className=\"form-control\" value={f.packingCharges} onChange={e => this.handleInputChange(\"packingCharges\", e.target.value)} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\nrenderLineItems = () => {\r\n  const items = this.state.formData.lineItems || [];\r\n  const isINR = (this.state.formData.currency || 'INR') === 'INR';\r\n  const showProrate = this.state.formData.prorate;\r\n\r\n  // Calculate days in month from duration\r\n  let daysInMonth = 30;\r\n  const { durationFrom, durationTo } = this.state.formData;\r\n  if (durationFrom && durationTo) {\r\n    const from = new Date(durationFrom);\r\n    const to = new Date(durationTo);\r\n    daysInMonth = Math.max(1, (to - from) / (1000 * 60 * 60 * 24));\r\n  }\r\n\r\n  return (\r\n    <div className=\"table-responsive\">\r\n      <table className=\"table table-bordered\" style={{minWidth: '800px'}}>\r\n        <thead>\r\n          <tr>\r\n            <th>Item Code</th>\r\n            <th>Item Desc</th>\r\n            <th>Duration</th>\r\n            <th>Qty</th>\r\n            <th>Unit Price</th>\r\n            {showProrate && <th>Days</th>}\r\n            <th>Months</th>\r\n            {isINR && <th>Tax Group</th>}\r\n            <th>Tax Amount</th>\r\n            <th>Item Total</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {items.map((it, i) => (\r\n            <tr key={i}>\r\n              <td>{it.itemCode}</td>\r\n              <td>{it.itemDesc}</td>\r\n              <td>{it.duration}</td>\r\n              <td>\r\n                <input\r\n                  type=\"number\"\r\n                  className=\"form-control\"\r\n                  value={it.qty}\r\n                  onChange={e => this.handleLineItemChange(i, \"qty\", e.target.value)}\r\n                />\r\n              </td>\r\n              <td>\r\n                <input\r\n                  type=\"number\"\r\n                  className=\"form-control\"\r\n                  value={it.unitPrice}\r\n                  onChange={e => this.handleLineItemChange(i, \"unitPrice\", e.target.value)}\r\n                />\r\n              </td>\r\n              <td>\r\n  <input\r\n    type=\"number\"\r\n    className=\"form-control\"\r\n    value={it.days || ''}\r\n    onChange={e => this.handleLineItemChange(i, \"days\", e.target.value)}\r\n  />\r\n</td>\r\n<td>\r\n  <input\r\n    type=\"number\"\r\n    className=\"form-control\"\r\n    value={it.months}\r\n    onChange={e => this.handleLineItemChange(i, \"months\", e.target.value)}\r\n  />\r\n</td>\r\n              {isINR && (\r\n                <td>\r\n                  <select\r\n                    className=\"form-control\"\r\n                    value={it.taxGroupNames?.[0] || ''}\r\n                    onChange={e => {\r\n                      const val = e.target.value;\r\n                      const arr = val ? [val] : [];\r\n                      this.handleLineItemChange(i, \"taxGroupNames\", arr);\r\n                    }}\r\n                  >\r\n                    <option value=\"\">-Select-</option>\r\n                    {this.state.taxGroups.map((tg, idx) => (\r\n                      <option key={idx} value={tg.groupName}>{tg.groupName}</option>\r\n                    ))}\r\n                  </select>\r\n                </td>\r\n              )}\r\n              <td>{it.taxAmt}</td>\r\n              <td>{it.itemTotal}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n};\r\n\r\n  renderTabs = () => {\r\n    const tabs = [\"Billing Details\", \"Port & Terms\", \"Notes\"];\r\n    return (\r\n      <ul className=\"nav nav-tabs mb-3\">\r\n        {tabs.map((t, i) => (\r\n          <li key={i} className=\"nav-item\">\r\n            <button\r\n              type=\"button\"\r\n              className={`nav-link ${this.state.activeTab === i ? \"active\" : \"\"}`}\r\n              onClick={() => this.handleTabChange(i)}\r\n            >\r\n              {t}\r\n            </button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    );\r\n  };\r\nrenderNotesTab = () => (\r\n  <div>\r\n    <div className=\"form-group\">\r\n      <label>Notes / Remarks</label>\r\n      <textarea\r\n        className=\"form-control form-control-sm\"\r\n        rows={2}\r\n        value={this.state.notes}\r\n        onChange={e => this.setState({ notes: e.target.value })}\r\n        style={{ resize: \"vertical\", minHeight: \"40px\", maxHeight: \"120px\" }}\r\n      />\r\n    </div>\r\n  </div>\r\n);\r\n  renderForm = () => {\r\n    return (\r\n      <div className=\"card full-height\">\r\n        <form onSubmit={this.handleSubmit}>\r\n          <div className=\"card-body\">\r\n            {this.renderTabs()}\r\n            {this.state.activeTab === 0 && (\r\n              <>\r\n                {this.renderBillingDetailsTab()}\r\n                {this.renderLineItems()}\r\n              </>\r\n            )}\r\n            {this.state.activeTab === 1 && this.renderTermsTab()}\r\n            {this.state.activeTab === 2 && this.renderNotesTab()}\r\n          </div>\r\n              <div className=\"fixed-card-footer text-right p-3 border-top bg-white\">\r\n            \r\n            <button\r\n              className=\"btn btn-secondary ml-2\"\r\n              type=\"button\"\r\n              onClick={() =>\r\n                this.setState({\r\n                  showForm: false,\r\n                  editingId: null,\r\n                  formData: this.getEmptyForm(),\r\n                  notes: \"\",\r\n                })\r\n              }\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button className=\"btn btn-success\" type=\"submit\">\r\n              {this.state.editingId ? \"Update\" : \"Create\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  renderTable = () => (\r\n    <div className=\"card mt-4 full-height\">\r\n      <div className=\"card-body\">\r\n        <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n          <h4 className=\"card-title\">Contract Billing</h4>\r\n          <button className=\"btn btn-primary\" onClick={() => this.setState({ showForm: true })}>Create</button>\r\n        </div>\r\n              <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Bill No</th>\r\n              <th>Date</th>\r\n              <th>Contract</th>\r\n              <th>Customer</th>\r\n              <th>Currency</th>\r\n              <th>Bill Value</th>\r\n              <th>Status</th>\r\n              <th>Print</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n  {this.state.bills.map((b, i) => {\r\n    let statusClass = \"badge-secondary\";\r\n    if (b.status === \"Entered\") statusClass = \"badge-warning\";\r\n    else if (b.status === \"Submitted\") statusClass = \"badge-info\";\r\n    else if (b.status === \"Cancelled\") statusClass = \"badge-danger\";\r\n    else if (b.status === \"Approved\") statusClass = \"badge-success\"; // optional extra\r\n\r\n    return (\r\n      <tr key={i}>\r\n        <td>\r\n          <button\r\n            className=\"btn btn-link\"\r\n            onClick={() =>\r\n              this.setState({\r\n                showForm: true,\r\n                editingId: b.id,\r\n                formData: { ...b },\r\n                notes: b.notes || \"\",\r\n              })\r\n            }\r\n          >\r\n            {b.billNo}\r\n          </button>\r\n        </td>\r\n        <td>{b.billDate}</td>\r\n        <td>{b.contractNo}</td>\r\n        <td>{b.customer}</td>\r\n        <td>{b.currency}</td>\r\n        <td>{b.billValue}</td>\r\n        <td>\r\n          <label className={`badge ${statusClass}`} style={{ fontSize: \"14px\" }}>\r\n            {b.status}\r\n          </label>\r\n        </td>\r\n        <td>\r\n          <i\r\n            className=\"mdi mdi-printer menu-icon\"\r\n            onClick={() => this.showContractBillingPDFWithOrg(b)}\r\n            style={{ fontSize: \"24px\", color: \"#2196F3\", cursor: \"pointer\" }}\r\n          />\r\n        </td>\r\n      </tr>\r\n    );\r\n  })}\r\n</tbody>\r\n\r\n        </table>\r\n      </div>\r\n    </div>\r\n    </div>\r\n  );\r\n\r\n  renderContractOverlay = () => {\r\n    const { contracts, contractOverlaySearch } = this.state;\r\n    const filtered = contracts.filter((c) =>\r\n      (c.contractNo || \"\")\r\n        .toLowerCase()\r\n        .includes(contractOverlaySearch.toLowerCase())\r\n    );\r\n    return (\r\n      <div className=\"custom-overlay\">\r\n        <div className=\"custom-overlay-content\">\r\n          <h5>Select Contract</h5>\r\n          <input\r\n            className=\"form-control mb-2\"\r\n            value={contractOverlaySearch}\r\n            onChange={(e) =>\r\n              this.setState({ contractOverlaySearch: e.target.value })\r\n            }\r\n          />\r\n          <table className=\"table table-sm table-bordered\">\r\n            <thead>\r\n              <tr>\r\n                <th>Contract No</th>\r\n                <th>Customer</th>\r\n                <th>Value</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {filtered.map((c) => (\r\n                <tr\r\n                  key={c.id}\r\n                  style={{ cursor: \"pointer\" }}\r\n                  onClick={() => this.selectContract(c)}\r\n                >\r\n                  <td>{c.contractNo}</td>\r\n                  <td>{c.customer}</td>\r\n                  <td>{c.contractValue}</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n          <button\r\n            className=\"btn btn-secondary btn-sm\"\r\n            onClick={() => this.setState({ showContractOverlay: false })}\r\n          >\r\n            Close\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        {this.state.showForm ? this.renderForm() : this.renderTable()}\r\n        {this.state.showContractOverlay && this.renderContractOverlay()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ContractFinalBilling;\r\n"]},"metadata":{},"sourceType":"module"}