{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\psp\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\invoice\\\\BillingAmendment.js\";\nimport React, { Component } from 'react';\nimport { db } from '../../../../firebase';\nimport { collection, getDocs, updateDoc, doc, onSnapshot } from 'firebase/firestore';\nimport { serverTimestamp } from 'firebase/firestore';\n\nclass BillingAmendment extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      cobilling: [],\n      selected: null,\n      loading: false,\n      showAmendDialog: false,\n      showEditForm: false,\n      editFormData: null,\n      amendReason: \"\"\n    };\n\n    this.subscribeToBills = () => {\n      // cobilling listener\n      this._unsubCob = onSnapshot(collection(db, 'cobilling'), snap => {\n        const cobData = snap.docs.map(d => ({\n          id: d.id,\n          ...d.data(),\n          source: 'cob'\n        }));\n        this._latestCob = cobData;\n        this.mergeAndSet();\n      }, err => {\n        console.error('cob snapshot error', err);\n      }); // invoices listener\n\n      this._unsubInv = onSnapshot(collection(db, 'invoices'), snap => {\n        const invData = snap.docs.map(d => ({\n          id: d.id,\n          ...d.data(),\n          source: 'direct'\n        }));\n        this._latestInv = invData;\n        this.mergeAndSet();\n      }, err => {\n        console.error('inv snapshot error', err);\n      });\n    };\n\n    this.mergeAndSet = () => {\n      const cob = this._latestCob || [];\n      const inv = this._latestInv || [];\n      const merged = [...cob, ...inv].sort((a, b) => {\n        const da = a.cobillingDate || a.invoiceDate || '';\n        const db_ = b.cobillingDate || b.invoiceDate || '';\n        return db_.localeCompare(da);\n      });\n      this.setState({\n        cobilling: merged\n      });\n    };\n\n    this.fetchBills = async () => {\n      try {\n        // fetch cobilling\n        const snapCOB = await getDocs(collection(db, 'cobilling'));\n        const cobData = snapCOB.docs.map(d => ({\n          id: d.id,\n          ...d.data(),\n          source: 'cob'\n        })); // fetch direct invoices\n\n        const snapINV = await getDocs(collection(db, 'invoices'));\n        const invData = snapINV.docs.map(d => ({\n          id: d.id,\n          ...d.data(),\n          source: 'direct'\n        })); // choose amendable bills: we'll consider Approved bills (same flow as approval)\n\n        const amendable = [...cobData, ...invData].filter(c => c.status === 'Approved');\n        this.setState({\n          cobilling: amendable\n        });\n      } catch (err) {\n        console.error('fetchBills error', err);\n        alert('Error fetching bills: ' + err.message);\n      }\n    };\n\n    this.openPreview = cob => {\n      this.setState({\n        selected: cob\n      });\n    };\n\n    this.closePreview = () => {\n      this.setState({\n        selected: null,\n        showAmendDialog: false,\n        amendReason: \"\"\n      });\n    };\n\n    this.openAmendDialog = () => {\n      this.setState({\n        showEditForm: true,\n        editFormData: { ...this.state.selected\n        }\n      });\n    };\n\n    this.closeEditForm = () => {\n      this.setState({\n        showEditForm: false,\n        editFormData: null\n      });\n    };\n\n    this.closeAmendDialog = () => {\n      this.setState({\n        showAmendDialog: false,\n        amendReason: \"\"\n      });\n    };\n\n    this.handleEditInputChange = (field, value) => {\n      this.setState(prev => ({\n        editFormData: { ...prev.editFormData,\n          [field]: value\n        }\n      }));\n    };\n\n    this.handleEditLineItemChange = (idx, field, value) => {\n      const items = [...this.state.editFormData.lineItems];\n      items[idx] = { ...items[idx],\n        [field]: value\n      };\n      this.setState(prev => ({\n        editFormData: { ...prev.editFormData,\n          lineItems: items\n        }\n      }));\n    };\n\n    this.handleEditSave = async e => {\n      e.preventDefault();\n      const {\n        editFormData\n      } = this.state;\n      const collectionName = editFormData.source === 'direct' ? 'invoices' : 'cobilling';\n\n      try {\n        await updateDoc(doc(db, collectionName, editFormData.id), { ...editFormData,\n          status: 'Amended',\n          amendedAt: serverTimestamp(),\n          updatedAt: serverTimestamp()\n        });\n        alert('Bill Amended.');\n        this.setState({\n          showEditForm: false,\n          editFormData: null,\n          selected: null\n        });\n        this.fetchBills && this.fetchBills();\n      } catch (err) {\n        alert('Error amending: ' + err.message);\n      }\n    };\n\n    this.handleAmendReasonChange = e => {\n      this.setState({\n        amendReason: e.target.value\n      });\n    };\n\n    this.handleAmendConfirm = async () => {\n      const {\n        selected,\n        amendReason\n      } = this.state;\n\n      if (!amendReason.trim()) {\n        alert(\"Please enter a reason for amendment.\");\n        return;\n      }\n\n      try {\n        const collectionName = selected.source === 'direct' ? 'invoices' : 'cobilling';\n        const ref = doc(db, collectionName, selected.id);\n        await updateDoc(ref, {\n          status: 'Amended',\n          amendedAt: serverTimestamp(),\n          amendReason,\n          updatedAt: serverTimestamp()\n        });\n        alert('Bill Amended.');\n        await this.fetchBills();\n        this.closePreview();\n      } catch (err) {\n        console.error('handleAmendConfirm error', err);\n        alert('Error amending: ' + err.message);\n      }\n    };\n\n    this.renderEditForm = () => {\n      var _editFormData$lineIte;\n\n      const {\n        editFormData\n      } = this.state;\n      if (!editFormData) return null;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 p-4 shadow-sm full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 7\n        }\n      }, \"Edit Bill - \", editFormData.cobillingNo || editFormData.invoiceNo), /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: this.handleEditSave,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 13\n        }\n      }, \"Customer\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: editFormData.customer,\n        onChange: e => this.handleEditInputChange(\"customer\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 13\n        }\n      }, \"Date\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"date\",\n        className: \"form-control\",\n        value: editFormData.cobillingDate || editFormData.invoiceDate,\n        onChange: e => this.handleEditInputChange(editFormData.cobillingDate ? \"cobillingDate\" : \"invoiceDate\", e.target.value),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"form-group col-md-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 13\n        }\n      }, \"Status\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        value: editFormData.status,\n        readOnly: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 9\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 15\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 15\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 15\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 15\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 15\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 11\n        }\n      }, (_editFormData$lineIte = editFormData.lineItems) === null || _editFormData$lineIte === void 0 ? void 0 : _editFormData$lineIte.map((item, idx) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: idx,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 17\n        }\n      }, item.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 17\n        }\n      }, item.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        value: item.qty,\n        onChange: e => this.handleEditLineItemChange(idx, \"qty\", e.target.value),\n        style: {\n          width: 80\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 19\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"number\",\n        value: item.unitPrice,\n        onChange: e => this.handleEditLineItemChange(idx, \"unitPrice\", e.target.value),\n        style: {\n          width: 80\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 19\n        }\n      })), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 17\n        }\n      }, item.itemTotal))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-success mr-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 11\n        }\n      }, \"Save\"), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary\",\n        onClick: this.closeEditForm,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 11\n        }\n      }, \"Cancel\"))));\n    };\n\n    this.renderAmendDialog = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay-content\",\n      style: {\n        width: 420\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }\n    }, \"Amend Reason\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control\",\n      rows: 4,\n      value: this.state.amendReason,\n      onChange: this.handleAmendReasonChange,\n      placeholder: \"Enter reason for amendment\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"text-right mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-secondary mr-2\",\n      onClick: this.closeAmendDialog,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 11\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-warning\",\n      onClick: this.handleAmendConfirm,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 11\n      }\n    }, \"Amend\"))));\n\n    this.renderTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-4 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"card-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }\n    }, \"Billing Amendment\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 17\n      }\n    }, \"Bill No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 17\n      }\n    }, \"Order\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 17\n      }\n    }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 17\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 17\n      }\n    }, \"Value\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 17\n      }\n    }, \"Type\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 17\n      }\n    }, \"Status\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 13\n      }\n    }, this.state.cobilling.map(c => {\n      let statusClass = \"badge-secondary\";\n      if (c.status === \"Approved\") statusClass = \"badge-success\";else if (c.status === \"Amended\") statusClass = \"badge-warning\";else if (c.status === \"Cancelled\") statusClass = \"badge-danger\";else if (c.status === \"Entered\" || c.status === \"Pending\") statusClass = \"badge-info\";\n      const billNo = c.source === 'direct' ? c.invoiceNo || '-' : c.cobillingNo || '-';\n      const date = c.source === 'direct' ? c.invoiceDate || '-' : c.cobillingDate || '-';\n      const value = c.source === 'direct' ? c.invoiceValue || c.amount || '-' : c.billValue || c.amount || '-';\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: `${c.source}_${c.id}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-link p-0\",\n        onClick: () => this.openPreview(c),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }\n      }, billNo)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 9\n        }\n      }, c.customerOrderId || \"-\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 9\n        }\n      }, c.customer || \"-\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 9\n        }\n      }, date), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 9\n        }\n      }, value), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 9\n        }\n      }, c.source === 'direct' ? \"Direct Billing\" : \"Customer Billing\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${statusClass}`,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }\n      }, c.status || 'N/A')));\n    }))))));\n\n    this.renderPreview = () => {\n      const c = this.state.selected;\n      if (!c) return null;\n      const billNo = c.source === 'direct' ? c.invoiceNo || '-' : c.cobillingNo || '-';\n      const date = c.source === 'direct' ? c.invoiceDate || '-' : c.cobillingDate || '-';\n      const value = c.source === 'direct' ? c.invoiceValue || '-' : c.billValue || '-';\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 p-4 shadow-sm full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title mb-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 9\n        }\n      }, \"Billing Preview - \", billNo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 37\n        }\n      }, \"Order:\"), \" \", c.customerOrderId || \"-\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 37\n        }\n      }, \"Customer:\"), \" \", c.customer || \"-\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 37\n        }\n      }, \"Date:\"), \" \", date)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 37\n        }\n      }, \"Value:\"), \" \", value), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 37\n        }\n      }, \"Status:\"), \" \", c.status), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 37\n        }\n      }, \"Amend Reason:\"), \" \", c.amendReason || \"-\")), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 9\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 15\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 15\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 15\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 15\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 15\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 11\n        }\n      }, (c.lineItems || []).map((li, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 17\n        }\n      }, li.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 17\n        }\n      }, li.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 17\n        }\n      }, li.qty), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 17\n        }\n      }, li.unitPrice), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 17\n        }\n      }, li.itemTotal))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-auto pt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-warning mr-2\",\n        onClick: this.openAmendDialog,\n        disabled: c.status === \"Amended\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351,\n          columnNumber: 11\n        }\n      }, \"Amend\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: this.closePreview,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }\n      }, \"Back to List\")), this.state.showAmendDialog && this.renderAmendDialog());\n    };\n  }\n\n  componentDidMount() {\n    this.subscribeToBills();\n  }\n\n  componentWillUnmount() {\n    if (this._unsubCob) this._unsubCob();\n    if (this._unsubInv) this._unsubInv();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 372,\n        columnNumber: 5\n      }\n    }, this.state.showEditForm ? this.renderEditForm() : this.state.selected ? this.renderPreview() : this.renderTable());\n  }\n\n}\n\nexport default BillingAmendment;","map":{"version":3,"sources":["C:/Users/College/psp/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/invoice/BillingAmendment.js"],"names":["React","Component","db","collection","getDocs","updateDoc","doc","onSnapshot","serverTimestamp","BillingAmendment","state","cobilling","selected","loading","showAmendDialog","showEditForm","editFormData","amendReason","subscribeToBills","_unsubCob","snap","cobData","docs","map","d","id","data","source","_latestCob","mergeAndSet","err","console","error","_unsubInv","invData","_latestInv","cob","inv","merged","sort","a","b","da","cobillingDate","invoiceDate","db_","localeCompare","setState","fetchBills","snapCOB","snapINV","amendable","filter","c","status","alert","message","openPreview","closePreview","openAmendDialog","closeEditForm","closeAmendDialog","handleEditInputChange","field","value","prev","handleEditLineItemChange","idx","items","lineItems","handleEditSave","e","preventDefault","collectionName","amendedAt","updatedAt","handleAmendReasonChange","target","handleAmendConfirm","trim","ref","renderEditForm","cobillingNo","invoiceNo","customer","item","itemCode","itemDescription","qty","width","unitPrice","itemTotal","renderAmendDialog","renderTable","statusClass","billNo","date","invoiceValue","amount","billValue","customerOrderId","fontSize","renderPreview","li","i","componentDidMount","componentWillUnmount","render"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,EAAT,QAAmB,sBAAnB;AACA,SAASC,UAAT,EAAqBC,OAArB,EAA8BC,SAA9B,EAAyCC,GAAzC,EAA6CC,UAA7C,QAA+D,oBAA/D;AACA,SAASC,eAAT,QAAgC,oBAAhC;;AAEA,MAAMC,gBAAN,SAA+BR,SAA/B,CAAyC;AAAA;AAAA;AAAA,SACvCS,KADuC,GAC/B;AACNC,MAAAA,SAAS,EAAE,EADL;AAENC,MAAAA,QAAQ,EAAE,IAFJ;AAGNC,MAAAA,OAAO,EAAE,KAHH;AAINC,MAAAA,eAAe,EAAE,KAJX;AAKNC,MAAAA,YAAY,EAAE,KALR;AAMNC,MAAAA,YAAY,EAAE,IANR;AAONC,MAAAA,WAAW,EAAE;AAPP,KAD+B;;AAAA,SAoBzCC,gBApByC,GAoBtB,MAAM;AACvB;AACA,WAAKC,SAAL,GAAiBZ,UAAU,CAACJ,UAAU,CAACD,EAAD,EAAK,WAAL,CAAX,EAA8BkB,IAAI,IAAI;AAC/D,cAAMC,OAAO,GAAGD,IAAI,CAACE,IAAL,CAAUC,GAAV,CAAcC,CAAC,KAAK;AAAEC,UAAAA,EAAE,EAAED,CAAC,CAACC,EAAR;AAAY,aAAGD,CAAC,CAACE,IAAF,EAAf;AAAyBC,UAAAA,MAAM,EAAE;AAAjC,SAAL,CAAf,CAAhB;AACA,aAAKC,UAAL,GAAkBP,OAAlB;AACA,aAAKQ,WAAL;AACD,OAJ0B,EAIxBC,GAAG,IAAI;AACRC,QAAAA,OAAO,CAACC,KAAR,CAAc,oBAAd,EAAoCF,GAApC;AACD,OAN0B,CAA3B,CAFuB,CAUvB;;AACA,WAAKG,SAAL,GAAiB1B,UAAU,CAACJ,UAAU,CAACD,EAAD,EAAK,UAAL,CAAX,EAA6BkB,IAAI,IAAI;AAC9D,cAAMc,OAAO,GAAGd,IAAI,CAACE,IAAL,CAAUC,GAAV,CAAcC,CAAC,KAAK;AAAEC,UAAAA,EAAE,EAAED,CAAC,CAACC,EAAR;AAAY,aAAGD,CAAC,CAACE,IAAF,EAAf;AAAyBC,UAAAA,MAAM,EAAE;AAAjC,SAAL,CAAf,CAAhB;AACA,aAAKQ,UAAL,GAAkBD,OAAlB;AACA,aAAKL,WAAL;AACD,OAJ0B,EAIxBC,GAAG,IAAI;AACRC,QAAAA,OAAO,CAACC,KAAR,CAAc,oBAAd,EAAoCF,GAApC;AACD,OAN0B,CAA3B;AAOD,KAtCwC;;AAAA,SAwCzCD,WAxCyC,GAwC3B,MAAM;AAClB,YAAMO,GAAG,GAAG,KAAKR,UAAL,IAAmB,EAA/B;AACA,YAAMS,GAAG,GAAG,KAAKF,UAAL,IAAmB,EAA/B;AACA,YAAMG,MAAM,GAAG,CAAC,GAAGF,GAAJ,EAAS,GAAGC,GAAZ,EAAiBE,IAAjB,CAAsB,CAACC,CAAD,EAAGC,CAAH,KAAS;AAC5C,cAAMC,EAAE,GAAGF,CAAC,CAACG,aAAF,IAAmBH,CAAC,CAACI,WAArB,IAAoC,EAA/C;AACA,cAAMC,GAAG,GAAGJ,CAAC,CAACE,aAAF,IAAmBF,CAAC,CAACG,WAArB,IAAoC,EAAhD;AACA,eAAOC,GAAG,CAACC,aAAJ,CAAkBJ,EAAlB,CAAP;AACD,OAJc,CAAf;AAKA,WAAKK,QAAL,CAAc;AAAEpC,QAAAA,SAAS,EAAE2B;AAAb,OAAd;AACD,KAjDwC;;AAAA,SAmDvCU,UAnDuC,GAmD1B,YAAY;AACvB,UAAI;AACF;AACA,cAAMC,OAAO,GAAG,MAAM7C,OAAO,CAACD,UAAU,CAACD,EAAD,EAAK,WAAL,CAAX,CAA7B;AACA,cAAMmB,OAAO,GAAG4B,OAAO,CAAC3B,IAAR,CAAaC,GAAb,CAAiBC,CAAC,KAAK;AAAEC,UAAAA,EAAE,EAAED,CAAC,CAACC,EAAR;AAAY,aAAGD,CAAC,CAACE,IAAF,EAAf;AAAyBC,UAAAA,MAAM,EAAE;AAAjC,SAAL,CAAlB,CAAhB,CAHE,CAIF;;AACA,cAAMuB,OAAO,GAAG,MAAM9C,OAAO,CAACD,UAAU,CAACD,EAAD,EAAK,UAAL,CAAX,CAA7B;AACA,cAAMgC,OAAO,GAAGgB,OAAO,CAAC5B,IAAR,CAAaC,GAAb,CAAiBC,CAAC,KAAK;AAAEC,UAAAA,EAAE,EAAED,CAAC,CAACC,EAAR;AAAY,aAAGD,CAAC,CAACE,IAAF,EAAf;AAAyBC,UAAAA,MAAM,EAAE;AAAjC,SAAL,CAAlB,CAAhB,CANE,CAOF;;AACA,cAAMwB,SAAS,GAAG,CAAC,GAAG9B,OAAJ,EAAa,GAAGa,OAAhB,EAAyBkB,MAAzB,CAAgCC,CAAC,IAAIA,CAAC,CAACC,MAAF,KAAa,UAAlD,CAAlB;AACA,aAAKP,QAAL,CAAc;AAAEpC,UAAAA,SAAS,EAAEwC;AAAb,SAAd;AACD,OAVD,CAUE,OAAOrB,GAAP,EAAY;AACZC,QAAAA,OAAO,CAACC,KAAR,CAAc,kBAAd,EAAkCF,GAAlC;AACAyB,QAAAA,KAAK,CAAC,2BAA2BzB,GAAG,CAAC0B,OAAhC,CAAL;AACD;AACF,KAlEsC;;AAAA,SAoEvCC,WApEuC,GAoExBrB,GAAD,IAAS;AACrB,WAAKW,QAAL,CAAc;AAAEnC,QAAAA,QAAQ,EAAEwB;AAAZ,OAAd;AACD,KAtEsC;;AAAA,SAwEvCsB,YAxEuC,GAwExB,MAAM;AACnB,WAAKX,QAAL,CAAc;AAAEnC,QAAAA,QAAQ,EAAE,IAAZ;AAAkBE,QAAAA,eAAe,EAAE,KAAnC;AAA0CG,QAAAA,WAAW,EAAE;AAAvD,OAAd;AACD,KA1EsC;;AAAA,SA4EvC0C,eA5EuC,GA4ErB,MAAM;AACxB,WAAKZ,QAAL,CAAc;AAAEhC,QAAAA,YAAY,EAAE,IAAhB;AAAsBC,QAAAA,YAAY,EAAE,EAAE,GAAG,KAAKN,KAAL,CAAWE;AAAhB;AAApC,OAAd;AACD,KA9EwC;;AAAA,SA+EvCgD,aA/EuC,GA+EvB,MAAM;AACpB,WAAKb,QAAL,CAAc;AAAEhC,QAAAA,YAAY,EAAE,KAAhB;AAAuBC,QAAAA,YAAY,EAAE;AAArC,OAAd;AACD,KAjFsC;;AAAA,SAkFvC6C,gBAlFuC,GAkFpB,MAAM;AACvB,WAAKd,QAAL,CAAc;AAAEjC,QAAAA,eAAe,EAAE,KAAnB;AAA0BG,QAAAA,WAAW,EAAE;AAAvC,OAAd;AACD,KApFsC;;AAAA,SAqFvC6C,qBArFuC,GAqFf,CAACC,KAAD,EAAQC,KAAR,KAAkB;AAC1C,WAAKjB,QAAL,CAAckB,IAAI,KAAK;AACrBjD,QAAAA,YAAY,EAAE,EAAE,GAAGiD,IAAI,CAACjD,YAAV;AAAwB,WAAC+C,KAAD,GAASC;AAAjC;AADO,OAAL,CAAlB;AAGD,KAzFwC;;AAAA,SA2FzCE,wBA3FyC,GA2Fd,CAACC,GAAD,EAAMJ,KAAN,EAAaC,KAAb,KAAuB;AAChD,YAAMI,KAAK,GAAG,CAAC,GAAG,KAAK1D,KAAL,CAAWM,YAAX,CAAwBqD,SAA5B,CAAd;AACAD,MAAAA,KAAK,CAACD,GAAD,CAAL,GAAa,EAAE,GAAGC,KAAK,CAACD,GAAD,CAAV;AAAiB,SAACJ,KAAD,GAASC;AAA1B,OAAb;AACA,WAAKjB,QAAL,CAAckB,IAAI,KAAK;AACrBjD,QAAAA,YAAY,EAAE,EAAE,GAAGiD,IAAI,CAACjD,YAAV;AAAwBqD,UAAAA,SAAS,EAAED;AAAnC;AADO,OAAL,CAAlB;AAGD,KAjGwC;;AAAA,SAmGzCE,cAnGyC,GAmGxB,MAAOC,CAAP,IAAa;AAC5BA,MAAAA,CAAC,CAACC,cAAF;AACA,YAAM;AAAExD,QAAAA;AAAF,UAAmB,KAAKN,KAA9B;AACA,YAAM+D,cAAc,GAAGzD,YAAY,CAACW,MAAb,KAAwB,QAAxB,GAAmC,UAAnC,GAAgD,WAAvE;;AACA,UAAI;AACF,cAAMtB,SAAS,CAACC,GAAG,CAACJ,EAAD,EAAKuE,cAAL,EAAqBzD,YAAY,CAACS,EAAlC,CAAJ,EAA2C,EACxD,GAAGT,YADqD;AAExDsC,UAAAA,MAAM,EAAE,SAFgD;AAGxDoB,UAAAA,SAAS,EAAElE,eAAe,EAH8B;AAIxDmE,UAAAA,SAAS,EAAEnE,eAAe;AAJ8B,SAA3C,CAAf;AAMA+C,QAAAA,KAAK,CAAC,eAAD,CAAL;AACA,aAAKR,QAAL,CAAc;AAAEhC,UAAAA,YAAY,EAAE,KAAhB;AAAuBC,UAAAA,YAAY,EAAE,IAArC;AAA2CJ,UAAAA,QAAQ,EAAE;AAArD,SAAd;AACA,aAAKoC,UAAL,IAAmB,KAAKA,UAAL,EAAnB;AACD,OAVD,CAUE,OAAOlB,GAAP,EAAY;AACZyB,QAAAA,KAAK,CAAC,qBAAqBzB,GAAG,CAAC0B,OAA1B,CAAL;AACD;AACF,KApHwC;;AAAA,SAsHvCoB,uBAtHuC,GAsHZL,CAAD,IAAO;AAC/B,WAAKxB,QAAL,CAAc;AAAE9B,QAAAA,WAAW,EAAEsD,CAAC,CAACM,MAAF,CAASb;AAAxB,OAAd;AACD,KAxHsC;;AAAA,SA0HvCc,kBA1HuC,GA0HlB,YAAY;AAC/B,YAAM;AAAElE,QAAAA,QAAF;AAAYK,QAAAA;AAAZ,UAA4B,KAAKP,KAAvC;;AACA,UAAI,CAACO,WAAW,CAAC8D,IAAZ,EAAL,EAAyB;AACvBxB,QAAAA,KAAK,CAAC,sCAAD,CAAL;AACA;AACD;;AACD,UAAI;AACF,cAAMkB,cAAc,GAAG7D,QAAQ,CAACe,MAAT,KAAoB,QAApB,GAA+B,UAA/B,GAA4C,WAAnE;AACA,cAAMqD,GAAG,GAAG1E,GAAG,CAACJ,EAAD,EAAKuE,cAAL,EAAqB7D,QAAQ,CAACa,EAA9B,CAAf;AACA,cAAMpB,SAAS,CAAC2E,GAAD,EAAM;AACnB1B,UAAAA,MAAM,EAAE,SADW;AAEnBoB,UAAAA,SAAS,EAAElE,eAAe,EAFP;AAGnBS,UAAAA,WAHmB;AAInB0D,UAAAA,SAAS,EAAEnE,eAAe;AAJP,SAAN,CAAf;AAOA+C,QAAAA,KAAK,CAAC,eAAD,CAAL;AACA,cAAM,KAAKP,UAAL,EAAN;AACA,aAAKU,YAAL;AACD,OAbD,CAaE,OAAO5B,GAAP,EAAY;AACZC,QAAAA,OAAO,CAACC,KAAR,CAAc,0BAAd,EAA0CF,GAA1C;AACAyB,QAAAA,KAAK,CAAC,qBAAqBzB,GAAG,CAAC0B,OAA1B,CAAL;AACD;AACF,KAjJsC;;AAAA,SAkJvCyB,cAlJuC,GAkJtB,MAAM;AAAA;;AACvB,YAAM;AAAEjE,QAAAA;AAAF,UAAmB,KAAKN,KAA9B;AACA,UAAI,CAACM,YAAL,EAAmB,OAAO,IAAP;AACnB,0BACE;AAAK,QAAA,SAAS,EAAC,wDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAiBA,YAAY,CAACkE,WAAb,IAA4BlE,YAAY,CAACmE,SAA1D,CADF,eAEE;AAAM,QAAA,QAAQ,EAAE,KAAKb,cAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAEtD,YAAY,CAACoE,QAHtB;AAIE,QAAA,QAAQ,EAAEb,CAAC,IAAI,KAAKT,qBAAL,CAA2B,UAA3B,EAAuCS,CAAC,CAACM,MAAF,CAASb,KAAhD,CAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CADF,eAUE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAEhD,YAAY,CAAC2B,aAAb,IAA8B3B,YAAY,CAAC4B,WAHpD;AAIE,QAAA,QAAQ,EAAE2B,CAAC,IAAI,KAAKT,qBAAL,CAA2B9C,YAAY,CAAC2B,aAAb,GAA6B,eAA7B,GAA+C,aAA1E,EAAyF4B,CAAC,CAACM,MAAF,CAASb,KAAlG,CAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAVF,eAmBE;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAEhD,YAAY,CAACsC,MAHtB;AAIE,QAAA,QAAQ,MAJV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAnBF,CADF,eA8BE;AAAI,QAAA,SAAS,EAAC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBA9BF,eA+BE;AAAO,QAAA,SAAS,EAAC,+BAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,SAAS,EAAC,aAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBALF,CADF,CADF,eAUE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCACGtC,YAAY,CAACqD,SADhB,0DACG,sBAAwB9C,GAAxB,CAA4B,CAAC8D,IAAD,EAAOlB,GAAP,kBAC3B;AAAI,QAAA,GAAG,EAAEA,GAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKkB,IAAI,CAACC,QAAV,CADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKD,IAAI,CAACE,eAAV,CAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,KAAK,EAAEF,IAAI,CAACG,GAFd;AAGE,QAAA,QAAQ,EAAEjB,CAAC,IAAI,KAAKL,wBAAL,CAA8BC,GAA9B,EAAmC,KAAnC,EAA0CI,CAAC,CAACM,MAAF,CAASb,KAAnD,CAHjB;AAIE,QAAA,KAAK,EAAE;AAAEyB,UAAAA,KAAK,EAAE;AAAT,SAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAHF,eAWE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,KAAK,EAAEJ,IAAI,CAACK,SAFd;AAGE,QAAA,QAAQ,EAAEnB,CAAC,IAAI,KAAKL,wBAAL,CAA8BC,GAA9B,EAAmC,WAAnC,EAAgDI,CAAC,CAACM,MAAF,CAASb,KAAzD,CAHjB;AAIE,QAAA,KAAK,EAAE;AAAEyB,UAAAA,KAAK,EAAE;AAAT,SAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAXF,eAmBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKJ,IAAI,CAACM,SAAV,CAnBF,CADD,CADH,CAVF,CA/BF,eAmEE;AAAK,QAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAQ,QAAA,IAAI,EAAC,QAAb;AAAsB,QAAA,SAAS,EAAC,sBAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAQ,QAAA,IAAI,EAAC,QAAb;AAAsB,QAAA,SAAS,EAAC,mBAAhC;AAAoD,QAAA,OAAO,EAAE,KAAK/B,aAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF,CAnEF,CAFF,CADF;AA6ED,KAlOwC;;AAAA,SAqOvCgC,iBArOuC,GAqOnB,mBAClB;AAAK,MAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,wBAAf;AAAwC,MAAA,KAAK,EAAE;AAAEH,QAAAA,KAAK,EAAE;AAAT,OAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AACE,MAAA,SAAS,EAAC,cADZ;AAEE,MAAA,IAAI,EAAE,CAFR;AAGE,MAAA,KAAK,EAAE,KAAK/E,KAAL,CAAWO,WAHpB;AAIE,MAAA,QAAQ,EAAE,KAAK2D,uBAJjB;AAKE,MAAA,WAAW,EAAC,4BALd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFF,eASE;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAQ,MAAA,SAAS,EAAC,wBAAlB;AAA2C,MAAA,OAAO,EAAE,KAAKf,gBAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAQ,MAAA,SAAS,EAAC,iBAAlB;AAAoC,MAAA,OAAO,EAAE,KAAKiB,kBAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAFF,CATF,CADF,CAtOqC;;AAAA,SAwPvCe,WAxPuC,GAwPzB,mBACZ;AAAK,MAAA,SAAS,EAAC,uBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAI,MAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BADF,eAEE;AAAK,MAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAO,MAAA,SAAS,EAAC,kCAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAO,MAAA,SAAS,EAAC,aAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eALF,eAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cANF,eAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAPF,CADF,CADF,eAYE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACT,KAAKnF,KAAL,CAAWC,SAAX,CAAqBY,GAArB,CAAyB8B,CAAC,IAAI;AAC7B,UAAIyC,WAAW,GAAG,iBAAlB;AACA,UAAIzC,CAAC,CAACC,MAAF,KAAa,UAAjB,EAA6BwC,WAAW,GAAG,eAAd,CAA7B,KACK,IAAIzC,CAAC,CAACC,MAAF,KAAa,SAAjB,EAA4BwC,WAAW,GAAG,eAAd,CAA5B,KACA,IAAIzC,CAAC,CAACC,MAAF,KAAa,WAAjB,EAA8BwC,WAAW,GAAG,cAAd,CAA9B,KACA,IAAIzC,CAAC,CAACC,MAAF,KAAa,SAAb,IAA0BD,CAAC,CAACC,MAAF,KAAa,SAA3C,EAAsDwC,WAAW,GAAG,YAAd;AAE3D,YAAMC,MAAM,GAAG1C,CAAC,CAAC1B,MAAF,KAAa,QAAb,GAAyB0B,CAAC,CAAC8B,SAAF,IAAe,GAAxC,GAAgD9B,CAAC,CAAC6B,WAAF,IAAiB,GAAhF;AACA,YAAMc,IAAI,GAAG3C,CAAC,CAAC1B,MAAF,KAAa,QAAb,GAAyB0B,CAAC,CAACT,WAAF,IAAiB,GAA1C,GAAkDS,CAAC,CAACV,aAAF,IAAmB,GAAlF;AACA,YAAMqB,KAAK,GAAGX,CAAC,CAAC1B,MAAF,KAAa,QAAb,GAAyB0B,CAAC,CAAC4C,YAAF,IAAkB5C,CAAC,CAAC6C,MAApB,IAA8B,GAAvD,GAA+D7C,CAAC,CAAC8C,SAAF,IAAe9C,CAAC,CAAC6C,MAAjB,IAA2B,GAAxG;AAEA,0BACE;AAAI,QAAA,GAAG,EAAG,GAAE7C,CAAC,CAAC1B,MAAO,IAAG0B,CAAC,CAAC5B,EAAG,EAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAQ,QAAA,SAAS,EAAC,kBAAlB;AAAqC,QAAA,OAAO,EAAE,MAAM,KAAKgC,WAAL,CAAiBJ,CAAjB,CAApD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA0E0C,MAA1E,CADF,CADF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAK1C,CAAC,CAAC+C,eAAF,IAAqB,GAA1B,CAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAK/C,CAAC,CAAC+B,QAAF,IAAc,GAAnB,CALF,eAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKY,IAAL,CANF,eAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKhC,KAAL,CAPF,eAQE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKX,CAAC,CAAC1B,MAAF,KAAa,QAAb,GAAwB,gBAAxB,GAA2C,kBAAhD,CARF,eASE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,SAAS,EAAG,SAAQmE,WAAY,EAAvC;AAA0C,QAAA,KAAK,EAAE;AAAEO,UAAAA,QAAQ,EAAE;AAAZ,SAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAwEhD,CAAC,CAACC,MAAF,IAAY,KAApF,CADF,CATF,CADF;AAeD,KA1BA,CADS,CAZF,CADF,CAFF,CADF,CAzPqC;;AAAA,SA6SvCgD,aA7SuC,GA6SvB,MAAM;AACpB,YAAMjD,CAAC,GAAG,KAAK3C,KAAL,CAAWE,QAArB;AACA,UAAI,CAACyC,CAAL,EAAQ,OAAO,IAAP;AACR,YAAM0C,MAAM,GAAG1C,CAAC,CAAC1B,MAAF,KAAa,QAAb,GAAyB0B,CAAC,CAAC8B,SAAF,IAAe,GAAxC,GAAgD9B,CAAC,CAAC6B,WAAF,IAAiB,GAAhF;AACA,YAAMc,IAAI,GAAG3C,CAAC,CAAC1B,MAAF,KAAa,QAAb,GAAyB0B,CAAC,CAACT,WAAF,IAAiB,GAA1C,GAAkDS,CAAC,CAACV,aAAF,IAAmB,GAAlF;AACA,YAAMqB,KAAK,GAAGX,CAAC,CAAC1B,MAAF,KAAa,QAAb,GAAyB0B,CAAC,CAAC4C,YAAF,IAAkB,GAA3C,GAAmD5C,CAAC,CAAC8C,SAAF,IAAe,GAAhF;AAEA,0BACE;AAAK,QAAA,SAAS,EAAC,wDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAI,QAAA,SAAS,EAAC,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAmDJ,MAAnD,CADF,eAEE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAA1B,OAAyC1C,CAAC,CAAC+C,eAAF,IAAqB,GAA9D,CADF,eAEE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAA1B,OAA4C/C,CAAC,CAAC+B,QAAF,IAAc,GAA1D,CAFF,eAGE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAA1B,OAAwCY,IAAxC,CAHF,CAFF,eAOE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAA1B,OAAyChC,KAAzC,CADF,eAEE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA1B,OAA0CX,CAAC,CAACC,MAA5C,CAFF,eAGE;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAA1B,OAAgDD,CAAC,CAACpC,WAAF,IAAiB,GAAjE,CAHF,CAPF,eAYE;AAAI,QAAA,SAAS,EAAC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAZF,eAaE;AAAO,QAAA,SAAS,EAAC,+BAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAO,QAAA,SAAS,EAAC,aAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBALF,CADF,CADF,eAUE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,CAACoC,CAAC,CAACgB,SAAF,IAAe,EAAhB,EAAoB9C,GAApB,CAAwB,CAACgF,EAAD,EAAKC,CAAL,kBACvB;AAAI,QAAA,GAAG,EAAEA,CAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKD,EAAE,CAACjB,QAAR,CADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKiB,EAAE,CAAChB,eAAR,CAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKgB,EAAE,CAACf,GAAR,CAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKe,EAAE,CAACb,SAAR,CAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKa,EAAE,CAACZ,SAAR,CALF,CADD,CADH,CAVF,CAbF,eAmCE;AAAK,QAAA,SAAS,EAAC,yBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,SAAS,EAAC,sBADZ;AAEE,QAAA,OAAO,EAAE,KAAKhC,eAFhB;AAGE,QAAA,QAAQ,EAAEN,CAAC,CAACC,MAAF,KAAa,SAHzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADF,eAQE;AACE,QAAA,SAAS,EAAC,mBADZ;AAEE,QAAA,OAAO,EAAE,KAAKI,YAFhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBARF,CAnCF,EAkDG,KAAKhD,KAAL,CAAWI,eAAX,IAA8B,KAAK8E,iBAAL,EAlDjC,CADF;AAsDD,KA1WsC;AAAA;;AAWzCa,EAAAA,iBAAiB,GAAG;AAClB,SAAKvF,gBAAL;AACD;;AAEDwF,EAAAA,oBAAoB,GAAG;AACrB,QAAI,KAAKvF,SAAT,EAAoB,KAAKA,SAAL;AACpB,QAAI,KAAKc,SAAT,EAAoB,KAAKA,SAAL;AACrB;;AA0VA0E,EAAAA,MAAM,GAAG;AACR,wBACE;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKjG,KAAL,CAAWK,YAAX,GACG,KAAKkE,cAAL,EADH,GAEG,KAAKvE,KAAL,CAAWE,QAAX,GACE,KAAK0F,aAAL,EADF,GAEE,KAAKT,WAAL,EALR,CADF;AASD;;AAtXwC;;AAyXzC,eAAepF,gBAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport { db } from '../../../../firebase';\r\nimport { collection, getDocs, updateDoc, doc,onSnapshot } from 'firebase/firestore';\r\nimport { serverTimestamp } from 'firebase/firestore';\r\n\r\nclass BillingAmendment extends Component {\r\n  state = {\r\n    cobilling: [],\r\n    selected: null,\r\n    loading: false,\r\n    showAmendDialog: false,\r\n    showEditForm: false,\r\n    editFormData: null,\r\n    amendReason: \"\",\r\n  };\r\n\r\ncomponentDidMount() {\r\n  this.subscribeToBills();\r\n}\r\n\r\ncomponentWillUnmount() {\r\n  if (this._unsubCob) this._unsubCob();\r\n  if (this._unsubInv) this._unsubInv();\r\n}\r\n\r\nsubscribeToBills = () => {\r\n  // cobilling listener\r\n  this._unsubCob = onSnapshot(collection(db, 'cobilling'), snap => {\r\n    const cobData = snap.docs.map(d => ({ id: d.id, ...d.data(), source: 'cob' }));\r\n    this._latestCob = cobData;\r\n    this.mergeAndSet();\r\n  }, err => {\r\n    console.error('cob snapshot error', err);\r\n  });\r\n\r\n  // invoices listener\r\n  this._unsubInv = onSnapshot(collection(db, 'invoices'), snap => {\r\n    const invData = snap.docs.map(d => ({ id: d.id, ...d.data(), source: 'direct' }));\r\n    this._latestInv = invData;\r\n    this.mergeAndSet();\r\n  }, err => {\r\n    console.error('inv snapshot error', err);\r\n  });\r\n};\r\n\r\nmergeAndSet = () => {\r\n  const cob = this._latestCob || [];\r\n  const inv = this._latestInv || [];\r\n  const merged = [...cob, ...inv].sort((a,b) => {\r\n    const da = a.cobillingDate || a.invoiceDate || '';\r\n    const db_ = b.cobillingDate || b.invoiceDate || '';\r\n    return db_.localeCompare(da);\r\n  });\r\n  this.setState({ cobilling: merged });\r\n};\r\n\r\n  fetchBills = async () => {\r\n    try {\r\n      // fetch cobilling\r\n      const snapCOB = await getDocs(collection(db, 'cobilling'));\r\n      const cobData = snapCOB.docs.map(d => ({ id: d.id, ...d.data(), source: 'cob' }));\r\n      // fetch direct invoices\r\n      const snapINV = await getDocs(collection(db, 'invoices'));\r\n      const invData = snapINV.docs.map(d => ({ id: d.id, ...d.data(), source: 'direct' }));\r\n      // choose amendable bills: we'll consider Approved bills (same flow as approval)\r\n      const amendable = [...cobData, ...invData].filter(c => c.status === 'Approved');\r\n      this.setState({ cobilling: amendable });\r\n    } catch (err) {\r\n      console.error('fetchBills error', err);\r\n      alert('Error fetching bills: ' + err.message);\r\n    }\r\n  };\r\n\r\n  openPreview = (cob) => {\r\n    this.setState({ selected: cob });\r\n  };\r\n\r\n  closePreview = () => {\r\n    this.setState({ selected: null, showAmendDialog: false, amendReason: \"\" });\r\n  };\r\n\r\n  openAmendDialog = () => {\r\n  this.setState({ showEditForm: true, editFormData: { ...this.state.selected } });\r\n};\r\n  closeEditForm = () => {\r\n    this.setState({ showEditForm: false, editFormData: null });\r\n  };\r\n  closeAmendDialog = () => {\r\n    this.setState({ showAmendDialog: false, amendReason: \"\" });\r\n  };\r\n  handleEditInputChange = (field, value) => {\r\n  this.setState(prev => ({\r\n    editFormData: { ...prev.editFormData, [field]: value }\r\n  }));\r\n};\r\n\r\nhandleEditLineItemChange = (idx, field, value) => {\r\n  const items = [...this.state.editFormData.lineItems];\r\n  items[idx] = { ...items[idx], [field]: value };\r\n  this.setState(prev => ({\r\n    editFormData: { ...prev.editFormData, lineItems: items }\r\n  }));\r\n};\r\n\r\nhandleEditSave = async (e) => {\r\n  e.preventDefault();\r\n  const { editFormData } = this.state;\r\n  const collectionName = editFormData.source === 'direct' ? 'invoices' : 'cobilling';\r\n  try {\r\n    await updateDoc(doc(db, collectionName, editFormData.id), {\r\n      ...editFormData,\r\n      status: 'Amended',\r\n      amendedAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    alert('Bill Amended.');\r\n    this.setState({ showEditForm: false, editFormData: null, selected: null });\r\n    this.fetchBills && this.fetchBills();\r\n  } catch (err) {\r\n    alert('Error amending: ' + err.message);\r\n  }\r\n};\r\n\r\n  handleAmendReasonChange = (e) => {\r\n    this.setState({ amendReason: e.target.value });\r\n  };\r\n\r\n  handleAmendConfirm = async () => {\r\n    const { selected, amendReason } = this.state;\r\n    if (!amendReason.trim()) {\r\n      alert(\"Please enter a reason for amendment.\");\r\n      return;\r\n    }\r\n    try {\r\n      const collectionName = selected.source === 'direct' ? 'invoices' : 'cobilling';\r\n      const ref = doc(db, collectionName, selected.id);\r\n      await updateDoc(ref, {\r\n        status: 'Amended',\r\n        amendedAt: serverTimestamp(),\r\n        amendReason,\r\n        updatedAt: serverTimestamp()\r\n      });\r\n\r\n      alert('Bill Amended.');\r\n      await this.fetchBills();\r\n      this.closePreview();\r\n    } catch (err) {\r\n      console.error('handleAmendConfirm error', err);\r\n      alert('Error amending: ' + err.message);\r\n    }\r\n  };\r\n  renderEditForm = () => {\r\n  const { editFormData } = this.state;\r\n  if (!editFormData) return null;\r\n  return (\r\n    <div className=\"card mt-4 p-4 shadow-sm full-height d-flex flex-column\">\r\n      <h4>Edit Bill - {editFormData.cobillingNo || editFormData.invoiceNo}</h4>\r\n      <form onSubmit={this.handleEditSave}>\r\n        <div className=\"form-row\">\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Customer</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={editFormData.customer}\r\n              onChange={e => this.handleEditInputChange(\"customer\", e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Date</label>\r\n            <input\r\n              type=\"date\"\r\n              className=\"form-control\"\r\n              value={editFormData.cobillingDate || editFormData.invoiceDate}\r\n              onChange={e => this.handleEditInputChange(editFormData.cobillingDate ? \"cobillingDate\" : \"invoiceDate\", e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"form-group col-md-3\">\r\n            <label>Status</label>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={editFormData.status}\r\n              readOnly\r\n            />\r\n          </div>\r\n        </div>\r\n        <h5 className=\"mt-3\">Line Items</h5>\r\n        <table className=\"table table-bordered table-sm\">\r\n          <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Item Code</th>\r\n              <th>Description</th>\r\n              <th>Qty</th>\r\n              <th>Unit Price</th>\r\n              <th>Item Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {editFormData.lineItems?.map((item, idx) => (\r\n              <tr key={idx}>\r\n                <td>{item.itemCode}</td>\r\n                <td>{item.itemDescription}</td>\r\n                <td>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={item.qty}\r\n                    onChange={e => this.handleEditLineItemChange(idx, \"qty\", e.target.value)}\r\n                    style={{ width: 80 }}\r\n                  />\r\n                </td>\r\n                <td>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={item.unitPrice}\r\n                    onChange={e => this.handleEditLineItemChange(idx, \"unitPrice\", e.target.value)}\r\n                    style={{ width: 80 }}\r\n                  />\r\n                </td>\r\n                <td>{item.itemTotal}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        <div className=\"mt-3 text-right\">\r\n          <button type=\"submit\" className=\"btn btn-success mr-2\">Save</button>\r\n          <button type=\"button\" className=\"btn btn-secondary\" onClick={this.closeEditForm}>Cancel</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n  renderAmendDialog = () => (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\" style={{ width: 420 }}>\r\n        <h5>Amend Reason</h5>\r\n        <textarea\r\n          className=\"form-control\"\r\n          rows={4}\r\n          value={this.state.amendReason}\r\n          onChange={this.handleAmendReasonChange}\r\n          placeholder=\"Enter reason for amendment\"\r\n        />\r\n        <div className=\"text-right mt-3\">\r\n          <button className=\"btn btn-secondary mr-2\" onClick={this.closeAmendDialog}>Cancel</button>\r\n          <button className=\"btn btn-warning\" onClick={this.handleAmendConfirm}>Amend</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderTable = () => (\r\n    <div className=\"card mt-4 full-height\">\r\n      <div className=\"card-body\">\r\n        <h4 className=\"card-title\">Billing Amendment</h4>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr>\r\n                <th>Bill No</th>\r\n                <th>Order</th>\r\n                <th>Customer</th>\r\n                <th>Date</th>\r\n                <th>Value</th>\r\n                <th>Type</th>\r\n                <th>Status</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n  {this.state.cobilling.map(c => {\r\n    let statusClass = \"badge-secondary\";\r\n    if (c.status === \"Approved\") statusClass = \"badge-success\";\r\n    else if (c.status === \"Amended\") statusClass = \"badge-warning\";\r\n    else if (c.status === \"Cancelled\") statusClass = \"badge-danger\";\r\n    else if (c.status === \"Entered\" || c.status === \"Pending\") statusClass = \"badge-info\";\r\n\r\n    const billNo = c.source === 'direct' ? (c.invoiceNo || '-') : (c.cobillingNo || '-');\r\n    const date = c.source === 'direct' ? (c.invoiceDate || '-') : (c.cobillingDate || '-');\r\n    const value = c.source === 'direct' ? (c.invoiceValue || c.amount || '-') : (c.billValue || c.amount || '-');\r\n\r\n    return (\r\n      <tr key={`${c.source}_${c.id}`}>\r\n        <td>\r\n          <button className=\"btn btn-link p-0\" onClick={() => this.openPreview(c)}>{billNo}</button>\r\n        </td>\r\n        <td>{c.customerOrderId || \"-\"}</td>\r\n        <td>{c.customer || \"-\"}</td>\r\n        <td>{date}</td>\r\n        <td>{value}</td>\r\n        <td>{c.source === 'direct' ? \"Direct Billing\" : \"Customer Billing\"}</td>\r\n        <td>\r\n          <label className={`badge ${statusClass}`} style={{ fontSize: '14px' }}>{c.status || 'N/A'}</label>\r\n        </td>\r\n      </tr>\r\n    );\r\n  })}\r\n</tbody>\r\n\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderPreview = () => {\r\n    const c = this.state.selected;\r\n    if (!c) return null;\r\n    const billNo = c.source === 'direct' ? (c.invoiceNo || '-') : (c.cobillingNo || '-');\r\n    const date = c.source === 'direct' ? (c.invoiceDate || '-') : (c.cobillingDate || '-');\r\n    const value = c.source === 'direct' ? (c.invoiceValue || '-') : (c.billValue || '-');\r\n\r\n    return (\r\n      <div className=\"card mt-4 p-4 shadow-sm full-height d-flex flex-column\">\r\n        <h4 className=\"card-title mb-0\">Billing Preview - {billNo}</h4>\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-md-4\"><b>Order:</b> {c.customerOrderId || \"-\"}</div>\r\n          <div className=\"col-md-4\"><b>Customer:</b> {c.customer || \"-\"}</div>\r\n          <div className=\"col-md-4\"><b>Date:</b> {date}</div>\r\n        </div>\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-md-4\"><b>Value:</b> {value}</div>\r\n          <div className=\"col-md-4\"><b>Status:</b> {c.status}</div>\r\n          <div className=\"col-md-4\"><b>Amend Reason:</b> {c.amendReason || \"-\"}</div>\r\n        </div>\r\n        <h5 className=\"mt-2\">Line Items</h5>\r\n        <table className=\"table table-bordered table-sm\">\r\n          <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Item Code</th>\r\n              <th>Description</th>\r\n              <th>Qty</th>\r\n              <th>Unit Price</th>\r\n              <th>Item Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {(c.lineItems || []).map((li, i) => (\r\n              <tr key={i}>\r\n                <td>{li.itemCode}</td>\r\n                <td>{li.itemDescription}</td>\r\n                <td>{li.qty}</td>\r\n                <td>{li.unitPrice}</td>\r\n                <td>{li.itemTotal}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        <div className=\"mt-auto pt-3 text-right\">\r\n          <button\r\n            className=\"btn btn-warning mr-2\"\r\n            onClick={this.openAmendDialog}\r\n            disabled={c.status === \"Amended\"}\r\n          >\r\n            Amend\r\n          </button>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={this.closePreview}\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n        {this.state.showAmendDialog && this.renderAmendDialog()}\r\n      </div>\r\n    );\r\n  };\r\n\r\n render() {\r\n  return (\r\n    <div className=\"container-fluid\">\r\n      {this.state.showEditForm\r\n        ? this.renderEditForm()\r\n        : this.state.selected\r\n          ? this.renderPreview()\r\n          : this.renderTable()}\r\n    </div>\r\n  );\r\n}\r\n}\r\n\r\nexport default BillingAmendment;\r\n"]},"metadata":{},"sourceType":"module"}