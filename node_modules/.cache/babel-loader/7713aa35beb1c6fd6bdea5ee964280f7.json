{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\College\\\\psp\\\\StarAdmin-Free-React-Admin-Template-master\\\\template\\\\demo_1\\\\src\\\\app\\\\sales\\\\salestransactions\\\\invoice\\\\BillingApproval.js\";\nimport React, { Component } from 'react';\nimport { db } from '../../../../firebase';\nimport { collection, getDocs, updateDoc, doc, onSnapshot } from 'firebase/firestore';\nimport { serverTimestamp } from 'firebase/firestore';\n\nclass BillingApproval extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      cobilling: [],\n      selected: null,\n      loading: false,\n      showRejectDialog: false,\n      rejectReason: \"\",\n      searchTerm: ''\n    };\n\n    this.subscribeToBills = () => {\n      // cobilling listener\n      this._unsubCob = onSnapshot(collection(db, 'cobilling'), snap => {\n        const cobData = snap.docs.map(d => ({\n          id: d.id,\n          ...d.data(),\n          source: 'cob'\n        }));\n        this._latestCob = cobData;\n        this.mergeAndSet();\n      }, err => {\n        console.error('cob snapshot error', err);\n      }); // invoices listener\n\n      this._unsubInv = onSnapshot(collection(db, 'invoices'), snap => {\n        const invData = snap.docs.map(d => ({\n          id: d.id,\n          ...d.data(),\n          source: 'direct'\n        }));\n        this._latestInv = invData;\n        this.mergeAndSet();\n      }, err => {\n        console.error('inv snapshot error', err);\n      });\n    };\n\n    this.mergeAndSet = () => {\n      const cob = this._latestCob || [];\n      const inv = this._latestInv || [];\n      const merged = [...cob, ...inv].sort((a, b) => {\n        const da = a.cobillingDate || a.invoiceDate || '';\n        const db_ = b.cobillingDate || b.invoiceDate || '';\n        return db_.localeCompare(da);\n      });\n      this.setState({\n        cobilling: merged\n      });\n    };\n\n    this.fetchAwaiting = async () => {\n      // 1. Fetch COB bills\n      const snapCOB = await getDocs(collection(db, 'cobilling'));\n      const cobData = snapCOB.docs.map(d => ({\n        id: d.id,\n        ...d.data(),\n        source: 'cob'\n      }));\n      const cobAwaiting = cobData.filter(c => c.status === 'Awaiting Approval'); // 2. Fetch Direct Billing invoices\n\n      const snapINV = await getDocs(collection(db, 'invoices'));\n      const invData = snapINV.docs.map(d => ({\n        id: d.id,\n        ...d.data(),\n        source: 'direct'\n      }));\n      const invAwaiting = invData.filter(inv => inv.status === 'Awaiting Approval'); // 3. Merge\n\n      this.setState({\n        cobilling: [...cobAwaiting, ...invAwaiting]\n      });\n    };\n\n    this.openPreview = cob => {\n      this.setState({\n        selected: cob\n      });\n    };\n\n    this.closePreview = () => {\n      this.setState({\n        selected: null,\n        showRejectDialog: false,\n        rejectReason: \"\"\n      });\n    };\n\n    this.approve = async cob => {\n      if (!window.confirm(`Approve ${cob.cobillingNo}?`)) return;\n      this.setState({\n        loading: true\n      });\n\n      try {\n        const ref = doc(db, cob.source === 'direct' ? 'invoices' : 'cobilling', cob.id);\n        await updateDoc(ref, {\n          status: 'Approved',\n          approvedAt: serverTimestamp(),\n          updatedAt: serverTimestamp()\n        }); // update order recvQty if needed (same as before)\n\n        if (cob.customerOrderId) {\n          const ordersSnap = await getDocs(collection(db, 'orders'));\n          const orderDoc = ordersSnap.docs.find(d => (d.data().orderNo || '') === (cob.customerOrderId || ''));\n\n          if (orderDoc) {\n            const orderId = orderDoc.id;\n            const orderData = orderDoc.data();\n            const updatedLineItems = (orderData.lineItems || []).map(oli => {\n              const match = (cob.lineItems || []).find(ci => ci.itemCode === oli.itemCode);\n\n              if (match) {\n                const incomingQty = parseFloat(match.qty || 0) || 0;\n                const prevRecv = parseFloat(oli.recvQty || 0) || 0;\n                oli.recvQty = Math.max(0, prevRecv + incomingQty);\n                oli.remainingQty = Math.max(0, parseFloat(oli.qty || oli.orderQty || 0) - oli.recvQty);\n              }\n\n              return oli;\n            });\n            let anyRecv = updatedLineItems.some(li => parseFloat(li.recvQty || 0) > 0);\n            let allDone = updatedLineItems.every(li => parseFloat(li.qty || li.orderQty || 0) <= parseFloat(li.recvQty || 0));\n            const newOrderStatus = allDone ? 'Completed' : anyRecv ? 'Partial' : orderData.status || 'Entered';\n            await updateDoc(doc(db, 'orders', orderId), {\n              lineItems: updatedLineItems,\n              status: newOrderStatus,\n              updatedAt: serverTimestamp()\n            });\n          }\n        }\n\n        alert('Approved.');\n        this.fetchAwaiting();\n        this.closePreview();\n      } catch (err) {\n        console.error(err);\n        alert('Error approving: ' + err.message);\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this.openRejectDialog = () => {\n      this.setState({\n        showRejectDialog: true,\n        rejectReason: \"\"\n      });\n    };\n\n    this.closeRejectDialog = () => {\n      this.setState({\n        showRejectDialog: false,\n        rejectReason: \"\"\n      });\n    };\n\n    this.handleRejectReasonChange = e => {\n      this.setState({\n        rejectReason: e.target.value\n      });\n    };\n\n    this.handleRejectConfirm = async () => {\n      const {\n        selected,\n        rejectReason\n      } = this.state;\n\n      if (!rejectReason.trim()) {\n        alert(\"Please enter a reason for rejection.\");\n        return;\n      }\n\n      try {\n        const ref = doc(db, selected.source === 'direct' ? 'invoices' : 'cobilling', selected.id);\n        await updateDoc(ref, {\n          status: 'Rejected',\n          rejectedAt: serverTimestamp(),\n          rejectReason,\n          updatedAt: serverTimestamp()\n        });\n        alert('Rejected.');\n        this.fetchAwaiting();\n        this.closePreview();\n      } catch (err) {\n        alert(err.message);\n      }\n    };\n\n    this.renderRejectDialog = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"custom-overlay-content\",\n      style: {\n        width: 400\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h5\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }\n    }, \"Reject Reason\"), /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"form-control\",\n      rows: 3,\n      value: this.state.rejectReason,\n      onChange: this.handleRejectReasonChange,\n      placeholder: \"Enter reason for rejection\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"text-right mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-secondary mr-2\",\n      onClick: this.closeRejectDialog,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 11\n      }\n    }, \"Cancel\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-danger\",\n      onClick: this.handleRejectConfirm,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 11\n      }\n    }, \"Reject\"))));\n\n    this.renderTable = () => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card mt-4 full-height\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"card-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }\n    }, \"Billing Approval\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      className: \"form-control\",\n      placeholder: \"Search by Bill No, Customer, Status, Date...\",\n      value: this.state.searchTerm,\n      onChange: e => this.setState({\n        searchTerm: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"table-responsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      className: \"table table-bordered table-hover\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      className: \"thead-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }\n    }, \"Bill No\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }\n    }, \"Order\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 17\n      }\n    }, \"Customer\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 17\n      }\n    }, \"Date\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 17\n      }\n    }, \"Value\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 17\n      }\n    }, \"Type\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 17\n      }\n    }, \"Status\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 12\n      }\n    }, this.state.cobilling.filter(c => {\n      const term = this.state.searchTerm.toLowerCase();\n      if (!term) return true;\n      const billNo = (c.source === 'direct' ? c.invoiceNo || '-' : c.cobillingNo || '-').toString().toLowerCase();\n      const date = (c.source === 'direct' ? c.invoiceDate || '-' : c.cobillingDate || '-').toString().toLowerCase();\n      const value = (c.source === 'direct' ? c.invoiceValue || c.amount || '-' : c.billValue || c.amount || '-').toString().toLowerCase();\n      const customer = (c.customer || \"-\").toLowerCase();\n      const status = (c.status || \"-\").toLowerCase();\n      const type = (c.source === 'direct' ? \"Direct Billing\" : \"Customer Billing\").toLowerCase();\n      return billNo.includes(term) || date.includes(term) || value.includes(term) || customer.includes(term) || status.includes(term) || type.includes(term);\n    }).map(c => {\n      let statusClass = \"badge-secondary\";\n      if (c.status === \"Approved\") statusClass = \"badge-success\";else if (c.status === \"Amended\") statusClass = \"badge-info\";else if (c.status === \"Cancelled\") statusClass = \"badge-danger\";else if (c.status === \"Awaiting Approval\" || c.status === \"Pending\") statusClass = \"badge-warning\";\n      const billNo = c.source === 'direct' ? c.invoiceNo || '-' : c.cobillingNo || '-';\n      const date = c.source === 'direct' ? c.invoiceDate || '-' : c.cobillingDate || '-';\n      const value = c.source === 'direct' ? c.invoiceValue || c.amount || '-' : c.billValue || c.amount || '-';\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: `${c.source}_${c.id}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-link p-0\",\n        onClick: () => this.openPreview(c),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 13\n        }\n      }, billNo)), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 11\n        }\n      }, c.customerOrderId || \"-\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }\n      }, c.customer || \"-\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 11\n        }\n      }, date), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }\n      }, value), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 11\n        }\n      }, c.source === 'direct' ? \"Direct Billing\" : \"Customer Billing\"), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        className: `badge ${statusClass}`,\n        style: {\n          fontSize: '14px'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 13\n        }\n      }, c.status || 'N/A')));\n    }), this.state.cobilling.length === 0 && /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      colSpan: \"7\",\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 7\n      }\n    }, \"No billing found.\")))))));\n\n    this.renderPreview = () => {\n      const c = this.state.selected;\n      if (!c) return null;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card mt-4 p-4 shadow-sm full-height d-flex flex-column\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        className: \"card-title mb-0\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 9\n        }\n      }, \"Billing Preview - \", c.cobillingNo), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 37\n        }\n      }, \"Order:\"), \" \", c.customerOrderId), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 37\n        }\n      }, \"Customer:\"), \" \", c.customer), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 37\n        }\n      }, \"Date:\"), \" \", c.cobillingDate)), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 37\n        }\n      }, \"Value:\"), \" \", c.billValue), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 37\n        }\n      }, \"Status:\"), \" \", c.status), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-4\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 37\n        }\n      }, \"Reject Reason:\"), \" \", c.rejectReason || \"-\")), /*#__PURE__*/React.createElement(\"h5\", {\n        className: \"mt-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 9\n        }\n      }, \"Line Items\"), /*#__PURE__*/React.createElement(\"table\", {\n        className: \"table table-bordered table-sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"thead\", {\n        className: \"thead-light\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 15\n        }\n      }, \"Item Code\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 15\n        }\n      }, \"Description\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 15\n        }\n      }, \"Qty\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 15\n        }\n      }, \"Unit Price\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 15\n        }\n      }, \"Item Total\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 11\n        }\n      }, (c.lineItems || []).map((li, i) => /*#__PURE__*/React.createElement(\"tr\", {\n        key: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 17\n        }\n      }, li.itemCode), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 17\n        }\n      }, li.itemDescription), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 17\n        }\n      }, li.qty), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 17\n        }\n      }, li.unitPrice), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 17\n        }\n      }, li.itemTotal))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mt-auto pt-3 text-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-success mr-2\",\n        onClick: () => this.approve(c),\n        disabled: c.status === \"Approved\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 11\n        }\n      }, \"Approve\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-danger mr-2\",\n        onClick: this.openRejectDialog,\n        disabled: c.status === \"Rejected\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 11\n        }\n      }, \"Reject\"), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn btn-secondary\",\n        onClick: this.closePreview,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 11\n        }\n      }, \"Back to List\")), this.state.showRejectDialog && this.renderRejectDialog());\n    };\n  }\n\n  componentDidMount() {\n    this.subscribeToBills();\n  }\n\n  componentWillUnmount() {\n    if (this._unsubCob) this._unsubCob();\n    if (this._unsubInv) this._unsubInv();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 7\n      }\n    }, this.state.selected ? this.renderPreview() : this.renderTable());\n  }\n\n}\n\nexport default BillingApproval;","map":{"version":3,"sources":["C:/Users/College/psp/StarAdmin-Free-React-Admin-Template-master/template/demo_1/src/app/sales/salestransactions/invoice/BillingApproval.js"],"names":["React","Component","db","collection","getDocs","updateDoc","doc","onSnapshot","serverTimestamp","BillingApproval","state","cobilling","selected","loading","showRejectDialog","rejectReason","searchTerm","subscribeToBills","_unsubCob","snap","cobData","docs","map","d","id","data","source","_latestCob","mergeAndSet","err","console","error","_unsubInv","invData","_latestInv","cob","inv","merged","sort","a","b","da","cobillingDate","invoiceDate","db_","localeCompare","setState","fetchAwaiting","snapCOB","cobAwaiting","filter","c","status","snapINV","invAwaiting","openPreview","closePreview","approve","window","confirm","cobillingNo","ref","approvedAt","updatedAt","customerOrderId","ordersSnap","orderDoc","find","orderNo","orderId","orderData","updatedLineItems","lineItems","oli","match","ci","itemCode","incomingQty","parseFloat","qty","prevRecv","recvQty","Math","max","remainingQty","orderQty","anyRecv","some","li","allDone","every","newOrderStatus","alert","message","openRejectDialog","closeRejectDialog","handleRejectReasonChange","e","target","value","handleRejectConfirm","trim","rejectedAt","renderRejectDialog","width","renderTable","term","toLowerCase","billNo","invoiceNo","toString","date","invoiceValue","amount","billValue","customer","type","includes","statusClass","fontSize","length","renderPreview","i","itemDescription","unitPrice","itemTotal","componentDidMount","componentWillUnmount","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { db } from '../../../../firebase';\r\nimport { collection, getDocs, updateDoc, doc ,onSnapshot} from 'firebase/firestore';\r\nimport { serverTimestamp } from 'firebase/firestore';\r\n\r\nclass BillingApproval extends Component {\r\n  state = {\r\n    cobilling: [],\r\n    selected: null,\r\n    loading: false,\r\n    showRejectDialog: false,\r\n    rejectReason: \"\",\r\n    searchTerm:'',\r\n  };\r\n\r\n  componentDidMount() { \r\n  this.subscribeToBills();\r\n\r\n }\r\n\r\ncomponentWillUnmount() {\r\n  if (this._unsubCob) this._unsubCob();\r\n  if (this._unsubInv) this._unsubInv();\r\n}\r\n\r\nsubscribeToBills = () => {\r\n  // cobilling listener\r\n  this._unsubCob = onSnapshot(collection(db, 'cobilling'), snap => {\r\n    const cobData = snap.docs.map(d => ({ id: d.id, ...d.data(), source: 'cob' }));\r\n    this._latestCob = cobData;\r\n    this.mergeAndSet();\r\n  }, err => {\r\n    console.error('cob snapshot error', err);\r\n  });\r\n\r\n  // invoices listener\r\n  this._unsubInv = onSnapshot(collection(db, 'invoices'), snap => {\r\n    const invData = snap.docs.map(d => ({ id: d.id, ...d.data(), source: 'direct' }));\r\n    this._latestInv = invData;\r\n    this.mergeAndSet();\r\n  }, err => {\r\n    console.error('inv snapshot error', err);\r\n  });\r\n};\r\n\r\nmergeAndSet = () => {\r\n  const cob = this._latestCob || [];\r\n  const inv = this._latestInv || [];\r\n  const merged = [...cob, ...inv].sort((a,b) => {\r\n    const da = a.cobillingDate || a.invoiceDate || '';\r\n    const db_ = b.cobillingDate || b.invoiceDate || '';\r\n    return db_.localeCompare(da);\r\n  });\r\n  this.setState({ cobilling: merged });\r\n};\r\n\r\n fetchAwaiting = async () => {\r\n  // 1. Fetch COB bills\r\n  const snapCOB = await getDocs(collection(db, 'cobilling'));\r\n  const cobData = snapCOB.docs.map(d => ({ id: d.id, ...d.data(), source: 'cob' }));\r\n  const cobAwaiting = cobData.filter(c => c.status === 'Awaiting Approval');\r\n\r\n  // 2. Fetch Direct Billing invoices\r\n  const snapINV = await getDocs(collection(db, 'invoices'));\r\n  const invData = snapINV.docs.map(d => ({ id: d.id, ...d.data(), source: 'direct' }));\r\n  const invAwaiting = invData.filter(inv => inv.status === 'Awaiting Approval');\r\n\r\n  // 3. Merge\r\n  this.setState({ cobilling: [...cobAwaiting, ...invAwaiting] });\r\n};\r\n\r\n\r\n  openPreview = (cob) => {\r\n    this.setState({ selected: cob });\r\n  };\r\n\r\n  closePreview = () => {\r\n    this.setState({ selected: null, showRejectDialog: false, rejectReason: \"\" });\r\n  };\r\n\r\n  approve = async (cob) => {\r\n    if (!window.confirm(`Approve ${cob.cobillingNo}?`)) return;\r\n    this.setState({ loading: true });\r\n    try {\r\n      const ref = doc(db, cob.source === 'direct' ? 'invoices' : 'cobilling', cob.id);\r\n      await updateDoc(ref, {\r\n        status: 'Approved',\r\n        approvedAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp()\r\n      });\r\n\r\n      // update order recvQty if needed (same as before)\r\n      if (cob.customerOrderId) {\r\n        const ordersSnap = await getDocs(collection(db, 'orders'));\r\n        const orderDoc = ordersSnap.docs.find(d => (d.data().orderNo || '') === (cob.customerOrderId || ''));\r\n        if (orderDoc) {\r\n          const orderId = orderDoc.id;\r\n          const orderData = orderDoc.data();\r\n          const updatedLineItems = (orderData.lineItems || []).map(oli => {\r\n            const match = (cob.lineItems || []).find(ci => ci.itemCode === oli.itemCode);\r\n            if (match) {\r\n              const incomingQty = parseFloat(match.qty || 0) || 0;\r\n              const prevRecv = parseFloat(oli.recvQty || 0) || 0;\r\n              oli.recvQty = Math.max(0, (prevRecv + incomingQty));\r\n              oli.remainingQty = Math.max(0, (parseFloat(oli.qty || oli.orderQty || 0) - oli.recvQty));\r\n            }\r\n            return oli;\r\n          });\r\n          let anyRecv = updatedLineItems.some(li => (parseFloat(li.recvQty || 0) > 0));\r\n          let allDone = updatedLineItems.every(li => (parseFloat(li.qty || li.orderQty || 0) <= (parseFloat(li.recvQty || 0))));\r\n          const newOrderStatus = allDone ? 'Completed' : (anyRecv ? 'Partial' : orderData.status || 'Entered');\r\n          await updateDoc(doc(db, 'orders', orderId), {\r\n            lineItems: updatedLineItems,\r\n            status: newOrderStatus,\r\n            updatedAt: serverTimestamp()\r\n          });\r\n        }\r\n      }\r\n      alert('Approved.');\r\n      this.fetchAwaiting();\r\n      this.closePreview();\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Error approving: ' + err.message);\r\n    } finally {\r\n      this.setState({ loading: false });\r\n    }\r\n  };\r\n\r\n  openRejectDialog = () => {\r\n    this.setState({ showRejectDialog: true, rejectReason: \"\" });\r\n  };\r\n\r\n  closeRejectDialog = () => {\r\n    this.setState({ showRejectDialog: false, rejectReason: \"\" });\r\n  };\r\n\r\n  handleRejectReasonChange = (e) => {\r\n    this.setState({ rejectReason: e.target.value });\r\n  };\r\n\r\n  handleRejectConfirm = async () => {\r\n  const { selected, rejectReason } = this.state;\r\n  if (!rejectReason.trim()) {\r\n    alert(\"Please enter a reason for rejection.\");\r\n    return;\r\n  }\r\n  try {\r\n    const ref = doc(db, selected.source === 'direct' ? 'invoices' : 'cobilling', selected.id);\r\n    await updateDoc(ref, {\r\n      status: 'Rejected',\r\n      rejectedAt: serverTimestamp(),\r\n      rejectReason,\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    alert('Rejected.');\r\n    this.fetchAwaiting();\r\n    this.closePreview();\r\n  } catch (err) {\r\n    alert(err.message);\r\n  }\r\n};\r\n\r\n\r\n  renderRejectDialog = () => (\r\n    <div className=\"custom-overlay\">\r\n      <div className=\"custom-overlay-content\" style={{ width: 400 }}>\r\n        <h5>Reject Reason</h5>\r\n        <textarea\r\n          className=\"form-control\"\r\n          rows={3}\r\n          value={this.state.rejectReason}\r\n          onChange={this.handleRejectReasonChange}\r\n          placeholder=\"Enter reason for rejection\"\r\n        />\r\n        <div className=\"text-right mt-3\">\r\n          <button className=\"btn btn-secondary mr-2\" onClick={this.closeRejectDialog}>Cancel</button>\r\n          <button className=\"btn btn-danger\" onClick={this.handleRejectConfirm}>Reject</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderTable = () => (\r\n    <div className=\"card mt-4 full-height\">\r\n      <div className=\"card-body\">\r\n        <h4 className=\"card-title\">Billing Approval</h4>\r\n        <div className=\"mb-3\">\r\n                <input\r\n    type=\"text\"\r\n    className=\"form-control\"\r\n    placeholder=\"Search by Bill No, Customer, Status, Date...\"\r\n    value={this.state.searchTerm}\r\n    onChange={(e) => this.setState({ searchTerm: e.target.value })}\r\n  />\r\n</div>\r\n\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-bordered table-hover\">\r\n            <thead className=\"thead-light\">\r\n              <tr>\r\n                <th>Bill No</th>\r\n                <th>Order</th>\r\n                <th>Customer</th>\r\n                <th>Date</th>\r\n                <th>Value</th>\r\n                <th>Type</th>\r\n                <th>Status</th>\r\n              </tr>\r\n            </thead>\r\n           <tbody>\r\n  {this.state.cobilling\r\n    .filter(c => {\r\n      const term = this.state.searchTerm.toLowerCase();\r\n      if (!term) return true;\r\n\r\n      const billNo = (c.source === 'direct' ? (c.invoiceNo || '-') : (c.cobillingNo || '-')).toString().toLowerCase();\r\n      const date = (c.source === 'direct' ? (c.invoiceDate || '-') : (c.cobillingDate || '-')).toString().toLowerCase();\r\n      const value = (c.source === 'direct' ? (c.invoiceValue || c.amount || '-') : (c.billValue || c.amount || '-')).toString().toLowerCase();\r\n      const customer = (c.customer || \"-\").toLowerCase();\r\n      const status = (c.status || \"-\").toLowerCase();\r\n      const type = (c.source === 'direct' ? \"Direct Billing\" : \"Customer Billing\").toLowerCase();\r\n\r\n      return (\r\n        billNo.includes(term) ||\r\n        date.includes(term) ||\r\n        value.includes(term) ||\r\n        customer.includes(term) ||\r\n        status.includes(term) ||\r\n        type.includes(term)\r\n      );\r\n    })\r\n    .map(c => {\r\n      let statusClass = \"badge-secondary\";\r\n      if (c.status === \"Approved\") statusClass = \"badge-success\";\r\n      else if (c.status === \"Amended\") statusClass = \"badge-info\";\r\n      else if (c.status === \"Cancelled\") statusClass = \"badge-danger\";\r\n      else if (c.status === \"Awaiting Approval\" || c.status === \"Pending\") statusClass = \"badge-warning\";\r\n\r\n      const billNo = c.source === 'direct' ? (c.invoiceNo || '-') : (c.cobillingNo || '-');\r\n      const date = c.source === 'direct' ? (c.invoiceDate || '-') : (c.cobillingDate || '-');\r\n      const value = c.source === 'direct' ? (c.invoiceValue || c.amount || '-') : (c.billValue || c.amount || '-');\r\n\r\n      return (\r\n        <tr key={`${c.source}_${c.id}`}>\r\n          <td>\r\n            <button className=\"btn btn-link p-0\" onClick={() => this.openPreview(c)}>{billNo}</button>\r\n          </td>\r\n          <td>{c.customerOrderId || \"-\"}</td>\r\n          <td>{c.customer || \"-\"}</td>\r\n          <td>{date}</td>\r\n          <td>{value}</td>\r\n          <td>{c.source === 'direct' ? \"Direct Billing\" : \"Customer Billing\"}</td>\r\n          <td>\r\n            <label className={`badge ${statusClass}`} style={{ fontSize: '14px' }}>{c.status || 'N/A'}</label>\r\n          </td>\r\n        </tr>\r\n      );\r\n    })}\r\n  {this.state.cobilling.length === 0 && (\r\n    <tr>\r\n      <td colSpan=\"7\" className=\"text-center\">No billing found.</td>\r\n    </tr>\r\n  )}\r\n</tbody>\r\n\r\n\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  renderPreview = () => {\r\n    const c = this.state.selected;\r\n    if (!c) return null;\r\n    return (\r\n      <div className=\"card mt-4 p-4 shadow-sm full-height d-flex flex-column\">\r\n        <h4 className=\"card-title mb-0\">Billing Preview - {c.cobillingNo}</h4>\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-md-4\"><b>Order:</b> {c.customerOrderId}</div>\r\n          <div className=\"col-md-4\"><b>Customer:</b> {c.customer}</div>\r\n          <div className=\"col-md-4\"><b>Date:</b> {c.cobillingDate}</div>\r\n        </div>\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-md-4\"><b>Value:</b> {c.billValue}</div>\r\n          <div className=\"col-md-4\"><b>Status:</b> {c.status}</div>\r\n          <div className=\"col-md-4\"><b>Reject Reason:</b> {c.rejectReason || \"-\"}</div>\r\n        </div>\r\n        <h5 className=\"mt-2\">Line Items</h5>\r\n        <table className=\"table table-bordered table-sm\">\r\n          <thead className=\"thead-light\">\r\n            <tr>\r\n              <th>Item Code</th>\r\n              <th>Description</th>\r\n              <th>Qty</th>\r\n              <th>Unit Price</th>\r\n              <th>Item Total</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {(c.lineItems || []).map((li, i) => (\r\n              <tr key={i}>\r\n                <td>{li.itemCode}</td>\r\n                <td>{li.itemDescription}</td>\r\n                <td>{li.qty}</td>\r\n                <td>{li.unitPrice}</td>\r\n                <td>{li.itemTotal}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        <div className=\"mt-auto pt-3 text-right\">\r\n          <button\r\n            className=\"btn btn-success mr-2\"\r\n            onClick={() => this.approve(c)}\r\n            disabled={c.status === \"Approved\"}\r\n          >\r\n            Approve\r\n          </button>\r\n          <button\r\n            className=\"btn btn-danger mr-2\"\r\n            onClick={this.openRejectDialog}\r\n            disabled={c.status === \"Rejected\"}\r\n          >\r\n            Reject\r\n          </button>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={this.closePreview}\r\n          >\r\n            Back to List\r\n          </button>\r\n        </div>\r\n        {this.state.showRejectDialog && this.renderRejectDialog()}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        {this.state.selected\r\n          ? this.renderPreview()\r\n          : this.renderTable()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default BillingApproval;"]},"metadata":{},"sourceType":"module"}